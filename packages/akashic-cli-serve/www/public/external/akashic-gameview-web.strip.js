!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.agv=e()}}(function(){return function(){function e(t,r,i){function n(a,s){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[a]={exports:{}};t[a][0].call(d.exports,function(e){return n(t[a][1][e]||e)},d,d.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}return e}()({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./SharedObject"),n=e("./DomElement"),o=e("./Error"),a=function(){function e(e){this._contents={};this._nextContentId=1;this._hasOwnGameViewShared=!1;this.vars={};var t=new n.GameViewElement(e.container);if(e.sharedObject)this._gameViewShared=e.sharedObject;else{this._gameViewShared=new i.GameViewSharedObject({baseDownloader:e.baseDownloader,window:e.window,untrustedFrameUrl:e.untrustedFrameUrl,trustedChildOrigin:e.trustedChildOrigin});this._hasOwnGameViewShared=!0}this._gameContentShared=new i.GameContentSharedObject({gameViewElement:t,gameViewWidth:e.width,gameViewHeight:e.height});t.setViewSize(e.width,e.height)}e.prototype.addContent=function(e){if(null!=e.id)throw o.ErrorFactory.createInvalidOperationError("content already added: "+e.id);e.id=this._nextContentId++;e.start(this._gameViewShared,this._gameContentShared);this._contents[e.id+""]=e};e.prototype.removeContent=function(e){if(null==e.id)throw o.ErrorFactory.createInvalidOperationError("content already removed");e.destroy();delete this._contents[e.id+""];e.id=null};e.prototype.removeAllContents=function(){var e=this;Object.keys(this._contents).forEach(function(t){e.removeContent(e._contents[t])})};e.prototype.setSocketOptions=function(e){this._gameViewShared.sessionManager.setSocketOptions(e)};e.prototype.registerExternalPlugin=function(e){this._gameViewShared.pluginManager.register(e)};e.prototype.setViewSize=function(e,t){this._gameContentShared.viewWidth=e;this._gameContentShared.viewHeight=t;this._gameContentShared.gameViewElement.setViewSize(e,t)};e.prototype.getViewSize=function(){return{width:this._gameContentShared.viewWidth,height:this._gameContentShared.viewHeight}};e.prototype.getContentById=function(e){return this._contents[e+""]};e.prototype.getGameViewSharedObject=function(){return this._gameViewShared};e.prototype.destroy=function(){if(!this.destroyed()){this.removeAllContents();if(this._hasOwnGameViewShared){this._gameViewShared.destroyed()||this._gameViewShared.destroy();this._hasOwnGameViewShared=!1}this._gameViewShared=null;this._gameContentShared=null}};e.prototype.destroyed=function(){return null==this._gameViewShared};return e}();r.AkashicGameView=a},{"./DomElement":4,"./Error":6,"./SharedObject":11}],2:[function(e,t,r){"use strict";function i(e){var t=e.naturalWidth,r=e.naturalHeight;return{x:a(e,t),y:s(e,r),width:t,height:r}}function n(e){return{x:0,y:0,width:e.outerWidth,height:e.outerHeight}}function o(e){var t=e.outerWidth/e.naturalWidth,r=e.outerHeight/e.naturalHeight,i=Math.min(t,r),n=e.naturalWidth*i,o=e.naturalHeight*i;return{x:a(e,n),y:s(e,o),width:n,height:o}}function a(e,t){switch(e.horizontalAlignment){case l.HorizontalAlignment.Left:return 0;case l.HorizontalAlignment.Center:return(e.outerWidth-t)/2;case l.HorizontalAlignment.Right:return e.outerWidth-t;default:return 0}}function s(e,t){switch(e.verticalAlignment){case l.VerticalAlignment.Top:return 0;case l.VerticalAlignment.Center:return(e.outerHeight-t)/2;case l.VerticalAlignment.Bottom:return e.outerHeight-t;default:return 0}}Object.defineProperty(r,"__esModule",{value:!0});var l=e("@akashic/akashic-gameview");r.calcNoneLayout=i;r.calcFillLayout=n;r.calcAspectFitLayout=o},{"@akashic/akashic-gameview":27}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("@akashic/akashic-gameview"),n=e("./utils"),o=e("./Error"),a=function(){function e(e,t){this._gameContentShared=null;this._gameViewShared=null;this._contentLoadListeners=new n.ObjectList;this._errorListeners=new n.ObjectList;this._contentDestroyListeners=new n.ObjectList;this._contentArea=void 0;this._contentAreaNeedsUpdate=!1;this._zIndex=void 0;this._zIndexNeedsUpdate=!1;this._contentLayout={scaleMode:i.ScaleMode.AspectFit,verticalAlignment:i.VerticalAlignment.Center,horizontalAlignment:i.HorizontalAlignment.Center,passthroughEvent:!0,backgroundColor:"transparent"};this._contentLayoutNeedsUpdate=!1;this._visibility=!0;this._visibilityNeedsUpdate=!1;this._dataBus=null;this.id=null;this.vars={};this.type=t;this._contentUrl=e.contentUrl;null!=e.contentArea&&this.setContentArea(e.contentArea);null!=e.zIndex&&this.setZIndex(e.zIndex);null!=e.contentLayout&&this.setContentLayout(e.contentLayout)}e.prototype.destroy=function(){this._contentDestroyListeners.forEach(function(e){return e.onDestroy()})};e.prototype.addContentLoadListener=function(e){this._contentLoadListeners.addItem(e)};e.prototype.removeContentLoadListener=function(e){this._contentLoadListeners.removeItem(e)};e.prototype.addErrorListener=function(e){this._errorListeners.addItem(e)};e.prototype.removeErrorListener=function(e){this._errorListeners.removeItem(e)};e.prototype.addContentDestroyListener=function(e){this._contentDestroyListeners.addItem(e)};e.prototype.removeContentDestroyListener=function(e){this._contentDestroyListeners.removeItem(e)};e.prototype.setContentArea=function(e){this._contentArea=n.assignObject(this._contentArea||{},e);this._contentAreaNeedsUpdate=!0;this._update()};e.prototype.getContentArea=function(){return n.assignObject({},this._contentArea)};e.prototype.setZIndex=function(e){this._zIndex=e;this._zIndexNeedsUpdate=!0;this._update()};e.prototype.getZIndex=function(){return this._zIndex};e.prototype.moveTopMost=function(){if(this._gameContentShared)this.setZIndex(this._gameContentShared.largestZIndex+1);else{var e=o.ErrorFactory.createInvalidOperationError("moveTopMost");this._errorListeners.forEach(function(t){return t.onError(e)})}};e.prototype.setContentLayout=function(e){this._contentLayout=n.assignObject(this._contentLayout||{},e);this._contentLayoutNeedsUpdate=!0;this._update()};e.prototype.getContentLayout=function(){return n.assignObject({},this._contentLayout)};e.prototype.hide=function(){if(!1!==this._visibility){this._visibility=!1;this._visibilityNeedsUpdate=!0;this._update()}};e.prototype.show=function(){if(!0!==this._visibility){this._visibility=!0;this._visibilityNeedsUpdate=!0;this._update()}};e.prototype.isVisible=function(){return this._visibility};e.prototype.getDataBus=function(){return this._dataBus};return e}();r.Content=a},{"./Error":6,"./utils":26,"@akashic/akashic-gameview":27}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){var t=document.createElement("div");t.style.position="relative";t.style.overflow="hidden";t.style.pointerEvents="none";e.appendChild(t);this._parent=e;this._htmlElement=t}e.prototype.appendChild=function(e){this._htmlElement.appendChild(e)};e.prototype.removeChild=function(e){this._htmlElement.removeChild(e)};e.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)};e.prototype.setViewSize=function(e,t){this._htmlElement.style.width=e+"px";this._htmlElement.style.height=t+"px"};return e}();r.GameViewElement=i;var n=function(){function e(e,t,r){var i=this,n=document.createElement("iframe");n.style.position="absolute";n.style.borderStyle="none";n.style.pointerEvents="auto";n.addEventListener("load",function(){setTimeout(function(){r(i._htmlElement)},0)});n.src=t;e.appendChild(n);this._parent=e;this._htmlElement=n}e.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)};e.prototype.setContentArea=function(e){this._htmlElement.style.left=e.x+"px";this._htmlElement.style.top=e.y+"px";this._htmlElement.style.width=e.width+"px";this._htmlElement.style.height=e.height+"px"};e.prototype.setContentLayout=function(e){this._htmlElement.style.backgroundColor=e.backgroundColor};e.prototype.setZIndex=function(e){this._htmlElement.style.zIndex=e+""};e.prototype.setVisibility=function(e){this._htmlElement.style.display=e?"block":"none"};e.prototype.getContentWindow=function(){return this._htmlElement.contentWindow};return e}();r.WebContentElement=n;var o=function(){function e(e,t,r){var i=this,n=document.createElement("div");n.style.position="absolute";n.style.overflow="hidden";n.style.pointerEvents="auto";var o=null;if(t){var a=document.createElement("iframe");a.addEventListener("load",function(){setTimeout(function(){r(i._innerHtmlElement)},0)});a.sandbox="allow-scripts allow-same-origin";a.src=t;a.scrolling="no";o=a}else{o=document.createElement("div");setTimeout(function(){return r(o)},0)}o.style.position="absolute";o.style.borderStyle="none";o.style.overflow="hidden";o.style.pointerEvents="auto";n.appendChild(o);e.appendChild(n);this._parent=e;this._outerHtmlElement=n;this._innerHtmlElement=o}e.prototype.destroy=function(){this._parent.removeChild(this._outerHtmlElement)};e.prototype.setInnerSize=function(e){this._innerHtmlElement.style.left=e.x+"px";this._innerHtmlElement.style.top=e.y+"px";this._innerHtmlElement.style.width=e.width+"px";this._innerHtmlElement.style.height=e.height+"px"};e.prototype.setContentArea=function(e){this._outerHtmlElement.style.left=e.x+"px";this._outerHtmlElement.style.top=e.y+"px";this._outerHtmlElement.style.width=e.width+"px";this._outerHtmlElement.style.height=e.height+"px"};e.prototype.setContentLayout=function(e){this._outerHtmlElement.style.backgroundColor=e.backgroundColor;this._outerHtmlElement.style.pointerEvents=e.passthroughEvent?"none":"auto"};e.prototype.setZIndex=function(e){this._outerHtmlElement.style.zIndex=e+""};e.prototype.setVisibility=function(e){this._outerHtmlElement.style.display=e?"block":"none"};e.prototype.getContentWindow=function(){return this._innerHtmlElement.contentWindow};return e}();r.GameContentElement=o},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){void 0===e&&(e=15e3);this.defaultTimeOut=e;this._createXmlHttpRequest=function(){return new XMLHttpRequest}}e.prototype.start=function(e,t){var r=this._createXmlHttpRequest();r.open("GET",e);r.responseType="text";r.timeout=this.defaultTimeOut;r.addEventListener("load",function(i){r.status>=200&&r.status<300?t(null,r.responseText):t(new Error("request failed: "+e),null)});r.addEventListener("error",function(r){return t(new Error("request error: "+e),null)});r.addEventListener("timeout",function(r){return t(new Error("request timed out: "+e),null)});r.send();return{cancel:function(){r.readyState!==r.DONE&&r.abort()},isFinished:function(){return r.readyState===r.DONE}}};return e}();r.XhrDownloader=i;var n=function(){function e(e,t){void 0===e&&(e=new i);void 0===t&&(t=2);this.baseDownloader=e;this.defaultRetry=t}e.prototype.start=function(e,t){var r=this,i={count:this.defaultRetry},n={cancel:function(){},isFinished:function(){return!1}},o=function(){var a=r.baseDownloader.start(e,function(e,r){null!=e?--i.count<=0?t(e,r):setTimeout(function(){return o()},0):t(null,r)});n.cancel=a.cancel;n.isFinished=a.isFinished};setTimeout(function(){return o()},0);return n};return e}();r.RetryDownloader=n},{}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){function t(e){return function(t){var r=new Error(e);r.name=e;r.cause=t;return r}}e.createInvalidOperationError=t("InvalidOperation");e.createGameDriverError=t("GameDriverError");e.createLoadMuduleError=t("LoadMuduleError");e.createPlaylogError=t("PlaylogError");e.createHttpRequestError=t("HttpRequestError");e.createInvalidGameError=t("InvalidGameError");e.createAbortGameError=t("AbortGameError");e.createPostMessageError=t("PostMessageError");e.createInsecureFrameUrlError=t("InsecureFrameUrlError")}(r.ErrorFactory||(r.ErrorFactory={}))},{}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this._externalPlugin={}}e.prototype.register=function(e){this._externalPlugin[e.name]=e};e.prototype.find=function(e){return this._externalPlugin[e]};return e}();r.ExternalPluginManager=i},{}],8:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("@akashic/akashic-gameview"),o=e("@cross-border-bridge/memory-queue"),a=e("@cross-border-bridge/memory-queue-data-bus"),s=e("./Content"),l=e("./DomElement"),u=e("./TrustedGameLoader"),d=e("./UntrustedGameLoader"),h=e("./utils"),c=e("./Error"),p=e("./CalcLayout"),g=function(e){function t(t){var r=e.call(this,t,"game")||this;r._skippingListeners=new h.ObjectList;r._loadStartTime=0;r._loader=null;r._element=null;r._isRunning=!1;r._naturalWidth=0;r._naturalHeight=0;r._untrusted=!1;r._replayData=null;r._engineConfig=null;r._destroyed=!1;r._contentUrl=t.contentUrl;r._player=t.player;r._playConfig=t.playConfig;r._untrustedFrameUrl=t.untrustedFrameUrl;r._untrustedFrameTargetOrigin=t.untrustedFrameTargetOrigin;r._argument=t.argument;r._pauseOnStart=t.pause;r._initialEvents=t.initialEvents;r._givenUntrusted=t.untrusted;r._customizer=t.gameLoaderCustomizer;r._audioPdiHandlers=t.audioPdiHandlers;return r}i(t,e);t.prototype.start=function(e,t){var r=this;this._loadStartTime=(new Date).getTime();this._gameViewShared=e;this._gameContentShared=t;this._customizer&&null!=this._customizer.overwriteEngineConfig?setTimeout(function(){return r._start_createElement(r._customizer.overwriteEngineConfig)},0):this._gameViewShared.downloader.start(this._contentUrl,function(e,t){e?r._fireError(c.ErrorFactory.createHttpRequestError(e)):r._start_createElement(t)})};t.prototype._parseEngineConfig=function(e){var t;try{t=JSON.parse(e)}catch(e){this._fireError(c.ErrorFactory.createInvalidGameError(e));return null}null==t.engine_urls&&(t.engine_urls=[]);null==t.external&&(t.external=[]);return t};t.prototype._start_createElement=function(e){var t=this,r=this._gameContentShared,i=this._engineConfig=this._parseEngineConfig(e);if(i){var n=i.untrusted,o=this._givenUntrusted;this._untrusted=!0===o||null==o&&!0===n;this._element=new l.GameContentElement(r.gameViewElement,this._untrusted?this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl:null,function(e){return t._start_startLoader(e)});null==this._contentArea&&this.setContentArea({x:0,y:0,width:r.viewWidth,height:r.viewHeight});null==this._zIndex&&this.setZIndex(++r.largestZIndex);null==this._dataBus&&this._initDataBus()}};t.prototype._start_startLoader=function(e){var t=this;if(!this._destroyed){var r=this._engineConfig;if(this._untrusted){var i=this._getUntrustedFrameHostname(),n=window.location.hostname;if(!i||""!==n&&0===i.indexOf(n)){this._fireError(c.ErrorFactory.createInsecureFrameUrlError());return}var o=this._element.getContentWindow(),a=this._getUntrustedTargetOrigin();this._loader=new d.UntrustedGameLoader({engineConfig:r,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers,contentWindow:o,targetOrigin:a})}else this._loader=new u.TrustedGameLoader({engineConfig:r,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers});this._loader.start({parentHtmlElement:e,contentUrl:this._contentUrl,initialEvents:this._initialEvents,argument:this._argument,pause:this._pauseOnStart,player:this._player,playConfig:this._playConfig,gameCreatedHandler:function(r){if(t._loader){t._workaroundEngine(e);t._naturalWidth=r.width;t._naturalHeight=r.height;t._contentLayoutNeedsUpdate=!0;t._isRunning=!0;t._update();t._engineConfig.external.forEach(function(e){var i=t._gameViewShared.pluginManager.find(e);null!=i&&setTimeout(function(){t._loader&&i.onload(r,t.getPluginDataBus(),t)},0)});r.skippingChangedTrigger&&r.skippingChangedTrigger.handle(function(e){t._skippingListeners.forEach(function(t){return t.onSkip(e)})});var i=((new Date).getTime()-t._loadStartTime)/1e3;t._contentLoadListeners.forEach(function(e){return e.onLoad(i)})}},errorHandler:function(e){return t._errorListeners.forEach(function(t){return t.onError(e)})},gameFinishedHandler:function(){t._isRunning=!1},replayData:this._replayData||this._playConfig.replayData})}};t.prototype._update=function(){if(null!=this._element){if(this._contentAreaNeedsUpdate||this._contentLayoutNeedsUpdate){this._element.setContentArea(this._contentArea);this._element.setContentLayout(this._contentLayout);var e={outerWidth:this._contentArea.width,outerHeight:this._contentArea.height,naturalWidth:this._naturalWidth,naturalHeight:this._naturalHeight,horizontalAlignment:this._contentLayout.horizontalAlignment,verticalAlignment:this._contentLayout.verticalAlignment},t=void 0;switch(this._contentLayout.scaleMode){case n.ScaleMode.AspectFit:t=p.calcAspectFitLayout(e);break;case n.ScaleMode.Fill:t=p.calcFillLayout(e);break;default:t=p.calcNoneLayout(e)}this._element.setInnerSize(t);this._isRunning&&this._loader&&this._loader.setScale(t.width/this._naturalWidth,t.height/this._naturalHeight);this._contentAreaNeedsUpdate=!1;this._contentLayoutNeedsUpdate=!1}if(this._zIndexNeedsUpdate){this._element.setZIndex(this._zIndex);this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex);this._zIndexNeedsUpdate=!1}if(this._visibilityNeedsUpdate){this._element.setVisibility(this._visibility);this._visibilityNeedsUpdate=!1}}};t.prototype._initDataBus=function(){var e=new o.MemoryQueue,t=new o.MemoryQueue,r=new a.MemoryQueueDataBus(t,e),i=new a.MemoryQueueDataBus(e,t);this._dataBus=r;this._pluginDataBus=i};t.prototype.destroy=function(){if(!this._destroyed){this._destroyed=!0;if(this._loader){this._loader.stopGame();this._loader=void 0;this._element.destroy();this._element=void 0;this._dataBus.destroy();this._dataBus=void 0;this._pluginDataBus.destroy();this._pluginDataBus=void 0}e.prototype.destroy.call(this)}};t.prototype.pause=function(){this._loader?this._loader.pauseGame():this._fireInvalidOperationError("pause")};t.prototype.resume=function(){this._loader?this._loader.resumeGame():this._fireInvalidOperationError("resume")};t.prototype.isPaused=function(){return this._loader?this._loader.isPaused():!!this._pauseOnStart};t.prototype.setExecutionMode=function(e){this._loader&&this._loader.setExecutionMode(e)||this._fireInvalidOperationError("setExecutionMode")};t.prototype.getExecutionMode=function(){return this._loader?this._loader.getExecutionMode():null};t.prototype.setReplayTargetTimeFunc=function(e){this._loader&&this._loader.setReplayTargetTimeFunc(e)||this._fireInvalidOperationError("setReplayTargetTimeFunc")};t.prototype.getReplayTargetTimeFunc=function(){return this._loader?this._loader.getReplayTargetTimeFunc():null};t.prototype.setReplayOriginDate=function(e){this._loader&&this._loader.setReplayOriginDate(e)||this._fireInvalidOperationError("setReplayOriginDate")};t.prototype.getReplayOriginDate=function(){return this._loader?this._loader.getReplayOriginDate():null};t.prototype.getAverageFramePerSecond=function(e){var t=this;this._loader?setTimeout(function(){return e(t._loader?t._loader.fps:0)},0):this._fireInvalidOperationError("getAverageFramePerSecond")};t.prototype.addSkippingListener=function(e){this._skippingListeners.addItem(e)};t.prototype.removeSkippingListener=function(e){this._skippingListeners.removeItem(e)};t.prototype.sendEvents=function(e){this._loader?this._loader.sendEvents(e):this._fireInvalidOperationError("sendEvents")};t.prototype.getPlayOriginDate=function(){return this._loader?this._loader.getPlayOriginDate():null};t.prototype.getGameVars=function(e,t){this._loader?this._loader.getGameVars(e,t):this._fireInvalidOperationError("getGameVars")};t.prototype.getGame=function(){if(this._loader)return this._loader.game;this._fireInvalidOperationError("getGame")};t.prototype.getGameDriver=function(){if(this._loader)return this._loader.driver;this._fireInvalidOperationError("getGameDriver")};t.prototype.getPluginDataBus=function(){return this._pluginDataBus};t.prototype.dumpPlaylog=function(){return this._loader.dumpPlaylog()};t.prototype.getGameContentSize=function(){var e=this.getGame();return{width:e.width,height:e.height}};t.prototype.setGameContentSize=function(e){if(this._loader){this._loader.resetPrimarySurface(e.width,e.height);this._naturalWidth=e.width;this._naturalHeight=e.height}else this._fireInvalidOperationError("setGameContentSize")};t.prototype.getMasterVolume=function(){if(this._loader)return this._loader.getMasterVolume();this._fireInvalidOperationError("getMasterVolume")};t.prototype.setMasterVolume=function(e){this._loader?this._loader.setMasterVolume(e):this._fireInvalidOperationError("setMasterVolume")};t.prototype._fireInvalidOperationError=function(e){this._fireError(c.ErrorFactory.createInvalidOperationError(e))};t.prototype._fireError=function(e){this._errorListeners.forEach(function(t){return t.onError(e)})};t.prototype._getUntrustedTargetOrigin=function(){if(null!=this._untrustedFrameTargetOrigin)return this._untrustedFrameTargetOrigin;if(!this._untrustedFrameUrl&&null!=this._gameViewShared.untrustedFrameTargetOrigin)return this._gameViewShared.untrustedFrameTargetOrigin;var e=this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl,t=e.match(/^(https?:\/\/[^\/]*)\//);return t&&t[1]?t[1]:null};t.prototype._getUntrustedFrameHostname=function(){var e=this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl,t=e.match(/^https?:\/\/([^\/:]*)(?::\d+)?\//);return t&&t[1]?t[1]:null};t.prototype._workaroundEngine=function(e){for(var t=e.getElementsByClassName("input-handler"),r=0;r<t.length;++r)t[r].setAttribute("tabindex","0")};return t}(s.Content);r.GameContent=g},{"./CalcLayout":2,"./Content":3,"./DomElement":4,"./Error":6,"./TrustedGameLoader":12,"./UntrustedGameLoader":14,"./utils":26,"@akashic/akashic-gameview":27,"@cross-border-bridge/memory-queue":32,"@cross-border-bridge/memory-queue-data-bus":31}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(t){this._loadedTable=Object.create(null);this._loadingTable=Object.create(null);this._loadFunc=t||e._addScriptElement}e._addScriptElement=function(e,t){var r=document.createElement("script");r.src=e;r.addEventListener("load",function(){t(null)});r.addEventListener("error",function(){t(new Error("failed to load script: "+e))});document.head.appendChild(r)};e.prototype.appendScripts=function(e,t){var r=this,i=[],n=e.length;e.forEach(function(e){r._appendScript(e,function(r){r&&i.push(e);--n;n>0||t(0===i.length?null:new Error("failed to load scripts: "+i.join(", ")))})})};e.prototype._appendScript=function(e,t){var r=this;if(this._loadedTable[e])setTimeout(function(){return t(null)},0);else if(this._loadingTable[e])this._loadingTable[e].push(t);else{this._loadingTable[e]=[t];this._loadFunc(e,function(t){t||(r._loadedTable[e]=!0);var i=r._loadingTable[e];delete r._loadingTable[e];i.forEach(function(e){return e(t)})})}};return e}();r.ScriptManager=i},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this._activeSessionTable={};this._playlogClient=null;this._socketOpts=null}e.prototype.isInitialized=function(){return!!this._playlogClient};e.prototype.initialize=function(e){this._playlogClient=e};e.prototype.setSocketOptions=function(e){this._socketOpts=e};e.prototype.getSession=function(e,t,r,i){var n=this;if(this._playlogClient){var o=this._activeSessionTable[e];if(null==o){var a=this._playlogClient.Socket.Type.WebSocket,s=new this._playlogClient.Session(e,{socketType:a,validationData:r,socketOpts:this._socketOpts});s.on("error",function(t){var r=n._activeSessionTable[e];null!=r&&r.errorHandlers.forEach(function(e){return e(t)})});s.open(function(t){if(t)setTimeout(function(){i(t,null,!0)},0);else{n._activeSessionTable[e]={session:s,refCount:1,errorHandlers:[]};setTimeout(function(){i(null,s,!0)},0)}})}else{++o.refCount;setTimeout(function(){i(null,o.session,!1)},0)}}else setTimeout(function(){return i(new Error("playlog-client not initialized"),null,!0)})};e.prototype.addErrorHandler=function(e,t){var r=this._activeSessionTable[e];null!=r&&r.errorHandlers.push(t)};e.prototype.removeErrorHandler=function(e,t){var r=this._activeSessionTable[e];null!=r&&(r.errorHandlers=r.errorHandlers.filter(function(e){return e!==t}))};e.prototype.releaseSession=function(e){var t=this._activeSessionTable[e];if(null!=t&&--t.refCount<1){t.session.close(function(){});this._activeSessionTable[e]=null}};return e}();r.SessionManager=i},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("./ExternalPluginManager"),n=e("./SessionManager"),o=e("./Downloader"),a=e("./ScriptManager"),s=e("./bridge/PostMessageBridgeDemux"),l=function(){function e(e){this.pluginManager=new i.ExternalPluginManager;this.sessionManager=new n.SessionManager;this.scriptManager=new a.ScriptManager;this.downloader=new o.RetryDownloader(e?e.baseDownloader:void 0);this.bridgeDemux=new s.PostMessageBridgeDemux(e.window||window,e.trustedChildOrigin);this.untrustedFrameUrl=e.untrustedFrameUrl;this.untrustedFrameTargetOrigin=e.untrustedFrameTargetOrigin||null}e.prototype.destroy=function(){this.pluginManager=null;this.sessionManager=null;this.scriptManager=null;this.downloader=null;null!=this.bridgeDemux&&this.bridgeDemux.destroy();this.bridgeDemux=null};e.prototype.destroyed=function(){return null==this.bridgeDemux};return e}();r.GameViewSharedObject=l;var u=function(){function e(e){this.gameViewElement=e.gameViewElement;this.largestZIndex=0;this.viewWidth=e.gameViewWidth;this.viewHeight=e.gameViewHeight}return e}();r.GameContentSharedObject=u},{"./Downloader":5,"./ExternalPluginManager":7,"./ScriptManager":9,"./SessionManager":10,"./bridge/PostMessageBridgeDemux":20}],12:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("./Error"),o=e("./TrustedGameLoaderBase"),a=function(e){function t(t){var r=e.call(this,t)||this;r._shared=t.shared;r._onSessionManagerError_bound=r._onSessionManagerError.bind(r);return r}i(t,e);t.prototype._getAdditionalScripts=function(e){var t=this,r=[];if(0===e.external.length)return r;e.external.forEach(function(e){var i=t._shared.pluginManager.find(e);null!=i&&null!=i.scriptUrls&&i.scriptUrls.forEach(function(e){return r.push(e)})});return r};t.prototype._loadScripts=function(e,t){this._shared.scriptManager.appendScripts(e,t)};t.prototype._initializeSessionManagerIfNeeded=function(e){e&&!this._shared.sessionManager.isInitialized()&&this._shared.sessionManager.initialize(e)};t.prototype._acquirePlaylogClientAMFlow=function(e,t){var r=this;this._shared.sessionManager.getSession(e.playlogServerUrl,e.protocol,{playId:e.playId,token:e.playToken},function(i,n,o){if(i)t(i,null);else{r._shared.sessionManager.addErrorHandler(e.playlogServerUrl,r._onSessionManagerError_bound);n.createClient({usePrimaryChannel:o},t)}})};t.prototype._releasePlaylogClientAMFlow=function(e){this._shared.sessionManager.removeErrorHandler(this._playlogServerUrl,this._onSessionManagerError_bound);this._shared.sessionManager.releaseSession(this._playlogServerUrl);this._onSessionManagerError_bound=null};t.prototype._onSessionManagerError=function(e){this._param.errorHandler(n.ErrorFactory.createPlaylogError(e))};return t}(o.TrustedGameLoaderBase);r.TrustedGameLoader=a},{"./Error":6,"./TrustedGameLoaderBase":13}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("@akashic/akashic-gameview"),n=e("./Error"),o=e("./detectEngineFileObject"),a=function(){function e(e){this._playId=null;this._playToken="";this._agvExecutionMode=null;this._playlogServerUrl="";this._protocol=i.ProtocolType.WebSocket;this._amflowClient=null;this._g=null;this._GameDriver=null;this._PdiBrowser=null;this._usingCustomAmflow=!1;this._rawLoadGameConfiguration=null;this._isLoadEnded=!1;this._isPaused=!1;this._engineConfig=null;this._destroyed=!1;this.isTestbed=!1;this.game=null;this.driver=null;this.platform=null;this.fps=0;this._replayOriginDateOffset=0;this._customizer=e.customizer;this._engineConfig=e.engineConfig;this._audioPdiHandler=e.audioPdiHandler}e.prototype.start=function(e){this._param=e;this._isPaused=!!e.pause;this._downloadScripts()};e.prototype._downloadScripts=function(){var e=this,t=this._getAdditionalScripts(this._engineConfig),r=this._engineConfig.engine_urls.concat(t);this._loadScripts(r,function(t){if(t)e._param.errorHandler(n.ErrorFactory.createHttpRequestError(t));else{var i=o.detectEngineFileObject(r),a=i[0],s=i[1];if(!a&&s){e._g=s.g;e._GameDriver=s.GameDriver;e._PdiBrowser=s.PdiBrowser;e._initializeSessionManagerIfNeeded(s.PlaylogClient);e._playId=e._param.playConfig.playId;e._agvExecutionMode=e._param.playConfig.executionMode;e.isTestbed="playlogServerUrl"in e._param.playConfig;e._param.replayData?setTimeout(function(){return e._startReplayGame()},0):e.isTestbed?setTimeout(function(){return e._startPlaylogGame()},0):setTimeout(function(){return e._startStandaloneGame()},0)}else e._param.errorHandler(a)}})};e.prototype._startReplayGame=function(){var e=this;this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId,tickList:this._param.replayData.tickList,startPoints:this._param.replayData.startPoints});if(this._param.playConfig.replayTargetTimeFunc&&this._param.replayData.startPoints&&this._param.replayData.startPoints[0]){var t=this._param.replayData.startPoints[0].timestamp,r=this._param.playConfig.replayTargetTimeFunc();null!=this._param.playConfig.replayOriginDate&&(r+=this._param.playConfig.replayOriginDate);this._replayOriginDateOffset=t-r}setTimeout(function(){return e._startGame()},0)};e.prototype._startStandaloneGame=function(){var e=this;if(this._customizer&&this._customizer.createCustomAmflowClient){this._amflowClient=this._customizer.createCustomAmflowClient();this._usingCustomAmflow=!0}else this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId});setTimeout(function(){return e._startGame()},0)};e.prototype._startPlaylogGame=function(){var e=this,t=this._param.playConfig;this._playToken=t.playToken;this._playlogServerUrl=t.playlogServerUrl;this._protocol=t.protocol||i.ProtocolType.WebSocket;if(this._customizer&&this._customizer.createCustomAmflowClient){this._amflowClient=this._customizer.createCustomAmflowClient();this._usingCustomAmflow=!0;setTimeout(function(){return e._startGame()},0)}else this._acquirePlaylogClientAMFlow({playlogServerUrl:this._playlogServerUrl,protocol:this._protocol,playId:this._playId,playToken:this._playToken},function(t,r){if(t)e._param.errorHandler(n.ErrorFactory.createPlaylogError(t));else{e._amflowClient=r;e._startGame()}})};e.prototype._startGame=function(){var e=this,t=this._createPlatform(),r=this._createGameDriver(t);r.gameCreatedTrigger.handle(function(t){e.game=t;"abortTrigger"in e.game&&e.game.abortTrigger.handle(function(){e._param.errorHandler(n.ErrorFactory.createAbortGameError())})
;e._param.gameCreatedHandler(t)});this.driver=r;this.platform=t;setTimeout(function(){return e._startGameDriver(r)},0)};e.prototype._createPlatform=function(){var e=this,t=null;try{t=new this._PdiBrowser.Platform({amflow:this._amflowClient,containerView:this._param.parentHtmlElement,audioPlugins:this._createAudioPlugins()});this._customizer&&this._customizer.platformCustomizer&&this._customizer.platformCustomizer(t,{g:this._g});this._rawLoadGameConfiguration=t.loadGameConfiguration;t.loadGameConfiguration=function(t,r){e._customLoadGameConfiguration(t,r)}}catch(e){this._param.errorHandler(n.ErrorFactory.createLoadMuduleError(e));return}return t};e.prototype._customLoadGameConfiguration=function(e,t){var r=this;if("<agvw-queryparam>"!==e)"<agvw-configuration>"!==e?-1===this._param.contentUrl.indexOf("?")?this._rawLoadGameConfiguration(e,t):setTimeout(function(){return t(null,{definitions:[{url:"<agvw-configuration>",basePath:r._getAssetBase()},"<agvw-queryparam>"]})},0):this._rawLoadGameConfiguration(this._engineConfig.content_url,t);else{var i=this._param.contentUrl.slice(this._param.contentUrl.indexOf("?")+1),n=i.split("&").reduce(function(e,t){var r=t.split("=");try{e[r[0]]=JSON.parse(decodeURIComponent(r[1]))}catch(e){}return e},{});setTimeout(function(){return t(null,n)},0)}};e.prototype._createGameDriver=function(e){var t=this;return new this._GameDriver.GameDriver({platform:e,player:this._param.player,errorHandler:function(e){return t._param.errorHandler(n.ErrorFactory.createGameDriverError(e))}})};e.prototype._startGameDriver=function(e){var t=this;this.driver.initialize(this._createInitializeParameter(),function(e){if(e)t._param.errorHandler(n.ErrorFactory.createGameDriverError(e));else{t._param.replayData||t._sendinitialEvents();t._isPaused||t.driver.startGame();t._isLoadEnded=!0;t._destroyed&&t.stopGame()}})};e.prototype._createInitializeParameter=function(){var e=this._agvExecutionMode===i.ExecutionMode.Active&&!this._param.replayData,t=!!this._param.replayData||this._agvExecutionMode===i.ExecutionMode.Replay,r=this._isPaused,n=e?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,o=null!=this._param.playConfig.replayOriginDate?this._param.playConfig.replayOriginDate+this._replayOriginDateOffset:this._replayOriginDateOffset,a=t?this._createLoopConfigurationForReplay(this._param.playConfig.replayTargetTimeFunc,o):this._createLoopConfigurationForRealtime(this._param.playConfig.replayTargetTimeFunc,o);return{configurationUrl:this._engineConfig.content_url,assetBase:this._getAssetBase(),profiler:this._getProfiler(),gameArgs:this._param.argument,driverConfiguration:{playId:this._playId,playToken:this._playToken,executionMode:n,eventBufferMode:{isSender:!r&&!e&&!t,isReceiver:e,isDiscarder:r}},loopConfiguration:a}};e.prototype._getAssetBase=function(){var e=this._engineConfig.asset_base_url;if(null==e){var t=this._engineConfig.content_url;e=t.substr(0,t.lastIndexOf("/"))+"/"}return e};e.prototype._getProfiler=function(){var e=this,t=null;this._GameDriver.SimpleProfiler&&(t=new this._GameDriver.SimpleProfiler({interval:200,getValueHandler:function(t){e.fps=t.framePerSecond.ave}}));return t};e.prototype._sendinitialEvents=function(){var e=this;if(this._param.initialEvents)try{this._param.initialEvents.forEach(function(t){return e._amflowClient.sendEvent(t)})}catch(e){this._param.errorHandler(n.ErrorFactory.createPlaylogError(e))}};e.prototype.pauseGame=function(){if(!this._isPaused){this._isPaused=!0;if(this._isLoadEnded){this.driver._eventBuffer.setMode({isSender:!1,isDiscarder:!0});this.driver.stopGame();this.game._setMuted(!0)}}};e.prototype.resumeGame=function(){if(this._isPaused){this._isPaused=!1;if(this._isLoadEnded){this.driver.startGame();var e=this._agvExecutionMode===i.ExecutionMode.Active,t=this._agvExecutionMode===i.ExecutionMode.Replay;this.driver._eventBuffer.setMode({isSender:!e&&!t,isDiscarder:!1});this.game._setMuted(!1)}}};e.prototype.isPaused=function(){return this._isPaused};e.prototype.stopGame=function(){var e=this;this._destroyed=!0;if(this._isLoadEnded){this.game&&this.game.audio&&Object.keys(this.game.audio).forEach(function(t){return e.game.audio[t].stopAll()});this.driver.stopGame();this.driver.initialize({driverConfiguration:{playId:null},configurationUrl:null},function(){e.isTestbed&&!e._usingCustomAmflow&&e._releasePlaylogClientAMFlow(e._playlogServerUrl);e._amflowClient=null;e._g=null;e._GameDriver=null;e._PdiBrowser=null;e.game=null;e.platform=null;e.driver.destroy?e.driver.destroy().then(function(){return e._param.gameFinishedHandler()}):setTimeout(function(){return e._param.gameFinishedHandler()})})}};e.prototype.sendEvents=function(e){var t=this;try{e.forEach(function(e){return t._amflowClient.sendEvent(e)})}catch(e){this._param.errorHandler(n.ErrorFactory.createPlaylogError(e))}};e.prototype.dumpPlaylog=function(){return this.isTestbed||!this._amflowClient.dump?null:this._amflowClient.dump()};e.prototype.getGameVars=function(e,t){var r=this;setTimeout(function(){r.game&&t(r.game.vars&&r.game.vars[e])},0)};e.prototype.setExecutionMode=function(e){if(!this.driver)return!1;if(!this.driver._gameLoop||!this.driver._eventBuffer)return!1;if(this._agvExecutionMode===e)return!0;this._agvExecutionMode=e;var t=this._agvExecutionMode===i.ExecutionMode.Active,r=!!this._param.replayData||this._agvExecutionMode===i.ExecutionMode.Replay,n=t?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,o=r?this._createLoopConfigurationForReplay():this._createLoopConfigurationForRealtime();this.driver._gameLoop.setExecutionMode(n);this.driver._gameLoop.setLoopConfiguration(o);this.driver._eventBuffer.setMode({isSender:!t&&!r,isReceiver:t});return!0};e.prototype._createLoopConfigurationForRealtime=function(t,r){return{loopMode:this._GameDriver.LoopMode.Realtime,delayIgnoreThreshold:e.REALTIME_DELAY_IGNORE_THRESHOLD,jumpTryThreshold:e.REALTIME_JUMP_TRY_THRESHOLD,targetTimeFunc:t,originDate:r}};e.prototype._createLoopConfigurationForReplay=function(e,t){return{loopMode:this._GameDriver.LoopMode.Replay,delayIgnoreThreshold:Number.MAX_VALUE,jumpTryThreshold:Number.MAX_VALUE,targetTimeFunc:e,originDate:t}};e.prototype.getExecutionMode=function(){return this._agvExecutionMode};e.prototype.setReplayTargetTimeFunc=function(e){if(!this.driver||!this.driver._gameLoop)return!1;this.driver._gameLoop.setLoopConfiguration({targetTimeFunc:e});return!0};e.prototype.getReplayTargetTimeFunc=function(){if(!this.driver)return null;var e=this.driver.getLoopConfiguration();return e?e.targetTimeFunc:null};e.prototype.setReplayOriginDate=function(e){if(!this.driver||!this.driver._gameLoop)return!1;this.driver._gameLoop.setLoopConfiguration({originDate:e+this._replayOriginDateOffset});return!0};e.prototype.getReplayOriginDate=function(){if(!this.driver)return null;var e=this.driver.getLoopConfiguration();return e?e.originDate:null};e.prototype.getPlayOriginDate=function(){if(!this.driver||!this.driver._gameLoop)return null;var e=this.driver._gameLoop._startedAt;return e||null};e.prototype.getReplayOriginDateOffset=function(){return this._replayOriginDateOffset};e.prototype.resetPrimarySurface=function(e,t){var r=this.driver;r&&r.resetPrimarySurface&&r.resetPrimarySurface(e,t)};e.prototype.setScale=function(e,t){this.platform.setScale(e,t)};e.prototype.setMasterVolume=function(e){this.platform.setMasterVolume(e)};e.prototype.getMasterVolume=function(){return this.platform.getMasterVolume()};e.prototype._createAudioPlugins=function(){var e=this._PdiBrowser;return this._customizer&&this._customizer.createCustomAudioPlugins?this._customizer.createCustomAudioPlugins():this._audioPdiHandler&&e.ProxyAudioPlugin?[new e.ProxyAudioPlugin(this._audioPdiHandler)]:[e.WebAudioPlugin,e.HTMLAudioPlugin]};e.REALTIME_DELAY_IGNORE_THRESHOLD=6;e.REALTIME_JUMP_TRY_THRESHOLD=3e4;return e}();r.TrustedGameLoaderBase=a},{"./Error":6,"./detectEngineFileObject":24,"@akashic/akashic-gameview":27}],14:[function(e,t,r){"use strict";var i=this&&this.__assign||function(){i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};return i.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0});var n=e("@akashic/akashic-gameview"),o=e("@akashic/trigger"),a=e("./Error"),s=e("./detectEngineFileObject"),l=e("./bridge/LoaderMessage"),u=e("./bridge/setupAMFlowProxy"),d=e("./bridge/setupAudioPdiProxy"),h=function(){function e(e){this.width=e.width;this.height=e.height;this.fps=e.fps;this.external={};this.skippingChangedTrigger=new o.Trigger;this._started=new o.Trigger;this._loaded=new o.Trigger}return e}();r.GameProxy=h;var c=function(){function e(e){this._bridge=e}e.prototype.changeState=function(e,t){this._bridge.request(l.LoaderMessage.ChangeDriverState,e,function(e){t(e&&"string"==typeof e?a.ErrorFactory.createGameDriverError(e):null)})};return e}();r.GameDriverProxy=c;var p=function(){function e(e){this._agvExecutionMode=null;this._amflowClient=null;this._isPaused=!1;this._engineConfig=null;this.game=null;this.driver=null;this.fps=-1;this._teardownAudioPdiProxy=null;this._teardownAMFlowProxy=null;this._usingCustomAmflow=!1;this._shared=e.shared;this._customizer=e.customizer;this._audioPdiHandler=e.audioPdiHandler;this._engineConfig=e.engineConfig;this._targetOrigin=e.targetOrigin;this._contentWindow=e.contentWindow;this._replayTargetTimeFunc=null;this._replayOriginDate=0;this._playOriginDate=null;this._masterVolume=1;this._handleSessionManagerError_bound=this._handleSessionManagerError.bind(this);this._handleGameCreated_bound=this._handleGameCreated.bind(this);this._handleAcquireAMFlow_bound=this._handleAcquireAMFlow.bind(this);this._handlePlayOriginDate_bound=this._handlePlayOriginDate.bind(this);this._handleExternalSend_bound=this._handleExternalSend.bind(this);this._handleSkippingChanged_bound=this._handleSkippingChanged.bind(this);this._handleGameLoaded_bound=this._handleGameLoaded.bind(this);this._handleGameStarted_bound=this._handleGameStarted.bind(this);this._notifyTargetTime_bound=this._notifyTargetTime.bind(this)}e.prototype.start=function(e){var t=this;this._param=e;this._isPaused=!!e.pause;this._replayTargetTimeFunc=e.playConfig.replayTargetTimeFunc;this._shared.bridgeDemux.register(this._contentWindow,this._targetOrigin,function(e,r){if(e)t._param.errorHandler(a.ErrorFactory.createPostMessageError(e));else{t._bridge=r;t._bridge.on(l.LoaderMessage.Error,function(e){return t._fireErrorTriggerIfNeeded(e)});t._bridge.on(l.LoaderMessage.GameCreated,t._handleGameCreated_bound);t._bridge.on(l.LoaderMessage.AcquireAMFlow,t._handleAcquireAMFlow_bound);t._bridge.on(l.LoaderMessage.PlayOriginDate,t._handlePlayOriginDate_bound);t._bridge.on(l.LoaderMessage.ExternalSend,t._handleExternalSend_bound);t._bridge.on(l.LoaderMessage.SkippingChanged,t._handleSkippingChanged_bound);t._bridge.on(l.LoaderMessage.GameLoaded,t._handleGameLoaded_bound);t._bridge.on(l.LoaderMessage.GameStarted,t._handleGameStarted_bound);t._audioPdiHandler&&(t._teardownAudioPdiProxy=d.setupAudioPdiProxy(t._audioPdiHandler,t._bridge));t._start_initializePlaylogClient()}})};e.prototype._start_initializePlaylogClient=function(){var e=this;if(this._shared.sessionManager.isInitialized())this._start_request();else{var t=s.findPlaylogClientUrl(this._engineConfig.engine_urls);t?this._shared.scriptManager.appendScripts([t],function(r){if(r)e._param.errorHandler(a.ErrorFactory.createHttpRequestError(r));else{var i=s.detectPlaylogClientObject(t);i&&e._shared.sessionManager.initialize(i);e._start_request()}}):this._start_request()}};e.prototype._start_request=function(){var e=this,t=this._param;this._bridge.request(l.LoaderMessage.Start,{engineConfig:this._engineConfig,replayData:t.replayData,contentUrl:t.contentUrl,initialEvents:t.initialEvents,argument:t.argument,pause:this._isPaused,player:t.player,playConfig:i({},t.playConfig,{replayTargetTimeFunc:void 0}),proxyAudio:!!this._audioPdiHandler},function(t){return e._fireErrorTriggerIfNeeded(t)})};e.prototype.pauseGame=function(){if(!this._isPaused){this._isPaused=!0;this._bridge.send(l.LoaderMessage.PauseGame);this._updateTargetTimeNotifier()}};e.prototype.resumeGame=function(){if(this._isPaused){this._isPaused=!1;this._bridge.send(l.LoaderMessage.ResumeGame);this._updateTargetTimeNotifier()}};e.prototype.isPaused=function(){return this._isPaused};e.prototype.stopGame=function(){if(this._bridge){this._bridge.send(l.LoaderMessage.StopGame,null);this._teardownAudioPdiProxy&&this._teardownAudioPdiProxy();this._releaseAMFlow();this._bridge.destroy();this._bridge=null;this._handleSessionManagerError_bound=null;this._handleGameCreated_bound=null;this._handleAcquireAMFlow_bound=null;this._handlePlayOriginDate_bound=null;this._handleExternalSend_bound=null;this._handleSkippingChanged_bound=null;this._handleGameLoaded_bound=null;this._handleGameStarted_bound=null;this._notifyTargetTime_bound=null;this._updateTargetTimeNotifier();this._param.gameFinishedHandler()}};e.prototype.sendEvents=function(e){this._bridge.send(l.LoaderMessage.SendEvents,e)};e.prototype.dumpPlaylog=function(){return null};e.prototype.getGameVars=function(e,t){var r=this;this._bridge.request(l.LoaderMessage.GetGameVars,e,function(e,i){if(!r._fireErrorTriggerIfNeeded(e))try{t(i)}catch(e){r._param.errorHandler(e)}})};e.prototype.setExecutionMode=function(e){if(this._agvExecutionMode===e)return!0;this._agvExecutionMode=e;this._bridge.send(l.LoaderMessage.SetExecutionMode,e);this._updateTargetTimeNotifier();return!0};e.prototype.getExecutionMode=function(){return this._agvExecutionMode};e.prototype.setReplayTargetTimeFunc=function(e){this._replayTargetTimeFunc=e;this._updateTargetTimeNotifier();return!0};e.prototype.getReplayTargetTimeFunc=function(){return this._replayTargetTimeFunc};e.prototype.setReplayOriginDate=function(e){this._replayOriginDate=e;this._bridge.send(l.LoaderMessage.SetReplayOriginDate,e);return!0};e.prototype.getReplayOriginDate=function(){return this._replayOriginDate};e.prototype.getPlayOriginDate=function(){return this._playOriginDate};e.prototype.resetPrimarySurface=function(e,t){this._bridge.send(l.LoaderMessage.ResetSurface,{width:e,height:t})};e.prototype.setScale=function(e,t){this._bridge.send(l.LoaderMessage.SetScale,{xScale:e,yScale:t})};e.prototype.setMasterVolume=function(e){if(this._masterVolume!==e){this._masterVolume=e;this._bridge.send(l.LoaderMessage.SetMasterVolume,e)}};e.prototype.getMasterVolume=function(){return this._masterVolume};e.prototype._fireErrorTriggerIfNeeded=function(e){if(e&&"string"==typeof e){this._param.errorHandler(a.ErrorFactory.createGameDriverError(e));return!0}return!1};e.prototype._handleSessionManagerError=function(e){this._param.errorHandler(a.ErrorFactory.createPlaylogError(e))};e.prototype._releaseAMFlow=function(){if(this._teardownAMFlowProxy){this._teardownAMFlowProxy();if(!this._usingCustomAmflow){var e=this._param.playConfig,t=e.playlogServerUrl;this._shared.sessionManager.removeErrorHandler(t,this._handleSessionManagerError_bound);this._shared.sessionManager.releaseSession(t)}}};e.prototype._handleGameCreated=function(e){this.game=new h(e);this.driver=new c(this._bridge);this._param.gameCreatedHandler(this.game);this._updateTargetTimeNotifier()};e.prototype._handleAcquireAMFlow=function(e,t){var r=this,i=function(e){r._param.errorHandler(e);t(e.message)},o=function(e){r._amflowClient=e;r._teardownAMFlowProxy=u.setupAMFlowProxy(e,r._bridge);t(null)};if(this._customizer.createCustomAmflowClient){this._usingCustomAmflow=!0;o(this._customizer.createCustomAmflowClient())}else{var a=this._param.playConfig;this._shared.sessionManager.getSession(a.playlogServerUrl,a.protocol||n.ProtocolType.WebSocket,{playId:a.playId,token:a.playToken},function(e,t,n){if(e)i(e);else{r._shared.sessionManager.addErrorHandler(a.playlogServerUrl,r._handleSessionManagerError_bound);t.createClient({usePrimaryChannel:n},function(e,t){e?i(e):o(t)})}})}};e.prototype._handlePlayOriginDate=function(e){"number"==typeof e&&(this._playOriginDate=e)};e.prototype._handleExternalSend=function(e){this.game.external&&this.game.external.send&&this.game.external.send(e)};e.prototype._handleSkippingChanged=function(e){this.game.skippingChangedTrigger.fire(e)};e.prototype._handleGameLoaded=function(){this.game._loaded.fire()};e.prototype._handleGameStarted=function(){this.game._started.fire()};e.prototype._updateTargetTimeNotifier=function(){var e=this._agvExecutionMode!==n.ExecutionMode.Active,t=this.game&&e&&!this._isPaused&&this._replayTargetTimeFunc&&!!this._bridge;if(t&&!this._targetTimeNotifierTimer)this._targetTimeNotifierTimer=setInterval(this._notifyTargetTime_bound,this.game.fps);else if(!t&&this._targetTimeNotifierTimer){clearInterval(this._targetTimeNotifierTimer);this._targetTimeNotifierTimer=null}};e.prototype._notifyTargetTime=function(){var e=this._replayTargetTimeFunc();this._bridge.send(l.LoaderMessage.TargetTime,e)};return e}();r.UntrustedGameLoader=p},{"./Error":6,"./bridge/LoaderMessage":18,"./bridge/setupAMFlowProxy":22,"./bridge/setupAudioPdiProxy":23,"./detectEngineFileObject":24,"@akashic/akashic-gameview":27,"@akashic/trigger":30}],15:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("@cross-border-bridge/post-message-data-bus"),o=e("./Content"),a=e("./DomElement"),s=function(e){function t(t){var r=e.call(this,t,"web")||this;r._element=null;return r}i(t,e);t.prototype.start=function(e,t){var r=this,i=(new Date).getTime();this._gameViewShared=e;this._gameContentShared=t;this._element=new a.WebContentElement(t.gameViewElement,this._contentUrl,function(){var e=((new Date).getTime()-i)/1e3;r._dataBus=new n.PostMessageDataBus(r._element.getContentWindow());r._contentLoadListeners.forEach(function(t){return t.onLoad(e)})});null==this._contentArea&&this.setContentArea({x:0,y:0,width:t.viewWidth,height:t.viewHeight});null==this._zIndex&&this.setZIndex(++t.largestZIndex)};t.prototype._update=function(){if(null!=this._element){if(this._contentAreaNeedsUpdate){this._element.setContentArea(this._contentArea);this._contentAreaNeedsUpdate=!1}if(this._zIndexNeedsUpdate){this._element.setZIndex(this._zIndex);this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex);this._zIndexNeedsUpdate=!1}if(this._contentLayoutNeedsUpdate){this._element.setContentLayout(this._contentLayout);this._contentLayoutNeedsUpdate=!1}if(this._visibilityNeedsUpdate){this._element.setVisibility(this._visibility);this._visibilityNeedsUpdate=!1}}};t.prototype.destroy=function(){this._element.destroy();e.prototype.destroy.call(this)};return t}(o.Content);r.WebContent=s},{"./Content":3,"./DomElement":4,"@cross-border-bridge/post-message-data-bus":33}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.Load="audio:load";e.Unload="audio:unload";e.CreatePlayer="audio:createPlayer";e.DestroyPlayer="audio:destroyPlayer";e.Play="audio:play";e.Stop="audio:stop";e.ChangeVolume="audio:changeVolume";e.ChangeRate="audio:changeRate"}(r.AudioMessage||(r.AudioMessage={}))},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.Init="bridge:init"}(r.BridgeMessage||(r.BridgeMessage={}));!function(e){e.Open="amf:open";e.Close="amf:close";e.Authenticate="amf:authenticate";e.SendTick="amf:sendTick";e.SubscribeTick="amf:subscribeTick";e.UnsubscribeTick="amf:unsubscribeTick";e.ReceiveTick="amf:[t]";e.SendEvent="amf:sendEvent";e.SubscribeEvent="amf:subscribeEvent";e.UnsubscribeEvent="amf:unsubscribeEvent";e.ReceiveEvent="amf:[e]";e.GetTickList="amf:getTickList";e.PutStartPoint="amf:putStartPoint";e.GetStartPoint="amf:getStartPoint"}(r.BridgeAMFlowMessage||(r.BridgeAMFlowMessage={}))},{}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e.Start="loader:start";e.PauseGame="loader:pauseGame";e.ResumeGame="loader:resumeGame";e.StopGame="loader:stopGame";e.SendEvents="loader:sendEvents";e.SetExecutionMode="loader:setExecutionMode";e.TargetTime="loader:targetTime";e.SetReplayOriginDate="loader:setReplayOriginDate";e.SetScale="loader:setScale";e.SetMasterVolume="loader:setMasterVolume";e.GetGameVars="loader:getGameVars";e.ChangeDriverState="loader:changeDriverState";e.ResetSurface="loader:resetSurface";e.GameCreated="loader:gameCreated";e.Error="loader:error";e.PlayOriginDate="loader:playOriginDate";e.AcquireAMFlow="loader:acquireAMFlow";e.ReleaseAMFlow="loader:releaseAMFlow";e.ExternalSend="loader:externalSend";e.SkippingChanged="loader:skippingChanged";e.GameLoaded="loader:gameLoaded";e.GameStarted="loader:gameStarted"}(r.LoaderMessage||(r.LoaderMessage={}))},{}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e){this._requestIndex=0;this._requestHandlersTable={};this._handlersTable={};this._target=e}e.prototype.destroy=function(){this._target=null;this._requestHandlersTable=null;this._handlersTable=null};e.prototype.getTarget=function(){return this._target};e.prototype.request=function(e,t,r){var i="req"+this._requestIndex++,n=this._createRawMessageBase();n.type=e;n.data=t;n.reqId=i;this._target.window.postMessage(n,this._target.targetOrigin);this._requestHandlersTable[i]=r};e.prototype.send=function(e,t){var r=this._createRawMessageBase();r.type=e;r.data=t;this._target.window.postMessage(r,this._target.targetOrigin)};e.prototype.on=function(e,t){var r=this._handlersTable;(r[e]||(r[e]=[])).push({handler:t,isOnce:!1})};e.prototype.once=function(e,t){var r=this._handlersTable;(r[e]||(r[e]=[])).push({handler:t,isOnce:!0})};e.prototype.off=function(e,t){var r=this._handlersTable;r[e]&&0!==r[e].length&&(r[e]=r[e].filter(function(e){return e.handler!==t}))};e.prototype._respond=function(e,t,r){var i=this._createRawMessageBase();i.resId=e;i.data=r;i.errorMessage=t;this._target.window.postMessage(i,this._target.targetOrigin)};e.prototype._handleRawMessageEvent=function(e){var t=this,r=e.data;if(e.source===this._target.window){var i=r.resId;if(null==i){var n=this._handlersTable,o=r.type;if(n&&n.hasOwnProperty(o)&&n[o].length>0){for(var a=n[o].concat(),s=null==r.reqId?null:function(e,i){t._respond(r.reqId,e,i)},l=!1,u=0;u<a.length;++u){var d=a[u];if(d.handler){d.handler(r.data,s);if(d.isOnce){d.handler=null;l=!0}}}l&&this.off(o,null)}else null==r.reqId?console.warn("PostMessageBridgeBase: ignored unknown message",r):this._respond(r.reqId,"No corresponding handler",null)}else{var h=this._requestHandlersTable[i];delete this._requestHandlersTable[i];h(r.errorMessage?new Error(r.errorMessage):null,r.data)}}else console.warn("PostMessageBridgeBase: got "+JSON.stringify(r)+" from unknown source")};e.prototype._createRawMessageBase=function(){return{}};e.prototype._setImmediate=function(e){setTimeout(e,0)};return e}();r.PostMessageBridgeBase=i},{}],20:[function(e,t,r){"use strict";function i(e,t){for(var r=0;r<e.length;++r)if(t(e[r]))return r;return-1}function n(e,t){var r=Object.keys(e),n=i(r,function(r){return t(e[r])});return-1!==n?e[r[n]]:null}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./BridgeMessage"),a=e("./PostMessageDemuxedBridge"),s=function(){function e(e,t){this._waitingEvents=[];this._targetIndex=0;this._bridgeTable=Object.create(null);this._window=e;this._trustedOriginRegExp=t;this._handleMessage_bound=this._handleMessage.bind(this);this._handleDestroyBridge_bound=this._handleDestroyBridge.bind(this);this._window.addEventListener("message",this._handleMessage_bound)}e.prototype.register=function(e,t,r){if(this._trustedOriginRegExp.test(t)){var n=this.findBridge(e);if(n)this._setImmediate(function(){n.getTarget().targetOrigin!==t?r(new Error("PostMessageBridgeDemux#register(): targetOrigin mismatch: "+t)):r(null,n)});else{var o="PDBT"+this._targetIndex++;n=new a.PostMessageDemuxedBridge(o,{targetOrigin:t,window:e},this._handleDestroyBridge_bound);this._bridgeTable[o]=n;var s=i(this._waitingEvents,function(t){return t.source===e});if(-1!==s){var l=this._waitingEvents.splice(s,1)[0];n.processRawMessageEvent(l)}n.initialize(function(e){return r(e,e?null:n)})}}else this._setImmediate(function(){return r(new Error("PostMessageDemuxedBridge#register(): untrusted origin: "+t))})};e.prototype.destroy=function(){var e=this;Object.keys(this._bridgeTable).forEach(function(t){return e._bridgeTable[t].destroy()});this._window.removeEventListener("message",this._handleMessage_bound);this._window=null;this._waitingEvents=null;this._bridgeTable=null;this._trustedOriginRegExp=null;this._handleMessage_bound=null;this._handleDestroyBridge_bound=null};e.prototype.findBridge=function(e){return n(this._bridgeTable,function(t){return t.getTarget().window===e})};e.prototype._handleDestroyBridge=function(e){delete this._bridgeTable[e.selfKey]};e.prototype._handleMessage=function(e){if(this._trustedOriginRegExp.test(e.origin)){var t=e.data,r=t.key,i=!r&&t.type===o.BridgeMessage.Init,n=i?this.findBridge(e.source):this._bridgeTable[r];n?n.processRawMessageEvent(e):i&&this._waitingEvents.push(e)}};e.prototype._setImmediate=function(e){setTimeout(e,0)};return e}();r.PostMessageBridgeDemux=s},{"./BridgeMessage":17,"./PostMessageDemuxedBridge":21}],21:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("./BridgeMessage"),o=e("./PostMessageBridgeBase"),a=function(e){function t(t,r,i){var o=e.call(this,r)||this;o.selfKey=t;o._isConnected=!1;o._handleBeforeDestroyFunc=i;o.once(n.BridgeMessage.Init,function(e,t){t(null,o.selfKey);o._isConnected=!0});return o}i(t,e);t.prototype.destroy=function(){this._handleBeforeDestroyFunc(this);e.prototype.destroy.call(this);this._isConnected=!1;this._handleBeforeDestroyFunc=null};t.prototype.initialize=function(e){this._isConnected?this._setImmediate(e):this.once(n.BridgeMessage.Init,function(){return e()})};t.prototype.processRawMessageEvent=function(e){this._handleRawMessageEvent(e)};return t}(o.PostMessageBridgeBase);r.PostMessageDemuxedBridge=a},{"./BridgeMessage":17,"./PostMessageBridgeBase":19}],22:[function(e,t,r){"use strict";function i(e,t){var r=function(t,r){e.open(t,function(e){return r(e?e.message:null)})},i=function(t,r){e.close(function(e){return r(e?e.message:null)})},o=function(t,r){e.authenticate(t,function(e,t){return e?r(e.message):r(null,t)})},a=function(t){return e.sendTick(t)},s=function(t){return e.sendEvent(t)},l=function(e){return t.send(n.BridgeAMFlowMessage.ReceiveTick,e)},u=function(e){return t.send(n.BridgeAMFlowMessage.ReceiveEvent,e)},d=function(){return e.onTick(l)},h=function(){return e.offTick(l)},c=function(){return e.onEvent(u)},p=function(){return e.offEvent(u)},g=function(t,r){e.getTickList(t.begin,t.end,function(e,t){return e?r(e.message):r(null,t)})},_=function(t,r){e.putStartPoint(t,function(e){return r(e?e.message:null)})},f=function(t,r){e.getStartPoint(t,function(e,t){return e?r(e.message):r(null,t)})};t.on(n.BridgeAMFlowMessage.Open,r);t.on(n.BridgeAMFlowMessage.Close,i);t.on(n.BridgeAMFlowMessage.Authenticate,o);t.on(n.BridgeAMFlowMessage.SendTick,a);t.on(n.BridgeAMFlowMessage.SendEvent,s);t.on(n.BridgeAMFlowMessage.SubscribeTick,d);t.on(n.BridgeAMFlowMessage.UnsubscribeTick,h);t.on(n.BridgeAMFlowMessage.SubscribeEvent,c);t.on(n.BridgeAMFlowMessage.UnsubscribeEvent,p);t.on(n.BridgeAMFlowMessage.GetTickList,g);t.on(n.BridgeAMFlowMessage.PutStartPoint,_);t.on(n.BridgeAMFlowMessage.GetStartPoint,f);return function(){h();p();t.off(n.BridgeAMFlowMessage.Open,r);t.off(n.BridgeAMFlowMessage.Close,i);t.off(n.BridgeAMFlowMessage.Authenticate,o);t.off(n.BridgeAMFlowMessage.SendTick,a);t.off(n.BridgeAMFlowMessage.SendEvent,s);t.off(n.BridgeAMFlowMessage.SubscribeTick,d);t.off(n.BridgeAMFlowMessage.UnsubscribeTick,h);t.off(n.BridgeAMFlowMessage.SubscribeEvent,c);t.off(n.BridgeAMFlowMessage.UnsubscribeEvent,p);t.off(n.BridgeAMFlowMessage.GetTickList,g);t.off(n.BridgeAMFlowMessage.PutStartPoint,_);t.off(n.BridgeAMFlowMessage.GetStartPoint,f)}}Object.defineProperty(r,"__esModule",{value:!0});var n=e("./BridgeMessage");r.setupAMFlowProxy=i},{"./BridgeMessage":17}],23:[function(e,t,r){"use strict";function i(e,t){var r=function(t,r){e.loadAudioAsset(t,function(e){return r(e?e.message:null)})},i=function(t){return e.unloadAudioAsset(t)},o=function(t){return e.createAudioPlayer(t)},a=function(t){return e.destroyAudioPlayer(t)},s=function(t){return e.playAudioPlayer(t)},l=function(t){return e.stopAudioPlayer(t)},u=function(t){e.changeAudioVolume(t.audioPlayerId,t.volume)},d=function(t){e.changeAudioPlaybackRate(t.audioPlayerId,t.playbackRate)};t.on(n.AudioMessage.Load,r);t.on(n.AudioMessage.Unload,i);t.on(n.AudioMessage.CreatePlayer,o);t.on(n.AudioMessage.DestroyPlayer,a);t.on(n.AudioMessage.Play,s);t.on(n.AudioMessage.Stop,l);t.on(n.AudioMessage.ChangeVolume,u);t.on(n.AudioMessage.ChangeRate,d);return function(){t.off(n.AudioMessage.Load,r);t.off(n.AudioMessage.Unload,i);t.off(n.AudioMessage.CreatePlayer,o);t.off(n.AudioMessage.DestroyPlayer,a);t.off(n.AudioMessage.Play,s);t.off(n.AudioMessage.Stop,l);t.off(n.AudioMessage.ChangeVolume,u);t.off(n.AudioMessage.ChangeRate,d)}}Object.defineProperty(r,"__esModule",{value:!0});var n=e("./AudioMessage");r.setupAudioPdiProxy=i},{"./AudioMessage":16}],24:[function(e,t,r){"use strict";function i(e){var t=e.filter(function(e){return/.*\/playlogClientV.*\.js$/.test(e)});return t.length>0?t[0]:null}function n(e){var t=window,r=e.match(/.*\/(playlogClientV.*)\.js$/);return r?t[r[1]]:null}function o(e){var t=window,r=null,o=null,s=null,l=null,u=e.filter(function(e){return/.*\/engineFilesV.*\.js$/.test(e)})[0];if(u){var d=u.match(/.*\/(engineFilesV.*)\.js$/);if(d){var h=t[d[1]];r=h.akashicEngine;o=h.gameDriver;s=h.pdiBrowser}}var c=i(e);c&&(l=n(c));if(r&&o&&s)return[null,{g:r,GameDriver:o,PdiBrowser:s,PlaylogClient:l}];var p=null;try{r=t.require("@akashic/akashic-engine");o=t.require("@akashic/game-driver");s=t.require("@akashic/pdi-browser");try{l=t.require("@akashic/playlog-client")}catch(e){}if(r&&o&&s)return[null,{g:r,GameDriver:o,PdiBrowser:s,PlaylogClient:l}]}catch(e){p=e}return[a.ErrorFactory.createLoadMuduleError(p||new Error("unknown failure for require()")),null]}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./Error");r.findPlaylogClientUrl=i;r.detectPlaylogClientObject=n;r.detectEngineFileObject=o},{"./Error":6}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=e("@akashic/akashic-gameview");r.ScaleMode=i.ScaleMode;r.VerticalAlignment=i.VerticalAlignment;r.HorizontalAlignment=i.HorizontalAlignment;r.ExecutionMode=i.ExecutionMode;r.ProtocolType=i.ProtocolType;var n=e("./AkashicGameViewWeb");r.AkashicGameView=n.AkashicGameView;var o=e("./SharedObject");r.GameViewSharedObject=o.GameViewSharedObject;r.GameContentSharedObject=o.GameContentSharedObject;var a=e("./Content");r.Content=a.Content;var s=e("./Downloader");r.XhrDownloader=s.XhrDownloader;r.RetryDownloader=s.RetryDownloader;var l=e("./WebContent");r.WebContent=l.WebContent;var u=e("./GameContent");r.GameContent=u.GameContent;var d=e("./utils");r.ObjectList=d.ObjectList},{"./AkashicGameViewWeb":1,"./Content":3,"./Downloader":5,"./GameContent":8,"./SharedObject":11,"./WebContent":15,"./utils":26,
"@akashic/akashic-gameview":27}],26:[function(e,t,r){"use strict";function i(e,t){Object.keys(t).forEach(function(r){e[r]=t[r]});return e}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(){this._objectList=[]}e.prototype.addItem=function(e){this._objectList.push(e)};e.prototype.removeItem=function(e){this._objectList=this._objectList.filter(function(t){return t!==e})};e.prototype.removeAllItems=function(){this._objectList=[]};e.prototype.forEach=function(e){this._objectList.forEach(e)};return e}();r.ObjectList=n;r.assignObject=i},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});!function(e){e[e.None=0]="None";e[e.Fill=1]="Fill";e[e.AspectFit=2]="AspectFit"}(r.ScaleMode||(r.ScaleMode={}));!function(e){e[e.Top=0]="Top";e[e.Center=1]="Center";e[e.Bottom=2]="Bottom"}(r.VerticalAlignment||(r.VerticalAlignment={}));!function(e){e[e.Left=0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"}(r.HorizontalAlignment||(r.HorizontalAlignment={}));!function(e){e[e.Active=0]="Active";e[e.Passive=1]="Passive";e[e.Replay=2]="Replay"}(r.ExecutionMode||(r.ExecutionMode={}));!function(e){e[e.WebSocket=0]="WebSocket"}(r.ProtocolType||(r.ProtocolType={}))},{}],28:[function(e,t,r){"use strict";var i=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return e(t,r)};return function(t,r){function i(){this.constructor=t}e(t,r);t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(r,"__esModule",{value:!0});var n=e("./Trigger"),o=function(e){function t(t,r,i){var n=e.call(this)||this;n.chain=t;n.filter=r;n.filterOwner=i;n._isActivated=!1;return n}i(t,e);t.prototype.add=function(t,r){e.prototype.add.call(this,t,r);if(!this._isActivated){this.chain.add(this._onChainTriggerFired,this);this._isActivated=!0}};t.prototype.addOnce=function(t,r){e.prototype.addOnce.call(this,t,r);if(!this._isActivated){this.chain.add(this._onChainTriggerFired,this);this._isActivated=!0}};t.prototype.remove=function(t,r){e.prototype.remove.call(this,t,r);if(0===this.length&&this._isActivated){this.chain.remove(this._onChainTriggerFired,this);this._isActivated=!1}};t.prototype.removeAll=function(t){e.prototype.removeAll.call(this,t);if(0===this.length&&this._isActivated){this.chain.remove(this._onChainTriggerFired,this);this._isActivated=!1}};t.prototype.destroy=function(){e.prototype.destroy.call(this);this.chain.remove(this._onChainTriggerFired,this);this.filter=null;this.filterOwner=null;this._isActivated=!1};t.prototype._onChainTriggerFired=function(e){this.filter&&!this.filter.call(this.filterOwner,e)||this.fire(e)};return t}(n.Trigger);r.ChainTrigger=o},{"./Trigger":29}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(){this._handlers=[];this.length=0}e.prototype.add=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!1,name:void 0});else{var r=e;"number"==typeof r.index?this._handlers.splice(r.index,0,{func:r.func,owner:r.owner,once:!1,name:r.name}):this._handlers.push({func:r.func,owner:r.owner,once:!1,name:r.name})}this.length=this._handlers.length};e.prototype.addOnce=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!0,name:void 0});else{var r=e;"number"==typeof r.index?this._handlers.splice(r.index,0,{func:r.func,owner:r.owner,once:!0,name:r.name}):this._handlers.push({func:r.func,owner:r.owner,once:!0,name:r.name})}this.length=this._handlers.length};e.prototype.handle=function(e,t,r){this.add(t?{owner:e,func:t,name:r}:{func:e})};e.prototype.fire=function(e){if(this._handlers&&this._handlers.length){for(var t=this._handlers.concat(),r=0;r<t.length;r++){var i=t[r];if(i.func.call(i.owner,e)||i.once){var n=this._handlers.indexOf(i);-1!==n&&this._handlers.splice(n,1)}}null!=this._handlers&&(this.length=this._handlers.length)}};e.prototype.contains=function(e,t){for(var r="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++)if(this._comparePartial(r,this._handlers[i]))return!0;return!1};e.prototype.remove=function(e,t){for(var r="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++){var n=this._handlers[i];if(r.func===n.func&&r.owner===n.owner&&r.name===n.name){this._handlers.splice(i,1);--this.length;return}}};e.prototype.removeAll=function(e){var t=[];if(e)for(var r=0;r<this._handlers.length;r++){var i=this._handlers[r];this._comparePartial(e,i)||t.push(i)}this._handlers=t;this.length=this._handlers.length};e.prototype.destroy=function(){this._handlers=null;this.length=null};e.prototype.destroyed=function(){return null===this._handlers};e.prototype._comparePartial=function(e,t){return(void 0===e.func||e.func===t.func)&&((void 0===e.owner||e.owner===t.owner)&&(void 0===e.name||e.name===t.name))};return e}();r.Trigger=i},{}],30:[function(e,t,r){"use strict";function i(e){for(var t in e)r.hasOwnProperty(t)||(r[t]=e[t])}Object.defineProperty(r,"__esModule",{value:!0});i(e("./Trigger"));i(e("./ChainTrigger"))},{"./ChainTrigger":28,"./Trigger":29}],31:[function(e,t,r){
// Copyright  2017 DWANGO Co., Ltd.
var i=function(){function e(e,t){this._sender=e;this._receiver=t;this._handlers=[];var r=this;this._receiver.setHandler(function(){for(var e=0,t=r._handlers;e<t.length;e++){t[e].apply(r,arguments)}})}e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._sender.send.apply(this._sender,e)};e.prototype.addHandler=function(e){this._handlers.push(e)};e.prototype.removeHandler=function(e){var t=this._handlers.indexOf(e);t<0||this._handlers.splice(t,1)};e.prototype.removeAllHandlers=function(){this._handlers=[]};e.prototype.destroy=function(){this.removeAllHandlers();this._receiver.setHandler(void 0)};return e}();r.MemoryQueueDataBus=i},{}],32:[function(e,t,r){
// Copyright  2017 DWANGO Co., Ltd.
var i=function(){function e(e){this._handler=e}e.prototype.setHandler=function(e){this._handler=e};e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._handler&&this._handler.apply(null,e)};return e}();r.MemoryQueue=i},{}],33:[function(e,t,r){function i(e){Object.keys(l).length||window.addEventListener("message",o);var t=s.indexOf(e._target);-1===t&&(t=s.push(e._target)-1);l[t]||(l[t]=[]);l[t].push(e)}function n(e){var t=s.indexOf(e._target);if(-1!==t){l[t]=l[t].filter(function(t){return t!==e});if(!l[t].length){delete l[t];s[t]=null}Object.keys(l).length||window.removeEventListener("message",o)}}function o(e){var t=s.indexOf(e.source);if(-1!==t){var r=null;try{r=JSON.parse(e.data)}catch(e){return}l[t].forEach(function(e){e._onMessage(r)})}}
// Copyright  2017 DWANGO Co., Ltd.
var a=function(){function e(e){this._target=e;this._handlers=[]}e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this._target&&this._target.postMessage(JSON.stringify(e),"*")};e.prototype.addHandler=function(e){if(this._target){0===this._handlers.length&&i(this);this._handlers.push(e)}};e.prototype.removeHandler=function(e){if(this._target){var t=this._handlers.indexOf(e);if(!(t<0)){this._handlers.splice(t,1);0===this._handlers.length&&n(this)}}};e.prototype.removeAllHandlers=function(){if(this._target&&0!==this._handlers.length){this._handlers=[];n(this)}};e.prototype._onMessage=function(e){if(this._target&&0!==this._handlers.length){for(var t=[],r=0,i=this._handlers;r<i.length;r++){var n=i[r];n.apply(null,e)&&t.push(n)}for(var o=0;o<t.length;o++){var n=t[o];this.removeHandler(n)}}};e.prototype.destroy=function(){if(this._target){this.removeAllHandlers();this._target=void 0}};return e}();r.PostMessageDataBus=a;var s=[],l={}},{}]},{},[25])(25)});