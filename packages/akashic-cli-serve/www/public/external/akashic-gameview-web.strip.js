!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.agv=e()}}(function(){return function i(r,o,a){function s(t,e){if(!o[t]){if(!r[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}n=o[t]={exports:{}};r[t][0].call(n.exports,function(e){return s(r[t][1][e]||e)},n,n.exports,i,r,o,a)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.AkashicGameView=void 0;var i=e("./SharedObject"),r=e("./DomElement"),o=e("./Error"),e=function(){function e(e){this._contents={};this._nextContentId=1;this._hasOwnGameViewShared=!1;this.vars={};var t=new r.GameViewElement(e.container);if(e.sharedObject)this._gameViewShared=e.sharedObject;else{this._gameViewShared=new i.GameViewSharedObject({baseDownloader:e.baseDownloader,window:e.window,untrustedFrameUrl:e.untrustedFrameUrl,trustedChildOrigin:e.trustedChildOrigin});this._hasOwnGameViewShared=!0}this._gameContentShared=new i.GameContentSharedObject({gameViewElement:t,gameViewWidth:e.width,gameViewHeight:e.height});t.setViewSize(e.width,e.height)}e.prototype.addContent=function(e){if(null!=e.id)throw o.ErrorFactory.createInvalidOperationError("content already added: "+e.id);e.id=this._nextContentId++;e.start(this._gameViewShared,this._gameContentShared);this._contents[e.id+""]=e};e.prototype.removeContent=function(e){if(null==e.id)throw o.ErrorFactory.createInvalidOperationError("content already removed");e.destroy();delete this._contents[e.id+""];e.id=null};e.prototype.removeAllContents=function(){var t=this;Object.keys(this._contents).forEach(function(e){t.removeContent(t._contents[e])})};e.prototype.setSocketOptions=function(e){this._gameViewShared.sessionManager.setSocketOptions(e)};e.prototype.registerExternalPlugin=function(e){this._gameViewShared.pluginManager.register(e)};e.prototype.setViewSize=function(e,t){this._gameContentShared.viewWidth=e;this._gameContentShared.viewHeight=t;this._gameContentShared.gameViewElement.setViewSize(e,t)};e.prototype.getViewSize=function(){return{width:this._gameContentShared.viewWidth,height:this._gameContentShared.viewHeight}};e.prototype.getContentById=function(e){return this._contents[e+""]};e.prototype.getGameViewSharedObject=function(){return this._gameViewShared};e.prototype.destroy=function(){if(!this.destroyed()){this.removeAllContents();if(this._hasOwnGameViewShared){this._gameViewShared.destroyed()||this._gameViewShared.destroy();this._hasOwnGameViewShared=!1}this._gameViewShared=null;this._gameContentShared=null}};e.prototype.destroyed=function(){return null==this._gameViewShared};return e}();n.AkashicGameView=e},{"./DomElement":4,"./Error":6,"./SharedObject":12}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.calcAspectFitLayout=n.calcFillLayout=n.calcNoneLayout=void 0;var i=e("@akashic/akashic-gameview");n.calcNoneLayout=function(e){var t=e.naturalWidth,n=e.naturalHeight;return{x:r(e,t),y:o(e,n),width:t,height:n}};n.calcFillLayout=function(e){return{x:0,y:0,width:e.outerWidth,height:e.outerHeight}};n.calcAspectFitLayout=function(e){var t=e.outerWidth/e.naturalWidth,n=e.outerHeight/e.naturalHeight,t=Math.min(t,n),n=e.naturalWidth*t,t=e.naturalHeight*t;return{x:r(e,n),y:o(e,t),width:n,height:t}};function r(e,t){switch(e.horizontalAlignment){case i.HorizontalAlignment.Left:return 0;case i.HorizontalAlignment.Center:return(e.outerWidth-t)/2;case i.HorizontalAlignment.Right:return e.outerWidth-t;default:return 0}}function o(e,t){switch(e.verticalAlignment){case i.VerticalAlignment.Top:return 0;case i.VerticalAlignment.Center:return(e.outerHeight-t)/2;case i.VerticalAlignment.Bottom:return e.outerHeight-t;default:return 0}}},{"@akashic/akashic-gameview":29}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Content=void 0;var i=e("@akashic/akashic-gameview"),r=e("./utils"),o=e("./Error"),e=function(){function e(e,t){this._contentLoadListeners=new r.ObjectList;this._errorListeners=new r.ObjectList;this._contentDestroyListeners=new r.ObjectList;this._contentAreaNeedsUpdate=!1;this._zIndexNeedsUpdate=!1;this._contentLayout={scaleMode:i.ScaleMode.AspectFit,verticalAlignment:i.VerticalAlignment.Center,horizontalAlignment:i.HorizontalAlignment.Center,passthroughEvent:!0,backgroundColor:"transparent"};this._contentLayoutNeedsUpdate=!1;this._visibility=!0;this._visibilityNeedsUpdate=!1;this.id=null;this.vars={};this.type=t;this._contentUrl=e.contentUrl;null!=e.contentArea&&this.setContentArea(e.contentArea);null!=e.zIndex&&this.setZIndex(e.zIndex);null!=e.contentLayout&&this.setContentLayout(e.contentLayout);this._gameContentShared=null;this._gameViewShared=null;this._contentArea=null;this._zIndex=null;this._dataBus=null}e.prototype.destroy=function(){this._contentDestroyListeners.forEach(function(e){return e.onDestroy()})};e.prototype.addContentLoadListener=function(e){this._contentLoadListeners.addItem(e)};e.prototype.removeContentLoadListener=function(e){this._contentLoadListeners.removeItem(e)};e.prototype.addErrorListener=function(e){this._errorListeners.addItem(e)};e.prototype.removeErrorListener=function(e){this._errorListeners.removeItem(e)};e.prototype.addContentDestroyListener=function(e){this._contentDestroyListeners.addItem(e)};e.prototype.removeContentDestroyListener=function(e){this._contentDestroyListeners.removeItem(e)};e.prototype.setContentArea=function(e){this._contentArea=(0,r.assignObject)(this._contentArea||{},e);this._contentAreaNeedsUpdate=!0;this._update()};e.prototype.getContentArea=function(){return(0,r.assignObject)({},this._contentArea)};e.prototype.setZIndex=function(e){this._zIndex=e;this._zIndexNeedsUpdate=!0;this._update()};e.prototype.getZIndex=function(){return this._zIndex};e.prototype.moveTopMost=function(){if(this._gameContentShared)this.setZIndex(this._gameContentShared.largestZIndex+1);else{var t=o.ErrorFactory.createInvalidOperationError("moveTopMost");this._errorListeners.forEach(function(e){return e.onError(t)})}};e.prototype.setContentLayout=function(e){this._contentLayout=(0,r.assignObject)(this._contentLayout||{},e);this._contentLayoutNeedsUpdate=!0;this._update()};e.prototype.getContentLayout=function(){return(0,r.assignObject)({},this._contentLayout)};e.prototype.hide=function(){if(!1!==this._visibility){this._visibility=!1;this._visibilityNeedsUpdate=!0;this._update()}};e.prototype.show=function(){if(!0!==this._visibility){this._visibility=!0;this._visibilityNeedsUpdate=!0;this._update()}};e.prototype.isVisible=function(){return this._visibility};e.prototype.getDataBus=function(){return this._dataBus};return e}();n.Content=e},{"./Error":6,"./utils":28,"@akashic/akashic-gameview":29}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.GameContentElement=n.WebContentElement=n.GameViewElement=void 0;var i=e("@akashic/akashic-gameview"),u=e("./utils"),r={mousedown:i.DroppedEventType.Down,mousemove:i.DroppedEventType.Move,mouseup:i.DroppedEventType.Up,touchstart:i.DroppedEventType.Down,touchmove:i.DroppedEventType.Move,touchend:i.DroppedEventType.Up,click:i.DroppedEventType.Click},e=function(){function e(e){var t=document.createElement("div");t.style.position="relative";t.style.overflow="hidden";t.style.pointerEvents="none";e.appendChild(t);this._parent=e;this._htmlElement=t}e.prototype.appendChild=function(e){this._htmlElement.appendChild(e)};e.prototype.removeChild=function(e){this._htmlElement.removeChild(e)};e.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)};e.prototype.setViewSize=function(e,t){this._htmlElement.style.width=e+"px";this._htmlElement.style.height=t+"px"};return e}(),i=(n.GameViewElement=e,function(){function e(e,t,n){var i=this,r=document.createElement("iframe");r.style.position="absolute";r.style.borderStyle="none";r.style.pointerEvents="auto";r.addEventListener("load",function(){setTimeout(function(){n(i._htmlElement)},0)});r.src=t;e.appendChild(r);this._parent=e;this._htmlElement=r}e.prototype.destroy=function(){this._parent.removeChild(this._htmlElement)};e.prototype.setContentArea=function(e){this._htmlElement.style.left=e.x+"px";this._htmlElement.style.top=e.y+"px";this._htmlElement.style.width=e.width+"px";this._htmlElement.style.height=e.height+"px"};e.prototype.setContentLayout=function(e){this._htmlElement.style.backgroundColor=e.backgroundColor};e.prototype.setZIndex=function(e){this._htmlElement.style.zIndex=e+""};e.prototype.setVisibility=function(e){this._htmlElement.style.display=e?"block":"none"};e.prototype.getContentWindow=function(){return this._htmlElement.contentWindow};return e}()),e=(n.WebContentElement=i,function(){function e(e){var t=e.parent,n=e.frameSrc,i=e.onCreated,e=e.runInIframe,r=this;this._isDropDomEvent=!1;this._isTouched=!1;this._droppedDomEventListeners=new u.ObjectList;this._handleMouseDown_bound=this._handleMouseDown.bind(this);this._handleMouseMove_bound=this._handleMouseMove.bind(this);this._handleMouseUp_bound=this._handleMouseUp.bind(this);this._handleTouchStart_bound=this._handleTouchStart.bind(this);this._handleTouchMove_bound=this._handleTouchMove.bind(this);this._handleTouchEnd_bound=this._handleTouchEnd.bind(this);this._handleClick_bound=this._handleClick.bind(this);var o=document.createElement("div");o.style.position="absolute";o.style.overflow="hidden";o.style.pointerEvents="auto";if(n){(s=document.createElement("iframe")).addEventListener("load",function(){setTimeout(function(){i(window,r._innerHtmlElement)},0)});s.sandbox="allow-scripts allow-same-origin";s.src=n;s.scrolling="no";l=s}else if(e){var a=document.createElement("iframe");a.name="trusted-loader-window";a.scrolling="no";a.addEventListener("load",function(){var e=a.contentWindow,t=a.contentDocument;t.body.style.padding="0";t.body.style.margin="0";t.body.addEventListener("contextmenu",function(e){return e.preventDefault()});var n=t.createElement("div");t.body.appendChild(n);i(e,n)});l=a}else{var s,l=s=document.createElement("div");setTimeout(function(){return i(window,l)},0)}l.style.position="absolute";l.style.width="100%";l.style.height="100%";l.style.borderStyle="none";l.style.overflow="hidden";l.style.pointerEvents="auto";n=document.createElement("div");n.style.position="absolute";n.style.pointerEvents="none";n.appendChild(l);o.appendChild(n);t.appendChild(o);this._parent=t;this._outerHtmlElement=o;this._innerHtmlElement=n;this._gameContainerHtmlElement=l}e.prototype.destroy=function(){this._cleanupDropDomEventListeners();this._parent.removeChild(this._outerHtmlElement)};e.prototype.setInnerSize=function(e){this._innerHtmlElement.style.left=e.x+"px";this._innerHtmlElement.style.top=e.y+"px";this._innerHtmlElement.style.width=e.width+"px";this._innerHtmlElement.style.height=e.height+"px"};e.prototype.setContentArea=function(e){this._outerHtmlElement.style.left=e.x+"px";this._outerHtmlElement.style.top=e.y+"px";this._outerHtmlElement.style.width=e.width+"px";this._outerHtmlElement.style.height=e.height+"px"};e.prototype.setContentLayout=function(e){this._outerHtmlElement.style.backgroundColor=e.backgroundColor;this._outerHtmlElement.style.pointerEvents=e.passthroughEvent?"none":"auto"};e.prototype.setZIndex=function(e){this._outerHtmlElement.style.zIndex=e+""};e.prototype.setVisibility=function(e){this._outerHtmlElement.style.display=e?"block":"none"};e.prototype.getContentWindow=function(){return this._gameContainerHtmlElement.contentWindow};e.prototype.addDroppedDomEventListener=function(e){this._droppedDomEventListeners.addItem(e)};e.prototype.removeDroppedDomEventListener=function(e){this._droppedDomEventListeners.removeItem(e)};e.prototype.setDropDomEvent=function(e){if(e){this._gameContainerHtmlElement.style.pointerEvents="none";this._innerHtmlElement.style.pointerEvents="auto";this._innerHtmlElement.addEventListener("mousedown",this._handleMouseDown_bound);this._innerHtmlElement.addEventListener("touchstart",this._handleTouchStart_bound);this._innerHtmlElement.addEventListener("click",this._handleClick_bound)}else{this._gameContainerHtmlElement.style.pointerEvents="auto";this._innerHtmlElement.style.pointerEvents="none";this._cleanupDropDomEventListeners()}this._isDropDomEvent=e};e.prototype._cleanupDropDomEventListeners=function(){this._innerHtmlElement.removeEventListener("mousedown",this._handleMouseDown_bound);this._innerHtmlElement.removeEventListener("touchstart",this._handleTouchStart_bound);this._innerHtmlElement.removeEventListener("click",this._handleClick_bound);this._innerHtmlElement.removeEventListener("touchmove",this._handleTouchMove_bound);this._innerHtmlElement.removeEventListener("touchend",this._handleTouchEnd_bound);window.removeEventListener("mousemove",this._handleMouseMove_bound);window.removeEventListener("mouseup",this._handleMouseUp_bound)};e.prototype._handleMouseDown=function(e){if(!this._isTouched){window.addEventListener("mousemove",this._handleMouseMove_bound);window.addEventListener("mouseup",this._handleMouseUp_bound);this._fireDroppedDomEvent(e)}};e.prototype._handleMouseMove=function(e){this._isTouched||this._fireDroppedDomEvent(e)};e.prototype._handleMouseUp=function(e){window.removeEventListener("mousemove",this._handleMouseMove_bound);window.removeEventListener("mouseup",this._handleMouseUp_bound);this._fireDroppedDomEvent(e)};e.prototype._handleTouchStart=function(e){this._isTouched=!0;this._innerHtmlElement.addEventListener("touchmove",this._handleTouchMove_bound);this._innerHtmlElement.addEventListener("touchend",this._handleTouchEnd_bound);this._fireDroppedDomEvent(e)};e.prototype._handleTouchMove=function(e){this._fireDroppedDomEvent(e)};e.prototype._handleTouchEnd=function(e){this._innerHtmlElement.removeEventListener("touchmove",this._handleTouchMove_bound);this._innerHtmlElement.removeEventListener("touchend",this._handleTouchEnd_bound);this._fireDroppedDomEvent(e)};e.prototype._handleClick=function(e){this._isTouched=!1;this._isDropDomEvent&&this._fireDroppedDomEvent(e)};e.prototype._fireDroppedDomEvent=function(t){var n=r[t.type];null!=n&&this._droppedDomEventListeners.forEach(function(e){return e(n,t)})};return e}());n.GameContentElement=e},{"./utils":28,"@akashic/akashic-gameview":29}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.RetryDownloader=n.XhrDownloader=void 0;var i=function(){function e(e){this.defaultTimeOut=e=void 0===e?15e3:e;this._createXmlHttpRequest=function(){return new XMLHttpRequest}}e.prototype.start=function(t,n){var i=this._createXmlHttpRequest();i.open("GET",t);i.responseType="text";i.timeout=this.defaultTimeOut;i.addEventListener("load",function(e){200<=i.status&&i.status<300?n(null,i.responseText):n(new Error("request failed: "+t),"")});i.addEventListener("error",function(e){return n(new Error("request error: "+t),"")});i.addEventListener("timeout",function(e){return n(new Error("request timed out: "+t),"")});i.send();return{cancel:function(){i.readyState!==i.DONE&&i.abort()},isFinished:function(){return i.readyState===i.DONE}}};return e}(),r=(n.XhrDownloader=i,function(){function e(e,t){void 0===e&&(e=new i);void 0===t&&(t=2);this.baseDownloader=e;this.defaultRetry=t}e.prototype.start=function(t,n){function i(){var e=r.baseDownloader.start(t,function(e,t){null==e?n(null,t):--o.count<=0?n(e,t):setTimeout(i,0)});a.cancel=e.cancel;a.isFinished=e.isFinished}var r=this,o={count:this.defaultRetry},a={cancel:function(){},isFinished:function(){return!1}};setTimeout(i,0);return a};return e}());n.RetryDownloader=r},{}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ErrorFactory=void 0;n=n.ErrorFactory||(n.ErrorFactory={});n.createInvalidOperationError=i("InvalidOperation");n.createGameDriverError=i("GameDriverError");n.createLoadMuduleError=i("LoadMuduleError");n.createPlaylogError=i("PlaylogError");n.createHttpRequestError=i("HttpRequestError");n.createInvalidGameError=i("InvalidGameError");n.createAbortGameError=i("AbortGameError");n.createPostMessageError=i("PostMessageError");n.createInsecureFrameUrlError=i("InsecureFrameUrlError");function i(n){return function(e){var t=new Error(n);t.name=n;t.cause=e;return t}}},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ExternalPluginManager=void 0;var i=e("@akashic/trigger"),e=function(){function e(){this.onRegister=new i.Trigger;this._externalPlugin={};this._implicitPluginNames=[]}e.prototype.register=function(e){(this._externalPlugin[e.name]=e).implicit&&this._implicitPluginNames.push(e.name);e.onregister&&e.onregister(this);this.onRegister.fire(e)};e.prototype.find=function(e){return this._externalPlugin[e]};e.prototype.implicitPluginNames=function(){return this._implicitPluginNames};return e}();n.ExternalPluginManager=e},{"@akashic/trigger":37}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ExternalPluginSignatureCaller=void 0;var i=function(){function e(e,t){this._trustedFunctionTable=Object.create(null,{});for(var n=Object.keys(e.content),i=0;i<n.length;i++)this.setupFunctionTable(e.content[n[i]],t,n[i],n[i])}e.prototype.call=function(e,t,n){e=this._trustedFunctionTable[e];e&&e(t,n)};e.prototype.setupFunctionTable=function(e,t,i,n){if("function"===e.type)if(null!=e.callbackProp){var r=e.callbackProp.match(/arguments\[(\d+)\]\.(.+)$/);if(null==r)throw new Error("invalid callbackProp geven");var o=parseInt(r[1],10),a=r[2];this._trustedFunctionTable[n]=function(e,n){if(n)if(null!=e[o]){e[o][a]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n(null,e)};t[i].apply(t,e)}else{t[i].apply(t,e);n(null)}}}else this._trustedFunctionTable[n]=function(e){return t[i].apply(t,e)};else if("object"===e.type)for(var s=Object.keys(e.content),l=0;l<s.length;l++)this.setupFunctionTable(e.content[s[l]],t[i],s[l],n+":"+s[l])};return e}();n.ExternalPluginSignatureCaller=i},{}],9:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.GameContent=void 0;var u=e("@akashic/akashic-gameview"),o=e("@cross-border-bridge/memory-queue"),a=e("@cross-border-bridge/memory-queue-data-bus"),s=e("./Content"),l=e("./DomElement"),d=e("./TrustedGameLoader"),h=e("./UntrustedGameLoader"),c=e("./utils"),p=e("./Error"),_=e("./CalcLayout"),e=function(n){r(e,n);function e(e){var t=this;(t=n.call(this,e,"game")||this)._skippingListeners=new c.ObjectList;t._droppedListeners=new c.ObjectList;t._loadStartTime=0;t._isRunning=!1;t._isReplay=!1;t._naturalWidth=0;t._naturalHeight=0;t._bufferingNaturalWidth=null;t._bufferingNaturalHeight=null;t._updatePrimarySurfaceSizeTimeoutId=null;t._lastUpdatePrimarySurfaceSizeTime=null;t._updatePrimarySurfaceSizeDelay=1e3;t._untrusted=!1;t._replayData=null;t._engineConfig=null;t._destroyed=!1;t._eventDropPolicy=void 0;t._isDropEventNeedsUpdate=!1;t._handleDroppedDomEvent_bound=t._handleDroppedDomEvent.bind(t);t._contentUrl=e.contentUrl;t._player=e.player;t._playConfig=e.playConfig;t._untrustedFrameUrl=e.untrustedFrameUrl;t._untrustedFrameTargetOrigin=e.untrustedFrameTargetOrigin;t._argument=e.argument;t._pauseOnStart=!!e.pause;t._initialEvents=e.initialEvents;t._givenUntrusted=e.untrusted;t._givenRunInIframe=!!e.runInIframe;t._customizer=e.gameLoaderCustomizer;t._audioPdiHandlers=e.audioPdiHandlers;t._eventDropPolicy=null!=(e=e.eventDropPolicy)?e:void 0;t._loader=null;t._element=null;t._pluginDataBus=null;return t}e.prototype.start=function(e,t){var n=this;this._loadStartTime=(new Date).getTime();this._gameViewShared=e;this._gameContentShared=t;if(this._customizer&&null!=this._customizer.overwriteEngineConfig){var i=this._customizer.overwriteEngineConfig;setTimeout(function(){return n._start_createElement(i)},0)}else this._gameViewShared.downloader.start(this._contentUrl,function(e,t){e?n._fireError(p.ErrorFactory.createHttpRequestError(e)):n._start_createElement(t)})};e.prototype._parseEngineConfig=function(e){var t;try{t=JSON.parse(e)}catch(e){this._fireError(p.ErrorFactory.createInvalidGameError(e));return null}null==t.engine_urls&&(t.engine_urls=[]);null==t.external&&(t.external=[]);return t};e.prototype._start_createElement=function(e){var n=this;if(!this._destroyed){var t=this._gameContentShared,e=this._engineConfig=this._parseEngineConfig(e);if(e){var i=e.untrusted,e=!!this._givenRunInIframe||!!e.runInIframe,r=this._givenUntrusted;this._untrusted=!0===r||null==r&&!0===i;this._element=new l.GameContentElement({parent:t.gameViewElement,frameSrc:this._untrusted&&null!=(i=null!=(r=this._untrustedFrameUrl)?r:this._gameViewShared.untrustedFrameUrl)?i:null,onCreated:function(e,t){return n._start_startLoader(e,t)},runInIframe:e});this._element.addDroppedDomEventListener(this._handleDroppedDomEvent_bound);null==this._contentArea&&this.setContentArea({x:0,y:0,width:t.viewWidth,height:t.viewHeight});null==this._zIndex&&this.setZIndex(++t.largestZIndex);null==this._dataBus&&this._initDataBus()}}};e.prototype._start_startLoader=function(e,o){var a=this;if(!this._destroyed){var t=this._engineConfig;if(this._untrusted){var n=this._getUntrustedFrameHostname(),i=e.location.hostname;if(!n||""!==i&&0===n.indexOf(i))return this._fireError(p.ErrorFactory.createInsecureFrameUrlError()),void 0;n=this._element.getContentWindow(),i=this._getUntrustedTargetOrigin();this._loader=new h.UntrustedGameLoader({engineConfig:t,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers,contentWindow:n,targetOrigin:i})}else this._loader=new d.TrustedGameLoader({engineConfig:t,shared:this._gameViewShared,customizer:this._customizer,audioPdiHandler:this._audioPdiHandlers,window:e});for(var r={},s=0;s<this._engineConfig.external.length;s++){var l=this._gameViewShared.pluginManager.find(this._engineConfig.external[s]);l&&l.untrustedSignature&&(r[l.name]=l.untrustedSignature)}this._loader.start({parentHtmlElement:o,contentUrl:this._contentUrl,initialEvents:this._initialEvents,argument:this._argument,pause:this._pauseOnStart,player:this._player,playConfig:this._playConfig,gameCreatedHandler:function(n){if(a._loader){a._workaroundEngine(o);a._handleGameArgument(a._argument);a._naturalWidth=n.width;a._naturalHeight=n.height;a._contentLayoutNeedsUpdate=!0;a._isReplay=a._playConfig.executionMode===u.ExecutionMode.Replay;a._isDropEventNeedsUpdate=!0;a._isRunning=!0;a._update();var i=[],r=function(e){if(!(0<=i.indexOf(e))){var t=a._gameViewShared.pluginManager.find(e);if(null!=t){i.push(e);t.requires&&t.requires.forEach(r);try{t.onload(n,a.getPluginDataBus(),a)}catch(e){console.error(e)}}}};a._engineConfig.external.forEach(r);a._gameViewShared.pluginManager.implicitPluginNames().forEach(r);n.skippingChangedTrigger&&n.skippingChangedTrigger.handle(function(t){a._skippingListeners.forEach(function(e){return e.onSkip(t)})});var t=((new Date).getTime()-a._loadStartTime)/1e3;a._contentLoadListeners.forEach(function(e){return e.onLoad(t)})}},errorHandler:function(t){return a._errorListeners.forEach(function(e){return e.onError(t)})},gameFinishedHandler:function(){a._isRunning=!1},replayData:this._replayData||this._playConfig.replayData,externalPluginSignature:{type:"object",content:r}})}};e.prototype._update=function(){if(null!=this._element){if(this._contentAreaNeedsUpdate||this._contentLayoutNeedsUpdate){this._element.setContentArea(this._contentArea);this._element.setContentLayout(this._contentLayout);var e={outerWidth:this._contentArea.width,outerHeight:this._contentArea.height,naturalWidth:this._naturalWidth,naturalHeight:this._naturalHeight,horizontalAlignment:this._contentLayout.horizontalAlignment,verticalAlignment:this._contentLayout.verticalAlignment},t=void 0;switch(this._contentLayout.scaleMode){case u.ScaleMode.AspectFit:t=_.calcAspectFitLayout(e);break;case u.ScaleMode.Fill:t=_.calcFillLayout(e);break;default:t=_.calcNoneLayout(e)}this._element.setInnerSize(t);if(this._isRunning&&this._loader){!this._loader.resizablePrimarySurface||t.width===this._naturalWidth&&t.height===this._naturalHeight||this._requestResizePrimarySurface(t.width,t.height);this._loader.setScale(t.width/this._naturalWidth,t.height/this._naturalHeight)}this._contentAreaNeedsUpdate=!1;this._contentLayoutNeedsUpdate=!1}if(this._zIndexNeedsUpdate){this._element.setZIndex(this._zIndex);this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex);this._zIndexNeedsUpdate=!1}if(this._visibilityNeedsUpdate){this._element.setVisibility(this._visibility);this._visibilityNeedsUpdate=!1}if(this._isDropEventNeedsUpdate){this._updateDropEvent();this._isDropEventNeedsUpdate=!1}}};e.prototype._initDataBus=function(){var e=new o.MemoryQueue,t=new o.MemoryQueue,n=new a.MemoryQueueDataBus(t,e),e=new a.MemoryQueueDataBus(e,t);this._dataBus=n;this._pluginDataBus=e};e.prototype.destroy=function(){if(!this._destroyed){if(this._loader){this._loader.stopGame();this._loader=void 0}if(this._pluginDataBus){this._pluginDataBus.destroy();this._pluginDataBus=void 0}if(this._dataBus){this._dataBus.destroy();this._dataBus=void 0}if(this._element){this._element.destroy();this._element=void 0}this._destroyed=!0;this._cancelResizePrimarySurface();n.prototype.destroy.call(this)}};e.prototype.pause=function(){this._loader?this._loader.pauseGame():this._fireInvalidOperationError("pause")};e.prototype.resume=function(){this._loader?this._loader.resumeGame():this._fireInvalidOperationError("resume")};e.prototype.isPaused=function(){return this._loader?this._loader.isPaused():!!this._pauseOnStart};e.prototype.setEventDropPolicy=function(e){this._loader||this._fireInvalidOperationError("setEventDropPolicy");if(this._eventDropPolicy!==e){this._eventDropPolicy=e;this._isDropEventNeedsUpdate=!0;this._update()}};e.prototype.getEventDropPolicy=function(){var e;return null!=(e=this._eventDropPolicy)?e:u.EventDropPolicy.InReplay};e.prototype.setExecutionMode=function(e){this._loader&&this._loader.setExecutionMode(e)||this._fireInvalidOperationError("setExecutionMode");e=e===u.ExecutionMode.Replay;if(this._isReplay!==e){this._isReplay=e;this._isDropEventNeedsUpdate=!0}this._update()};e.prototype.getExecutionMode=function(){return this._loader?this._loader.getExecutionMode():this._playConfig.executionMode};e.prototype.setReplayTargetTimeFunc=function(e){this._loader&&this._loader.setReplayTargetTimeFunc(e)||this._fireInvalidOperationError("setReplayTargetTimeFunc")};e.prototype.getReplayTargetTimeFunc=function(){return this._loader?this._loader.getReplayTargetTimeFunc():null};e.prototype.setReplayOriginDate=function(e){this._loader&&this._loader.setReplayOriginDate(e)||this._fireInvalidOperationError("setReplayOriginDate")};e.prototype.getReplayOriginDate=function(){return this._loader?this._loader.getReplayOriginDate():null};e.prototype.getAverageFramePerSecond=function(e){var t=this;this._loader?setTimeout(function(){return e(t._loader?t._loader.fps:0)},0):this._fireInvalidOperationError("getAverageFramePerSecond")};e.prototype.addSkippingListener=function(e){this._skippingListeners.addItem(e)};e.prototype.removeSkippingListener=function(e){this._skippingListeners.removeItem(e)};e.prototype.addDroppedEventListener=function(e){this._droppedListeners.addItem(e)};e.prototype.removeDroppedEventListener=function(e){this._droppedListeners.removeItem(e)};e.prototype.sendEvents=function(e){this._loader?this._loader.sendEvents(e):this._fireInvalidOperationError("sendEvents")};e.prototype.getPlayOriginDate=function(){return this._loader?this._loader.getPlayOriginDate():null};e.prototype.getGameVars=function(e,t){this._loader?this._loader.getGameVars(e,t):this._fireInvalidOperationError("getGameVars")};e.prototype.getGame=function(){if(this._loader)return this._loader.game;this._fireInvalidOperationError("getGame")};e.prototype.getGameDriver=function(){if(this._loader)return this._loader.driver;this._fireInvalidOperationError("getGameDriver")};e.prototype.getPluginDataBus=function(){return this._pluginDataBus};e.prototype.dumpPlaylog=function(){return this._loader?this._loader.dumpPlaylog():null};e.prototype.getGameContentSize=function(){var e=this.getGame();return{width:e.width,height:e.height}};e.prototype.setGameContentSize=function(e){if(this._loader){this._loader.resetPrimarySurface(e.width,e.height);this._naturalWidth=e.width;this._naturalHeight=e.height}else this._fireInvalidOperationError("setGameContentSize")};e.prototype.getMasterVolume=function(){if(this._loader)return this._loader.getMasterVolume();this._fireInvalidOperationError("getMasterVolume");return null};e.prototype.setMasterVolume=function(e){this._loader?this._loader.setMasterVolume(e):this._fireInvalidOperationError("setMasterVolume")};e.prototype._fireInvalidOperationError=function(e){this._fireError(p.ErrorFactory.createInvalidOperationError(e))};e.prototype._fireError=function(t){this._errorListeners.forEach(function(e){return e.onError(t)})};e.prototype._getUntrustedTargetOrigin=function(){var e;return null!=this._untrustedFrameTargetOrigin?this._untrustedFrameTargetOrigin:this._untrustedFrameUrl||null==this._gameViewShared.untrustedFrameTargetOrigin?(e=this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl)&&(e=e.match(/^(https?:\/\/[^\/]*)\//))&&e[1]?e[1]:null:this._gameViewShared.untrustedFrameTargetOrigin};e.prototype._getUntrustedFrameHostname=function(){var e=this._untrustedFrameUrl||this._gameViewShared.untrustedFrameUrl;return(e=e&&e.match(/^https?:\/\/([^\/:]*)(?::\d+)?\//))&&e[1]?e[1]:null};e.prototype._workaroundEngine=function(e){for(var t=e.getElementsByClassName("input-handler"),n=0;n<t.length;++n)t[n].setAttribute("tabindex","0")};e.prototype._handleGameArgument=function(e){if(e&&e.agv){e=e.agv;if(null!=e&&e.disableDropEventInReplay&&void 0===this._eventDropPolicy){this._eventDropPolicy=u.EventDropPolicy.Never;this._isDropEventNeedsUpdate=!0}}};e.prototype._requestResizePrimarySurface=function(e,t){var i=this;this._bufferingNaturalWidth=Math.ceil(e);this._bufferingNaturalHeight=Math.ceil(t);this._lastUpdatePrimarySurfaceSizeTime=Date.now();if(null==this._updatePrimarySurfaceSizeTimeoutId){var r=function(){var e=i._bufferingNaturalWidth,t=i._bufferingNaturalHeight,n=i._lastUpdatePrimarySurfaceSizeTime;if(Date.now()<n+i._updatePrimarySurfaceSizeDelay)i._updatePrimarySurfaceSizeTimeoutId=window.setTimeout(r,i._updatePrimarySurfaceSizeDelay);else{i._naturalWidth=e;i._naturalHeight=t;i._bufferingNaturalWidth=null;i._bufferingNaturalHeight=null;i._loader.setScale(1,1);i._loader.resetPrimarySurface(i._naturalWidth,i._naturalHeight);i._updatePrimarySurfaceSizeTimeoutId=null}};this._updatePrimarySurfaceSizeTimeoutId=window.setTimeout(r,this._updatePrimarySurfaceSizeDelay)}};e.prototype._cancelResizePrimarySurface=function(){if(null!=this._updatePrimarySurfaceSizeTimeoutId){window.clearTimeout(this._updatePrimarySurfaceSizeTimeoutId);this._updatePrimarySurfaceSizeTimeoutId=null}};e.prototype._handleDroppedDomEvent=function(e,t){var n={type:e,reason:u.DroppedEventReason.Replay};this._droppedListeners.forEach(function(e){return e(n)})};e.prototype._updateDropEvent=function(){var e=null!=(e=this._eventDropPolicy)?e:u.EventDropPolicy.InReplay,e=e===u.EventDropPolicy.Always||e===u.EventDropPolicy.InReplay&&this._isReplay;this._element.setDropDomEvent(e)};return e}(s.Content);n.GameContent=e},{"./CalcLayout":2,"./Content":3,"./DomElement":4,"./Error":6,"./TrustedGameLoader":13,"./UntrustedGameLoader":15,"./utils":28,"@akashic/akashic-gameview":29,"@cross-border-bridge/memory-queue":39,"@cross-border-bridge/memory-queue-data-bus":38}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ScriptManager=void 0;var i=function(){function t(e){this._loadedTableMap=new WeakMap;this._loadingTableMap=new WeakMap;this._loadFunc=e||t._addScriptElement}t._addScriptElement=function(e,t,n){var i=e.document.createElement("script");i.src=t;i.addEventListener("load",function(){n(null)});i.addEventListener("error",function(){n(new Error("failed to load script: "+t))});e.document.head.appendChild(i)};t.prototype.appendScripts=function(e,t,n){var i=this,r=[],o=t.length;o?t.forEach(function(t){i._appendScript(e,t,function(e){e&&r.push(t);0<--o||n(0===r.length?null:new Error("failed to load scripts: "+r.join(", ")))})}):setTimeout(function(){return n(null)},0)};t.prototype._appendScript=function(e,n,t){this._loadedTableMap.has(e)||this._loadedTableMap.set(e,Object.create(null));var i=this._loadedTableMap.get(e);if(i[n])setTimeout(function(){return t(null)},0);else{this._loadingTableMap.has(e)||this._loadingTableMap.set(e,Object.create(null));var r=this._loadingTableMap.get(e);if(r[n])r[n].push(t);else{r[n]=[t];this._loadFunc(e,n,function(t){t||(i[n]=!0);var e=r[n];delete r[n];e.forEach(function(e){return e(t)})})}}};return t}();n.ScriptManager=i},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.SessionManager=void 0;var i=function(){function e(){this._activeSessionTable={};this._playlogClient=null;this._socketOpts=null}e.prototype.isInitialized=function(){return!!this._playlogClient};e.prototype.initialize=function(e){this._playlogClient=e};e.prototype.setSocketOptions=function(e){this._socketOpts=e};e.prototype.getSession=function(n,e,t,i){var r=this;if(this._playlogClient){var o=this._activeSessionTable[n];if(null!=o){++o.refCount;setTimeout(function(){i(null,o.session,!1)},0)}else{var a=this._playlogClient.Socket.Type.WebSocket,s=new this._playlogClient.Session(n,{socketType:a,validationData:t,socketOpts:this._socketOpts});s.on("error",function(t){var e=r._activeSessionTable[n];null!=e&&e.errorHandlers.forEach(function(e){return e(t)})});s.open(function(e){if(e)setTimeout(function(){i(e,null,!0)},0);else{r._activeSessionTable[n]={session:s,refCount:1,errorHandlers:[]};setTimeout(function(){i(null,s,!0)},0)}})}}else setTimeout(function(){return i(new Error("playlog-client not initialized"),null,!0)})};e.prototype.addErrorHandler=function(e,t){e=this._activeSessionTable[e];null!=e&&e.errorHandlers.push(t)};e.prototype.removeErrorHandler=function(e,t){e=this._activeSessionTable[e];null!=e&&(e.errorHandlers=e.errorHandlers.filter(function(e){return e!==t}))};e.prototype.releaseSession=function(e){var t=this._activeSessionTable[e];if(null!=t&&--t.refCount<1){t.session.close(function(){});this._activeSessionTable[e]=null}};return e}();n.SessionManager=i},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.GameContentSharedObject=n.GameViewSharedObject=void 0;function i(e){this.gameViewElement=e.gameViewElement;this.largestZIndex=0;this.viewWidth=e.gameViewWidth;this.viewHeight=e.gameViewHeight}var r=e("./ExternalPluginManager"),o=e("./SessionManager"),a=e("./Downloader"),s=e("./ScriptManager"),l=e("./bridge/PostMessageBridgeDemux"),e=function(){function e(e){this.pluginManager=new r.ExternalPluginManager;this.sessionManager=new o.SessionManager;this.scriptManager=new s.ScriptManager;this.downloader=new a.RetryDownloader(e?e.baseDownloader:void 0);this.bridgeDemux=new l.PostMessageBridgeDemux((null==e?void 0:e.window)||window,null==e?void 0:e.trustedChildOrigin);this.untrustedFrameUrl=null==e?void 0:e.untrustedFrameUrl;this.untrustedFrameTargetOrigin=(null==e?void 0:e.untrustedFrameTargetOrigin)||null}e.prototype.destroy=function(){this.pluginManager=null;this.sessionManager=null;this.scriptManager=null;(this.downloader=null)!=this.bridgeDemux&&this.bridgeDemux.destroy();this.bridgeDemux=null};e.prototype.destroyed=function(){return null==this.bridgeDemux};return e}();n.GameViewSharedObject=e;n.GameContentSharedObject=i},{"./Downloader":5,"./ExternalPluginManager":7,"./ScriptManager":10,"./SessionManager":11,"./bridge/PostMessageBridgeDemux":21}],13:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.TrustedGameLoader=void 0;var o=e("./Error"),e=function(n){r(e,n);function e(e){var t=n.call(this,e)||this;t._shared=e.shared;t._onSessionManagerError_bound=t._onSessionManagerError.bind(t);return t}e.prototype._getAdditionalScripts=function(e){var t=this,n=[];0!==e.external.length&&e.external.forEach(function(e){e=t._shared.pluginManager.find(e);null!=e&&null!=e.scriptUrls&&e.scriptUrls.forEach(function(e){return n.push(e)})});return n};e.prototype._loadScripts=function(e,t,n){this._shared.scriptManager.appendScripts(e,t,n)};e.prototype._initializeSessionManagerIfNeeded=function(e){e&&!this._shared.sessionManager.isInitialized()&&this._shared.sessionManager.initialize(e)};e.prototype._acquirePlaylogClientAMFlow=function(i,r){var o=this;this._shared.sessionManager.getSession(i.playlogServerUrl,i.protocol,{playId:i.playId,token:i.playToken},function(e,t,n){if(e)r(e,null);else{o._shared.sessionManager.addErrorHandler(i.playlogServerUrl,o._onSessionManagerError_bound);t.createClient({usePrimaryChannel:n},r)}})};e.prototype._releasePlaylogClientAMFlow=function(e){this._shared.sessionManager.removeErrorHandler(this._playlogServerUrl,this._onSessionManagerError_bound);this._shared.sessionManager.releaseSession(this._playlogServerUrl);this._onSessionManagerError_bound=null};e.prototype._onSessionManagerError=function(e){this._param.errorHandler(o.ErrorFactory.createPlaylogError(e))};return e}(e("./TrustedGameLoaderBase").TrustedGameLoaderBase);n.TrustedGameLoader=e},{"./Error":6,"./TrustedGameLoaderBase":14}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TrustedGameLoaderBase=void 0;var o=e("@akashic/akashic-gameview"),r=e("./Error"),a=e("./detectEngineFileObject"),i=e("./createProxyAudioPluginClass"),e=function(){function n(e){this._playToken="";this._agvExecutionMode=null;this._playlogServerUrl="";this._protocol=o.ProtocolType.WebSocket;this._amflowClient=null;this._g=null;this._GameDriver=null;this._PdiBrowser=null;this._usingCustomAmflow=!1;this._isLoadEnded=!1;this._isPaused=!1;this._engineConfig=null;this._destroyed=!1;this.isTestbed=!1;this.game=null;this.driver=null;this.platform=null;this.fps=0;this.resizablePrimarySurface=!1;this._replayOriginDateOffset=0;this._customizer=e.customizer;this._engineConfig=e.engineConfig;this._audioPdiHandler=e.audioPdiHandler;this._globalObject=null!=(e=e.window)?e:window;this._param=null;this._rawLoadGameConfiguration=null}n.prototype.start=function(e){this._param=e;this._isPaused=!!e.pause;this._downloadScripts()};n.prototype._downloadScripts=function(){var n=this,e=this._getAdditionalScripts(this._engineConfig),i=this._engineConfig.engine_urls.concat(e),e=i.filter(function(e){return(!(0,a.isEngineFilesUrl)(e)||!(0,a.detectEngineFilesObject)(n._globalObject,e))&&(!(0,a.isPlaylogClientUrl)(e)||!(0,a.detectPlaylogClientObject)(n._globalObject,e))});this._loadScripts(this._globalObject,e,function(e){if(e)n._param.errorHandler(r.ErrorFactory.createHttpRequestError(e));else{var e=(0,a.detectRuntimes)(n._globalObject,i),t=e[0],e=e[1];if(t)n._param.errorHandler(t);else{n._g=e.g;n._GameDriver=e.GameDriver;n._PdiBrowser=e.PdiBrowser;n._initializeSessionManagerIfNeeded(e.PlaylogClient);n._playId=n._param.playConfig.playId;n._agvExecutionMode=n._param.playConfig.executionMode;n.isTestbed="playlogServerUrl"in n._param.playConfig;n._param.replayData?setTimeout(function(){return n._startReplayGame()},0):n.isTestbed?setTimeout(function(){return n._startPlaylogGame()},0):setTimeout(function(){return n._startStandaloneGame()},0)}}})};n.prototype._startReplayGame=function(){var e=this,t=this._param.replayData;this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId,tickList:t.tickList,startPoints:t.startPoints});if(this._param.playConfig.replayTargetTimeFunc&&t.startPoints&&t.startPoints[0]){var t=t.startPoints[0].timestamp,n=this._param.playConfig.replayTargetTimeFunc();null!=this._param.playConfig.replayOriginDate&&(n+=this._param.playConfig.replayOriginDate);this._replayOriginDateOffset=t-n}setTimeout(function(){return e._startGame()},0)};n.prototype._startStandaloneGame=function(){var e=this;if(this._customizer&&this._customizer.createCustomAmflowClient){this._amflowClient=this._customizer.createCustomAmflowClient();this._usingCustomAmflow=!0}else this._amflowClient=new this._GameDriver.MemoryAmflowClient({playId:this._playId});setTimeout(function(){return e._startGame()},0)};n.prototype._startPlaylogGame=function(){var n=this,e=this._param.playConfig;this._playToken=e.playToken;this._playlogServerUrl=e.playlogServerUrl;this._protocol=e.protocol||o.ProtocolType.WebSocket;if(this._customizer&&this._customizer.createCustomAmflowClient){this._amflowClient=this._customizer.createCustomAmflowClient();this._usingCustomAmflow=!0;setTimeout(function(){return n._startGame()},0)}else this._acquirePlaylogClientAMFlow({playlogServerUrl:this._playlogServerUrl,protocol:this._protocol,playId:this._playId,playToken:this._playToken},function(e,t){if(e)n._param.errorHandler(r.ErrorFactory.createPlaylogError(e));else{n._amflowClient=t;n._startGame()}})};n.prototype._startGame=function(){var t=this,e=this._createPlatform(),n=this._createGameDriver(e);n.gameCreatedTrigger.handle(function(e){t.game=e;"abortTrigger"in t.game&&t.game.abortTrigger.handle(function(){t._param.errorHandler(r.ErrorFactory.createAbortGameError())});t._param.gameCreatedHandler(e)});this.driver=n;this.platform=e;setTimeout(function(){return t._startGameDriver(n)},0)};n.prototype._createPlatform=function(){var i=this,e=null;try{var t=this._PdiBrowser,n={amflow:this._amflowClient,containerView:this._param.parentHtmlElement,audioPlugins:this._createAudioPlugins()};this._overwritePlatformParameter(n);e=new t.Platform(n);this._customizer&&this._customizer.platformCustomizer&&this._customizer.platformCustomizer(e,{g:this._g});this._rawLoadGameConfiguration=e.loadGameConfiguration;e.loadGameConfiguration=function(e,n){i._customLoadGameConfiguration(e,function(e,t){t.environment&&t.environment.surface&&t.environment.surface.resizablePrimary&&(i.resizablePrimarySurface=!0);n(e,t)})}}catch(e){this._param.errorHandler(r.ErrorFactory.createLoadMuduleError(e));return}return e};n.prototype._customLoadGameConfiguration=function(e,t){var n=this,i="<agvw-queryparam>",r="<agvw-configuration>";if(e===i){var o=this._param.contentUrl.slice(this._param.contentUrl.indexOf("?")+1).split("&").reduce(function(e,t){t=t.split("=");try{e[t[0]]=JSON.parse(decodeURIComponent(t[1]))}catch(e){}return e},{});setTimeout(function(){return t(null,o)},0)}else e===r?this._rawLoadGameConfiguration(this._engineConfig.content_url,t):-1!==this._param.contentUrl.indexOf("?")?setTimeout(function(){return t(null,{definitions:[{url:r,basePath:n._getAssetBase()},i]})},0):this._rawLoadGameConfiguration(e,t)};n.prototype._createGameDriver=function(e){var t=this;return new this._GameDriver.GameDriver({platform:e,player:this._param.player,errorHandler:function(e){return t._param.errorHandler(r.ErrorFactory.createGameDriverError(e))}})};n.prototype._startGameDriver=function(e){var t=this;this.driver.initialize(this._createInitializeParameter(),function(e){if(e)t._param.errorHandler(r.ErrorFactory.createGameDriverError(e));else{t._param.replayData||t._sendinitialEvents();t._isPaused||t.driver.startGame();t._isLoadEnded=!0;t._destroyed&&t.stopGame()}})};n.prototype._createInitializeParameter=function(){var e=this._agvExecutionMode===o.ExecutionMode.Active&&!this._param.replayData,t=!!this._param.replayData||this._agvExecutionMode===o.ExecutionMode.Replay,n=this._isPaused,i=e?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,r=null!=this._param.playConfig.replayOriginDate?this._param.playConfig.replayOriginDate+this._replayOriginDateOffset:this._replayOriginDateOffset,r=t?this._createLoopConfigurationForReplay(this._param.playConfig.replayTargetTimeFunc,r):this._createLoopConfigurationForRealtime(this._param.playConfig.replayTargetTimeFunc,r);return{configurationUrl:this._engineConfig.content_url,assetBase:this._getAssetBase(),profiler:this._getProfiler(),gameArgs:this._param.argument,driverConfiguration:{playId:this._playId,playToken:this._playToken,executionMode:i,eventBufferMode:{isSender:!n&&!e&&!t,isReceiver:e,isDiscarder:n}},loopConfiguration:r}};n.prototype._getAssetBase=function(){var e,t=this._engineConfig.asset_base_url;return t=null==t?(e=this._engineConfig.content_url).substr(0,e.lastIndexOf("/"))+"/":t};n.prototype._getProfiler=function(){var t=this,e=null;return e=this._GameDriver.SimpleProfiler?new this._GameDriver.SimpleProfiler({interval:200,getValueHandler:function(e){t.fps=e.framePerSecond.ave}}):e};n.prototype._sendinitialEvents=function(){var t=this;if(this._param.initialEvents)try{this._param.initialEvents.forEach(function(e){return t._amflowClient.sendEvent(e)})}catch(e){this._param.errorHandler(r.ErrorFactory.createPlaylogError(e))}};n.prototype.pauseGame=function(){if(!this._isPaused){this._isPaused=!0;if(this._isLoadEnded){this.driver._eventBuffer.setMode({isSender:!1,isDiscarder:!0});this.driver.stopGame();this.game._setMuted(!0)}}};n.prototype.resumeGame=function(){if(this._isPaused){this._isPaused=!1;if(this._isLoadEnded){this.driver.startGame();var e=this._agvExecutionMode===o.ExecutionMode.Active,t=this._agvExecutionMode===o.ExecutionMode.Replay;this.driver._eventBuffer.setMode({isSender:!e&&!t,isDiscarder:!1});this.game._setMuted(!1)}}};n.prototype.isPaused=function(){return this._isPaused};n.prototype.stopGame=function(){var e=this;this._destroyed=!0;if(this._isLoadEnded){if(this.game&&this.game.audio){if(this.game.audio.stopAll)this.game.audio.stopAll();else{this.game.audio.music.stopAll();this.game.audio.sound.stopAll()}this.game.audio.music.stopAll();this.game.audio.sound.stopAll()}this.driver.stopGame();this.driver.initialize({driverConfiguration:{playId:null},configurationUrl:null},function(){e.isTestbed&&!e._usingCustomAmflow&&e._releasePlaylogClientAMFlow(e._playlogServerUrl);e._amflowClient=null;e._g=null;e._GameDriver=null;e._PdiBrowser=null;e.game=null;e.platform=null;e.driver.destroy?e.driver.destroy().then(function(){return e._param.gameFinishedHandler()}):setTimeout(function(){return e._param.gameFinishedHandler()})})}};n.prototype.sendEvents=function(e){var t=this;try{this.driver._eventBuffer&&this.driver._eventBuffer.onEvent?e.forEach(function(e){return t.driver._eventBuffer.onEvent(e)}):e.forEach(function(e){return t._amflowClient.sendEvent(e)})}catch(e){this._param.errorHandler(r.ErrorFactory.createPlaylogError(e))}};n.prototype.dumpPlaylog=function(){return this.isTestbed||!this._amflowClient.dump?null:this._amflowClient.dump()};n.prototype.getGameVars=function(e,t){var n=this;setTimeout(function(){n.game&&t(n.game.vars&&n.game.vars[e])},0)};n.prototype.setExecutionMode=function(e){if(!this.driver)return!1;if(!this.driver._gameLoop||!this.driver._eventBuffer)return!1;if(this._agvExecutionMode!==e){this._agvExecutionMode=e;var e=this._agvExecutionMode===o.ExecutionMode.Active,t=!!this._param.replayData||this._agvExecutionMode===o.ExecutionMode.Replay,n=e?this._GameDriver.ExecutionMode.Active:this._GameDriver.ExecutionMode.Passive,i=t?this._createLoopConfigurationForReplay():this._createLoopConfigurationForRealtime();this.driver._gameLoop.setExecutionMode(n);this.driver._gameLoop.setLoopConfiguration(i);this.driver._eventBuffer.setMode({isSender:!e&&!t,isReceiver:e})}return!0};n.prototype._createLoopConfigurationForRealtime=function(e,t){return{loopMode:this._GameDriver.LoopMode.Realtime,delayIgnoreThreshold:n.REALTIME_DELAY_IGNORE_THRESHOLD,jumpTryThreshold:n.REALTIME_JUMP_TRY_THRESHOLD,targetTimeFunc:e,originDate:t}};n.prototype._createLoopConfigurationForReplay=function(e,t){return{loopMode:this._GameDriver.LoopMode.Replay,delayIgnoreThreshold:Number.MAX_VALUE,jumpTryThreshold:Number.MAX_VALUE,targetTimeFunc:e,originDate:t}};n.prototype.getExecutionMode=function(){var e;return null!=(e=this._agvExecutionMode)?e:this._param.playConfig.executionMode};n.prototype.setReplayTargetTimeFunc=function(e){if(!this.driver||!this.driver._gameLoop)return!1;this.driver._gameLoop.setLoopConfiguration({targetTimeFunc:e});return!0};n.prototype.getReplayTargetTimeFunc=function(){var e;return this.driver&&(e=this.driver.getLoopConfiguration())?e.targetTimeFunc:null};n.prototype.setReplayOriginDate=function(e){if(!this.driver||!this.driver._gameLoop)return!1;this.driver._gameLoop.setLoopConfiguration({originDate:e+this._replayOriginDateOffset});return!0};n.prototype.getReplayOriginDate=function(){var e;return this.driver&&(e=this.driver.getLoopConfiguration())?e.originDate:null};n.prototype.getPlayOriginDate=function(){return this.driver&&this.driver._gameLoop&&this.driver._gameLoop._startedAt||null};n.prototype.getReplayOriginDateOffset=function(){return this._replayOriginDateOffset};n.prototype.resetPrimarySurface=function(e,t){var n=this.driver;n&&n.resetPrimarySurface&&n.resetPrimarySurface(e,t)};n.prototype.setScale=function(e,t){this.platform.setScale(e,t)};n.prototype.setMasterVolume=function(e){this.platform.setMasterVolume(e)};n.prototype.getMasterVolume=function(){return this.platform.getMasterVolume()};n.prototype._overwritePlatformParameter=function(e){};n.prototype._createAudioPlugins=function(){var e=this._PdiBrowser;return this._customizer&&this._customizer.createCustomAudioPlugins?this._customizer.createCustomAudioPlugins():this._audioPdiHandler?[(0,i.createProxyAudioPluginClass)(this._g,this._audioPdiHandler)]:[e.WebAudioPlugin,e.HTMLAudioPlugin]};n.REALTIME_DELAY_IGNORE_THRESHOLD=6;n.REALTIME_JUMP_TRY_THRESHOLD=3e4;return n}();n.TrustedGameLoaderBase=e},{"./Error":6,"./createProxyAudioPluginClass":25,"./detectEngineFileObject":26,"@akashic/akashic-gameview":29}],15:[function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});n.UntrustedGameLoader=n.GameDriverProxy=n.GameProxy=void 0;var s=e("@akashic/akashic-gameview"),r=e("@akashic/trigger"),o=e("./Error"),a=e("./detectEngineFileObject"),l=e("./bridge/LoaderMessage"),u=e("./bridge/setupAMFlowProxy"),d=e("./bridge/setupAudioPdiProxy"),h=e("./ExternalPluginSignatureCaller"),c=function(e){this.playId=e.playId;this.width=e.width;this.height=e.height;this.fps=e.fps;this.external={};this.skippingChangedTrigger=new r.Trigger;this._started=new r.Trigger;this._loaded=new r.Trigger},p=(n.GameProxy=c,function(){function e(e){this._bridge=e}e.prototype.changeState=function(e,t){this._bridge.request(l.LoaderMessage.ChangeDriverState,e,function(e){t(e&&"string"==typeof e?o.ErrorFactory.createGameDriverError(e):null)})};return e}()),e=(n.GameDriverProxy=p,function(){function e(e){this._agvExecutionMode=null;this._amflowClient=null;this._externalPluginCaller=void 0;this._isPaused=!1;this._engineConfig=null;this.game=null;this.driver=null;this.fps=-1;this.resizablePrimarySurface=!1;this._teardownAudioPdiProxy=null;this._teardownAMFlowProxy=null;this._usingCustomAmflow=!1;this._shared=e.shared;this._customizer=e.customizer;this._audioPdiHandler=e.audioPdiHandler;this._engineConfig=e.engineConfig;this._targetOrigin=e.targetOrigin;this._contentWindow=e.contentWindow;this._replayOriginDate=0;this._playOriginDate=null;this._masterVolume=1;this._handleSessionManagerError_bound=this._handleSessionManagerError.bind(this);this._handleGameCreated_bound=this._handleGameCreated.bind(this);this._handleAcquireAMFlow_bound=this._handleAcquireAMFlow.bind(this);this._handlePlayOriginDate_bound=this._handlePlayOriginDate.bind(this);this._handleExternalSend_bound=this._handleExternalSend.bind(this);this._handleExternalPlugin_bound=this._handleExternalPlugin.bind(this);this._handleSkippingChanged_bound=this._handleSkippingChanged.bind(this);this._handleGameLoaded_bound=this._handleGameLoaded.bind(this);this._handleGameStarted_bound=this._handleGameStarted.bind(this);this._notifyTargetTime_bound=this._notifyTargetTime.bind(this);this._param=null;this._bridge=null;this._replayTargetTimeFunc=null}e.prototype.start=function(e){var n=this;this._param=e;this._isPaused=!!e.pause;this._replayTargetTimeFunc=e.playConfig.replayTargetTimeFunc;this._shared.bridgeDemux.register(this._contentWindow,this._targetOrigin,function(e,t){if(e)n._param.errorHandler(o.ErrorFactory.createPostMessageError(e));else{n._bridge=t;n._bridge.on(l.LoaderMessage.Error,function(e){return n._fireErrorTriggerIfNeeded(e)});n._bridge.on(l.LoaderMessage.GameCreated,n._handleGameCreated_bound);n._bridge.on(l.LoaderMessage.AcquireAMFlow,n._handleAcquireAMFlow_bound);n._bridge.on(l.LoaderMessage.PlayOriginDate,n._handlePlayOriginDate_bound);n._bridge.on(l.LoaderMessage.ExternalSend,n._handleExternalSend_bound);n._bridge.on(l.LoaderMessage.External,n._handleExternalPlugin_bound);n._bridge.on(l.LoaderMessage.SkippingChanged,n._handleSkippingChanged_bound);n._bridge.on(l.LoaderMessage.GameLoaded,n._handleGameLoaded_bound);n._bridge.on(l.LoaderMessage.GameStarted,n._handleGameStarted_bound);n._audioPdiHandler&&(n._teardownAudioPdiProxy=(0,d.setupAudioPdiProxy)(n._audioPdiHandler,n._bridge));n._start_initializePlaylogClient()}})};e.prototype._start_initializePlaylogClient=function(){var t=this;if(this._shared.sessionManager.isInitialized())this._start_request();else{var n=(0,a.findPlaylogClientUrl)(this._engineConfig.engine_urls);n?this._shared.scriptManager.appendScripts(this._contentWindow,[n],function(e){if(e)t._param.errorHandler(o.ErrorFactory.createHttpRequestError(e));else{e=(0,a.detectPlaylogClientObject)(t._contentWindow,n);e&&t._shared.sessionManager.initialize(e);t._start_request()}}):this._start_request()}};e.prototype._start_request=function(){var t=this,e=this._param;this._bridge.request(l.LoaderMessage.Start,{engineConfig:this._engineConfig,replayData:e.replayData,contentUrl:e.contentUrl,initialEvents:e.initialEvents,argument:e.argument,pause:this._isPaused,player:e.player,playConfig:i(i({},e.playConfig),{replayTargetTimeFunc:void 0}),proxyAudio:!!this._audioPdiHandler,externalPluginSignature:e.externalPluginSignature},function(e){return t._fireErrorTriggerIfNeeded(e)})};e.prototype.pauseGame=function(){if(!this._isPaused){this._isPaused=!0;this._bridge.send(l.LoaderMessage.PauseGame);this._updateTargetTimeNotifier()}};e.prototype.resumeGame=function(){if(this._isPaused){this._isPaused=!1;this._bridge.send(l.LoaderMessage.ResumeGame);this._updateTargetTimeNotifier()}};e.prototype.isPaused=function(){return this._isPaused};e.prototype.stopGame=function(){if(this._bridge){this._bridge.send(l.LoaderMessage.StopGame,null);this._teardownAudioPdiProxy&&this._teardownAudioPdiProxy();this._releaseAMFlow();this._bridge.destroy();this._bridge=null;this._externalPluginCaller=null;this._handleSessionManagerError_bound=null;this._handleGameCreated_bound=null;this._handleAcquireAMFlow_bound=null;this._handlePlayOriginDate_bound=null;this._handleExternalSend_bound=null;this._handleExternalPlugin_bound=null;this._handleSkippingChanged_bound=null;this._handleGameLoaded_bound=null;this._handleGameStarted_bound=null;this._notifyTargetTime_bound=null;this._updateTargetTimeNotifier();this._param.gameFinishedHandler()}};e.prototype.sendEvents=function(e){this._bridge.send(l.LoaderMessage.SendEvents,e)};e.prototype.dumpPlaylog=function(){return null};e.prototype.getGameVars=function(e,n){var i=this;this._bridge.request(l.LoaderMessage.GetGameVars,e,function(e,t){if(!i._fireErrorTriggerIfNeeded(e))try{n(t)}catch(e){i._param.errorHandler(e)}})};e.prototype.setExecutionMode=function(e){if(this._agvExecutionMode!==e){this._agvExecutionMode=e;this._bridge.send(l.LoaderMessage.SetExecutionMode,e);this._updateTargetTimeNotifier()}return!0};e.prototype.getExecutionMode=function(){var e;return null!=(e=this._agvExecutionMode)?e:this._param.playConfig.executionMode};e.prototype.setReplayTargetTimeFunc=function(e){this._replayTargetTimeFunc=e;this._updateTargetTimeNotifier();return!0};e.prototype.getReplayTargetTimeFunc=function(){var e;return null!=(e=this._replayTargetTimeFunc)?e:null};e.prototype.setReplayOriginDate=function(e){this._replayOriginDate=e;this._bridge.send(l.LoaderMessage.SetReplayOriginDate,e);return!0};e.prototype.getReplayOriginDate=function(){return this._replayOriginDate};e.prototype.getPlayOriginDate=function(){return this._playOriginDate};e.prototype.resetPrimarySurface=function(e,t){this._bridge.send(l.LoaderMessage.ResetSurface,{width:e,height:t})};e.prototype.setScale=function(e,t){this._bridge.send(l.LoaderMessage.SetScale,{xScale:e,yScale:t})};e.prototype.setMasterVolume=function(e){if(this._masterVolume!==e){this._masterVolume=e;this._bridge.send(l.LoaderMessage.SetMasterVolume,e)}};e.prototype.getMasterVolume=function(){return this._masterVolume};e.prototype._fireErrorTriggerIfNeeded=function(e){if(e&&"string"==typeof e)return this._param.errorHandler(o.ErrorFactory.createGameDriverError(e)),!0;return!1};e.prototype._handleSessionManagerError=function(e){this._param.errorHandler(o.ErrorFactory.createPlaylogError(e))};e.prototype._releaseAMFlow=function(){if(this._teardownAMFlowProxy){this._teardownAMFlowProxy();if(!this._usingCustomAmflow){var e=this._param.playConfig.playlogServerUrl;this._shared.sessionManager.removeErrorHandler(e,this._handleSessionManagerError_bound);this._shared.sessionManager.releaseSession(e)}}};e.prototype._handleGameCreated=function(e){this.game=new c(i(i({},e),{playId:this._param.playConfig.playId}));this.driver=new p(this._bridge);this._param.gameCreatedHandler(this.game);if(this._param.externalPluginSignature){e=this._param.externalPluginSignature;this._externalPluginCaller=new h.ExternalPluginSignatureCaller(e,this.game.external)}this._updateTargetTimeNotifier()};e.prototype._handleAcquireAMFlow=function(e,t){function i(e){o._param.errorHandler(e);null!=t&&t(e.message)}function r(e){o._amflowClient=e;o._teardownAMFlowProxy=(0,u.setupAMFlowProxy)(e,o._bridge);null!=t&&t(null)}var n,o=this;if(null!=(n=this._customizer)&&n.createCustomAmflowClient){this._usingCustomAmflow=!0;r(this._customizer.createCustomAmflowClient())}else{var a=this._param.playConfig;this._shared.sessionManager.getSession(a.playlogServerUrl,a.protocol||s.ProtocolType.WebSocket,{playId:a.playId,token:a.playToken},function(e,t,n){if(e)i(e);else{o._shared.sessionManager.addErrorHandler(a.playlogServerUrl,o._handleSessionManagerError_bound);t.createClient({usePrimaryChannel:n},function(e,t){e?i(e):r(t)})}})}};e.prototype._handlePlayOriginDate=function(e){"number"==typeof e&&(this._playOriginDate=e)};e.prototype._handleExternalSend=function(e){var t;null!=(t=null==(t=this.game)?void 0:t.external)&&t.send&&this.game.external.send(e)};e.prototype._handleExternalPlugin=function(e,t){var n;this._externalPluginCaller&&null!=(n=this.game)&&n.external&&this._externalPluginCaller.call(e.identifier,e.args,t)};e.prototype._handleSkippingChanged=function(e){var t;null!=(t=this.game)&&t.skippingChangedTrigger.fire(e)};e.prototype._handleGameLoaded=function(){var e;null!=(e=this.game)&&e._loaded.fire()};e.prototype._handleGameStarted=function(){var e;null!=(e=this.game)&&e._started.fire()};e.prototype._updateTargetTimeNotifier=function(){var e=this._agvExecutionMode!==s.ExecutionMode.Active,e=this.game&&e&&!this._isPaused&&this._replayTargetTimeFunc&&!!this._bridge;if(e&&!this._targetTimeNotifierTimer)this._targetTimeNotifierTimer=setInterval(this._notifyTargetTime_bound,this.game.fps);else if(!e&&this._targetTimeNotifierTimer){clearInterval(this._targetTimeNotifierTimer);this._targetTimeNotifierTimer=null}};e.prototype._notifyTargetTime=function(){if(this._replayTargetTimeFunc){var e=this._replayTargetTimeFunc();this._bridge.send(l.LoaderMessage.TargetTime,e)}};return e}());n.UntrustedGameLoader=e},{"./Error":6,"./ExternalPluginSignatureCaller":8,"./bridge/LoaderMessage":19,"./bridge/setupAMFlowProxy":23,"./bridge/setupAudioPdiProxy":24,"./detectEngineFileObject":26,"@akashic/akashic-gameview":29,"@akashic/trigger":37}],16:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.WebContent=void 0;var o=e("@cross-border-bridge/post-message-data-bus"),a=e("./Content"),s=e("./DomElement"),e=function(t){r(e,t);function e(e){e=t.call(this,e,"web")||this;e._element=null;return e}e.prototype.start=function(e,t){var n=this,i=(new Date).getTime();this._gameViewShared=e;this._gameContentShared=t;this._element=new s.WebContentElement(t.gameViewElement,this._contentUrl,function(){var e,t=((new Date).getTime()-i)/1e3;n._dataBus=new o.PostMessageDataBus(null!=(e=n._element.getContentWindow())?e:null);n._contentLoadListeners.forEach(function(e){return e.onLoad(t)})});null==this._contentArea&&this.setContentArea({x:0,y:0,width:t.viewWidth,height:t.viewHeight});null==this._zIndex&&this.setZIndex(++t.largestZIndex)};e.prototype._update=function(){if(null!=this._element){if(this._contentAreaNeedsUpdate){this._element.setContentArea(this._contentArea);this._contentAreaNeedsUpdate=!1}if(this._zIndexNeedsUpdate){this._element.setZIndex(this._zIndex);this._gameContentShared.largestZIndex=Math.max(this._gameContentShared.largestZIndex,this._zIndex);this._zIndexNeedsUpdate=!1}if(this._contentLayoutNeedsUpdate){this._element.setContentLayout(this._contentLayout);this._contentLayoutNeedsUpdate=!1}if(this._visibilityNeedsUpdate){this._element.setVisibility(this._visibility);this._visibilityNeedsUpdate=!1}}};e.prototype.destroy=function(){this._element.destroy();t.prototype.destroy.call(this)};return e}(a.Content);n.WebContent=e},{"./Content":3,"./DomElement":4,"@cross-border-bridge/post-message-data-bus":40}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.AudioMessage=void 0;n=n.AudioMessage||(n.AudioMessage={});n.Load="audio:load";n.Unload="audio:unload";n.CreatePlayer="audio:createPlayer";n.DestroyPlayer="audio:destroyPlayer";n.Play="audio:play";n.Stop="audio:stop";n.ChangeVolume="audio:changeVolume";n.ChangeRate="audio:changeRate"},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.BridgeAMFlowMessage=n.BridgeMessage=void 0;(n.BridgeMessage||(n.BridgeMessage={})).Init="bridge:init";n=n.BridgeAMFlowMessage||(n.BridgeAMFlowMessage={});n.Open="amf:open";n.Close="amf:close";n.Authenticate="amf:authenticate";n.SendTick="amf:sendTick";n.SubscribeTick="amf:subscribeTick";n.UnsubscribeTick="amf:unsubscribeTick";n.ReceiveTick="amf:[t]";n.SendEvent="amf:sendEvent";n.SubscribeEvent="amf:subscribeEvent";n.UnsubscribeEvent="amf:unsubscribeEvent";n.ReceiveEvent="amf:[e]";n.GetTickList="amf:getTickList";n.PutStartPoint="amf:putStartPoint";n.GetStartPoint="amf:getStartPoint"},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.LoaderMessage=void 0;n=n.LoaderMessage||(n.LoaderMessage={});n.Start="loader:start";n.PauseGame="loader:pauseGame";n.ResumeGame="loader:resumeGame";n.StopGame="loader:stopGame";n.SendEvents="loader:sendEvents";n.SetExecutionMode="loader:setExecutionMode";n.TargetTime="loader:targetTime";n.SetReplayOriginDate="loader:setReplayOriginDate";n.SetScale="loader:setScale";n.SetMasterVolume="loader:setMasterVolume";n.GetGameVars="loader:getGameVars";n.ChangeDriverState="loader:changeDriverState";n.ResetSurface="loader:resetSurface";n.GameCreated="loader:gameCreated";n.Error="loader:error";n.PlayOriginDate="loader:playOriginDate";n.AcquireAMFlow="loader:acquireAMFlow";n.ReleaseAMFlow="loader:releaseAMFlow";n.ExternalSend="loader:externalSend";n.External="loader:external";n.SkippingChanged="loader:skippingChanged";n.GameLoaded="loader:gameLoaded";n.GameStarted="loader:gameStarted"},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.PostMessageBridgeBase=void 0;var i=function(){function e(e){this._requestIndex=0;this._requestHandlersTable={};this._handlersTable={};this._target=e}e.prototype.destroy=function(){this._target=null;this._requestHandlersTable=null;this._handlersTable=null};e.prototype.getTarget=function(){return this._target};e.prototype.request=function(e,t,n){var i="req".concat(this._requestIndex++),r=this._createRawMessageBase();r.type=e;r.data=t;r.reqId=i;this._target.window.postMessage(r,this._target.targetOrigin);this._requestHandlersTable[i]=n};e.prototype.send=function(e,t){var n=this._createRawMessageBase();n.type=e;n.data=t;this._target.window.postMessage(n,this._target.targetOrigin)};e.prototype.on=function(e,t){var n=this._handlersTable;(n[e]||(n[e]=[])).push({handler:t,isOnce:!1})};e.prototype.once=function(e,t){var n=this._handlersTable;(n[e]||(n[e]=[])).push({handler:t,isOnce:!0})};e.prototype.off=function(e,t){var n=this._handlersTable;n[e]&&0!==n[e].length&&(n[e]=n[e].filter(function(e){return e.handler!==t}))};e.prototype._respond=function(e,t,n){var i=this._createRawMessageBase();i.resId=e;i.data=n;i.errorMessage=null!=t?t:void 0;this._target.window.postMessage(i,this._target.targetOrigin)};e.prototype._handleRawMessageEvent=function(e){var n=this,t=e.data;if(e.source!==this._target.window)console.warn("PostMessageBridgeBase: got ".concat(JSON.stringify(t)," from unknown source"));else{e=t.resId;if(null!=e){var i=this._requestHandlersTable[e];delete this._requestHandlersTable[e];i(t.errorMessage?new Error(t.errorMessage):null,t.data)}else{e=this._handlersTable,i=t.type;if(i&&e&&e.hasOwnProperty(i)&&0<e[i].length){for(var r=e[i].concat(),o=t.reqId,a=null==o?void 0:function(e,t){n._respond(o,e,t)},s=!1,l=0;l<r.length;++l){var u=r[l];if(u.handler){u.handler(t.data,a);u.isOnce&&(s=!(u.handler=null))}}s&&this.off(i,null)}else null!=t.reqId?this._respond(t.reqId,"No corresponding handler",null):console.warn("PostMessageBridgeBase: ignored unknown message",t)}}};e.prototype._createRawMessageBase=function(){return{}};e.prototype._setImmediate=function(e){setTimeout(e,0)};return e}();n.PostMessageBridgeBase=i},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.PostMessageBridgeDemux=void 0;var i=e("./BridgeMessage"),a=e("./PostMessageDemuxedBridge");function s(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1}e=function(){function e(e,t){this._waitingEvents=[];this._targetIndex=0;this._bridgeTable=Object.create(null);this._window=e;this._trustedOriginRegExp=t;this._handleMessage_bound=this._handleMessage.bind(this);this._handleDestroyBridge_bound=this._handleDestroyBridge.bind(this);this._window.addEventListener("message",this._handleMessage_bound)}e.prototype.register=function(t,e,n){if(e&&this._trustedOriginRegExp&&this._trustedOriginRegExp.test(e)){var i=this.findBridge(t);if(i)this._setImmediate(function(){i.getTarget().targetOrigin!==e?n(new Error("PostMessageBridgeDemux#register(): targetOrigin mismatch: "+e)):n(null,i)});else{var r="PDBT".concat(this._targetIndex++),o=new a.PostMessageDemuxedBridge(r,{targetOrigin:e,window:t},this._handleDestroyBridge_bound),r=(this._bridgeTable[r]=o,s(this._waitingEvents,function(e){return e.source===t}));if(-1!==r){r=this._waitingEvents.splice(r,1)[0];o.processRawMessageEvent(r)}o.initialize(function(e){return n(null!=e?e:null,e?void 0:o)})}}else this._setImmediate(function(){return n(new Error("PostMessageDemuxedBridge#register(): untrusted origin: "+e))})};e.prototype.destroy=function(){var t=this;Object.keys(this._bridgeTable).forEach(function(e){return t._bridgeTable[e].destroy()});this._window.removeEventListener("message",this._handleMessage_bound);this._window=null;this._waitingEvents=null;this._bridgeTable=null;this._trustedOriginRegExp=null;this._handleMessage_bound=null;this._handleDestroyBridge_bound=null};e.prototype.findBridge=function(t){return n=this._bridgeTable,i=function(e){return e.getTarget().window===t},e=Object.keys(n),-1!==(r=s(e,function(e){return i(n[e])}))?n[e[r]]:null;var n,i,e,r};e.prototype._handleDestroyBridge=function(e){delete this._bridgeTable[e.selfKey]};e.prototype._handleMessage=function(e){if(this._trustedOriginRegExp&&this._trustedOriginRegExp.test(e.origin)){var t=e.data,n=t.key,t=!n&&t.type===i.BridgeMessage.Init,n=t?this.findBridge(e.source):this._bridgeTable[n];n?n.processRawMessageEvent(e):t&&this._waitingEvents.push(e)}};e.prototype._setImmediate=function(e){setTimeout(e,0)};return e}();n.PostMessageBridgeDemux=e},{"./BridgeMessage":18,"./PostMessageDemuxedBridge":22}],22:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.PostMessageDemuxedBridge=void 0;var a=e("./BridgeMessage"),e=function(r){o(e,r);function e(e,t,n){var i=r.call(this,t)||this;i.selfKey=e;i._isConnected=!1;i._handleBeforeDestroyFunc=n;i.once(a.BridgeMessage.Init,function(e,t){null!=t&&t(null,i.selfKey);i._isConnected=!0});return i}e.prototype.destroy=function(){this._handleBeforeDestroyFunc(this);r.prototype.destroy.call(this);this._isConnected=!1;this._handleBeforeDestroyFunc=null};e.prototype.initialize=function(e){this._isConnected?this._setImmediate(e):this.once(a.BridgeMessage.Init,function(){return e()})};e.prototype.processRawMessageEvent=function(e){this._handleRawMessageEvent(e)};return e}(e("./PostMessageBridgeBase").PostMessageBridgeBase);n.PostMessageDemuxedBridge=e},{"./BridgeMessage":18,"./PostMessageBridgeBase":20}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.setupAMFlowProxy=void 0;var f=e("./BridgeMessage");n.setupAMFlowProxy=function(i,t){function e(e,t){i.open(e,function(e){return null==t?void 0:t(e?e.message:null)})}function n(e,t){i.close(function(e){return null==t?void 0:t(e?e.message:null)})}function r(e,n){i.authenticate(e,function(e,t){return e?null==n?void 0:n(e.message):null==n?void 0:n(null,t)})}function o(e){return i.sendTick(e)}function a(e){return i.sendEvent(e)}function s(e){return t.send(f.BridgeAMFlowMessage.ReceiveTick,e)}function l(e){return t.send(f.BridgeAMFlowMessage.ReceiveEvent,e)}function u(){return i.onTick(s)}function d(){return i.offTick(s)}function h(){return i.onEvent(l)}function c(){return i.offEvent(l)}function p(e,n){i.getTickList(e.begin,e.end,function(e,t){return e?null==n?void 0:n(e.message):null==n?void 0:n(null,t)})}function _(e,t){i.putStartPoint(e,function(e){return null==t?void 0:t(e?e.message:null)})}function g(e,n){i.getStartPoint(e,function(e,t){return e?null==n?void 0:n(e.message):null==n?void 0:n(null,t)})}t.on(f.BridgeAMFlowMessage.Open,e);t.on(f.BridgeAMFlowMessage.Close,n);t.on(f.BridgeAMFlowMessage.Authenticate,r);t.on(f.BridgeAMFlowMessage.SendTick,o);t.on(f.BridgeAMFlowMessage.SendEvent,a);t.on(f.BridgeAMFlowMessage.SubscribeTick,u);t.on(f.BridgeAMFlowMessage.UnsubscribeTick,d);t.on(f.BridgeAMFlowMessage.SubscribeEvent,h);t.on(f.BridgeAMFlowMessage.UnsubscribeEvent,c);t.on(f.BridgeAMFlowMessage.GetTickList,p);t.on(f.BridgeAMFlowMessage.PutStartPoint,_);t.on(f.BridgeAMFlowMessage.GetStartPoint,g);return function(){d();c();t.off(f.BridgeAMFlowMessage.Open,e);t.off(f.BridgeAMFlowMessage.Close,n);t.off(f.BridgeAMFlowMessage.Authenticate,r);t.off(f.BridgeAMFlowMessage.SendTick,o);t.off(f.BridgeAMFlowMessage.SendEvent,a);t.off(f.BridgeAMFlowMessage.SubscribeTick,u);t.off(f.BridgeAMFlowMessage.UnsubscribeTick,d);t.off(f.BridgeAMFlowMessage.SubscribeEvent,h);t.off(f.BridgeAMFlowMessage.UnsubscribeEvent,c);t.off(f.BridgeAMFlowMessage.GetTickList,p);t.off(f.BridgeAMFlowMessage.PutStartPoint,_);t.off(f.BridgeAMFlowMessage.GetStartPoint,g)}}},{"./BridgeMessage":18}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.setupAudioPdiProxy=void 0;var d=e("./AudioMessage");n.setupAudioPdiProxy=function(n,e){function t(e,t){n.loadAudioAsset(e,function(e){return null==t?void 0:t(e?e.message:null)})}function i(e){return n.unloadAudioAsset(e)}function r(e){return n.createAudioPlayer(e)}function o(e){return n.destroyAudioPlayer(e)}function a(e){return n.playAudioPlayer(e)}function s(e){return n.stopAudioPlayer(e)}function l(e){n.changeAudioVolume(e.audioPlayerId,e.volume)}function u(e){n.changeAudioPlaybackRate(e.audioPlayerId,e.playbackRate)}e.on(d.AudioMessage.Load,t);e.on(d.AudioMessage.Unload,i);e.on(d.AudioMessage.CreatePlayer,r);e.on(d.AudioMessage.DestroyPlayer,o);e.on(d.AudioMessage.Play,a);e.on(d.AudioMessage.Stop,s);e.on(d.AudioMessage.ChangeVolume,l);e.on(d.AudioMessage.ChangeRate,u);return function(){e.off(d.AudioMessage.Load,t);e.off(d.AudioMessage.Unload,i);e.off(d.AudioMessage.CreatePlayer,r);e.off(d.AudioMessage.DestroyPlayer,o);e.off(d.AudioMessage.Play,a);e.off(d.AudioMessage.Stop,s);e.off(d.AudioMessage.ChangeVolume,l);e.off(d.AudioMessage.ChangeRate,u)}}},{"./AudioMessage":17}],25:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(a=(o<3?r(a):3<o?r(t,n,a):r(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});n.createProxyAudioPluginClass=void 0;var a=e("@akashic/pdi-common-impl/lib/AudioAsset"),u=e("@akashic/pdi-common-impl/lib/AudioPlayer");n.createProxyAudioPluginClass=function(e,s){var t,l=function(l){r(e,l);function e(e,t,n,i,r,o,a,s){t=l.call(this,t,n,i,r,o,a,s)||this;t._handlerSet=e;return t}e.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id);l.prototype.destroy.call(this)};e.prototype._load=function(t){var n=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint,offset:this.offset},function(e){e?t._onAssetError(n,e):t._onAssetLoad(n)})};e.prototype._assetPathFilter=function(e){return e};return e}(null!=(t=e.AudioAsset)?t:a.AudioAsset),n=function(i){r(t,i);function t(e,t,n){t=i.call(this,t)||this;t._audioPlayerId=null;t._handlerSet=e;t._manager=null!=n?n:null;return t}t.prototype.changeVolume=function(e){i.prototype.changeVolume.call(this,e);this._notifyVolumeToHandler()};t.prototype._changeMuted=function(e){i.prototype._changeMuted.call(this,e);this._notifyVolumeToHandler()};t.prototype.play=function(e){null!=this._audioPlayerId&&this.stop();this._audioPlayerId="ap".concat(t._audioPlayerIdCounter++);this._handlerSet.createAudioPlayer({assetId:e.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1});i.prototype.play.call(this,e)};t.prototype.stop=function(){if(null!=this._audioPlayerId){this._handlerSet.stopAudioPlayer(this._audioPlayerId);this._handlerSet.destroyAudioPlayer(this._audioPlayerId);this._audioPlayerId=null}i.prototype.stop.call(this)};t.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()};t.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())};t.prototype._calculateVolume=function(){var e,t=null!=(e=null==(e=null==(t=this._manager)?void 0:t.getMasterVolume)?void 0:e.call(t))?e:1;return this._system._muted?0:this.volume*this._system.volume*t};t._audioPlayerIdCounter=0;return t}(null!=(t=e.AudioPlayer)?t:u.AudioPlayer);function i(){this.supportedFormats=[]}i.isSupported=function(){return!0};i.prototype.createAsset=function(e,t,n,i,r,o,a){void 0===r&&(r="music"===(null==i?void 0:i.id));return new l(s,e,t,n,i,r,o=void 0===o?{}:o,a=void 0===a?0:a)};i.prototype.createPlayer=function(e,t){return new n(s,e,"boolean"!=typeof t?t:void 0)};return o([function(e){}],i)}},{"@akashic/pdi-common-impl/lib/AudioAsset":31,"@akashic/pdi-common-impl/lib/AudioPlayer":32}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.detectRuntimes=n.detectEngineFilesObject=n.isEngineFilesUrl=n.detectPlaylogClientObject=n.findPlaylogClientUrl=n.isPlaylogClientUrl=void 0;var d=e("./Error");function i(e){return/.*\/playlogClientV.*\.js$/.test(e)}n.isPlaylogClientUrl=i;function h(e){for(var t=0;t<e.length;t++){var n=e[t];if(i(n))return n}return null}n.findPlaylogClientUrl=h;function c(e,t){t=t.match(/.*\/(playlogClientV.*)\.js$/);return t?e[t[1]]:null}n.detectPlaylogClientObject=c;function p(e){return/.*\/engineFilesV.*\.js$/.test(e)}n.isEngineFilesUrl=p;function _(e,t){t=t.match(/.*\/(engineFilesV.*)\.js$/);return t&&e[t[1]]?{g:(e=e[t[1]]).akashicEngine,GameDriver:e.gameDriver,PdiBrowser:e.pdiBrowser}:null}n.detectEngineFilesObject=_;n.detectRuntimes=function(e,t){for(var n=null,i=null,r=null,o=null,a=null,s=0;s<t.length;s++){var l=t[s];if(p(l)){a=l;break}}if(a){var u=_(e,a);u&&(n=u.g,i=u.GameDriver,r=u.PdiBrowser)}(u=h(t))&&(o=c(e,u));if(n&&i&&r)return[null,{g:n,GameDriver:i,PdiBrowser:r,PlaylogClient:o}];u=null;try{n=e.require("@akashic/akashic-engine");i=e.require("@akashic/game-driver");r=e.require("@akashic/pdi-browser");try{o=e.require("@akashic/playlog-client")}catch(e){}if(n&&i&&r)return[null,{g:n,GameDriver:i,PdiBrowser:r,PlaylogClient:o}]}catch(e){u=e}return[d.ErrorFactory.createLoadMuduleError(u||new Error("unknown failure for require()")),null]}},{"./Error":6}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ExternalPluginSignatureCaller=n.ObjectList=n.GameContent=n.WebContent=n.RetryDownloader=n.XhrDownloader=n.Content=n.GameContentSharedObject=n.GameViewSharedObject=n.AkashicGameView=n.DroppedEventType=n.DroppedEventReason=n.EventDropPolicy=n.ProtocolType=n.ExecutionMode=n.HorizontalAlignment=n.VerticalAlignment=n.ScaleMode=void 0;var i=e("@akashic/akashic-gameview");Object.defineProperty(n,"ScaleMode",{enumerable:!0,get:function(){return i.ScaleMode}});Object.defineProperty(n,"VerticalAlignment",{enumerable:!0,get:function(){return i.VerticalAlignment}});Object.defineProperty(n,"HorizontalAlignment",{enumerable:!0,get:function(){return i.HorizontalAlignment}});Object.defineProperty(n,"ExecutionMode",{enumerable:!0,get:function(){return i.ExecutionMode}});Object.defineProperty(n,"ProtocolType",{enumerable:!0,get:function(){return i.ProtocolType}});Object.defineProperty(n,"EventDropPolicy",{enumerable:!0,get:function(){return i.EventDropPolicy}});Object.defineProperty(n,"DroppedEventReason",{enumerable:!0,get:function(){return i.DroppedEventReason}});Object.defineProperty(n,"DroppedEventType",{enumerable:!0,get:function(){return i.DroppedEventType}});var r=e("./AkashicGameViewWeb"),o=(Object.defineProperty(n,"AkashicGameView",{enumerable:!0,get:function(){return r.AkashicGameView}}),e("./SharedObject"));Object.defineProperty(n,"GameViewSharedObject",{enumerable:!0,get:function(){return o.GameViewSharedObject}});Object.defineProperty(n,"GameContentSharedObject",{enumerable:!0,get:function(){return o.GameContentSharedObject}});var a=e("./Content"),s=(Object.defineProperty(n,"Content",{enumerable:!0,get:function(){return a.Content}}),e("./Downloader"));Object.defineProperty(n,"XhrDownloader",{enumerable:!0,get:function(){return s.XhrDownloader}});Object.defineProperty(n,"RetryDownloader",{enumerable:!0,get:function(){return s.RetryDownloader}});var l=e("./WebContent"),u=(Object.defineProperty(n,"WebContent",{enumerable:!0,get:function(){return l.WebContent}}),e("./GameContent")),d=(Object.defineProperty(n,"GameContent",{enumerable:!0,get:function(){return u.GameContent}}),e("./utils")),h=(Object.defineProperty(n,"ObjectList",{enumerable:!0,get:function(){return d.ObjectList}}),e("./ExternalPluginSignatureCaller"));Object.defineProperty(n,"ExternalPluginSignatureCaller",{enumerable:!0,get:function(){return h.ExternalPluginSignatureCaller}})},{"./AkashicGameViewWeb":1,"./Content":3,"./Downloader":5,"./ExternalPluginSignatureCaller":8,"./GameContent":9,"./SharedObject":12,"./WebContent":16,"./utils":28,"@akashic/akashic-gameview":29}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.assignObject=n.ObjectList=void 0;var i=function(){function e(){this._objectList=[]}e.prototype.addItem=function(e){this._objectList.push(e)};e.prototype.removeItem=function(t){this._objectList=this._objectList.filter(function(e){return e!==t})};e.prototype.removeAllItems=function(){this._objectList=[]};e.prototype.forEach=function(e){this._objectList.forEach(e)};return e}();n.ObjectList=i;n.assignObject=function(t,n){null!=n&&Object.keys(n).forEach(function(e){t[e]=n[e]});return t}},{}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.ProtocolType=n.ExecutionMode=n.HorizontalAlignment=n.VerticalAlignment=n.ScaleMode=n.DroppedEventType=n.DroppedEventReason=n.EventDropPolicy=void 0;var i=n.EventDropPolicy||(n.EventDropPolicy={});i[i.InReplay=0]="InReplay";i[i.Always=1]="Always";i[i.Never=2]="Never";var i=n.DroppedEventReason||(n.DroppedEventReason={});i[i.Unknown=0]="Unknown";i[i.Replay=1]="Replay";i=n.DroppedEventType||(n.DroppedEventType={});i[i.Click=0]="Click";i[i.Down=1]="Down";i[i.Move=2]="Move";i[i.Up=3]="Up";i=n.ScaleMode||(n.ScaleMode={});i[i.None=0]="None";i[i.Fill=1]="Fill";i[i.AspectFit=2]="AspectFit";i=n.VerticalAlignment||(n.VerticalAlignment={});i[i.Top=0]="Top";i[i.Center=1]="Center";i[i.Bottom=2]="Bottom";i=n.HorizontalAlignment||(n.HorizontalAlignment={});i[i.Left=0]="Left";i[i.Center=1]="Center";i[i.Right=2]="Right";i=n.ExecutionMode||(n.ExecutionMode={});i[i.Active=0]="Active";i[i.Passive=1]="Passive";i[i.Replay=2]="Replay";(i=n.ProtocolType||(n.ProtocolType={}))[i.WebSocket=0]="WebSocket"},{}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Asset=void 0;var i=e("@akashic/trigger"),e=function(){function e(e,t){this.id=e;this.originalPath=t;this.path=this._assetPathFilter(t);this.onDestroyed=new i.Trigger}e.prototype.destroy=function(){this.onDestroyed.fire(this);this.id=void 0;this.originalPath=void 0;this.path=void 0;this.onDestroyed.destroy();this.onDestroyed=void 0};e.prototype.destroyed=function(){return void 0===this.id};e.prototype.inUse=function(){return!1};e.prototype._assetPathFilter=function(e){return e};return e}();n.Asset=e},{"@akashic/trigger":37}],31:[function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.AudioAsset=void 0;e=function(s){r(e,s);function e(e,t,n,i,r,o,a){e=s.call(this,e,t)||this;e.type="audio";e.duration=n;e.loop=r;e.hint=o;e._system=i;e.data=void 0;e.offset=a;return e}e.prototype.play=function(){var e=this._system.createPlayer();e.play(this);return this._lastPlayedPlayer=e};e.prototype.stop=function(){for(var e=this._system.findPlayers(this),t=0;t<e.length;++t)e[t].stop()};e.prototype.inUse=function(){return 0<this._system.findPlayers(this).length};e.prototype.destroy=function(){this._system&&this.stop();this.data=void 0;this._system=void 0;this._lastPlayedPlayer=void 0;s.prototype.destroy.call(this)};return e}(e("./Asset").Asset);n.AudioAsset=e},{"./Asset":30}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.AudioPlayer=void 0;var i=e("@akashic/trigger"),e=function(){function e(e){this.onPlay=new i.Trigger;this.onStop=new i.Trigger;this.played=this.onPlay;this.stopped=this.onStop;this.currentAudio=void 0;this.volume=e.volume;this._muted=e._muted;this._system=e}e.prototype.play=function(e){this.currentAudio=e;this.onPlay.fire({player:this,audio:e})};e.prototype.stop=function(){var e=this.currentAudio;if(e){this.currentAudio=void 0;this.onStop.fire({player:this,audio:e})}};e.prototype.canHandleStopped=function(){return!0};e.prototype.changeVolume=function(e){this.volume=e};e.prototype._changeMuted=function(e){this._muted=e};e.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)};return e}();n.AudioPlayer=e},{"@akashic/trigger":37}],33:[function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(e,t);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});n.ChainTrigger=void 0;e=function(r){o(e,r);function e(e,t,n){var i=r.call(this)||this;i.chain=e;i.filter=null!=t?t:null;i.filterOwner=n;i._isActivated=!1;return i}e.prototype.add=function(e,t){r.prototype.add.call(this,e,t);if(!this._isActivated){this.chain.add(this._onChainTriggerFired,this);this._isActivated=!0}};e.prototype.addOnce=function(e,t){r.prototype.addOnce.call(this,e,t);if(!this._isActivated){this.chain.add(this._onChainTriggerFired,this);this._isActivated=!0}};e.prototype.remove=function(e,t){r.prototype.remove.call(this,e,t);if(0===this.length&&this._isActivated){this.chain.remove(this._onChainTriggerFired,this);this._isActivated=!1}};e.prototype.removeAll=function(e){r.prototype.removeAll.call(this,e);if(0===this.length&&this._isActivated){this.chain.remove(this._onChainTriggerFired,this);this._isActivated=!1}};e.prototype.destroy=function(){r.prototype.destroy.call(this);this.chain.remove(this._onChainTriggerFired,this);this.filter=null;this.filterOwner=null;this._isActivated=!1};e.prototype._onChainTriggerFired=function(e){this.filter&&!this.filter.call(this.filterOwner,e)||this.fire(e)};return e}(e("./Trigger").Trigger);n.ChainTrigger=e},{"./Trigger":35}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Trigger=void 0;var i=function(){function e(){this._handlers=[];this.length=0}e.prototype.add=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!1,name:void 0});else{t=e;"number"==typeof t.index?this._handlers.splice(t.index,0,{func:t.func,owner:t.owner,once:!1,name:t.name}):this._handlers.push({func:t.func,owner:t.owner,once:!1,name:t.name})}this.length=this._handlers.length};e.prototype.addOnce=function(e,t){if("function"==typeof e)this._handlers.push({func:e,owner:t,once:!0,name:void 0});else{t=e;"number"==typeof t.index?this._handlers.splice(t.index,0,{func:t.func,owner:t.owner,once:!0,name:t.name}):this._handlers.push({func:t.func,owner:t.owner,once:!0,name:t.name})}this.length=this._handlers.length};e.prototype.handle=function(e,t,n){this.add(t?{owner:e,func:t,name:n}:{func:e})};e.prototype.fire=function(e){if(this._handlers&&this._handlers.length){for(var t=this._handlers.concat(),n=0;n<t.length;n++){var i=t[n];if((i.func.call(i.owner,e)||i.once)&&this._handlers){i=this._handlers.indexOf(i);-1!==i&&this._handlers.splice(i,1)}}null!=this._handlers&&(this.length=this._handlers.length)}};e.prototype.contains=function(e,t){for(var n="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++)if(this._comparePartial(n,this._handlers[i]))return!0;return!1};e.prototype.remove=function(e,t){for(var n="function"==typeof e?{func:e,owner:t}:e,i=0;i<this._handlers.length;i++){var r=this._handlers[i];if(n.func===r.func&&n.owner===r.owner&&n.name===r.name){this._handlers.splice(i,1);--this.length;return}}};e.prototype.removeAll=function(e){var t=[];if(e)for(var n=0;n<this._handlers.length;n++){var i=this._handlers[n];this._comparePartial(e,i)||t.push(i)}this._handlers=t;this.length=this._handlers.length};e.prototype.destroy=function(){this._handlers=null;this.length=null};e.prototype.destroyed=function(){return null===this._handlers};e.prototype._comparePartial=function(e,t){return(void 0===e.func||e.func===t.func)&&((void 0===e.owner||e.owner===t.owner)&&(void 0===e.name||e.name===t.name))};return e}();n.Trigger=i},{}],36:[function(e,t,n){arguments[4][34][0].apply(n,arguments)},{dup:34}],37:[function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[n]}});Object.defineProperty(e,i,r)}:function(e,t,n,i){e[i=void 0===i?n:i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0});r(e("./TriggerLike"),n);r(e("./ChainTriggerLike"),n);r(e("./Trigger"),n);r(e("./ChainTrigger"),n)},{"./ChainTrigger":33,"./ChainTriggerLike":34,"./Trigger":35,"./TriggerLike":36}],38:[function(e,t,n){
// Copyright © 2017 DWANGO Co., Ltd.
var i=function(){function e(e,t){this._sender=e;this._receiver=t;this._handlers=[];var n=this;this._receiver.setHandler(function(){for(var e=0,t=n._handlers;e<t.length;e++)t[e].apply(n,arguments)})}e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[+t]=arguments[t];this._sender.send.apply(this._sender,e)};e.prototype.addHandler=function(e){this._handlers.push(e)};e.prototype.removeHandler=function(e){e=this._handlers.indexOf(e);e<0||this._handlers.splice(e,1)};e.prototype.removeAllHandlers=function(){this._handlers=[]};e.prototype.destroy=function(){this.removeAllHandlers();this._receiver.setHandler(void 0)};return e}();n.MemoryQueueDataBus=i},{}],39:[function(e,t,n){
// Copyright © 2017 DWANGO Co., Ltd.
var i=function(){function e(e){this._handler=e}e.prototype.setHandler=function(e){this._handler=e};e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[+t]=arguments[t];this._handler&&this._handler.apply(null,e)};return e}();n.MemoryQueue=i},{}],40:[function(e,t,n){
// Copyright © 2017 DWANGO Co., Ltd.
var i=function(){function e(e){this._target=e;this._handlers=[]}e.prototype.send=function(){for(var e=[],t=0;t<arguments.length;t++)e[+t]=arguments[t];this._target&&this._target.postMessage(JSON.stringify(e),"*")};e.prototype.addHandler=function(e){if(this._target){if(0===this._handlers.length){var t=this,n=(Object.keys(o).length||window.addEventListener("message",s),r.indexOf(t._target));-1===n&&(n=r.push(t._target)-1);o[n]||(o[n]=[]);o[n].push(t)}this._handlers.push(e)}};e.prototype.removeHandler=function(e){if(this._target){e=this._handlers.indexOf(e);if(!(e<0)){this._handlers.splice(e,1);0===this._handlers.length&&a(this)}}};e.prototype.removeAllHandlers=function(){if(this._target&&0!==this._handlers.length){this._handlers=[];a(this)}};e.prototype._onMessage=function(e){if(this._target&&0!==this._handlers.length){for(var t=[],n=0,i=this._handlers;n<i.length;n++)(o=i[n]).apply(null,e)&&t.push(o);for(var r=0;r<t.length;r++){var o=t[r];this.removeHandler(o)}}};e.prototype.destroy=function(){if(this._target){this.removeAllHandlers();this._target=void 0}};return e}(),r=(n.PostMessageDataBus=i,[]),o={};function a(t){var e=r.indexOf(t._target);if(-1!==e){o[e]=o[e].filter(function(e){return e!==t});if(!o[e].length){delete o[e];r[e]=null}Object.keys(o).length||window.removeEventListener("message",s)}}function s(e){var t=r.indexOf(e.source);if(-1!==t){var n=null;try{n=JSON.parse(e.data)}catch(e){return}o[t].forEach(function(e){e._onMessage(n)})}}},{}]},{},[27])(27)});