!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).engineFilesV3_7_16=e()}(this,(function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var r={},i={};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,o=void 0,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?o:String(o)),i)}var n,o}function a(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function c(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=h(t);if(e){var n=h(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return c(this,r)}}function d(){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}},d.apply(this,arguments)}Object.defineProperty(i,"__esModule",{value:!0}),i.PSEUDO_INFINITE_AGE=i.DEFAULT_POLLING_TICK_THRESHOLD=i.DEFAULT_JUMP_IGNORE_THRESHOLD=i.DEFAULT_JUMP_TRY_THRESHOLD=i.DEFAULT_SKIP_THRESHOLD=i.DEFAULT_SKIP_TICKS_AT_ONCE=i.DEFAULT_DELAY_IGNORE_THRESHOLD=void 0,i.DEFAULT_DELAY_IGNORE_THRESHOLD=6,i.DEFAULT_SKIP_TICKS_AT_ONCE=100,i.DEFAULT_SKIP_THRESHOLD=100,i.DEFAULT_JUMP_TRY_THRESHOLD=3e4,i.DEFAULT_JUMP_IGNORE_THRESHOLD=15e3,i.DEFAULT_POLLING_TICK_THRESHOLD=1e4,i.PSEUDO_INFINITE_AGE=189216e4;var p={};Object.defineProperty(p,"__esModule",{value:!0}),p._cloneDeep=p.MemoryAmflowClient=void 0;var f=function(){function t(t){this._tickHandlers=[],this._eventHandlers=[],this._events=[],this._tickList=null,this._playId=t.playId,this._putStorageDataSyncFunc=t.putStorageDataSyncFunc||function(){throw new Error("Implementation not given")},this._getStorageDataSyncFunc=t.getStorageDataSyncFunc||function(){throw new Error("Implementation not given")},t.startPoints?(t.tickList&&(this._tickList=t.tickList),this._startPoints=t.startPoints):this._startPoints=[]}return t.prototype.dump=function(){return{tickList:this._tickList,startPoints:this._startPoints}},t.prototype.open=function(t,e){var r=this;setTimeout((function(){e&&(t===r._playId?e(null):e(new Error("MemoryAmflowClient#open: unknown playId")))}),0)},t.prototype.close=function(t){t&&setTimeout((function(){t(null)}),0)},t.prototype.authenticate=function(e,r){setTimeout((function(){switch(e){case t.TOKEN_ACTIVE:r(null,{writeTick:!0,readTick:!0,subscribeTick:!1,sendEvent:!1,subscribeEvent:!0,maxEventPriority:2});break;case t.TOKEN_PASSIVE:r(null,{writeTick:!1,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!1,maxEventPriority:2});break;default:r(null,{writeTick:!0,readTick:!0,subscribeTick:!0,sendEvent:!0,subscribeEvent:!0,maxEventPriority:2})}}),0)},t.prototype.sendTick=function(t){if(t=_(t),this._tickList){if(this._tickList[0]<=t[0]&&t[0]<=this._tickList[1])throw new Error("illegal age tick");this._tickList[1]=t[0]}else this._tickList=[t[0],t[0],[]];var e=t[1],r=t[2];(e||r)&&(e&&(t[1]=e.filter((function(t){return!(8&t[1])}))),this._tickList[2].push(t)),this._tickHandlers.forEach((function(e){return e(t)}))},t.prototype.onTick=function(t){this._tickHandlers.push(t)},t.prototype.offTick=function(t){this._tickHandlers=this._tickHandlers.filter((function(e){return e!==t}))},t.prototype.sendEvent=function(t){t=_(t),0!==this._eventHandlers.length?this._eventHandlers.forEach((function(e){return e(t)})):this._events.push(t)},t.prototype.onEvent=function(t){var e=this;this._eventHandlers.push(t),this._events.length>0&&(this._events.forEach((function(t){e._eventHandlers.forEach((function(e){return e(t)}))})),this._events=[])},t.prototype.offEvent=function(t){this._eventHandlers=this._eventHandlers.filter((function(e){return e!==t}))},t.prototype.getTickList=function(t,e,r){var i,n;if("number"==typeof t?(i={begin:t,end:e},n=r):(i=t,n=e),this._tickList){var o=Math.max(i.begin,this._tickList[0]),s=Math.min(i.end,this._tickList[1]),a=this._tickList[2].filter((function(t){var e=t[0];return o<=e&&e<=s})),h=[o,s,a];setTimeout((function(){return n(null,h)}),0)}else n&&setTimeout((function(){return n(null)}),0)},t.prototype.putStartPoint=function(t,e){var r=this;setTimeout((function(){r._startPoints.push(t),e(null)}),0)},t.prototype.getStartPoint=function(t,e){var r=this;setTimeout((function(){if(r._startPoints&&0!==r._startPoints.length){var i=0;if(null!=t.frame)for(var n=r._startPoints[0].frame,o=1;o<r._startPoints.length;++o){var s=r._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,i=o)}else{var a=r._startPoints[0].timestamp;for(o=1;o<r._startPoints.length;++o){var h=r._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,i=o)}}e(null,r._startPoints[i])}else e(new Error("no startpoint"))}),0)},t.prototype.putStorageData=function(t,e,r,i){var n=this;setTimeout((function(){try{n._putStorageDataSyncFunc(t,e,r),i(null)}catch(t){i(t)}}),0)},t.prototype.getStorageData=function(t,e){var r=this;setTimeout((function(){try{var i=r._getStorageDataSyncFunc(t);e(null,i)}catch(t){e(t)}}),0)},t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],r=this._tickList[1];t<=e?(this._tickList=null,this._startPoints=[]):t<=r&&(this._tickList[1]=t-1,this._tickList[2]=this._tickList[2].filter((function(r){var i=r[0];return e<=i&&i<=t-1})),this._startPoints=this._startPoints.filter((function(e){return e.frame<t})))}},t.TOKEN_ACTIVE="mamfc-token:active",t.TOKEN_PASSIVE="mamfc-token:passive",t}();function _(t){return t&&"object"===n(t)?Array.isArray(t)?t.map(_):Object.keys(t).reduce((function(e,r){return e[r]=_(t[r]),e}),{}):t}p.MemoryAmflowClient=f,p._cloneDeep=_;var y={};Object.defineProperty(y,"__esModule",{value:!0}),y.ReplayAmflowProxy=void 0;var g=function(){function t(t){this._amflow=t.amflow,this._tickList=t.tickList,this._startPoints=t.startPoints}return t.prototype.dropAfter=function(t){if(this._tickList){var e=this._tickList[0],r=this._tickList[1],i=this._tickList[2]||[];t<=e?(this._tickList=null,this._startPoints=[]):t<=r&&(this._tickList[1]=t-1,this._tickList[2]=this._sliceTicks(i,r,t-1),this._startPoints=this._startPoints.filter((function(e){return e.frame<t})))}},t.prototype.open=function(t,e){this._amflow.open(t,e)},t.prototype.close=function(t){this._amflow.close(t)},t.prototype.authenticate=function(t,e){this._amflow.authenticate(t,e)},t.prototype.sendTick=function(t){this._amflow.sendTick(t)},t.prototype.onTick=function(t){this._amflow.onTick(t)},t.prototype.offTick=function(t){this._amflow.offTick(t)},t.prototype.sendEvent=function(t){this._amflow.sendEvent(t)},t.prototype.onEvent=function(t){this._amflow.onEvent(t)},t.prototype.offEvent=function(t){this._amflow.offEvent(t)},t.prototype.getTickList=function(t,e,r){var i,n,o=this;if("number"==typeof t?(i={begin:t,end:e},n=r):(i=t,n=e),this._tickList){var s=i.begin,a=i.end,h=this._tickList[0],u=this._tickList[1],c=this._tickList[2]||[],l=h<=s&&s<=u,d=h<=a&&a<=u;l&&d?setTimeout((function(){n(null,[s,a,o._sliceTicks(c,s,a)])}),0):this._amflow.getTickList({begin:s,end:a},(function(t,e){if(t)n(t);else if(e)if(l||d)if(l){r=o._sliceTicks(c,s,a).concat(e[2]||[]);n(null,[s,e[1],r])}else{r=(e[2]||[]).concat(o._sliceTicks(c,s,a));n(null,[e[0],a,r])}else if(a<h||u<s)n(null,e);else{var r;if(r=e[2]){var i=o._sliceTicks(r,s,h-1),p=o._sliceTicks(r,u+1,a);r=i.concat(c,p)}else r=c;n(null,[s,a,r])}else n(null,l||d?l?[s,u,o._sliceTicks(c,s,a)]:[h,a,o._sliceTicks(c,s,a)]:a<h||u<s?e:[h,u,o._sliceTicks(c,s,a)])}))}else this._amflow.getTickList(i,n)},t.prototype.putStartPoint=function(t,e){this._amflow.putStartPoint(t,e)},t.prototype.getStartPoint=function(t,e){var r=this,i=0;if(this._startPoints.length>0)if(null!=t.frame)for(var n=this._startPoints[0].frame,o=1;o<this._startPoints.length;++o){var s=this._startPoints[o].frame;s<=t.frame&&n<s&&(n=s,i=o)}else{var a=this._startPoints[0].timestamp;for(o=1;o<this._startPoints.length;++o){var h=this._startPoints[o].timestamp;h<=t.timestamp&&a<h&&(a=h,i=o)}}var u=this._tickList?this._tickList[1]:-1;"number"==typeof t.frame&&t.frame>u?this._amflow.getStartPoint(t,(function(t,n){t?e(t):n&&u<n.frame?e(null,n):e(null,r._startPoints[i])})):setTimeout((function(){e(null,r._startPoints[i])}),0)},t.prototype.putStorageData=function(t,e,r,i){this._amflow.putStorageData(t,e,r,i)},t.prototype.getStorageData=function(t,e){this._amflow.getStorageData(t,e)},t.prototype._sliceTicks=function(t,e,r){return t.filter((function(t){var i=t[0];return e<=i&&i<=r}))},t}();y.ReplayAmflowProxy=g;var v={},m={},T={},A={},w={};Object.defineProperty(w,"__esModule",{value:!0});var S={};Object.defineProperty(S,"__esModule",{value:!0});var x={};Object.defineProperty(x,"__esModule",{value:!0}),function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),i=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(w,e),i(S,e),i(x,e)}(A);var b={};var P=function(){function t(){o(this,t),this._handlers=[],this.length=0}return a(t,[{key:"add",value:function(t,e){if("function"==typeof t)this._addHandler({func:t,owner:e,once:!1,name:void 0,filter:void 0});else{var r=t,i="number"==typeof r.index?r.index:void 0;this._addHandler({func:r.func,owner:r.owner,once:!1,name:r.name,filter:r.filter},i)}this.length=this._handlers.length}},{key:"addOnce",value:function(t,e){if("function"==typeof t)this._addHandler({func:t,owner:e,once:!0,name:void 0,filter:void 0});else{var r=t,i="number"==typeof r.index?r.index:void 0;this._addHandler({func:r.func,owner:r.owner,once:!0,name:r.name,filter:r.filter},i)}this.length=this._handlers.length}},{key:"handle",value:function(t,e,r){this.add(e?{owner:t,func:e,name:r}:{func:t})}},{key:"fire",value:function(t){if(this._handlers&&this._handlers.length){for(var e,r=this._handlers.concat(),i=0;i<r.length;i++){var o=r[i];if(!o.filter||o.filter(o)){var s=o.func.call(o.owner,t);if(!(e=s,null!=e&&("object"===n(e)||"function"==typeof e)&&"function"==typeof e.then||!s)||o.once){if(!this._handlers)continue;var a=this._handlers.indexOf(o);-1!==a&&this._handlers.splice(a,1)}}}null!=this._handlers&&(this.length=this._handlers.length)}}},{key:"contains",value:function(t,e){for(var r="function"==typeof t?{func:t,owner:e}:t,i=0;i<this._handlers.length;i++)if(this._comparePartial(r,this._handlers[i]))return!0;return!1}},{key:"remove",value:function(t,e){for(var r="function"==typeof t?{func:t,owner:e}:t,i=0;i<this._handlers.length;i++){var n=this._handlers[i];if(r.func===n.func&&r.owner===n.owner&&r.name===n.name&&r.filter===n.filter)return this._handlers.splice(i,1),void--this.length}}},{key:"removeAll",value:function(t){var e=[];if(t)for(var r=0;r<this._handlers.length;r++){var i=this._handlers[r];this._comparePartial(t,i)||e.push(i)}this._handlers=e,this.length=this._handlers.length}},{key:"destroy",value:function(){this._handlers=null,this.length=null}},{key:"destroyed",value:function(){return null===this._handlers}},{key:"_addHandler",value:function(t,e){null==e?this._handlers.push({func:t.func,owner:t.owner,once:t.once,name:t.name,filter:t.filter}):this._handlers.splice(e,0,{func:t.func,owner:t.owner,once:t.once,name:t.name,filter:t.filter})}},{key:"_comparePartial",value:function(t,e){return(void 0===t.func||t.func===e.func)&&((void 0===t.owner||t.owner===e.owner)&&((void 0===t.name||t.name===e.name)&&(void 0===t.filter||t.filter===e.filter)))}}]),t}(),E=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(r,t);var e=l(r);function r(t,i,n){var s;return o(this,r),(s=e.call(this)).chain=t,s.filter=null!=i?i:null,s.filterOwner=n,s._isActivated=!1,s}return a(r,[{key:"add",value:function(t,e){d(h(r.prototype),"add",this).call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)}},{key:"addOnce",value:function(t,e){d(h(r.prototype),"addOnce",this).call(this,t,e),this._isActivated||(this.chain.add(this._onChainTriggerFired,this),this._isActivated=!0)}},{key:"remove",value:function(t,e){d(h(r.prototype),"remove",this).call(this,t,e),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)}},{key:"removeAll",value:function(t){d(h(r.prototype),"removeAll",this).call(this,t),0===this.length&&this._isActivated&&(this.chain.remove(this._onChainTriggerFired,this),this._isActivated=!1)}},{key:"destroy",value:function(){d(h(r.prototype),"destroy",this).call(this),this.chain.remove(this._onChainTriggerFired,this),this.filter=null,this.filterOwner=null,this._isActivated=!1}},{key:"_onChainTriggerFired",value:function(t){this.filter&&!this.filter.call(this.filterOwner,t)||this.fire(t)}}]),r}(P);b.ChainTrigger=E,b.Trigger=P;var O={},k={};Object.defineProperty(k,"__esModule",{value:!0});var M={};Object.defineProperty(M,"__esModule",{value:!0});var L={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.CompositeOperation=void 0,function(t){t[t.SourceOver=0]="SourceOver",t[t.SourceAtop=1]="SourceAtop",t[t.Lighter=2]="Lighter",t[t.Copy=3]="Copy",t[t.ExperimentalSourceIn=4]="ExperimentalSourceIn",t[t.ExperimentalSourceOut=5]="ExperimentalSourceOut",t[t.ExperimentalDestinationAtop=6]="ExperimentalDestinationAtop",t[t.ExperimentalDestinationIn=7]="ExperimentalDestinationIn",t[t.DestinationOut=8]="DestinationOut",t[t.DestinationOver=9]="DestinationOver",t[t.Xor=10]="Xor"}(t.CompositeOperation||(t.CompositeOperation={}))}(L);var R={};Object.defineProperty(R,"__esModule",{value:!0});var C={};Object.defineProperty(C,"__esModule",{value:!0});var I={};Object.defineProperty(I,"__esModule",{value:!0});var F={};Object.defineProperty(F,"__esModule",{value:!0});var D={};Object.defineProperty(D,"__esModule",{value:!0});var j={};Object.defineProperty(j,"__esModule",{value:!0});var G={};Object.defineProperty(G,"__esModule",{value:!0});var U={};Object.defineProperty(U,"__esModule",{value:!0});var H={};Object.defineProperty(H,"__esModule",{value:!0});var B={};Object.defineProperty(B,"__esModule",{value:!0});var N={};Object.defineProperty(N,"__esModule",{value:!0});var W={};Object.defineProperty(W,"__esModule",{value:!0});var V={};Object.defineProperty(V,"__esModule",{value:!0});var X={};Object.defineProperty(X,"__esModule",{value:!0});var z={};Object.defineProperty(z,"__esModule",{value:!0});var q={};Object.defineProperty(q,"__esModule",{value:!0});var Y={};Object.defineProperty(Y,"__esModule",{value:!0});var K={};Object.defineProperty(K,"__esModule",{value:!0});var $={};Object.defineProperty($,"__esModule",{value:!0});var J={};Object.defineProperty(J,"__esModule",{value:!0});var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var Q={};Object.defineProperty(Q,"__esModule",{value:!0});var tt={};Object.defineProperty(tt,"__esModule",{value:!0});var et={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.AssetLoadErrorType=void 0,function(t){t[t.Unspecified=0]="Unspecified",t[t.RetryLimitExceeded=1]="RetryLimitExceeded",t[t.NetworkError=2]="NetworkError",t[t.ClientError=3]="ClientError",t[t.ServerError=4]="ServerError"}(t.AssetLoadErrorType||(t.AssetLoadErrorType={}))}(et);var rt={};Object.defineProperty(rt,"__esModule",{value:!0});var it={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.FontWeight=void 0,function(t){t[t.Normal=0]="Normal",t[t.Bold=1]="Bold"}(t.FontWeight||(t.FontWeight={}))}(it);var nt={};!function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.FontFamily=void 0,function(t){t[t.SansSerif=0]="SansSerif",t[t.Serif=1]="Serif",t[t.Monospace=2]="Monospace"}(t.FontFamily||(t.FontFamily={}))}(nt);var ot={};Object.defineProperty(ot,"__esModule",{value:!0});var st={};Object.defineProperty(st,"__esModule",{value:!0});var at={};Object.defineProperty(at,"__esModule",{value:!0});var ht={};Object.defineProperty(ht,"__esModule",{value:!0});var ut={};Object.defineProperty(ut,"__esModule",{value:!0});var ct={};Object.defineProperty(ct,"__esModule",{value:!0});var lt={};Object.defineProperty(lt,"__esModule",{value:!0});var dt={};Object.defineProperty(dt,"__esModule",{value:!0});var pt={};Object.defineProperty(pt,"__esModule",{value:!0});var ft={};Object.defineProperty(ft,"__esModule",{value:!0}),function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),i=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(k,e),i(M,e),i(L,e),i(R,e),i(C,e),i(I,e),i(F,e),i(D,e),i(j,e),i(G,e),i(U,e),i(H,e),i(B,e),i(N,e),i(W,e),i(V,e),i(X,e),i(z,e),i(q,e),i(Y,e),i(K,e),i($,e),i(J,e),i(Z,e),i(Q,e),i(tt,e),i(et,e),i(rt,e),i(it,e),i(nt,e),i(ot,e),i(st,e),i(at,e),i(ht,e),i(ut,e),i(ct,e),i(lt,e),i(dt,e),i(pt,e),i(ft,e)}(O);var _t={},yt={};Object.defineProperty(yt,"__esModule",{value:!0}),yt.AudioPlayContext=void 0;var gt=b,vt=function(){function t(t){var e;this.onPlay=new gt.Trigger,this.onStop=new gt.Trigger,this.asset=t.asset,this._system=t.system,this._resourceFactory=t.resourceFactory,this._volume=null!==(e=t.volume)&&void 0!==e?e:1,this._id=t.id,this._systemId=t.systemId,this._player=this._createAudioPlayer(),this.asset.onDestroyed.addOnce(this.stop,this)}return Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},enumerable:!1,configurable:!0}),t.prototype.play=function(){this._player.play(this.asset)},t.prototype.stop=function(){this._player.stop()},t.prototype.changeVolume=function(t){this._volume=t,this._player.changeVolume(t)},t.prototype._startSuppress=function(){"music"!==this._systemId?this.stop():this._player.changeVolume(0)},t.prototype._endSuppress=function(){"music"!==this._systemId||this._player.changeVolume(this._volume)},t.prototype._createAudioPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this._system);return t.changeVolume(this._volume),t.onPlay.add(this.onPlay.fire,this.onPlay),t.onStop.add(this.onStop.fire,this.onStop),t},t}();yt.AudioPlayContext=vt;var mt,Tt={};Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.ExceptionFactory=void 0,function(t){t.createAssertionError=function(t,e){var r=new Error(t);return r.name="AssertionError",r.cause=e,r},t.createTypeMismatchError=function(t,e,r,i){var o="Type mismatch on "+t+", expected type is "+e;if(arguments.length>2)try{var s=void 0;o+=", actual type is "+((s=r&&r.constructor&&r.constructor.name?r.constructor.name:n(r)).length>40?s.substr(0,40):s)}catch(t){}o+=".";var a=new Error(o);return a.name="TypeMismatchError",a.cause=i,a.expected=e,a.actual=r,a},t.createAssetLoadError=function(t,e,r,i){void 0===e&&(e=!0);var n=new Error(t);return n.name="AssetLoadError",n.cause=i,n.retriable=e,n},t.createRequestAssetLoadError=function(t,e,r){var i=new Error(t);return i.name="RequestAssetLoadError",i.detail=e,i.cause=r,i}}(mt||(Tt.ExceptionFactory=mt={}));var At={};Object.defineProperty(At,"__esModule",{value:!0}),At.WeakRefKVS=void 0;var wt=function(){function t(t){this._target=t}return t.prototype.deref=function(){return this._target},t}(),St=function(){function t(){this._weakRefClass="undefined"!=typeof WeakRef?WeakRef:wt,this._refMap=Object.create(null)}return t.prototype.set=function(t,e){this._refMap[t]&&this.delete(t),this._refMap[t]=new this._weakRefClass(e)},t.prototype.get=function(t){var e=this._refMap[t];if(e)return e.deref()},t.prototype.has=function(t){return t in this._refMap},t.prototype.delete=function(t){delete this._refMap[t]},t.prototype.keys=function(){return Object.keys(this._refMap)},t.prototype.clear=function(){this._refMap=Object.create(null)},t.prototype.clean=function(){for(var t=0,e=Object.entries(this._refMap);t<e.length;t++){var r=e[t],i=r[0];void 0===r[1].deref()&&this.delete(i)}},t}();At.WeakRefKVS=St;var xt,bt=t&&t.__extends||(xt=function(t,e){return xt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},xt(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}xt(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(_t,"__esModule",{value:!0}),_t.SoundAudioSystem=_t.MusicAudioSystem=_t.AudioSystem=void 0;var Pt=yt,Et=Tt,Ot=At,kt=function(){function t(t){this.id=t.id,this._volume=t.volume||1,this._destroyRequestedAssets={},this._explicitMuted=t.muted||!1,this._suppressed=!1,this._muted=!1,this._contextMap=new Ot.WeakRefKVS,this._contextCount=0,this._resourceFactory=t.resourceFactory,this._updateMuted()}return Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0||t>1||isNaN(t)||"number"!=typeof t)throw Et.ExceptionFactory.createAssertionError("AudioSystem#volume: expected: 0.0-1.0, actual: "+t);this._volume=t,this._onVolumeChanged()},enumerable:!1,configurable:!0}),t.prototype.play=function(t){var e=this.create(t);return e.play(),e},t.prototype.create=function(t){var e=new Pt.AudioPlayContext({id:this._generateAudioPlayContextId(),resourceFactory:this._resourceFactory,asset:t,system:this,systemId:this.id,volume:1});return this._contextCount%this._contentMapCleaningFrequency==0&&this._contextMap.clean(),this._contextMap.set(e._id,e),e},t.prototype.stopAll=function(){for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],i=this._contextMap.get(r);null==i||i.stop()}this._contextMap.clean()},t.prototype.requestDestroy=function(t){this._destroyRequestedAssets[t.id]=t},t.prototype.cancelRequestDestroy=function(t){delete this._destroyRequestedAssets[t.id]},t.prototype.getDestroyRequestedAsset=function(t){return this._destroyRequestedAssets.hasOwnProperty(t)?this._destroyRequestedAssets[t]:null},t.prototype._reset=function(){this.stopAll(),this._volume=1,this._destroyRequestedAssets={},this._muted=!1,this._suppressed=!1,this._explicitMuted=!1},t.prototype._setMuted=function(t){var e=this._explicitMuted;this._explicitMuted=!!t,this._explicitMuted!==e&&(this._updateMuted(),this._onMutedChanged())},t.prototype._setPlaybackRate=function(t){if(t<0||isNaN(t)||"number"!=typeof t)throw Et.ExceptionFactory.createAssertionError("AudioSystem#playbackRate: expected: greater or equal to 0.0, actual: "+t);this._suppressed=1!==t,this._updateMuted(),this._onPlaybackRateChanged()},t.prototype._updateMuted=function(){this._muted=this._explicitMuted||this._suppressed},t.prototype._generateAudioPlayContextId=function(){return"".concat(this.id,"-").concat(this._contextCount++)},t.prototype._startSuppress=function(){this._setPlaybackRate(100);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],i=this._contextMap.get(r);null==i||i._startSuppress()}},t.prototype._endSuppress=function(){this._setPlaybackRate(1);for(var t=0,e=this._contextMap.keys();t<e.length;t++){var r=e[t],i=this._contextMap.get(r);null==i||i._endSuppress()}},t}();_t.AudioSystem=kt;var Mt=function(t){function e(e){var r=t.call(this,e)||this;return r._contentMapCleaningFrequency=5,r._player=void 0,r}return bt(e,t),Object.defineProperty(e.prototype,"player",{get:function(){return this._player||(this._player=this._resourceFactory.createAudioPlayer(this),this._player.onPlay.add(this._handlePlay,this),this._player.onStop.add(this._handleStop,this)),this._player},set:function(t){this._player=t},enumerable:!1,configurable:!0}),e.prototype.findPlayers=function(t){return this.player.currentAudio&&this.player.currentAudio.id===t.id?[this.player]:[]},e.prototype.createPlayer=function(){return this.player},e.prototype.stopAll=function(){t.prototype.stopAll.call(this),this._player&&this._player.stop()},e.prototype._reset=function(){t.prototype._reset.call(this),this._player&&(this._player.onPlay.remove(this._handlePlay,this),this._player.onStop.remove(this._handleStop,this)),this._player=void 0},e.prototype._onVolumeChanged=function(){this.player._notifyVolumeChanged()},e.prototype._onMutedChanged=function(){this.player._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){this.player._changeMuted(this._muted)},e.prototype._handlePlay=function(t){if(t.player!==this._player)throw Et.ExceptionFactory.createAssertionError("MusicAudioSystem#_onPlayerPlayed: unexpected audio player")},e.prototype._handleStop=function(t){this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy())},e}(kt);_t.MusicAudioSystem=Mt;var Lt=function(t){function e(e){var r=t.call(this,e)||this;return r._contentMapCleaningFrequency=50,r.players=[],r}return bt(e,t),e.prototype.createPlayer=function(){var t=this._resourceFactory.createAudioPlayer(this);return t.canHandleStopped()&&this.players.push(t),t.onPlay.add(this._handlePlay,this),t.onStop.add(this._handleStop,this),t},e.prototype.findPlayers=function(t){for(var e=[],r=0;r<this.players.length;++r){var i=this.players[r].currentAudio;i&&i.id===t.id&&e.push(this.players[r])}return e},e.prototype.stopAll=function(){t.prototype.stopAll.call(this);for(var e=this.players.concat(),r=0;r<e.length;++r)e[r].stop()},e.prototype._reset=function(){t.prototype._reset.call(this);for(var e=0;e<this.players.length;++e){var r=this.players[e];r.onPlay.remove(this._handlePlay,this),r.onStop.remove(this._handleStop,this)}this.players=[]},e.prototype._onMutedChanged=function(){for(var t=this.players,e=0;e<t.length;++e)t[e]._changeMuted(this._muted)},e.prototype._onPlaybackRateChanged=function(){var t=this.players;if(this._suppressed)for(var e=0;e<t.length;++e)t[e]._changeMuted(!0)},e.prototype._handlePlay=function(t){},e.prototype._handleStop=function(t){var e=this.players.indexOf(t.player);e<0||(t.player.onStop.remove(this._handleStop,this),this.players.splice(e,1),this._destroyRequestedAssets[t.audio.id]&&(delete this._destroyRequestedAssets[t.audio.id],t.audio.destroy()))},e.prototype._onVolumeChanged=function(){for(var t=0;t<this.players.length;++t)this.players[t]._notifyVolumeChanged()},e}(kt);_t.SoundAudioSystem=Lt;var Rt,Ct={},It={};Object.defineProperty(It,"__esModule",{value:!0}),It.PathUtil=void 0,function(t){t.resolvePath=function(e,r){function i(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return e;for(var n=t.splitPath(e),o=i(n.path).concat(i(r)),s=[],a=0;a<o.length;++a){var h=o[a];switch(h){case"..":var u=s.pop();if(void 0===u||""===u||"."===u)throw new Error("PathUtil.resolvePath: invalid arguments");break;case".":0===s.length&&s.push(".");break;case"":s=[""];break;default:s.push(h)}}return n.host+s.join("/")},t.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},t.resolveExtname=function(t){for(var e=t.length-1;e>=0;--e){var r=t.charAt(e);if("."===r)return t.substr(e);if("/"===r)return""}return""},t.makeNodeModulePaths=function(e){var r=t.splitPath(e),i=r.host;"/"===(e=r.path)[e.length-1]&&(e=e.slice(0,e.length-1));for(var n=e.split("/"),o=n.indexOf("node_modules"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if("node_modules"!==n[h]){var u=n.slice(0,h+1);u.push("node_modules");var c=u.join("/");a.push(i+c)}return a},t.splitPath=function(t){var e="",r=t.indexOf("//");if(r>=0){var i=t.indexOf("/",r+2);i>=0?(e=t.slice(0,i),t=t.slice(i)):(e=t,t="/")}else e="";return{host:e,path:t}}}(Rt||(It.PathUtil=Rt={})),Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.Module=void 0;var Ft=It,Dt=function(t){var e=this,r=t.path,i=Ft.PathUtil.resolveDirname(r),n=t.virtualPath,o=n?Ft.PathUtil.resolveDirname(n):void 0,s=t.requireFunc,a=t.resolveFunc;this._runtimeValue=Object.create(t.runtimeValueBase,{filename:{value:r,enumerable:!0},dirname:{value:i,enumerable:!0},module:{value:this,writable:!0,enumerable:!0,configurable:!0}}),this.id=t.id,this.filename=t.path,this.exports={},this.parent=null,this.loaded=!1,this.children=[],this.paths=o?Ft.PathUtil.makeNodeModulePaths(o):[],this._dirname=i,this._virtualDirname=o;var h=function(t){return s(t,e)};h.resolve=function(t){return a(t,e)},this.require=h};Ct.Module=Dt;var jt={};Object.defineProperty(jt,"__esModule",{value:!0}),jt.ShaderProgram=void 0;var Gt=function(t){this.fragmentShader=t.fragmentShader,this.uniforms=t.uniforms};jt.ShaderProgram=Gt;var Ut={};Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.VideoSystem=void 0;var Ht=function(){};Ut.VideoSystem=Ht;var Bt={},Nt={},Wt={},Vt=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.SeedEvent=Wt.PlayerInfoEvent=Wt.TimestampEvent=Wt.LeaveEvent=Wt.JoinEvent=Wt.OperationEvent=Wt.MessageEvent=Wt.PointMoveEventBase=Wt.PointUpEventBase=Wt.PointDownEventBase=Wt.PointEventBase=void 0;var Xt=function(t,e,r,i,n,o,s){this.eventFlags=o,this.local=!!n,this.player=i,this.pointerId=t,this.target=e,this.point=r,this.button=null!=s?s:0};Wt.PointEventBase=Xt;var zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="point-down",e}return Vt(e,t),e}(Xt);Wt.PointDownEventBase=zt;var qt=function(t){function e(e,r,i,n,o,s,a,h,u){var c=t.call(this,e,r,i,s,a,h,u)||this;return c.type="point-up",c.prevDelta=n,c.startDelta=o,c}return Vt(e,t),e}(Xt);Wt.PointUpEventBase=qt;var Yt=function(t){function e(e,r,i,n,o,s,a,h,u){var c=t.call(this,e,r,i,s,a,h,u)||this;return c.type="point-move",c.prevDelta=n,c.startDelta=o,c}return Vt(e,t),e}(Xt);Wt.PointMoveEventBase=Yt;var Kt=function(t,e,r,i){this.type="message",this.eventFlags=i,this.local=!!r,this.player=e,this.data=t};Wt.MessageEvent=Kt;var $t=function(t,e,r,i,n){this.type="operation",this.eventFlags=n,this.local=!!i,this.player=r,this.code=t,this.data=e};Wt.OperationEvent=$t;var Jt=function(t,e){this.type="join",this.eventFlags=e,this.player=t};Wt.JoinEvent=Jt;var Zt=function(t,e){this.type="leave",this.eventFlags=e,this.player=t};Wt.LeaveEvent=Zt;var Qt=function(t,e,r){this.type="timestamp",this.eventFlags=r,this.player=e,this.timestamp=t};Wt.TimestampEvent=Qt;var te=function(t,e){this.type="player-info",this.eventFlags=e,this.player=t};Wt.PlayerInfoEvent=te;var ee=function(t,e){this.type="seed",this.eventFlags=e,this.generator=t};Wt.SeedEvent=ee;var re={};Object.defineProperty(re,"__esModule",{value:!0}),re.PlainMatrix=void 0;var ie=function(){function t(t,e,r,i,n,o,s){void 0===t?(this._modified=!1,this._matrix=[1,0,0,1,0,0]):"number"==typeof t?(this._modified=!1,this._matrix=new Array(6),this.update(t,e,r,i,n,0,0,o,s)):(this._modified=t._modified,this._matrix=[t._matrix[0],t._matrix[1],t._matrix[2],t._matrix[3],t._matrix[4],t._matrix[5]])}return t.prototype.update=function(t,e,r,i,n,o,s,a,h){if(null!=a&&null!=h){var u=n*Math.PI/180,c=Math.cos(u),l=Math.sin(u),d=c*r,p=l*r,f=l*i,_=c*i,y=a*t,g=h*e;this._matrix[0]=d,this._matrix[1]=p,this._matrix[2]=-f,this._matrix[3]=_,this._matrix[4]=-d*y+f*g+o,this._matrix[5]=-p*y-_*g+s}else this._updateWithoutAnchor(t,e,r,i,n,o,s)},t.prototype._updateWithoutAnchor=function(t,e,r,i,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),u=Math.sin(a),c=h*r,l=u*r,d=u*i,p=h*i,f=t/2,_=e/2;this._matrix[0]=c,this._matrix[1]=l,this._matrix[2]=-d,this._matrix[3]=p,this._matrix[4]=-c*f+d*_+f+o,this._matrix[5]=-l*f-p*_+_+s},t.prototype.updateByInverse=function(t,e,r,i,n,o,s,a,h){if(null!=a&&null!=h){var u=n*Math.PI/180,c=Math.cos(u),l=Math.sin(u),d=c/r,p=l/i,f=l/r,_=c/i,y=a*t,g=h*e;this._matrix[0]=d,this._matrix[1]=-p,this._matrix[2]=f,this._matrix[3]=_,this._matrix[4]=-d*o-f*s+y,this._matrix[5]=p*o-_*s+g}else this._updateByInverseWithoutAnchor(t,e,r,i,n,o,s)},t.prototype._updateByInverseWithoutAnchor=function(t,e,r,i,n,o,s){var a=n*Math.PI/180,h=Math.cos(a),u=Math.sin(a),c=h/r,l=u/i,d=u/r,p=h/i,f=t/2,_=e/2;this._matrix[0]=c,this._matrix[1]=-l,this._matrix[2]=d,this._matrix[3]=p,this._matrix[4]=-c*(f+o)-d*(_+s)+f,this._matrix[5]=l*(f+o)-p*(_+s)+_},t.prototype.multiply=function(t){var e=this._matrix,r=t._matrix,i=e[0],n=e[1],o=e[2],s=e[3];e[0]=i*r[0]+o*r[1],e[1]=n*r[0]+s*r[1],e[2]=i*r[2]+o*r[3],e[3]=n*r[2]+s*r[3],e[4]=i*r[4]+o*r[5]+e[4],e[5]=n*r[4]+s*r[5]+e[5]},t.prototype.multiplyLeft=function(t){var e=t._matrix,r=this._matrix,i=r[0],n=r[2],o=r[4];r[0]=e[0]*i+e[2]*r[1],r[1]=e[1]*i+e[3]*r[1],r[2]=e[0]*n+e[2]*r[3],r[3]=e[1]*n+e[3]*r[3],r[4]=e[0]*o+e[2]*r[5]+e[4],r[5]=e[1]*o+e[3]*r[5]+e[5]},t.prototype.multiplyNew=function(t){var e=this.clone();return e.multiply(t),e},t.prototype.reset=function(t,e){this._matrix[0]=1,this._matrix[1]=0,this._matrix[2]=0,this._matrix[3]=1,this._matrix[4]=t||0,this._matrix[5]=e||0},t.prototype.clone=function(){return new t(this)},t.prototype.multiplyInverseForPoint=function(t){var e=this._matrix,r=1/(e[0]*e[3]+e[2]*-e[1]);return{x:e[3]*r*t.x+-e[2]*r*t.y+(e[5]*e[2]-e[4]*e[3])*r,y:e[0]*r*t.y+-e[1]*r*t.x+(-e[5]*e[0]+e[4]*e[1])*r}},t.prototype.scale=function(t,e){var r=this._matrix;r[0]*=t,r[1]*=e,r[2]*=t,r[3]*=e,r[4]*=t,r[5]*=e},t.prototype.multiplyPoint=function(t){var e=this._matrix;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}},t}();re.PlainMatrix=ie;var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.Object2D=void 0;var oe=Tt,se=re,ae=function(){function t(t){t?(this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.opacity=null!=t.opacity?t.opacity:1,this.scaleX=null!=t.scaleX?t.scaleX:1,this.scaleY=null!=t.scaleY?t.scaleY:1,this.angle=t.angle||0,this.compositeOperation=t.compositeOperation,this.anchorX=void 0===t.anchorX?0:t.anchorX,this.anchorY=void 0===t.anchorY?0:t.anchorY,this._matrix=void 0):(this.x=0,this.y=0,this.width=0,this.height=0,this.opacity=1,this.scaleX=1,this.scaleY=1,this.angle=0,this.compositeOperation=void 0,this.anchorX=0,this.anchorY=0,this._matrix=void 0)}return t.prototype.moveTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw oe.ExceptionFactory.createAssertionError("Object2D#moveTo: arguments must be CommonOffset or pair of x and y as a number.");"number"==typeof t?(this.x=t,this.y=e):(this.x=t.x,this.y=t.y)},t.prototype.moveBy=function(t,e){this.x+=t,this.y+=e},t.prototype.resizeTo=function(t,e){if("number"==typeof t&&"number"!=typeof e)throw oe.ExceptionFactory.createAssertionError("Object2D#resizeTo: arguments must be CommonSize or pair of width and height as a number.");"number"==typeof t?(this.width=t,this.height=e):(this.width=t.width,this.height=t.height)},t.prototype.resizeBy=function(t,e){this.width+=t,this.height+=e},t.prototype.scale=function(t){this.scaleX=t,this.scaleY=t},t.prototype.anchor=function(t,e){this.anchorX=t,this.anchorY=e},t.prototype.getMatrix=function(){if(this._matrix){if(!this._matrix._modified)return this._matrix}else this._matrix=new se.PlainMatrix;return this._updateMatrix(),this._matrix._modified=!1,this._matrix},t.prototype._updateMatrix=function(){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.update(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(this.x,this.y)},t}();ne.Object2D=ae;var he={};Object.defineProperty(he,"__esModule",{value:!0}),he.Util=void 0;var ue,ce=O;!function(t){var e;t.distance=function(t,e,r,i){return Math.sqrt(Math.pow(t-r,2)+Math.pow(e-i,2))},t.distanceBetweenOffsets=function(e,r){return t.distance(e.x,e.y,r.x,r.y)},t.distanceBetweenAreas=function(e,r){return t.distance(e.x+e.width/2,e.y+e.height/2,r.x+r.width/2,r.y+r.height/2)},t.charCodeAt=function(t,e){var r=t.charCodeAt(e);return 55296<=r&&r<=56319?r<<16|t.charCodeAt(e+1):56320<=r&&r<=57343?null:r},t.enumToSnakeCase=function(t,e){var r=t[e];return r[0].toLowerCase()+r.slice(1).replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}))},t.clamp=function(t,e,r){return Math.min(Math.max(t,e),r)},t.compositeOperationStringTable=((e={})[ce.CompositeOperation.SourceOver]="source-over",e[ce.CompositeOperation.SourceAtop]="source-atop",e[ce.CompositeOperation.Lighter]="lighter",e[ce.CompositeOperation.Copy]="copy",e[ce.CompositeOperation.ExperimentalSourceIn]="experimental-source-in",e[ce.CompositeOperation.ExperimentalSourceOut]="experimental-source-out",e[ce.CompositeOperation.ExperimentalDestinationAtop]="experimental-destination-atop",e[ce.CompositeOperation.ExperimentalDestinationIn]="experimental-destination-in",e[ce.CompositeOperation.DestinationOut]="destination-out",e[ce.CompositeOperation.DestinationOver]="destination-over",e[ce.CompositeOperation.Xor]="xor",e)}(ue||(he.Util=ue={}));var le=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.E=Nt.PointMoveEvent=Nt.PointUpEvent=Nt.PointDownEvent=void 0;var de=b,pe=Wt,fe=Tt,_e=re,ye=ne,ge=he,ve=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return le(e,t),e}(pe.PointDownEventBase);Nt.PointDownEvent=ve;var me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return le(e,t),e}(pe.PointUpEventBase);Nt.PointUpEvent=me;var Te=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return le(e,t),e}(pe.PointMoveEventBase);Nt.PointMoveEvent=Te;var Ae=function(t){function e(e){var r=t.call(this,e)||this;if(r.children=void 0,r.parent=void 0,r._touchable=!1,r.state=0,r._hasTouchableChildren=!1,r._onUpdate=void 0,r._onMessage=void 0,r._onPointDown=void 0,r._onPointMove=void 0,r._onPointUp=void 0,r.tag=e.tag,r.shaderProgram=e.shaderProgram,r.local="non-local"!==e.scene.local||!!e.local,e.children)for(var i=0;i<e.children.length;++i)r.append(e.children[i]);return e.parent&&e.parent.append(r),null!=e.touchable&&(r.touchable=e.touchable),e.hidden&&r.hide(),r.id=e.id,e.scene.register(r),r}return le(e,t),Object.defineProperty(e.prototype,"onUpdate",{get:function(){return this._onUpdate||(this._onUpdate=new de.ChainTrigger(this.scene.onUpdate)),this._onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{get:function(){return this._onMessage||(this._onMessage=new de.ChainTrigger(this.scene.onMessage)),this._onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointDown",{get:function(){return this._onPointDown||(this._onPointDown=new de.ChainTrigger(this.scene.onPointDownCapture,this._isTargetOperation,this)),this._onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointUp",{get:function(){return this._onPointUp||(this._onPointUp=new de.ChainTrigger(this.scene.onPointUpCapture,this._isTargetOperation,this)),this._onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onPointMove",{get:function(){return this._onPointMove||(this._onPointMove=new de.ChainTrigger(this.scene.onPointMoveCapture,this._isTargetOperation,this)),this._onPointMove},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touchable",{get:function(){return this._touchable},set:function(t){this._touchable!==t&&(this._touchable=t,t?this._enableTouchPropagation():this._disableTouchPropagation())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"update",{get:function(){return this.onUpdate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.onMessage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointDown",{get:function(){return this.onPointDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointUp",{get:function(){return this.onPointUp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointMove",{get:function(){return this.onPointMove},enumerable:!1,configurable:!0}),e.prototype.render=function(t,e){if(this.state&=-5,!(1&this.state))if(8&this.state){if(t.translate(this.x,this.y),this.renderSelf(t,e)&&this.children)for(var r=(o=this.children).length,i=0;i<r;++i)o[i].render(t,e);t.translate(-this.x,-this.y)}else{t.save(),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(this.x,this.y),1!==this.opacity&&t.opacity(this.opacity);var n=this.compositeOperation;if(void 0!==n&&t.setCompositeOperation("string"==typeof n?n:ge.Util.compositeOperationStringTable[n]),void 0!==this.shaderProgram&&t.isSupportedShaderProgram()&&t.setShaderProgram(this.shaderProgram),this.renderSelf(t,e)&&this.children){var o=this.children;for(i=0;i<o.length;++i)o[i].render(t,e)}t.restore()}},e.prototype.renderSelf=function(t,e){return!0},e.prototype.game=function(){return this.scene.game},e.prototype.append=function(t){this.insertBefore(t,void 0)},e.prototype.insertBefore=function(t,e){t.parent&&t.remove(),this.children||(this.children=[]),t.parent=this;var r=-1;void 0!==e&&(r=this.children.indexOf(e))>-1?this.children.splice(r,0,t):this.children.push(t),(t._touchable||t._hasTouchableChildren)&&(this._hasTouchableChildren=!0,this._enableTouchPropagation()),this.modified(!0)},e.prototype.remove=function(t){if(void 0!==t){var e=this.children?this.children.indexOf(t):-1;if(e<0)throw fe.ExceptionFactory.createAssertionError("E#remove: invalid child");this.children[e].parent=void 0,this.children.splice(e,1),(t._touchable||t._hasTouchableChildren)&&(this._findTouchableChildren(this)||(this._hasTouchableChildren=!1,this._disableTouchPropagation())),this.modified(!0)}else this.parent.remove(this)},e.prototype.destroy=function(){if(this.parent&&this.remove(),this.children){for(var t=this.children.length-1;t>=0;--t)this.children[t].destroy();if(0!==this.children.length)throw fe.ExceptionFactory.createAssertionError("E#destroy: can not destroy all children, "+this.children.length);this.children=void 0}this._onUpdate&&(this._onUpdate.destroy(),this._onUpdate=void 0),this._onMessage&&(this._onMessage.destroy(),this._onMessage=void 0),this._onPointDown&&(this._onPointDown.destroy(),this._onPointDown=void 0),this._onPointMove&&(this._onPointMove.destroy(),this._onPointMove=void 0),this._onPointUp&&(this._onPointUp.destroy(),this._onPointUp=void 0),this.scene.unregister(this)},e.prototype.destroyed=function(){return void 0===this.scene},e.prototype.modified=function(t){this._matrix&&(this._matrix._modified=!0),this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY||1!==this.opacity||void 0!==this.compositeOperation||void 0!==this.shaderProgram?this.state&=-9:this.state|=8,4&this.state||(this.state|=4,this.parent&&this.parent.modified(!0))},e.prototype.shouldFindChildrenByPoint=function(t){return!0},e.prototype.findPointSourceByPoint=function(t,e,r){if(!(1&this.state)){var i=(e=e?e.multiplyNew(this.getMatrix()):this.getMatrix().clone()).multiplyInverseForPoint(t);if(this._hasTouchableChildren||r&&this.children&&this.children.length){var n=this.children;if(this.shouldFindChildrenByPoint(i))for(var o=n.length-1;o>=0;--o){var s=n[o];if(r||s._touchable||s._hasTouchableChildren){var a=s.findPointSourceByPoint(t,e,r);if(a)return a}}}if(r||this._touchable)return 0<=i.x&&this.width>i.x&&0<=i.y&&this.height>i.y?{target:this,point:i}:void 0}},e.prototype.visible=function(){return 1!=(1&this.state)},e.prototype.show=function(){1&this.state&&(this.state&=-2,this.parent&&this.parent.modified(!0))},e.prototype.hide=function(){1&this.state||(this.state|=1,this.parent&&this.parent.modified(!0))},e.prototype.calculateBoundingRect=function(){return this._calculateBoundingRect(void 0)},e.prototype.localToGlobal=function(t){for(var r=t,i=this;i instanceof e;i=i.parent)r=i.getMatrix().multiplyPoint(r);return r},e.prototype.globalToLocal=function(t){for(var r=new _e.PlainMatrix,i=this;i instanceof e;i=i.parent)r.multiplyLeft(i.getMatrix());return r.multiplyInverseForPoint(t)},e.prototype._calculateMatrixTo=function(t){for(var r=new _e.PlainMatrix,i=this;i instanceof e&&i!==t;i=i.parent)r.multiplyLeft(i.getMatrix());return r},e.prototype._findLowestCommonAncestorWith=function(t){for(var r={},i=this;i instanceof e;i=i.parent)r[i.id]=!0;for(var n=t;n instanceof e&&!r.hasOwnProperty(n.id);n=n.parent);return n},e.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var r={left:0,right:this.width,top:0,bottom:this.height},i=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],n=e.multiplyPoint(i[0]),o={left:n.x,right:n.x,top:n.y,bottom:n.y},s=1;s<i.length;++s)n=e.multiplyPoint(i[s]),o.left>n.x&&(o.left=n.x),o.right<n.x&&(o.right=n.x),o.top>n.y&&(o.top=n.y),o.bottom<n.y&&(o.bottom=n.y);if(void 0!==this.children)for(s=0;s<this.children.length;++s){var a=this.children[s]._calculateBoundingRect(e);a&&(o.left>a.left&&(o.left=a.left),o.right<a.right&&(o.right=a.right),o.top>a.top&&(o.top=a.top),o.bottom<a.bottom&&(o.bottom=a.bottom))}return o}},e.prototype._enableTouchPropagation=function(){for(var t=this.parent;t instanceof e&&!t._hasTouchableChildren;)t._hasTouchableChildren=!0,t=t.parent},e.prototype._disableTouchPropagation=function(){for(var t=this.parent;t instanceof e&&t._hasTouchableChildren&&!this._findTouchableChildren(t);)t._hasTouchableChildren=!1,t=t.parent},e.prototype._isTargetOperation=function(t){return!(1&this.state)&&(t instanceof pe.PointEventBase&&(this._touchable&&t.target===this))},e.prototype._findTouchableChildren=function(t){if(t.children)for(var e=0;e<t.children.length;++e){if(t.children[e].touchable)return t.children[e];var r=this._findTouchableChildren(t.children[e]);if(r)return r}},e}(ye.Object2D);Nt.E=Ae;var we=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.CacheableE=void 0;var Se=function(t){function e(e){var r=t.call(this,e)||this;return r._shouldRenderChildren=!0,r._cache=void 0,r._renderer=void 0,r._renderedCamera=void 0,r}return we(e,t),e.prototype.invalidate=function(){this.state&=-3,this.modified()},e.prototype.renderSelf=function(t,r){var i=e.PADDING;if(this._renderedCamera!==r&&(this.state&=-3,this._renderedCamera=r),!(2&this.state)){this._cacheSize=this.calculateCacheSize();var n=Math.ceil(this._cacheSize.width)+2*i,o=Math.ceil(this._cacheSize.height)+2*i,s=!this._cache||this._cache.width<n||this._cache.height<o;s&&(this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=this.scene.game.resourceFactory.createSurface(n,o),this._renderer=this._cache.renderer());var a=this._renderer;a.begin(),s||a.clear(),a.save(),a.translate(i,i),this.renderCache(a,r),a.restore(),this.state|=2,a.end()}return this._cache&&this._cacheSize.width>0&&this._cacheSize.height>0&&(t.translate(-i,-i),this.renderSelfFromCache(t),t.translate(i,i)),this._shouldRenderChildren},e.prototype.renderSelfFromCache=function(t){t.drawImage(this._cache,0,0,this._cacheSize.width+e.PADDING,this._cacheSize.height+e.PADDING,0,0)},e.prototype.destroy=function(){this._cache&&!this._cache.destroyed()&&this._cache.destroy(),this._cache=void 0,t.prototype.destroy.call(this)},e.prototype.calculateCacheSize=function(){return{width:this.width,height:this.height}},e.PADDING=1,e}(Nt.E);Bt.CacheableE=Se;var xe={},be=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(xe,"__esModule",{value:!0}),xe.FilledRect=void 0;var Pe=Tt,Ee=function(t){function e(e){var r=t.call(this,e)||this;if("string"!=typeof e.cssColor)throw Pe.ExceptionFactory.createTypeMismatchError("ColorBox#constructor(cssColor)","string",e.cssColor);return r.cssColor=e.cssColor,r}return be(e,t),e.prototype.renderSelf=function(t){return t.fillRect(0,0,this.width,this.height,this.cssColor),!0},e}(Nt.E);xe.FilledRect=Ee;var Oe={},ke={},Me={};Object.defineProperty(Me,"__esModule",{value:!0}),Me.SurfaceUtil=void 0;var Le,Re=Tt;!function(t){function e(t,e,r,i,n){var o;void 0===n&&(n=4);for(var s=(o="number"==typeof n?{top:n,bottom:n,left:n,right:n}:n).left,a=i.width-o.right,h=o.top,u=i.height-o.bottom,c=o.left,l=e-o.right,d=o.top,p=r-o.bottom,f=[{x:0,y:0,width:o.left,height:o.top},{x:a,y:0,width:o.right,height:o.top},{x:0,y:u,width:o.left,height:o.bottom},{x:a,y:u,width:o.right,height:o.bottom}],_=[{x:0,y:0},{x:l,y:0},{x:0,y:p},{x:l,y:p}],y=0;y<f.length;++y){var g=f[y];t.save(),t.translate(_[y].x,_[y].y),t.drawImage(i,g.x,g.y,g.width,g.height,0,0),t.restore()}var v=[{x:s,y:0,width:a-s,height:o.top},{x:0,y:h,width:o.left,height:u-h},{x:a,y:h,width:o.right,height:u-h},{x:s,y:u,width:a-s,height:o.bottom}],m=[{x:c,y:0,width:l-c,height:o.top},{x:0,y:d,width:o.left,height:p-d},{x:l,y:d,width:o.right,height:p-d},{x:c,y:p,width:l-c,height:o.bottom}];for(y=0;y<v.length;++y){var T=v[y],A=m[y];t.save(),t.translate(A.x,A.y),t.transform([A.width/T.width,0,0,A.height/T.height,0,0]),t.drawImage(i,T.x,T.y,T.width,T.height,0,0),t.restore()}var w=a-s,S=u-h,x=l-c,b=p-d;t.save(),t.translate(c,d),t.transform([x/w,0,0,b/S,0,0]),t.drawImage(i,s,h,w,S,0,0),t.restore()}t.asSurface=function(t){if(t){if("type"in t&&"image"===t.type)return t.asSurface();if("_drawable"in t)return t;throw Re.ExceptionFactory.createTypeMismatchError("SurfaceUtil#asSurface","ImageAsset|Surface",t)}},t.setupAnimatingHandler=function(t,e){e.isPlaying()&&t._handleAnimationStart()},t.migrateAnimatingHandler=function(t,e,r){t._handleAnimationStop(),r.isPlaying()&&t._handleAnimationStart()},t.drawNinePatch=function(t,r,i){void 0===i&&(i=4);var n=t.renderer();n.begin(),n.clear(),e(n,t.width,t.height,r,i),n.end()},t.renderNinePatch=e}(Le||(Me.SurfaceUtil=Le={}));var Ce=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ke,"__esModule",{value:!0}),ke.Sprite=void 0;var Ie=re,Fe=Me,De=function(t){function e(e){var r=t.call(this,e)||this;return r.src=e.src,"_drawable"in e.src?r._surface=e.src:r._surface=Fe.SurfaceUtil.asSurface(e.src),null==e.width&&(r.width=r._surface.width),null==e.height&&(r.height=r._surface.height),r.srcWidth=null!=e.srcWidth?e.srcWidth:r.width,r.srcHeight=null!=e.srcHeight?e.srcHeight:r.height,r.srcX=e.srcX||0,r.srcY=e.srcY||0,r._stretchMatrix=void 0,r._beforeSrc=r.src,r._beforeSurface=r._surface,Fe.SurfaceUtil.setupAnimatingHandler(r,r._surface),r._invalidateSelf(),r}return Ce(e,t),e.prototype._handleUpdate=function(){this.modified()},e.prototype._handleAnimationStart=function(){this.onUpdate.contains(this._handleUpdate,this)||this.onUpdate.add(this._handleUpdate,this)},e.prototype._handleAnimationStop=function(){this.destroyed()||this.onUpdate.remove(this._handleUpdate,this)},e.prototype.renderSelf=function(t,e){return this.srcWidth<=0||this.srcHeight<=0||(this._stretchMatrix&&(t.save(),t.transform(this._stretchMatrix._matrix)),t.drawImage(this._surface,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0),this._stretchMatrix&&t.restore()),!0},e.prototype.invalidate=function(){this._invalidateSelf(),this.modified()},e.prototype.destroy=function(e){this._surface&&!this._surface.destroyed()&&e&&this._surface.destroy(),this.src=void 0,this._beforeSrc=void 0,this._surface=void 0,t.prototype.destroy.call(this)},e.prototype._invalidateSelf=function(){this.width===this.srcWidth&&this.height===this.srcHeight?this._stretchMatrix=void 0:(this._stretchMatrix=new Ie.PlainMatrix,this._stretchMatrix.scale(this.width/this.srcWidth,this.height/this.srcHeight)),this.src!==this._beforeSrc&&(this._beforeSrc=this.src,"_drawable"in this.src?this._surface=this.src:this._surface=Fe.SurfaceUtil.asSurface(this.src)),this._surface!==this._beforeSurface&&(Fe.SurfaceUtil.migrateAnimatingHandler(this,this._beforeSurface,this._surface),this._beforeSurface=this._surface)},e}(Nt.E);ke.Sprite=De;var je=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.FrameSprite=void 0;var Ge=b,Ue=function(t){function e(e){var r=t.call(this,e)||this;return r._lastUsedIndex=0,r.frameNumber=e.frameNumber||0,r.frames=null!=e.frames?e.frames:[0],r.interval=e.interval,r._timer=void 0,r.loop=null==e.loop||e.loop,r.onFinish=new Ge.Trigger,r.finished=r.onFinish,r._modifiedSelf(),r}return je(e,t),e.createBySprite=function(t,r,i){var n=new e({scene:t.scene,src:t.src,width:void 0===r?t.width:r,height:void 0===i?t.height:i});return n.srcHeight=void 0===i?t.srcHeight:i,n.srcWidth=void 0===r?t.srcWidth:r,n},e.prototype.start=function(){void 0===this.interval&&(this.interval=1e3/this.game().fps),this._timer&&this._free(),this._timer=this.scene.createTimer(this.interval),this._timer.onElapse.add(this._handleElapse,this)},e.prototype.destroy=function(e){this.stop(),t.prototype.destroy.call(this,e)},e.prototype.stop=function(){this._timer&&this._free()},e.prototype.modified=function(e){this._modifiedSelf(e),t.prototype.modified.call(this,e)},e.prototype._handleElapse=function(){this.frameNumber===this.frames.length-1?this.loop?this.frameNumber=0:(this.stop(),this.onFinish.fire()):this.frameNumber++,this.modified()},e.prototype._free=function(){this._timer&&(this._timer.onElapse.remove(this._handleElapse,this),this._timer.canDelete()&&this.scene.deleteTimer(this._timer),this._timer=void 0)},e.prototype._changeFrame=function(){var t=this.frames[this.frameNumber],e=Math.floor(this._surface.width/this.srcWidth);this.srcX=t%e*this.srcWidth,this.srcY=Math.floor(t/e)*this.srcHeight,this._lastUsedIndex=t},e.prototype._modifiedSelf=function(t){this._lastUsedIndex!==this.frames[this.frameNumber]&&this._changeFrame()},e}(ke.Sprite);Oe.FrameSprite=Ue;var He,Be={},Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.TextAlign=void 0,function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(He||(Ne.TextAlign=He={}));var We=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Be,"__esModule",{value:!0}),Be.Label=void 0;var Ve=Ne,Xe=he,ze=Bt,qe=function(t){function e(e){var r=t.call(this,e)||this;return r.text=e.text,r.font=e.font,r.textAlign=null!=e.textAlign?e.textAlign:Ve.TextAlign.Left,r.glyphs=new Array(e.text.length),r.fontSize=null!=e.fontSize?e.fontSize:e.font.size,r.maxWidth=e.maxWidth,r.widthAutoAdjust=null==e.widthAutoAdjust||e.widthAutoAdjust,r.textColor=e.textColor,r._realTextAlign="left",r._textWidth=0,r._overhangLeft=0,r._overhangRight=0,r._invalidateSelf(),r}return We(e,t),e.prototype.aligning=function(t,e){this.width=t,this.widthAutoAdjust=!1,this.textAlign=e},e.prototype.invalidate=function(){this._invalidateSelf(),t.prototype.invalidate.call(this)},e.prototype.renderSelfFromCache=function(t){var e;switch(this._realTextAlign){case"center":e=this.widthAutoAdjust?this._overhangLeft:0;break;case"right":e=this.widthAutoAdjust?this._overhangLeft:this._overhangRight;break;default:e=this._overhangLeft}t.drawImage(this._cache,0,0,this._cacheSize.width+ze.CacheableE.PADDING,this._cacheSize.height+ze.CacheableE.PADDING,e,0)},e.prototype.renderCache=function(t){if(!(!this.fontSize||this.height<=0||this._textWidth<=0)){var e=this.maxWidth&&this.maxWidth>0&&this.maxWidth<this._textWidth?this.maxWidth/this._textWidth:1,r=0;switch(this._realTextAlign){case"center":r=this.width/2-(this._textWidth+this._overhangLeft)/2*e;break;case"right":r=this.width-(this._textWidth+this._overhangLeft)*e;break;default:r-=this._overhangLeft*e}t.translate(Math.round(r),0),1!==e&&t.transform([e,0,0,1,0,0]),t.save();for(var i=this.fontSize/this.font.size,n=0,o=0;o<this.glyphs.length;++o){var s=this.glyphs[o],a=s.advanceWidth*i,h=s.code;s.isSurfaceValid||(s=this.font.glyphForCharacter(h))?(s.surface&&(t.save(),t.translate(Math.round(n),0),t.transform([i,0,0,i,0,0]),t.drawImage(s.surface,s.x,s.y,s.width,s.height,s.offsetX,s.offsetY),t.restore()),n+=a):this._outputOfWarnLogWithNoGlyph(h,"renderCache()")}t.restore(),t.save(),this.textColor&&(t.setCompositeOperation("source-atop"),t.fillRect(0,0,this._textWidth,this.height,this.textColor)),t.restore()}},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype._invalidateSelf=function(){this.glyphs.length=0,this._textWidth=0;var t=this.textAlign;if(this._realTextAlign="string"==typeof t?t:Xe.Util.enumToSnakeCase(Ve.TextAlign,t),this.fontSize){for(var e=this.text.length-1,r=this.text.length-1;r>=0;--r){if(o=Xe.Util.charCodeAt(this.text,r))if((s=this.font.glyphForCharacter(o))&&0!==s.width&&0!==s.advanceWidth){e=r;break}}var i=0,n=this.font.size>0?this.fontSize/this.font.size:0;for(r=0;r<=e;++r){var o,s;if(o=Xe.Util.charCodeAt(this.text,r))if(s=this.font.glyphForCharacter(o)){if(!(s.width<0||s.height<0||s.x<0||s.y<0)){this.glyphs.push(s);var a=0;0===r&&(this._overhangLeft=Math.min(s.offsetX,0),a=-this._overhangLeft),r===e&&(this._overhangRight=Math.max(s.width+s.offsetX-s.advanceWidth,0),a+=this._overhangRight),this._textWidth+=(s.advanceWidth+a)*n;var h=s.offsetY+s.height;i<h&&(i=h)}}else this._outputOfWarnLogWithNoGlyph(o,"_invalidateSelf()")}this.widthAutoAdjust&&(this.width=this._textWidth),this.height=i*n}else this.height=0},e.prototype._outputOfWarnLogWithNoGlyph=function(t,e){var r=4294901760&t?String.fromCharCode((4294901760&t)>>>16,65535&t):String.fromCharCode(t);console.warn("Label#"+e+": failed to get a glyph for '"+r+"' (BitmapFont might not have the glyph or DynamicFont might create a glyph larger than its atlas).")},e}(ze.CacheableE);Be.Label=qe;var Ye={},Ke=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Pane=void 0;var $e=Me,Je=function(t){function e(e){var r=t.call(this,e)||this;return r._oldWidth=e.width,r._oldHeight=e.height,r.backgroundImage=e.backgroundImage,r._beforeBackgroundImage=e.backgroundImage,r._backgroundImageSurface=$e.SurfaceUtil.asSurface(e.backgroundImage),r.backgroundEffector=e.backgroundEffector,r._shouldRenderChildren=!1,r._padding=e.padding||0,r._initialize(),r._paddingChanged=!1,r}return Ke(e,t),Object.defineProperty(e.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding=t,this._paddingChanged=!0},enumerable:!1,configurable:!0}),e.prototype.modified=function(e){e&&(this.state&=-3),t.prototype.modified.call(this)},e.prototype.shouldFindChildrenByPoint=function(t){var e=this._normalizedPadding;return e.left<t.x&&this.width-e.right>t.x&&e.top<t.y&&this.height-e.bottom>t.y},e.prototype.renderCache=function(t,e){this.width<=0||this.height<=0||(this._renderBackground(),this._renderChildren(e),this._bgSurface?t.drawImage(this._bgSurface,0,0,this.width,this.height,0,0):this._backgroundImageSurface&&t.drawImage(this._backgroundImageSurface,0,0,this.width,this.height,0,0),this._childrenArea.width<=0||this._childrenArea.height<=0||(t.save(),0===this._childrenArea.x&&0===this._childrenArea.y||t.translate(this._childrenArea.x,this._childrenArea.y),t.drawImage(this._childrenSurface,0,0,this._childrenArea.width,this._childrenArea.height,0,0),t.restore()))},e.prototype.destroy=function(e){e&&this._backgroundImageSurface&&!this._backgroundImageSurface.destroyed()&&this._backgroundImageSurface.destroy(),this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this.backgroundImage=void 0,this._backgroundImageSurface=void 0,this._beforeBackgroundImage=void 0,this._bgSurface=void 0,this._childrenSurface=void 0,t.prototype.destroy.call(this)},e.prototype._renderBackground=function(){if(this.backgroundImage!==this._beforeBackgroundImage&&(this._backgroundImageSurface=$e.SurfaceUtil.asSurface(this.backgroundImage),this._beforeBackgroundImage=this.backgroundImage),this._backgroundImageSurface&&this.backgroundEffector){var t=this.backgroundEffector.render(this._backgroundImageSurface,this.width,this.height);this._bgSurface!==t&&(this._bgSurface&&!this._bgSurface.destroyed()&&this._bgSurface.destroy(),this._bgSurface=t)}else this._bgSurface=void 0},e.prototype._renderChildren=function(t){var e=this._oldWidth!==this.width||this._oldHeight!==this.height||this._paddingChanged;if(e&&(this._initialize(),this._paddingChanged=!1,this._oldWidth=this.width,this._oldHeight=this.height),this._childrenRenderer.begin(),e||this._childrenRenderer.clear(),this.children)for(var r=this.children,i=0;i<r.length;++i)r[i].render(this._childrenRenderer,t);this._childrenRenderer.end()},e.prototype._initialize=function(){var t,e=this._padding;t="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e,this._childrenArea={x:t.left,y:t.top,width:this.width-t.left-t.right,height:this.height-t.top-t.bottom};var r=this.scene.game.resourceFactory;this._childrenSurface&&!this._childrenSurface.destroyed()&&this._childrenSurface.destroy(),this._childrenSurface=r.createSurface(Math.ceil(this._childrenArea.width),Math.ceil(this._childrenArea.height)),this._childrenRenderer=this._childrenSurface.renderer(),this._normalizedPadding=t},e.prototype._calculateBoundingRect=function(t){var e=this.getMatrix();if(t&&(e=t.multiplyNew(e)),this.visible()){for(var r={left:0,right:this.width,top:0,bottom:this.height},i=[{x:r.left,y:r.top},{x:r.left,y:r.bottom},{x:r.right,y:r.top},{x:r.right,y:r.bottom}],n=e.multiplyPoint(i[0]),o={left:n.x,right:n.x,top:n.y,bottom:n.y},s=1;s<i.length;++s)n=e.multiplyPoint(i[s]),o.left>n.x&&(o.left=n.x),o.right<n.x&&(o.right=n.x),o.top>n.y&&(o.top=n.y),o.bottom<n.y&&(o.bottom=n.y);return o}},e}(Bt.CacheableE);Ye.Pane=Je;var Ze={};Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.AssetAccessor=void 0;var Qe=function(){function t(t){this._assetManager=t}return t.prototype.getImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"image")},t.prototype.getAudio=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"audio")},t.prototype.getScript=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"script")},t.prototype.getText=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"text")},t.prototype.getTextContent=function(t){return this.getText(t).data},t.prototype.getJSONContent=function(t){return JSON.parse(this.getTextContent(t))},t.prototype.getVectorImage=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"vector-image")},t.prototype.getBinary=function(t){return this._assetManager.peekLiveAssetByAccessorPath(t,"binary")},t.prototype.getBinaryData=function(t){return this.getBinary(t).data},t.prototype.getAllImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","image")},t.prototype.getAllAudios=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","audio")},t.prototype.getAllScripts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","script")},t.prototype.getAllTexts=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","text")},t.prototype.getAllVectorImages=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","vector-image")},t.prototype.getAllBinaries=function(t){return this._assetManager.peekAllLiveAssetsByPattern(null!=t?t:"**/*","binary")},t.prototype.getImageById=function(t){return this._assetManager.peekLiveAssetById(t,"image")},t.prototype.getAudioById=function(t){return this._assetManager.peekLiveAssetById(t,"audio")},t.prototype.getScriptById=function(t){return this._assetManager.peekLiveAssetById(t,"script")},t.prototype.getTextById=function(t){return this._assetManager.peekLiveAssetById(t,"text")},t.prototype.getTextContentById=function(t){return this.getTextById(t).data},t.prototype.getJSONContentById=function(t){return JSON.parse(this.getTextById(t).data)},t.prototype.getVectorImageById=function(t){return this._assetManager.peekLiveAssetById(t,"vector-image")},t.prototype.getBinaryById=function(t){return this._assetManager.peekLiveAssetById(t,"binary")},t.prototype.getBinaryDataById=function(t){return this.getBinaryById(t).data},t}();Ze.AssetAccessor=Qe;var tr={};Object.defineProperty(tr,"__esModule",{value:!0});var er={};Object.defineProperty(er,"__esModule",{value:!0}),er.AssetHolder=void 0;var rr=Tt,ir=function(){function t(t){var e=t.assetManager,r=t.assetIds?t.assetIds.concat():[];r.push.apply(r,e.resolvePatternsToAssetIds(t.assetPaths||[])),this.waitingAssetsCount=r.length,this.userData=t.userData,this._assetManager=e,this._assetIds=r,this._assets=[],this._handlerSet=t.handlerSet,this._requested=!1,this._alwaysNotifyFinish=!!t.alwaysNotifyFinish,this._failureAssetIds=[]}return t.prototype.request=function(){return 0!==this.waitingAssetsCount&&(this._requested||(this._requested=!0,this._assetManager.requestAssets(this._assetIds,this)),!0)},t.prototype.destroy=function(){this._requested&&this._assetManager.unrefAssets(this._assets),this.waitingAssetsCount=0,this.userData=void 0,this._handlerSet=void 0,this._assetIds=void 0,this._failureAssetIds=void 0,this._requested=!1},t.prototype.destroyed=function(){return!this._handlerSet},t.prototype._onAssetError=function(t,e){var r=this._handlerSet;if(!this.destroyed()&&!r.owner.destroyed()){var i={asset:t,error:e,cancelRetry:!1};if(r.handleLoadFailure.call(r.owner,i),e.retriable&&!i.cancelRetry)this._assetManager.retryLoad(t);else if(this._assetManager.configuration[t.id])r.handleFinish.call(r.owner,this,!1);else if(this._alwaysNotifyFinish){var n=this._peekAssetConfFromAssetId(t.id);this._failureAssetIds.push(n),this._decrementWaitingAssetCount()}}},t.prototype._onAssetLoad=function(t){var e=this._handlerSet;this.destroyed()||e.owner.destroyed()||(e.handleLoad.call(e.owner,t),this._assets.push(t),this._decrementWaitingAssetCount())},t.prototype._decrementWaitingAssetCount=function(){if(--this.waitingAssetsCount,!(this.waitingAssetsCount>0)){if(this.waitingAssetsCount<0)throw rr.ExceptionFactory.createAssertionError("AssetHolder#_onAssetLoad: broken waitingAssetsCount");var t=this._handlerSet;t.handleFinish.call(t.owner,this,!0)}},t.prototype._getFailureAssetIds=function(){return this._failureAssetIds},t.prototype._peekAssetConfFromAssetId=function(t){for(var e=0,r=this._assetIds;e<r.length;e++){var i=r[e];if(t===("string"==typeof i?i:i.id))return i}throw rr.ExceptionFactory.createAssertionError("AssetHolder#_peekAssetConfFromAssetId: could not peek the asset: ".concat(t))},t}();er.AssetHolder=ir;var nr={};Object.defineProperty(nr,"__esModule",{value:!0});var or={},sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.EmptyBinaryAsset=void 0;var ar=b,hr=function(){function t(t,e){this.type="binary",this.onDestroyed=new ar.Trigger,this.id=t,this.path=e,this.originalPath=e,this.data=new ArrayBuffer(0)}return t.prototype.inUse=function(){return!1},t.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},t.prototype.destroyed=function(){return!this.onDestroyed},t.prototype._load=function(t){t._onAssetLoad(this)},t.prototype._assetPathFilter=function(t){return t},t}();sr.EmptyBinaryAsset=hr;var ur={},cr={};Object.defineProperty(cr,"__esModule",{value:!0}),cr.EmptyVectorImageAsset=void 0;var lr=b,dr=function(){function t(t,e,r,i,n){this.type="vector-image",this.width=0,this.height=0,this.onDestroyed=new lr.Trigger,this.id=t,this.path=e,this.originalPath=e,this.width=r,this.height=i,this.hint=n}return t.prototype.createSurface=function(t,e,r,i,n,o){return null},t.prototype.inUse=function(){return!1},t.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.destroy(),this.onDestroyed=void 0)},t.prototype.destroyed=function(){return!this.onDestroyed},t.prototype._load=function(t){t._onAssetLoad(this)},t.prototype._assetPathFilter=function(t){return t},t}();cr.EmptyVectorImageAsset=dr;var pr=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ur,"__esModule",{value:!0}),ur.EmptyGeneratedVectorImageAsset=void 0;var fr=function(t){function e(e,r,i){var n=t.call(this,e,r,0,0)||this;return n.data=i,n}return pr(e,t),e}(cr.EmptyVectorImageAsset);ur.EmptyGeneratedVectorImageAsset=fr;var _r={};Object.defineProperty(_r,"__esModule",{value:!0}),_r.PartialImageAsset=void 0;var yr=b,gr=function(){function t(t,e,r,i,n,o){this.type="image",this.hint=void 0,this.onDestroyed=new yr.Trigger,this._surface=null,this._loadHandler=null,this.id=e,this.path=r,this.originalPath=r,this.width=o.width,this.height=o.height,this._slice=o,this._resourceFactory=t;var s="".concat(e,"/<internal>");this._src=t.createImageAsset(s,r,i,n)}return t.prototype.initialize=function(t){this.hint=t,this._src.initialize(t)},t.prototype.inUse=function(){return!1},t.prototype.destroy=function(){this.destroyed()||(this.onDestroyed.fire(this),this._src.destroy(),this._src=null,this._slice=null,this._resourceFactory=null,this._surface=null,this._loadHandler=null,this.onDestroyed.destroy(),this.onDestroyed=void 0)},t.prototype.destroyed=function(){return!this._src},t.prototype.asSurface=function(){if(this._surface)return this._surface;var t=this._slice,e=t.x,r=t.y,i=t.width,n=t.height,o=this._resourceFactory.createSurface(i,n),s=o.renderer();return s.begin(),s.drawImage(this._src.asSurface(),e,r,i,n,0,0),s.end(),this._surface=o,o},t.prototype._load=function(t){this._loadHandler=t,this._src._load(this)},t.prototype._onAssetLoad=function(t){this._loadHandler._onAssetLoad(this)},t.prototype._onAssetError=function(t,e){this._loadHandler._onAssetError(this,e)},t.prototype._assetPathFilter=function(t){return t},t}();_r.PartialImageAsset=gr,Object.defineProperty(or,"__esModule",{value:!0}),or.AssetManager=void 0;var vr=sr,mr=ur,Tr=cr,Ar=_r,wr=Tt,Sr=Ut,xr=function(t,e){this.asset=t,this.handlers=[e],this.errorCount=0,this.loading=!1};function br(t){var e=/([^\*\\\?]*)(\\\*|\\\?|\?|\*(?!\*)|\*\*\/|$)/g,r={"":"","\\*":"\\*","\\?":"\\?","*":"[^/]*","?":"[^/]","**/":"(?:^/)?(?:[^/]+/)*"},i=/[\\^$.*+?()[\]{}|]/g;for(var n="",o=e.exec(t);o&&""!==o[0];o=e.exec(t))n+=o[1].replace(i,"\\$&")+r[o[2]];var s=new RegExp("^"+n+"$");return function(t){return s.test(t)}}var Pr=function(){function t(t,e,r,i){this._resourceFactory=t.resourceFactory,this._audioSystemManager=t.audio,this._defaultAudioSystemId=t.defaultAudioSystemId,this._audioSystemConfMap=function(t){void 0===t&&(t={});var e={music:{loop:!0,hint:{streaming:!0}},sound:{loop:!1,hint:{streaming:!1}}};for(var r in e)r in t||(t[r]=e[r]);return t}(r),this.configuration=this._normalize(e||{}),this._assets={},this._virtualPathToIdTable={},this._liveAssetVirtualPathTable={},this._liveAssetPathTable={},this._moduleMainScripts=i||{},this._refCounts={},this._loadings={},this._generatedAssetCount=0;for(var n=Object.keys(this.configuration),o=0;o<n.length;++o){var s=n[o],a=this.configuration[s];this._virtualPathToIdTable[a.virtualPath]=s}}return t.prototype.destroy=function(){for(var t=Object.keys(this._refCounts),e=0;e<t.length;++e)this._releaseAsset(t[e]);this.configuration=void 0,this._assets=void 0,this._liveAssetVirtualPathTable=void 0,this._liveAssetPathTable=void 0,this._refCounts=void 0,this._loadings=void 0},t.prototype.destroyed=function(){return void 0===this._assets},t.prototype.retryLoad=function(e){if(!this._loadings.hasOwnProperty(e.id))throw wr.ExceptionFactory.createAssertionError("AssetManager#retryLoad: invalid argument.");var r=this._loadings[e.id];if(r.errorCount>t.MAX_ERROR_COUNT){if(!this.configuration[e.id])return;throw wr.ExceptionFactory.createAssertionError("AssetManager#retryLoad: too many retrying.")}r.loading||(r.loading=!0,e._load(this))},t.prototype.globalAssetIds=function(){var t=[],e=this.configuration;for(var r in e)e.hasOwnProperty(r)&&e[r].global&&t.push(r);return t},t.prototype.preloadScriptAssetIds=function(){return Object.entries(this.configuration).filter((function(t){var e=t[1];return"script"===e.type&&e.global&&e.preload})).map((function(t){return t[0]}))},t.prototype.resolvePatternsToAssetIds=function(t){if(0===t.length)return[];for(var e=Object.keys(this._virtualPathToIdTable),r=[],i=0;i<t.length;++i)for(var n=t[i],o="string"==typeof n?br(this._replaceModulePathToAbsolute(n)):n,s=0;s<e.length;++s){var a=e[s];o("/"+a)&&r.push(this._virtualPathToIdTable[a])}return r},t.prototype.requestAsset=function(t,e){var r;"string"==typeof t?r=t:"uri"in t?(r=t.id,t=this._normalizeAssetBaseDeclaration(r,Object.create(t))):r=t.id;var i,n=!1;if(this._assets.hasOwnProperty(r))++this._refCounts[r],e._onAssetLoad(this._assets[r]);else if(this._loadings.hasOwnProperty(r))(i=this._loadings[r]).handlers.push(e),++this._refCounts[r],n=!0;else{var o=this._getAudioSystem(t),s=null==o?void 0:o.getDestroyRequestedAsset(r);if(o&&s)o.cancelRequestDestroy(s),this._addAssetToTables(s),this._refCounts[r]=1,e._onAssetLoad(s);else{var a=this._createAssetFor(t);i=new xr(a,e),this._loadings[r]=i,this._refCounts[r]=1,n=!0,i.loading=!0,a._load(this)}}return n},t.prototype.unrefAsset=function(t){var e="string"==typeof t?t:t.id;--this._refCounts[e]>0||this._releaseAsset(e)},t.prototype.requestAssets=function(t,e){for(var r=0,i=0,n=t.length;i<n;++i)this.requestAsset(t[i],e)&&++r;return r},t.prototype.unrefAssets=function(t){for(var e=0,r=t.length;e<r;++e)this.unrefAsset(t[e])},t.prototype.peekLiveAssetByAccessorPath=function(t,e){if("/"!==(t=this._replaceModulePathToAbsolute(t))[0])throw wr.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): accessorPath must start with '/'");var r=t.slice(1),i=this._liveAssetVirtualPathTable[r];if(!i||e!==i.type)throw wr.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetByAccessorPath(): No ".concat(e," asset for ").concat(t));return i},t.prototype.peekLiveAssetById=function(t,e){var r=this._assets[t];if(!r||e!==r.type)throw wr.ExceptionFactory.createAssertionError("AssetManager#peekLiveAssetById(): No ".concat(e," asset for id ").concat(t));return r},t.prototype.peekAllLiveAssetsByPattern=function(t,e){for(var r=Object.keys(this._liveAssetVirtualPathTable),i="string"==typeof t?br(this._replaceModulePathToAbsolute(t)):t,n=[],o=0;o<r.length;++o){var s=r[o],a=this._liveAssetVirtualPathTable[s];if(!e||a.type===e)i("/"+s)&&n.push(a)}return n},t.prototype._normalize=function(t){var e={};if(!(t instanceof Object))throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: invalid arguments.");for(var r in t)if(t.hasOwnProperty(r)){var i=this._normalizeAssetBaseDeclaration(r,Object.create(t[r]));if(!i.path)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: No path given for: "+r);if(!i.virtualPath)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: No virtualPath given for: "+r);i.global||(i.global=!1),e[r]=i}return e},t.prototype._normalizeAssetBaseDeclaration=function(t,e){if(!e.type)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: No type given for: "+t);if("image"===e.type){if("number"!=typeof e.width)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the image asset: "+t);if("number"!=typeof e.height)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the image asset: "+t);e.slice=e.slice?(r=e.slice,Array.isArray(r)?{x:r[0],y:r[1],width:r[2],height:r[3]}:r):void 0}var r;if("audio"===e.type){void 0===e.duration&&(e.duration=0);var i=this._audioSystemConfMap[e.systemId];if(void 0===e.loop&&(e.loop=!!i&&!!i.loop),void 0===e.hint&&(e.hint=i?i.hint:{}),"music"!==e.systemId&&"sound"!==e.systemId)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong systemId given for the audio asset: "+t)}if("video"===e.type&&!e.useRealSize){if("number"!=typeof e.width)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the video asset: "+t);if("number"!=typeof e.height)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the video asset: "+t);e.useRealSize=!1}if("vector-image"===e.type){if("number"!=typeof e.width)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong width given for the vector-image asset: "+t);if("number"!=typeof e.height)throw wr.ExceptionFactory.createAssertionError("AssetManager#_normalize: wrong height given for the vector-image asset: "+t)}return e},t.prototype._createAssetFor=function(t){var e,r,i,n;if("string"==typeof t)r=t,n=this.configuration[r],i=this.configuration[r].path;else{if(!("uri"in t))return this._createGeneratedAssetFor(t);r=t.id,n=t,i=t.uri}var o=this._resourceFactory;if(!n)throw wr.ExceptionFactory.createAssertionError("AssetManager#_createAssetFor: unknown asset ID: "+r);var s=n.type;switch(s){case"image":if(Array.isArray(n.slice))throw new Error("AssetManager#_createAssetFor: array type of configuration.slice is not yet supported");var a=n.slice?new Ar.PartialImageAsset(o,r,i,n.width,n.height,n.slice):o.createImageAsset(r,i,n.width,n.height);return a.initialize(n.hint),a;case"audio":var h=n.systemId?this._audioSystemManager[n.systemId]:this._audioSystemManager[this._defaultAudioSystemId];return o.createAudioAsset(r,i,n.duration,h,!!n.loop,null!==(e=n.hint)&&void 0!==e?e:{},n.offset);case"text":return o.createTextAsset(r,i);case"script":return o.createScriptAsset(r,i,n.exports);case"video":var u=new Sr.VideoSystem;return o.createVideoAsset(r,i,n.width,n.height,u,!!n.loop,!!n.useRealSize);case"vector-image":return o.createVectorImageAsset?o.createVectorImageAsset(r,i,n.width,n.height,n.hint):new Tr.EmptyVectorImageAsset(r,i,n.width,n.height,n.hint);case"binary":return o.createBinaryAsset?o.createBinaryAsset(r,i):new vr.EmptyBinaryAsset(r,i);default:throw wr.ExceptionFactory.createAssertionError("AssertionError#_createAssetFor: unknown asset type "+s+" for asset ID: "+r)}},t.prototype._createGeneratedAssetFor=function(t){var e=this._resourceFactory,r="%akashic%/generated-asset-".concat(this._generatedAssetCount++);if("vector-image"===t.type)return e.createVectorImageAssetFromString?e.createVectorImageAssetFromString(t.id,r,t.data):new mr.EmptyGeneratedVectorImageAsset(t.id,r,t.data);throw wr.ExceptionFactory.createAssertionError("AssertionError#_createFromAssetGenerationFor: unsupported asset type ".concat(t.type," for asset ID: ").concat(t.id))},t.prototype._releaseAsset=function(t){var e=this._assets[t]||this._loadings[t]&&this._loadings[t].asset,r=null;if(e)if(r=e.path,e.inUse())if("audio"===e.type)e._system.requestDestroy(e);else{if("video"!==e.type)throw wr.ExceptionFactory.createAssertionError("AssetManager#unrefAssets: Unsupported in-use "+e.id);e.destroy()}else e.destroy();if(delete this._refCounts[t],delete this._loadings[t],delete this._assets[t],this.configuration[t]){var i=this.configuration[t].virtualPath;i&&this._liveAssetVirtualPathTable.hasOwnProperty(i)&&delete this._liveAssetVirtualPathTable[i],r&&this._liveAssetPathTable.hasOwnProperty(r)&&delete this._liveAssetPathTable[r]}},t.prototype._countLoadingAsset=function(){return Object.keys(this._loadings).length},t.prototype._onAssetError=function(e,r){if(!this.destroyed()&&!e.destroyed()){var i=this._loadings[e.id],n=i.handlers;i.loading=!1,++i.errorCount,i.errorCount>t.MAX_ERROR_COUNT&&r.retriable&&(r=wr.ExceptionFactory.createAssetLoadError("Retry limit exceeded",!1,null,r)),r.retriable||delete this._loadings[e.id];for(var o=0;o<n.length;++o)n[o]._onAssetError(e,r,this.retryLoad.bind(this))}},t.prototype._onAssetLoad=function(t){if(!this.destroyed()&&!t.destroyed()){var e=this._loadings[t.id];e.loading=!1,delete this._loadings[t.id],this._addAssetToTables(t);for(var r=e.handlers,i=0;i<r.length;++i)r[i]._onAssetLoad(t)}},t.prototype._replaceModulePathToAbsolute=function(t){if("/"===t[0]||"*"===t[0])return t;for(var e in this._moduleMainScripts)if(this._moduleMainScripts.hasOwnProperty(e)&&0===t.lastIndexOf(e,0))return"/node_modules/"+t;return t},t.prototype._getAudioSystem=function(t){var e=null;if("string"==typeof t)e=this.configuration[t];else if("uri"in t){e=t}return e?"audio"!==e.type?null:e.systemId?this._audioSystemManager[e.systemId]:this._audioSystemManager[this._defaultAudioSystemId]:null},t.prototype._addAssetToTables=function(t){if(this._assets[t.id]=t,this.configuration[t.id]){var e=this.configuration[t.id].virtualPath;if(this._liveAssetVirtualPathTable.hasOwnProperty(e)){if(this._liveAssetVirtualPathTable[e].path!==t.path)throw wr.ExceptionFactory.createAssertionError("AssetManager#_onAssetLoad(): duplicated asset path")}else this._liveAssetVirtualPathTable[e]=t;this._liveAssetPathTable.hasOwnProperty(t.path)||(this._liveAssetPathTable[t.path]=e)}},t.MAX_ERROR_COUNT=3,t}();or.AssetManager=Pr;var Er={};Object.defineProperty(Er,"__esModule",{value:!0});var Or={};Object.defineProperty(Or,"__esModule",{value:!0}),Or.AudioSystemManager=void 0;var kr=_t,Mr=Tt,Lr=function(){function t(t){this._muted=!1,this._resourceFactory=t,this.music=new kr.MusicAudioSystem({id:"music",muted:this._muted,resourceFactory:t}),this.sound=new kr.SoundAudioSystem({id:"sound",muted:this._muted,resourceFactory:t})}return t.prototype.create=function(t){if("music"===t._system.id)return this.music.create(t);if("sound"===t._system.id)return this.sound.create(t);throw Mr.ExceptionFactory.createAssertionError('AudioSystemManager#create(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},t.prototype.play=function(t){if("music"===t._system.id)return this.music.play(t);if("sound"===t._system.id)return this.sound.play(t);throw Mr.ExceptionFactory.createAssertionError('AudioSystemManager#play(): unknown systemId "'.concat(t._system.id,'" for asset ID "').concat(t.id,'"'))},t.prototype._reset=function(){this._muted=!1,this.music._reset(),this.sound._reset()},t.prototype._setMuted=function(t){this._muted!==t&&(this._muted=t,this.music._setMuted(t),this.sound._setMuted(t))},t.prototype._setPlaybackRate=function(t){this.music._setPlaybackRate(t),this.sound._setPlaybackRate(t)},t.prototype._startSuppress=function(){this.music._startSuppress(),this.sound._startSuppress()},t.prototype._endSuppress=function(){this.music._endSuppress(),this.sound._endSuppress()},t.prototype.stopAll=function(){this.music.stopAll(),this.sound.stopAll()},t}();Or.AudioSystemManager=Lr;var Rr={};Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.AudioUtil=void 0;var Cr,Ir=he,Fr=function(t,e,r,i){return r*t/i+e};!function(t){function e(t,e,r,n,o){void 0===n&&(n=1),void 0===o&&(o=Fr),e.changeVolume(0),e.play();var s=i(t,e,r,n,o),a=s.complete,h=s.cancel;return{complete:function(){a()},cancel:function(t){void 0===t&&(t=!1),h(t),t&&e.stop()}}}function r(t,e,r,n){void 0===n&&(n=Fr);var o=i(t,e,r,0,n),s=o.complete,a=o.cancel;return{complete:function(){s(),e.stop()},cancel:function(t){void 0===t&&(t=!1),a(t)}}}function i(t,e,r,i,n){void 0===n&&(n=Fr);var o=1e3/t.fps,s=e.volume,a=0;e.changeVolume(Ir.Util.clamp(s,0,1));var h=function(){if((a+=o)<=r){var t=n(a,s,i-s,r);return e.changeVolume(Ir.Util.clamp(t,0,1)),!1}return e.changeVolume(i),!0},u=function(){t.onUpdate.contains(h)&&t.onUpdate.remove(h)};return t.onUpdate.add(h),{complete:function(){u(),e.changeVolume(i)},cancel:function(t){u(),t&&e.changeVolume(s)}}}t.fadeIn=e,t.fadeOut=r,t.crossFade=function(t,i,n,o,s,a){void 0===s&&(s=1),void 0===a&&(a=Fr);var h=e(t,i,o,s,a),u=r(t,n,o,a);return{complete:function(){h.complete(),u.complete()},cancel:function(t){void 0===t&&(t=!1),h.cancel(t),u.cancel(t)}}},t.transitionVolume=i}(Cr||(Rr.AudioUtil=Cr={}));var Dr={},jr={};Object.defineProperty(jr,"__esModule",{value:!0}),jr.Font=void 0;var Gr=he,Ur=function(){function t(){}return t.prototype.measureText=function(t){for(var e=0,r=0,i=0,n=null,o=0;o<t.length;o++){var s=Gr.Util.charCodeAt(t,o);if(s){var a=this.glyphForCharacter(s);!a||a.x<0||a.y<0||a.width<0||a.height<0||(0===o&&(r=-a.offsetX),n=a,e+=a.advanceWidth)}}return n&&(i=e+n.offsetX+n.width-n.advanceWidth),{width:e,actualBoundingBoxLeft:r,actualBoundingBoxRight:i}},t}();jr.Font=Ur;var Hr=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.BitmapFont=void 0;var Br=Me,Nr=function(t){function e(e){var r=t.call(this)||this;return r.surface=Br.SurfaceUtil.asSurface(e.src),e.glyphInfo?(r.map=e.glyphInfo.map,r.defaultGlyphWidth=e.glyphInfo.width,r.defaultGlyphHeight=e.glyphInfo.height,r.missingGlyph=e.glyphInfo.missingGlyph,r.size=e.glyphInfo.height):(r.map=e.map||{},r.defaultGlyphWidth=e.defaultGlyphWidth||0,r.defaultGlyphHeight=e.defaultGlyphHeight||0,r.missingGlyph=e.missingGlyph,r.size=e.defaultGlyphHeight||0),r}return Hr(e,t),e.prototype.glyphForCharacter=function(t){var e=this.map[t]||this.missingGlyph;if(!e)return null;var r=void 0===e.width?this.defaultGlyphWidth:e.width,i=void 0===e.height?this.defaultGlyphHeight:e.height,n=e.offsetX||0,o=e.offsetY||0,s=void 0===e.advanceWidth?r:e.advanceWidth,a=0===r||0===i?void 0:this.surface;return{code:t,x:e.x,y:e.y,width:r,height:i,surface:a,offsetX:n,offsetY:o,advanceWidth:s,isSurfaceValid:!0,_atlas:null}},e.prototype.destroy=function(){this.surface&&!this.surface.destroyed()&&this.surface.destroy(),this.map=void 0},e.prototype.destroyed=function(){return!this.map},e}(jr.Font);Dr.BitmapFont=Nr;var Wr={};Object.defineProperty(Wr,"__esModule",{value:!0});var Vr={},Xr=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.Camera2D=void 0;var zr=function(t){function e(e){var r=t.call(this,e)||this;return r.local=!!e.local,r.name=e.name,r._modifiedCount=0,r}return Xr(e,t),e.deserialize=function(t){return new e(t.param)},e.prototype.modified=function(){this._modifiedCount=(this._modifiedCount+1)%32768,this._matrix&&(this._matrix._modified=!0)},e.prototype.serialize=function(){return{param:{local:this.local,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,opacity:this.opacity,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle,anchorX:this.anchorX,anchorY:this.anchorY,compositeOperation:this.compositeOperation}}},e.prototype._applyTransformToRenderer=function(t){this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?t.transform(this.getMatrix()._matrix):t.translate(-this.x,-this.y),1!==this.opacity&&t.opacity(this.opacity)},e.prototype._updateMatrix=function(){this._matrix&&(this.angle||1!==this.scaleX||1!==this.scaleY||0!==this.anchorX||0!==this.anchorY?this._matrix.updateByInverse(this.width,this.height,this.scaleX,this.scaleY,this.angle,this.x,this.y,this.anchorX,this.anchorY):this._matrix.reset(-this.x,-this.y))},e}(ne.Object2D);Vr.Camera2D=zr;var qr={};Object.defineProperty(qr,"__esModule",{value:!0}),qr.Collision=void 0;var Yr,Kr=he;function $r(t,e){return t.x*e.y-t.y*e.x}function Jr(t,e){return{x:t.x-e.x,y:t.y-e.y}}!function(t){t.intersectEntities=function(e,r,i,n){var o=e._findLowestCommonAncestorWith(r);if(!o)return!1;var s=i?{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height}:{left:0,top:0,right:e.width,bottom:e.height},a=n?{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height}:{left:0,top:0,right:r.width,bottom:r.height},h=e._calculateMatrixTo(o),u=r._calculateMatrixTo(o),c=h.multiplyPoint({x:s.left,y:s.top}),l=h.multiplyPoint({x:s.right,y:s.top}),d=h.multiplyPoint({x:s.left,y:s.bottom}),p=h.multiplyPoint({x:s.right,y:s.bottom}),f=u.multiplyPoint({x:a.left,y:a.top}),_=u.multiplyPoint({x:a.right,y:a.top}),y=u.multiplyPoint({x:a.left,y:a.bottom}),g=u.multiplyPoint({x:a.right,y:a.bottom}),v=Math.min(c.x,l.x,d.x,p.x),m=Math.max(c.x,l.x,d.x,p.x),T=Math.min(f.x,_.x,y.x,g.x),A=Math.max(f.x,_.x,y.x,g.x);if(m<T||A<v)return!1;var w=Math.min(c.y,l.y,d.y,p.y),S=Math.max(c.y,l.y,d.y,p.y),x=Math.min(f.y,_.y,y.y,g.y),b=Math.max(f.y,_.y,y.y,g.y);if(S<x||b<w)return!1;if(t.intersectLineSegments(c,l,f,_)||t.intersectLineSegments(c,l,_,g)||t.intersectLineSegments(c,l,g,y)||t.intersectLineSegments(c,l,y,f)||t.intersectLineSegments(l,p,f,_)||t.intersectLineSegments(l,p,_,g)||t.intersectLineSegments(l,p,g,y)||t.intersectLineSegments(l,p,y,f)||t.intersectLineSegments(p,d,f,_)||t.intersectLineSegments(p,d,_,g)||t.intersectLineSegments(p,d,g,y)||t.intersectLineSegments(p,d,y,f)||t.intersectLineSegments(d,c,f,_)||t.intersectLineSegments(d,c,_,g)||t.intersectLineSegments(d,c,g,y)||t.intersectLineSegments(d,c,y,f))return!0;var P=$r(Jr(c,l),Jr(f,l));if(P*$r(Jr(d,c),Jr(f,c))>=0&&P*$r(Jr(p,d),Jr(f,d))>=0&&P*$r(Jr(l,p),Jr(f,p))>=0)return!0;var E=$r(Jr(f,_),Jr(c,_));return E*$r(Jr(y,f),Jr(c,f))>=0&&E*$r(Jr(g,y),Jr(c,y))>=0&&E*$r(Jr(_,g),Jr(c,g))>=0},t.intersectLineSegments=function(t,e,r,i){var n=Jr(e,t),o=Jr(i,r);return $r(Jr(r,t),n)*$r(Jr(i,t),n)<=0&&$r(Jr(t,r),o)*$r(Jr(e,r),o)<=0},t.intersect=function(t,e,r,i,n,o,s,a){return t<=n+s&&n<=t+r&&e<=o+a&&o<=e+i},t.intersectAreas=function(e,r){return t.intersect(e.x,e.y,e.width,e.height,r.x,r.y,r.width,r.height)},t.within=function(t,e,r,i,n){return void 0===n&&(n=1),n>=Kr.Util.distance(t,e,r,i)},t.withinAreas=function(t,e,r){return void 0===r&&(r=1),r>=Kr.Util.distanceBetweenAreas(t,e)}}(Yr||(qr.Collision=Yr={}));var Zr={},Qr={},ti=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Qr,"__esModule",{value:!0}),Qr.CameraCancellingE=void 0;var ei=Vr,ri=ne,ii=function(t){function e(e){var r=t.call(this,e)||this;return r._canceller=new ri.Object2D,r}return ti(e,t),e.prototype.renderSelf=function(t,e){if(!this.children)return!1;if(e&&e instanceof ei.Camera2D){var r=e,i=this._canceller;r.x===i.x&&r.y===i.y&&r.angle===i.angle&&r.scaleX===i.scaleX&&r.scaleY===i.scaleY||(i.x=r.x,i.y=r.y,i.angle=r.angle,i.scaleX=r.scaleX,i.scaleY=r.scaleY,i._matrix&&(i._matrix._modified=!0)),t.save(),t.transform(i.getMatrix()._matrix)}for(var n=this.children,o=0;o<n.length;++o)n[o].render(t,e);return e&&t.restore(),!1},e}(Nt.E);Qr.CameraCancellingE=ii;var ni={},oi={},si={},ai={};Object.defineProperty(ai,"__esModule",{value:!0}),ai.Timer=void 0;var hi=b,ui=function(){function t(t,e){this.interval=t,this._scaledInterval=Math.round(t*e),this.onElapse=new hi.Trigger,this.elapsed=this.onElapse,this._scaledElapsed=0}return t.prototype.tick=function(){for(this._scaledElapsed+=1e3;this._scaledElapsed>=this._scaledInterval&&this.onElapse;)this.onElapse.fire(),this._scaledElapsed-=this._scaledInterval},t.prototype.canDelete=function(){return!this.onElapse||0===this.onElapse.length},t.prototype.destroy=function(){this.interval=void 0,this.onElapse.destroy(),this.onElapse=void 0,this.elapsed=void 0,this._scaledInterval=0,this._scaledElapsed=0},t.prototype.destroyed=function(){return void 0===this.onElapse},t}();ai.Timer=ui,Object.defineProperty(si,"__esModule",{value:!0}),si.TimerManager=si.TimerIdentifier=void 0;var ci=Tt,li=ai,di=function(){function t(t,e,r,i,n){this._timer=t,this._handler=e,this._handlerOwner=r,this._fired=i,this._firedOwner=n,this._timer.onElapse.add(this._handleElapse,this)}return t.prototype.destroy=function(){this._timer.onElapse.remove(this._handleElapse,this),this._timer=void 0,this._handler=void 0,this._handlerOwner=void 0,this._fired=void 0,this._firedOwner=void 0},t.prototype.destroyed=function(){return void 0===this._timer},t.prototype._handleElapse=function(){this.destroyed()||(this._handler.call(this._handlerOwner),this._fired&&this._fired.call(this._firedOwner,this))},t}();si.TimerIdentifier=di;var pi=function(){function t(t,e){this._timers=[],this._trigger=t,this._identifiers=[],this._fps=e,this._registered=!1}return t.prototype.destroy=function(){for(var t=0;t<this._identifiers.length;++t)this._identifiers[t].destroy();for(t=0;t<this._timers.length;++t)this._timers[t].destroy();this._timers=void 0,this._trigger=void 0,this._identifiers=void 0,this._fps=void 0},t.prototype.destroyed=function(){return void 0===this._timers},t.prototype.createTimer=function(t){if(this._registered||(this._trigger.add(this._tick,this),this._registered=!0),t<0)throw ci.ExceptionFactory.createAssertionError("TimerManager#createTimer: invalid interval");t<1&&(t=1);for(var e=Math.min(1e3,t*this._fps),r=0;r<this._timers.length;++r)if(this._timers[r].interval===t&&this._timers[r]._scaledElapsed<e)return this._timers[r];var i=new li.Timer(t,this._fps);return this._timers.push(i),i},t.prototype.deleteTimer=function(t){if(t.canDelete()){var e=this._timers.indexOf(t);if(e<0)throw ci.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: can not find timer");if(this._timers.splice(e,1),t.destroy(),!this._timers.length){if(!this._registered)throw ci.ExceptionFactory.createAssertionError("TimerManager#deleteTimer: handler is not handled");this._trigger.remove(this._tick,this),this._registered=!1}}},t.prototype.setTimeout=function(t,e,r){var i=this.createTimer(e),n=new di(i,t,r,this._onTimeoutFired,this);return this._identifiers.push(n),n},t.prototype.clearTimeout=function(t){this._clear(t)},t.prototype.setInterval=function(t,e,r){var i=this.createTimer(e),n=new di(i,t,r);return this._identifiers.push(n),n},t.prototype.clearInterval=function(t){this._clear(t)},t.prototype._tick=function(){for(var t=this._timers.concat(),e=0;e<t.length;++e)t[e].tick()},t.prototype._onTimeoutFired=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw ci.ExceptionFactory.createAssertionError("TimerManager#_onTimeoutFired: can not find identifier");this._identifiers.splice(e,1);var r=t._timer;t.destroy(),this.deleteTimer(r)},t.prototype._clear=function(t){var e=this._identifiers.indexOf(t);if(e<0)throw ci.ExceptionFactory.createAssertionError("TimerManager#_clear: can not find identifier");if(t.destroyed())throw ci.ExceptionFactory.createAssertionError("TimerManager#_clear: invalid identifier");this._identifiers.splice(e,1);var r=t._timer;t.destroy(),this.deleteTimer(r)},t}();si.TimerManager=pi,Object.defineProperty(oi,"__esModule",{value:!0}),oi.Scene=void 0;var fi=b,_i=Ze,yi=er,gi=Vr,vi=Tt,mi=si,Ti=function(){function t(t){var e=t.game,r=void 0===t.local||!1===t.local?"non-local":!0===t.local?"full-local":t.local,i=void 0!==t.tickGenerationMode?t.tickGenerationMode:"by-clock";this.name=t.name,this.game=e,this.local=r,this.tickGenerationMode=i,this.onLoad=new fi.Trigger,this.loaded=this.onLoad,this._onReady=new fi.Trigger,this._ready=this._onReady,this.assets={},this.asset=new _i.AssetAccessor(e._assetManager),this.vars={},this._loaded=!1,this._prefetchRequested=!1,this._loadingState="initial",this.onUpdate=new fi.Trigger,this.update=this.onUpdate,this._timer=new mi.TimerManager(this.onUpdate,this.game.fps),this.onAssetLoad=new fi.Trigger,this.onAssetLoadFailure=new fi.Trigger,this.onAssetLoadComplete=new fi.Trigger,this.assetLoaded=this.onAssetLoad,this.assetLoadFailed=this.onAssetLoadFailure,this.assetLoadCompleted=this.onAssetLoadComplete,this.onMessage=new fi.Trigger,this.onPointDownCapture=new fi.Trigger,this.onPointMoveCapture=new fi.Trigger,this.onPointUpCapture=new fi.Trigger,this.onOperation=new fi.Trigger,this.message=this.onMessage,this.pointDownCapture=this.onPointDownCapture,this.pointMoveCapture=this.onPointMoveCapture,this.pointUpCapture=this.onPointUpCapture,this.operation=this.onOperation,this.children=[],this.state="standby",this.onStateChange=new fi.Trigger,this._assetHolders=[],this._sceneAssetHolder=new yi.AssetHolder({assetManager:this.game._assetManager,assetIds:t.assetIds,assetPaths:t.assetPaths,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:null}),this.seethrough=null!=t.seethrough&&t.seethrough}return t.prototype.modified=function(t){this.game.modified()},t.prototype.destroy=function(){this.state="before-destroyed",this.onStateChange.fire(this.state);for(var t=0,e=[this.game.db,this.game._localDb];t<e.length;t++)for(var r=e[t],i=0,n=r.keys();i<n.length;i++){var o=n[i],s=r.get(o);(null==s?void 0:s.scene)===this&&s.destroy()}this._timer.destroy(),this.onUpdate.destroy(),this.onMessage.destroy(),this.onPointDownCapture.destroy(),this.onPointMoveCapture.destroy(),this.onPointUpCapture.destroy(),this.onOperation.destroy(),this.onLoad.destroy(),this.onAssetLoad.destroy(),this.onAssetLoadFailure.destroy(),this.onAssetLoadComplete.destroy(),this.assets={},this.vars={};for(var a=0;a<this._assetHolders.length;++a)this._assetHolders[a].destroy();this._sceneAssetHolder.destroy(),this.game=void 0,this._waitingPrepare=void 0,this.state="destroyed",this.onStateChange.fire(this.state),this.onStateChange.destroy()},t.prototype.destroyed=function(){return void 0===this.game},t.prototype.createTimer=function(t){return this._timer.createTimer(t)},t.prototype.deleteTimer=function(t){this._timer.deleteTimer(t)},t.prototype.setInterval=function(t,e,r){return this._timer.setInterval(t,e,r)},t.prototype.clearInterval=function(t){this._timer.clearInterval(t)},t.prototype.setTimeout=function(t,e,r){return this._timer.setTimeout(t,e,r)},t.prototype.clearTimeout=function(t){this._timer.clearTimeout(t)},t.prototype.isCurrentScene=function(){return this.game.scene()===this},t.prototype.gotoScene=function(t,e){if(!this.isCurrentScene())throw vi.ExceptionFactory.createAssertionError("Scene#gotoScene: this scene is not the current scene");e?this.game.pushScene(t):this.game.replaceScene(t)},t.prototype.end=function(){if(!this.isCurrentScene())throw vi.ExceptionFactory.createAssertionError("Scene#end: this scene is not the current scene");this.game.popScene()},t.prototype.register=function(t){this.game.register(t),t.scene=this},t.prototype.unregister=function(t){t.scene=void 0,this.game.unregister(t)},t.prototype.append=function(t){this.insertBefore(t,void 0)},t.prototype.insertBefore=function(t,e){t.parent&&t.remove(),t.parent=this;var r=-1;void 0!==e&&(r=this.children.indexOf(e))>-1?this.children.splice(r,0,t):this.children.push(t),this.modified(!0)},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&(this.children[e].parent=void 0,this.children.splice(e,1),this.modified(!0))},t.prototype.findPointSourceByPoint=function(t,e,r){for(var i="non-local"!==this.local,n=this.children,o=r&&r instanceof gi.Camera2D?r.getMatrix():void 0,s=n.length-1;s>=0;--s){var a=n[s].findPointSourceByPoint(t,o,e);if(a)return a.local=a.target&&a.target.local||i,a}return{target:void 0,point:void 0,local:i}},t.prototype.prefetch=function(){this._loaded||this._prefetchRequested||(this._prefetchRequested=!0,this._sceneAssetHolder.request())},t.prototype.requestAssets=function(t,e){var r,i,n=this;if("ready-fired"!==this._loadingState&&"loaded-fired"!==this._loadingState)throw vi.ExceptionFactory.createAssertionError("Scene#requestAssets(): can be called after loaded.");Array.isArray(t)?(r=t,i=!1):(r=t.assetIds,i=!!t.notifyErrorOnCallback);var o=new yi.AssetHolder({assetManager:this.game._assetManager,assetIds:r,alwaysNotifyFinish:i,handlerSet:{owner:this,handleLoad:this._handleSceneAssetLoad,handleLoadFailure:this._handleSceneAssetLoadFailure,handleFinish:this._handleSceneAssetLoadFinish},userData:function(){if(!n.destroyed()){var t=o._getFailureAssetIds();if(t.length){var r=vi.ExceptionFactory.createRequestAssetLoadError("Scene#requestAssets(): failed to load the asset. refer to the 'detail' property for more information.",{failureAssetIds:t});e(r)}else e()}}});this._assetHolders.push(o),o.request()},t.prototype._activate=function(){this.state="active",this.onStateChange.fire(this.state)},t.prototype._deactivate=function(){this.state="deactive",this.onStateChange.fire(this.state)},t.prototype._needsLoading=function(){return this._sceneAssetHolder.waitingAssetsCount>0||!!this._waitingPrepare},t.prototype._load=function(){this._loaded||(this._loaded=!0,this._sceneAssetHolder.request()||this._notifySceneReady())},t.prototype._handleSceneAssetLoad=function(t){this.assets[t.id]=t,this.onAssetLoad.fire(t),this.onAssetLoadComplete.fire(t)},t.prototype._handleSceneAssetLoadFailure=function(t){this.onAssetLoadFailure.fire(t),this.onAssetLoadComplete.fire(t.asset)},t.prototype._handleSceneAssetLoadFinish=function(t,e){e?t.userData?this.game._pushPostTickTask(t.userData,null):this._loaded&&this._notifySceneReady():this.game.terminateGame()},t.prototype._notifySceneReady=function(){this._loadingState="ready",this.game._pushPostTickTask(this._fireReady,this)},t.prototype._fireReady=function(){this.destroyed()||(this._onReady.fire(this),this._loadingState="ready-fired")},t.prototype._fireLoaded=function(){this.destroyed()||"loaded-fired"!==this._loadingState&&(this.onLoad.fire(this),this._loadingState="loaded-fired")},t}();oi.Scene=Ti;var Ai=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ni,"__esModule",{value:!0}),ni.LoadingScene=void 0;var wi=b,Si=Tt,xi=function(t){function e(e){var r=this;return e.local=!0,(r=t.call(this,e)||this).onTargetReset=new wi.Trigger,r.onTargetReady=new wi.Trigger,r.onTargetAssetLoad=new wi.Trigger,r.targetReset=r.onTargetReset,r.targetReady=r.onTargetReady,r.targetAssetLoaded=r.onTargetAssetLoad,r._explicitEnd=!!e.explicitEnd,r._targetScene=void 0,r}return Ai(e,t),e.prototype.destroy=function(){this._clearTargetScene(),t.prototype.destroy.call(this)},e.prototype.reset=function(t){this._clearTargetScene(),this._targetScene=t,"loaded-fired"!==this._loadingState?this.onLoad.addOnce(this._doReset,this):this._doReset()},e.prototype.getTargetWaitingAssetsCount=function(){return this._targetScene?this._targetScene._sceneAssetHolder.waitingAssetsCount:0},e.prototype.end=function(){if(!this._targetScene||"initial"===this._targetScene._loadingState){var t="LoadingScene#end(): the target scene is in invalid state: "+(this._targetScene?this._targetScene._loadingState:"(no scene)");throw Si.ExceptionFactory.createAssertionError(t)}this.game._popSceneRaw(!0),this.game._pushPostTickTask(this._targetScene._fireLoaded,this._targetScene),this._clearTargetScene()},e.prototype._clearTargetScene=function(){this._targetScene&&(this.onLoad.removeAll({owner:this,func:this._doReset}),this._targetScene._onReady.removeAll({owner:this}),this._targetScene.onAssetLoad.removeAll({owner:this}),this._targetScene=void 0)},e.prototype._doReset=function(){this.onTargetReset.fire(this._targetScene),"initial"===this._targetScene._loadingState||"ready"===this._targetScene._loadingState?(this._targetScene._onReady.add(this._handleReady,this),this._targetScene.onAssetLoad.add(this._handleAssetLoad,this),this._targetScene._load()):this._handleReady(this._targetScene)},e.prototype._handleAssetLoad=function(t){this.onTargetAssetLoad.fire(t)},e.prototype._handleReady=function(t){this.onTargetReady.fire(t),this._explicitEnd||this.end()},e}(oi.Scene);ni.LoadingScene=xi;var bi=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.DefaultLoadingScene=void 0;var Pi=Qr,Ei=xe,Oi=function(t){function e(e){var r=t.call(this,{game:e.game,name:"akashic:default-loading-scene"})||this;return"compact"===e.style?(r._barWidth=r.game.width/4,r._barHeight=5,r._style="compact"):(r._barWidth=Math.min(r.game.width,Math.max(100,r.game.width/2)),r._barHeight=5,r._style="default"),r._gauge=void 0,r._gaugeUpdateCount=0,r._totalWaitingAssetCount=0,r.onLoad.add(r._handleLoad,r),r.onTargetReset.add(r._handleTargetReset,r),r.onTargetAssetLoad.add(r._handleTargetAssetLoad,r),r}return bi(e,t),e.prototype._handleLoad=function(){var t,e,r,i;if("compact"===this._style){var n=.05*Math.min(this.game.width,this.game.height);t=this.game.width-n-this._barWidth,e=this.game.height-n-this._barHeight,r="transparent"}else t=(this.game.width-this._barWidth)/2,e=(this.game.height-this._barHeight)/2,r="rgba(0, 0, 0, 0.8)";return this.append(new Pi.CameraCancellingE({scene:this,children:[new Ei.FilledRect({scene:this,width:this.game.width,height:this.game.height,cssColor:r,children:[new Ei.FilledRect({scene:this,x:t,y:e,width:this._barWidth,height:this._barHeight,cssColor:"gray",children:[i=new Ei.FilledRect({scene:this,width:0,height:this._barHeight,cssColor:"white"})]})]})]})),i.onUpdate.add(this._handleUpdate,this),this._gauge=i,!0},e.prototype._handleUpdate=function(){++this._gaugeUpdateCount;var t=Math.round(205+50*Math.sin(this._gaugeUpdateCount/this.game.fps*(2/3)*(2*Math.PI)));this._gauge.cssColor="rgb("+t+","+t+","+t+")",this._gauge.modified()},e.prototype._handleTargetReset=function(t){this._gauge&&(this._gauge.width=0,this._gauge.modified()),this._totalWaitingAssetCount=t._sceneAssetHolder.waitingAssetsCount},e.prototype._handleTargetAssetLoad=function(t){var e=this._targetScene._sceneAssetHolder.waitingAssetsCount;this._gauge.width=Math.ceil((1-e/this._totalWaitingAssetCount)*this._barWidth),this._gauge.modified()},e}(ni.LoadingScene);Zr.DefaultLoadingScene=Oi;var ki={},Mi=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ki,"__esModule",{value:!0}),ki.DefaultSkippingScene=void 0;var Li=Qr,Ri=oi;function Ci(t,e,r,i){var n=.15*i;return 0<t&&t<n?function(t,e,r,i){return(t/=i/2)<1?r/2*t*t+e:-r/2*(--t*(t-2)-1)+e}(t,e,r,n):e+r}var Ii=function(t){function e(e){var r=t.call(this,e)||this;return r.age=0,r.offsetDurationFrame=e.offsetDurationFrame,r.easingDurationFrame=e.easingDurationFrame,r.valueFrom=e.valueFrom,r.valueTo=e.valueTo,r.easing=e.easing,r.onUpdate.add(r._incrementAge,r),r.onUpdate.add(r._updateColor,r),r}return Mi(e,t),e.prototype._incrementAge=function(){this.age++},e.prototype._updateColor=function(){var t=this._calculateCSSColor();this.cssColor!==t&&(this.cssColor=t,this.modified())},e.prototype._calculateCSSColor=function(){var t=this,e=t.age,r=t.offsetDurationFrame,i=t.easingDurationFrame,n=t.valueFrom,o=t.valueTo,s=(0,t.easing)(Math.max(e-r,0)%i,n,o-n,i);return"rgb(".concat(s,", ").concat(s,", ").concat(s,")")},e}(xe.FilledRect),Fi=function(t){function e(e){var r=t.call(this,{game:e.game,local:"full-local",name:"akashic:default-skipping-scene"})||this;return"indicator"===e.style&&r.onLoad.addOnce(r._handleLoadForIndicator,r),r}return Mi(e,t),e.prototype._handleLoadForIndicator=function(){var t=this,e=this.game,r=.03*Math.min(e.width,e.height)|0,i=.03*Math.min(e.width,e.height)|0,n=.05*Math.min(e.width,e.height)|0,o=.05*Math.min(e.width,e.height)|0,s=400/(1e3/e.fps),a=2500/(1e3/e.fps),h=255,u=Ci;this.append(new Li.CameraCancellingE({scene:this,children:[3,2,1,0].map((function(c,l){return new Ii({scene:t,cssColor:"rgb(".concat(h,", ").concat(h,", ").concat(h,")"),width:r,height:r,x:e.width-l*(r+i)-n,y:e.height-o,anchorX:1,anchorY:1,offsetDurationFrame:s*c,easingDurationFrame:a,valueFrom:205,valueTo:h,easing:u})}))}))},e}(Ri.Scene);ki.DefaultSkippingScene=Fi;var Di={};Object.defineProperty(Di,"__esModule",{value:!0});var ji={},Gi={},Ui={},Hi={};Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.SurfaceAtlasSlot=void 0;var Bi=function(t,e,r,i){this.x=t,this.y=e,this.width=r,this.height=i,this.prev=null,this.next=null};Hi.SurfaceAtlasSlot=Bi,Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.SurfaceAtlas=void 0;var Ni=Hi;var Wi=function(){function t(t){this._surface=t,this._emptySurfaceAtlasSlotHead=new Ni.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize={width:0,height:0}}return t.prototype.reset=function(){var t=this._surface.renderer();t.begin(),t.clear(),t.end(),this._emptySurfaceAtlasSlotHead=new Ni.SurfaceAtlasSlot(0,0,this._surface.width,this._surface.height),this._accessScore=0,this._usedRectangleAreaSize.width=0,this._usedRectangleAreaSize.height=0},t.prototype._acquireSurfaceAtlasSlot=function(t,e){t+=1,e+=1;var r=function(t,e,r){for(;t;){if(t.width>=e&&t.height>=r)return t;t=t.next}return null}(this._emptySurfaceAtlasSlotHead,t,e);if(!r)return null;var i,n,o=r.width-t,s=r.height-e;o<=s?(i=new Ni.SurfaceAtlasSlot(r.x+t,r.y,o,e),n=new Ni.SurfaceAtlasSlot(r.x,r.y+e,r.width,s)):(i=new Ni.SurfaceAtlasSlot(r.x,r.y+e,t,s),n=new Ni.SurfaceAtlasSlot(r.x+t,r.y,o,r.height)),i.prev=r.prev,i.next=n,null===i.prev?this._emptySurfaceAtlasSlotHead=i:i.prev.next=i,n.prev=i,n.next=r.next,n.next&&(n.next.prev=n);var a=new Ni.SurfaceAtlasSlot(r.x,r.y,t,e);return this._updateUsedRectangleAreaSize(a),a},t.prototype._updateUsedRectangleAreaSize=function(t){var e=t.x+t.width,r=t.y+t.height;e>this._usedRectangleAreaSize.width&&(this._usedRectangleAreaSize.width=e),r>this._usedRectangleAreaSize.height&&(this._usedRectangleAreaSize.height=r)},t.prototype.addSurface=function(t,e,r,i,n){var o=this._acquireSurfaceAtlasSlot(i,n);if(!o)return null;var s=this._surface.renderer();return s.begin(),s.drawImage(t,e,r,i,n,o.x,o.y),s.end(),o},t.prototype.destroy=function(){this._surface.destroy()},t.prototype.destroyed=function(){return this._surface.destroyed()},t.prototype.getAtlasUsedSize=function(){return this._usedRectangleAreaSize},t.prototype.getAccessScore=function(){return this._accessScore},t}();Ui.SurfaceAtlas=Wi,Object.defineProperty(Gi,"__esModule",{value:!0}),Gi.SurfaceAtlasSet=void 0;var Vi=Ui;var Xi=function(){function t(e){this._surfaceAtlases=[],this._atlasGlyphsTable=[],this._resourceFactory=e.resourceFactory,this._currentAtlasIndex=0;var r=e.hint?e.hint:{};this._maxAtlasNum=r.maxAtlasNum?r.maxAtlasNum:t.INITIAL_MAX_SURFACEATLAS_NUM,r.initialAtlasWidth=r.initialAtlasWidth?r.initialAtlasWidth:512,r.initialAtlasHeight=r.initialAtlasHeight?r.initialAtlasHeight:512,r.maxAtlasWidth=r.maxAtlasWidth?r.maxAtlasWidth:512,r.maxAtlasHeight=r.maxAtlasHeight?r.maxAtlasHeight:512,this._atlasSize=function(t){return{width:Math.ceil(Math.min(t.initialAtlasWidth,t.maxAtlasWidth)),height:Math.ceil(Math.min(t.initialAtlasHeight,t.maxAtlasHeight))}}(r)}return t.prototype._deleteAtlas=function(t){for(var e=0;e<t;++e){var r=this._spliceLeastFrequentlyUsedAtlas();if(!r)return;r.destroy()}},t.prototype._findLeastFrequentlyUsedAtlasIndex=function(){for(var t=Number.MAX_VALUE,e=-1,r=0;r<this._surfaceAtlases.length;++r)this._surfaceAtlases[r]._accessScore<=t&&(t=this._surfaceAtlases[r]._accessScore,e=r);return e},t.prototype._spliceLeastFrequentlyUsedAtlas=function(){var t=this._findLeastFrequentlyUsedAtlasIndex();if(-1===t)return null;this._currentAtlasIndex>=t&&--this._currentAtlasIndex;for(var e=this._surfaceAtlases.splice(t,1)[0],r=this._atlasGlyphsTable.splice(t,1)[0],i=0;i<r.length;i++){var n=r[i];n.surface=void 0,n.isSurfaceValid=!1,n._atlas=null}return e},t.prototype._moveGlyphSurface=function(t){for(var e=0;e<this._surfaceAtlases.length;++e){var r=(this._currentAtlasIndex+e)%this._surfaceAtlases.length,i=this._surfaceAtlases[r],n=i.addSurface(t.surface,t.x,t.y,t.width,t.height);if(n)return this._currentAtlasIndex=r,t.surface&&t.surface.destroy(),t.surface=i._surface,t.x=n.x,t.y=n.y,t._atlas=i,this._atlasGlyphsTable[r].push(t),!0}return!1},t.prototype._reallocateAtlas=function(){var t=null;this._surfaceAtlases.length>=this._maxAtlasNum?(t=this._spliceLeastFrequentlyUsedAtlas()).reset():t=new Vi.SurfaceAtlas(this._resourceFactory.createSurface(this._atlasSize.width,this._atlasSize.height)),this._surfaceAtlases.push(t),this._atlasGlyphsTable.push([]),this._currentAtlasIndex=this._surfaceAtlases.length-1},t.prototype.getAtlas=function(t){return this._surfaceAtlases[t]},t.prototype.getAtlasNum=function(){return this._surfaceAtlases.length},t.prototype.getMaxAtlasNum=function(){return this._maxAtlasNum},t.prototype.changeMaxAtlasNum=function(t){if(this._maxAtlasNum=t,this._surfaceAtlases.length>this._maxAtlasNum){var e=this._surfaceAtlases.length-this._maxAtlasNum;this._deleteAtlas(e)}},t.prototype.getAtlasUsedSize=function(){return this._atlasSize},t.prototype.addGlyph=function(t){return!(t.width>this._atlasSize.width||t.height>this._atlasSize.height)&&(!!this._moveGlyphSurface(t)||(this._reallocateAtlas(),this._moveGlyphSurface(t)))},t.prototype.touchGlyph=function(t){t._atlas&&(t._atlas._accessScore+=1);for(var e=0;e<this._surfaceAtlases.length;e++){this._surfaceAtlases[e]._accessScore/=2}},t.prototype.destroy=function(){for(var t=0;t<this._surfaceAtlases.length;++t)this._surfaceAtlases[t].destroy();this._surfaceAtlases=void 0,this._resourceFactory=void 0,this._atlasGlyphsTable=void 0},t.prototype.destroyed=function(){return void 0===this._surfaceAtlases},t.INITIAL_MAX_SURFACEATLAS_NUM=10,t}();Gi.SurfaceAtlasSet=Xi;var zi=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ji,"__esModule",{value:!0}),ji.DynamicFont=void 0;var qi=O,Yi=Dr,Ki=Gi,$i=he,Ji=function(t){function e(e){var r=t.call(this)||this;r.fontFamily=e.fontFamily,r.size=e.size,r.hint=null!=e.hint?e.hint:{},r.fontColor=null!=e.fontColor?e.fontColor:"black",r.fontWeight=null!=e.fontWeight?e.fontWeight:qi.FontWeight.Normal,r.strokeWidth=null!=e.strokeWidth?e.strokeWidth:0,r.strokeColor=null!=e.strokeColor?e.strokeColor:"black",r.strokeOnly=null!=e.strokeOnly&&e.strokeOnly;var i=e.game;r._resourceFactory=i.resourceFactory;var n,o=r.fontFamily;if("string"==typeof o)n=o;else if(Array.isArray(o)){for(var s=[],a=0;a<o.length;++a){var h=o[a];s.push("string"==typeof h?h:$i.Util.enumToSnakeCase(qi.FontFamily,h))}n=s}else{(s=[]).push("string"==typeof o?o:$i.Util.enumToSnakeCase(qi.FontFamily,o)),n=s}var u=r.fontWeight,c="string"==typeof u?u:$i.Util.enumToSnakeCase(qi.FontWeight,u);if(r._glyphFactory=r._resourceFactory.createGlyphFactory(n,r.size,r.hint.baselineHeight,r.fontColor,r.strokeWidth,r.strokeColor,r.strokeOnly,c),r._glyphs={},r._destroyed=!1,r._isSurfaceAtlasSetOwner=!1,e.surfaceAtlasSet?r._atlasSet=e.surfaceAtlasSet:e.hint?(r._isSurfaceAtlasSetOwner=!0,r._atlasSet=new Ki.SurfaceAtlasSet({resourceFactory:i.resourceFactory,hint:r.hint})):r._atlasSet=i.surfaceAtlasSet,r.hint.presetChars){a=0;for(var l=r.hint.presetChars.length;a<l;a++){var d=$i.Util.charCodeAt(r.hint.presetChars,a);d&&r.glyphForCharacter(d)}}return r}return zi(e,t),e.prototype.glyphForCharacter=function(t){var e=this._glyphs[t];if(!e||!e.isSurfaceValid){if((e=this._glyphFactory.create(t)).surface&&!this._atlasSet.addGlyph(e))return null;this._glyphs[t]=e}return this._atlasSet.touchGlyph(e),e},e.prototype.asBitmapFont=function(t){var e=this;if(1!==this._atlasSet.getAtlasNum())return null;var r=null;t&&(r=$i.Util.charCodeAt(t,0),this.glyphForCharacter(r));var i={};Object.keys(this._glyphs).forEach((function(t){var r=Number(t),n=e._glyphs[r],o={x:n.x,y:n.y,width:n.width,height:n.height,offsetX:n.offsetX,offsetY:n.offsetY,advanceWidth:n.advanceWidth};i[r]=o}));var n=i[r],o=this._atlasSet.getAtlas(0),s=o.getAtlasUsedSize(),a=this._resourceFactory.createSurface(s.width,s.height),h=a.renderer();return h.begin(),h.drawImage(o._surface,0,0,s.width,s.height,0,0),h.end(),new Yi.BitmapFont({src:a,map:i,defaultGlyphWidth:0,defaultGlyphHeight:this.size,missingGlyph:n})},e.prototype.destroy=function(){this._isSurfaceAtlasSetOwner&&this._atlasSet.destroy(),this._glyphs=void 0,this._glyphFactory=void 0,this._destroyed=!0},e.prototype.destroyed=function(){return this._destroyed},e}(jr.Font);ji.DynamicFont=Ji;var Zi={};Object.defineProperty(Zi,"__esModule",{value:!0});var Qi={};Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.EventConverter=void 0;var tn=Nt,en=Wt,rn=Tt,nn=function(){function t(t){var e;this._game=t.game,this._playerId=null!==(e=t.playerId)&&void 0!==e?e:null,this._playerTable={}}return t.prototype.toGameEvent=function(t){var e,r,i,n,o,s,a,h,u,c=t[0],l=t[1],d=t[2],p=this._playerTable[d]||{id:d};switch(c){case 0:return p={id:d,name:t[3]},this._playerTable[d]&&null!=this._playerTable[d].userData&&(p.userData=this._playerTable[d].userData),this._playerTable[d]=p,new en.JoinEvent(p,l);case 1:return delete this._playerTable[p.id],new en.LeaveEvent(p,l);case 2:return h=t[3],new en.TimestampEvent(h,p,l);case 3:return p={id:d,name:t[3],userData:t[4]},this._playerTable[d]=p,new en.PlayerInfoEvent(p,l);case 32:return a=t[4],new en.MessageEvent(t[3],p,a,l);case 33:return a=t[8],e=t[3],i=null==(r=t[6])?void 0:r>=0?this._game.db.get(r):this._game._localDb.get(r),n={x:t[4],y:t[5]},u=t[7],new tn.PointDownEvent(e,i,n,p,a,l,u);case 34:return a=t[12],e=t[3],i=null==(r=t[10])?void 0:r>=0?this._game.db.get(r):this._game._localDb.get(r),n={x:t[4],y:t[5]},o={x:t[6],y:t[7]},s={x:t[8],y:t[9]},u=t[11],new tn.PointMoveEvent(e,i,n,s,o,p,a,l,u);case 35:return a=t[12],e=t[3],i=null==(r=t[10])?void 0:r>=0?this._game.db.get(r):this._game._localDb.get(r),n={x:t[4],y:t[5]},o={x:t[6],y:t[7]},s={x:t[8],y:t[9]},u=t[11],new tn.PointUpEvent(e,i,n,s,o,p,a,l,u);case 64:a=t[5];var f=t[3],_=t[4],y=this._game._decodeOperationPluginOperation(f,_);return new en.OperationEvent(f,y,p,a,l);default:throw rn.ExceptionFactory.createAssertionError("EventConverter#toGameEvent")}},t.prototype.toPlaylogEvent=function(t,e){var r,i,n,o,s,a,h,u,c;switch(t.type){case"join":case"leave":throw rn.ExceptionFactory.createAssertionError("EventConverter#toPlaylogEvent: Invalid type: "+t.type);case"timestamp":var l=t;return c=e?null!==(r=l.player.id)&&void 0!==r?r:null:this._playerId,[2,l.eventFlags,c,l.timestamp];case"player-info":var d=t;return c=e?null!==(i=d.player.id)&&void 0!==i?i:null:this._playerId,[3,d.eventFlags,c,d.player.name,d.player.userData];case"point-down":var p=t;return u=p.target?p.target.id:null,c=e&&p.player?null!==(n=p.player.id)&&void 0!==n?n:null:this._playerId,[33,p.eventFlags,c,p.pointerId,p.point.x,p.point.y,u,p.button,!!p.local];case"point-move":var f=t;return u=f.target?f.target.id:null,c=e&&f.player?null!==(o=f.player.id)&&void 0!==o?o:null:this._playerId,[34,f.eventFlags,c,f.pointerId,f.point.x,f.point.y,f.startDelta.x,f.startDelta.y,f.prevDelta.x,f.prevDelta.y,u,f.button,!!f.local];case"point-up":var _=t;return u=_.target?_.target.id:null,c=e&&_.player?null!==(s=_.player.id)&&void 0!==s?s:null:this._playerId,[35,_.eventFlags,c,_.pointerId,_.point.x,_.point.y,_.startDelta.x,_.startDelta.y,_.prevDelta.x,_.prevDelta.y,u,_.button,!!_.local];case"message":var y=t;return c=e&&y.player?null!==(a=y.player.id)&&void 0!==a?a:null:this._playerId,[32,y.eventFlags,c,y.data,!!y.local];case"operation":var g=t;return c=e&&g.player?null!==(h=g.player.id)&&void 0!==h?h:null:this._playerId,[64,g.eventFlags,c,g.code,g.data,!!g.local];default:throw rn.ExceptionFactory.createAssertionError("Unknown type: "+t.type)}},t.prototype.makePlaylogOperationEvent=function(t){var e=this._playerId;return[64,null!=t.priority?3&t.priority:0,e,t._code,t.data,!!t.local]},t}();Qi.EventConverter=nn;var on={};Object.defineProperty(on,"__esModule",{value:!0});var sn={};Object.defineProperty(sn,"__esModule",{value:!0});var an={};Object.defineProperty(an,"__esModule",{value:!0});var hn={};Object.defineProperty(hn,"__esModule",{value:!0});var un={};Object.defineProperty(un,"__esModule",{value:!0});var cn={};Object.defineProperty(cn,"__esModule",{value:!0});var ln={};Object.defineProperty(ln,"__esModule",{value:!0});var dn={},pn={};Object.defineProperty(pn,"__esModule",{value:!0}),pn.RequireCachedValue=void 0;var fn=function(){function t(t){this._value=t}return t.prototype._cachedValue=function(){return this._value},t}();pn.RequireCachedValue=fn;var _n={};Object.defineProperty(_n,"__esModule",{value:!0}),_n.ScriptAssetContext=void 0;var yn=Tt,gn=function(){function t(t,e){this._asset=t,this._module=e,this._started=!1}return t.prototype._cachedValue=function(){if(!this._started)throw yn.ExceptionFactory.createAssertionError("ScriptAssetContext#_cachedValue: not executed yet.");return this._module.exports},t.prototype._executeScript=function(t){return this._started||(t&&(this._module.parent=t,t.children.push(this._module)),this._started=!0,this._asset.execute(this._module._runtimeValue),this._module.loaded=!0),this._module.exports},t}();_n.ScriptAssetContext=gn,Object.defineProperty(dn,"__esModule",{value:!0}),dn.ModuleManager=void 0;var vn=It,mn=Tt,Tn=Ct,An=pn,wn=_n,Sn=function(){function t(t,e){this._assetManager=e,this._runtimeValueBase=t,this._scriptCaches={}}return t.prototype._internalRequire=function(t,e){var r=this._require(t,e);return r.__esModule?r.default:r},t.prototype._require=function(t,e){var r,i,n=this,o=this._assetManager._liveAssetVirtualPathTable,s=this._assetManager._moduleMainScripts;if(-1===t.indexOf("/")&&this._assetManager._assets.hasOwnProperty(t)&&(r=this._assetManager._assets[t],i=this._assetManager._liveAssetPathTable[r.path]),i||(i=this._resolvePath(t,e),/^\//.test(i)&&(i=i.slice(1))),this._scriptCaches.hasOwnProperty(i))return this._scriptCaches[i]._cachedValue();if(r=s[t]?o[i]:this._findAssetByPathAsFile(i,o)){if(this._scriptCaches.hasOwnProperty(i))return this._scriptCaches[i]._cachedValue();if("script"===r.type){var a=new Tn.Module({runtimeValueBase:this._runtimeValueBase,id:r.id,path:r.path,virtualPath:this._assetManager._liveAssetPathTable[r.path],requireFunc:function(t,e){return n._require(t,e)},resolveFunc:function(t,e){return n._resolvePath(t,e)}}),h=new wn.ScriptAssetContext(r,a);return this._scriptCaches[i]=h,h._executeScript(e)}if("text"===r.type&&r&&".json"===vn.PathUtil.resolveExtname(t))return(this._scriptCaches[i]=new An.RequireCachedValue(JSON.parse(r.data)))._cachedValue()}throw mn.ExceptionFactory.createAssertionError("g._require: can not find module: "+t)},t.prototype._resolvePath=function(t,e){var r=null,i=this._assetManager._liveAssetVirtualPathTable,n=this._assetManager._moduleMainScripts;if(/^\.\/|^\.\.\/|^\//.test(t)){if(e){if(!e._virtualDirname)throw mn.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the moudle path without virtualPath");r=vn.PathUtil.resolvePath(e._virtualDirname,t)}else{if(!/^\.\//.test(t))throw mn.ExceptionFactory.createAssertionError("g._require.resolve: entry point path must start with './'");r=t.substring(2)}if(h=this._resolveAbsolutePathAsFile(r,i))return h;if(h=this._resolveAbsolutePathAsDirectory(r,i))return h}else{if(n[t])return n[t];var o=e?e.paths.concat():[];o.push("node_modules");for(var s=0;s<o.length;++s){var a=o[s],h=vn.PathUtil.resolvePath(a,t);if(r=this._resolveAbsolutePathAsFile(h,i))return r;if(r=this._resolveAbsolutePathAsDirectory(h,i))return r}}throw mn.ExceptionFactory.createAssertionError("g._require.resolve: couldn't resolve the path: "+t)},t.prototype._findAssetByPathAsFile=function(t,e){return e.hasOwnProperty(t)?e[t]:e.hasOwnProperty(t+".js")?e[t+".js"]:void 0},t.prototype._resolveAbsolutePathAsFile=function(t,e){return e.hasOwnProperty(t)?"/"+t:e.hasOwnProperty(t+".js")?"/"+t+".js":null},t.prototype._resolveAbsolutePathAsDirectory=function(t,e){var r=t+"/package.json",i=e[r];if(e.hasOwnProperty(r)&&"text"===i.type){var n=JSON.parse(i.data);if(n&&"string"==typeof n.main){var o=this._resolveAbsolutePathAsFile(vn.PathUtil.resolvePath(t,n.main),e);if(o)return o}}return r=t+"/index.js",e.hasOwnProperty(r)?"/"+r:null},t}();dn.ModuleManager=Sn;var xn={};Object.defineProperty(xn,"__esModule",{value:!0}),xn.NinePatchSurfaceEffector=void 0;var bn=Me,Pn=function(){function t(t,e){void 0===e&&(e=4),this.game=t,this.borderWidth="number"==typeof e?{top:e,bottom:e,left:e,right:e}:e}return t.prototype.render=function(t,e,r){return this._surface&&this._surface.width===e&&this._surface.height===r&&this._beforeSrcSurface===t||(this._surface=this.game.resourceFactory.createSurface(Math.ceil(e),Math.ceil(r)),this._beforeSrcSurface=t),bn.SurfaceUtil.drawNinePatch(this._surface,t,this.borderWidth),this._surface},t}();xn.NinePatchSurfaceEffector=Pn;var En={};Object.defineProperty(En,"__esModule",{value:!0});var On={},kn=t&&t.__assign||function(){return kn=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},kn.apply(this,arguments)};Object.defineProperty(On,"__esModule",{value:!0}),On.OperationPluginManager=void 0;var Mn=b,Ln=function(){function t(t,e,r){this._code=t,this._handler=r,this._handlerOwner=e}return t.prototype.onOperation=function(t){var e;e=t instanceof Array?{_code:this._code,data:t}:kn({_code:this._code},t),this._handler.call(this._handlerOwner,e)},t}(),Rn=function(){function t(t,e){this.onOperate=new Mn.Trigger,this.operated=this.onOperate,this.plugins={},this._game=t,this._viewInfo=e}return t.prototype.register=function(t,e,r){return this._instantiateOperationPlugin(t,e,r)},t.prototype.start=function(t){var e=this.plugins[t];e&&e.start()},t.prototype.stop=function(t){var e=this.plugins[t];e&&e.stop()},t.prototype.destroy=function(){this.stopAll(),this.onOperate.destroy(),this.onOperate=void 0,this.operated=void 0,this.plugins=void 0,this._game=void 0,this._viewInfo=void 0},t.prototype.reset=function(){this.stopAll(),this.onOperate.removeAll(),this.plugins={}},t.prototype.stopAll=function(){for(var t in this.plugins)if(this.plugins.hasOwnProperty(t)){var e=this.plugins[t];e&&e.stop()}},t.prototype._instantiateOperationPlugin=function(t,e,r){if(t.isSupported()){if(this.plugins[e])throw new Error("Plugin#code conflicted for code: ".concat(e));var i=new t(this._game,this._viewInfo,r);this.plugins[e]=i;var n=new Ln(e,this.onOperate,this.onOperate.fire);return i.operationTrigger.add(n.onOperation,n),i}},t}();On.OperationPluginManager=Rn;var Cn={};Object.defineProperty(Cn,"__esModule",{value:!0});var In={};Object.defineProperty(In,"__esModule",{value:!0});var Fn={};Object.defineProperty(Fn,"__esModule",{value:!0});var Dn={};Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.PointEventResolver=void 0;var jn=function(){function t(t){var e;this._currentPoints=0,this._pointEventMap={},this._sourceResolver=t.sourceResolver,this._playerId=t.playerId,this._maxPoints=null!==(e=t.maxPoints)&&void 0!==e?e:null}return t.prototype.pointDown=function(t){if(null!=this._maxPoints&&this._currentPoints>=this._maxPoints)return null;var e=this._sourceResolver.findPointSource(t.offset),r=e.point?e.point:t.offset,i=e.target?e.target.id:void 0,n=e.local;this._pointEventMap[t.identifier]={targetId:i,local:n,point:r,start:{x:t.offset.x,y:t.offset.y},prev:{x:t.offset.x,y:t.offset.y}},this._currentPoints++;var o=[33,2,this._playerId,t.identifier,r.x,r.y,i,t.button];return e&&e.local&&o.push(e.local),o},t.prototype.pointMove=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var r={x:0,y:0},i={x:0,y:0};this._pointMoveAndUp(e,t.offset,r,i);var n=[34,2,this._playerId,t.identifier,e.point.x,e.point.y,i.x,i.y,r.x,r.y,e.targetId,t.button];return e.local&&n.push(e.local),n},t.prototype.pointUp=function(t){var e=this._pointEventMap[t.identifier];if(!e)return null;var r={x:0,y:0},i={x:0,y:0};this._pointMoveAndUp(e,t.offset,r,i),delete this._pointEventMap[t.identifier],this._currentPoints--;var n=[35,2,this._playerId,t.identifier,e.point.x,e.point.y,i.x,i.y,r.x,r.y,e.targetId,t.button];return e.local&&n.push(e.local),n},t.prototype._pointMoveAndUp=function(t,e,r,i){i.x=e.x-t.start.x,i.y=e.y-t.start.y,r.x=e.x-t.prev.x,r.y=e.y-t.prev.y,t.prev.x=e.x,t.prev.y=e.y},t}();Dn.PointEventResolver=jn;var Gn={};Object.defineProperty(Gn,"__esModule",{value:!0}),Gn.RandomGenerator=void 0;var Un=function(t){this.seed=t};Gn.RandomGenerator=Un;var Hn={};Object.defineProperty(Hn,"__esModule",{value:!0});var Bn={};Object.defineProperty(Bn,"__esModule",{value:!0});var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});var Wn={};Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.SpriteFactory=void 0;var Vn=ke,Xn=Tt,zn=function(){function t(){}return t.createSpriteFromE=function(t,e,r){var i=e.x,n=e.y,o=0,s=0,a=e.width,h=e.height,u=e.calculateBoundingRect();if(!u)throw Xn.ExceptionFactory.createAssertionError("SpriteFactory.createSpriteFromE: camera must look e");a=u.right-u.left,h=u.bottom-u.top,u.left<e.x&&(o=e.x-u.left),u.top<e.y&&(s=e.y-u.top),e.moveTo(o,s),e._matrix&&(e._matrix._modified=!0);var c=t.game.resourceFactory.createSurface(Math.ceil(a),Math.ceil(h)),l=c.renderer();l.begin(),e.render(l,r),l.end();var d=new Vn.Sprite({scene:t,src:c,width:a,height:h});return d.moveTo(u.left,u.top),e.moveTo(i,n),e._matrix&&(e._matrix._modified=!0),d},t.createSpriteFromScene=function(t,e,r){var i=t.game.resourceFactory.createSurface(Math.ceil(e.game.width),Math.ceil(e.game.height)),n=i.renderer();n.begin();for(var o=e.children,s=0;s<o.length;++s)o[s].render(n,r);return n.end(),new Vn.Sprite({scene:t,src:i,width:e.game.width,height:e.game.height})},t}();Wn.SpriteFactory=zn;var qn={};Object.defineProperty(qn,"__esModule",{value:!0});var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0});var Kn={};Object.defineProperty(Kn,"__esModule",{value:!0});var $n={};Object.defineProperty($n,"__esModule",{value:!0});var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.Xorshift=void 0;var Zn=function(){function t(t){var e=Array.isArray(t)?t:this.generateSeeds(t);this._state0U=0|e[0],this._state0L=0|e[1],this._state1U=0|e[2],this._state1L=0|e[3]}return t.deserialize=function(e){return new t([e._state0U,e._state0L,e._state1U,e._state1L])},t.prototype.initState=function(t){var e=this.generateSeeds(t);this._state0L=0|e[0],this._state0U=0|e[1],this._state1L=0|e[2],this._state1U=0|e[3]},t.prototype.randomInt=function(){var t=this._state0U,e=this._state0L,r=this._state1U,i=this._state1L,n=(i>>>0)+(e>>>0),o=r+t+(n/2>>>31)>>>0,s=n>>>0;this._state0U=r,this._state0L=i;var a=0,h=0;a=(t^=a=t<<23|(-512&e)>>>9)^r,h=(e^=h=e<<23)^i;a^=t>>>18,h^=e>>>18|(262143&t)<<14;return a^=r>>>5,h^=i>>>5|(31&r)<<27,this._state1U=a,this._state1L=h,[o,s]},t.prototype.random=function(){var t=this.randomInt();return 2.3283064365386963e-10*t[0]+2220446049250313e-31*(t[1]>>>12)},t.prototype.nextInt=function(t,e){return Math.floor(t+this.random()*(e-t))},t.prototype.serialize=function(){return{_state0U:this._state0U,_state0L:this._state0L,_state1U:this._state1U,_state1L:this._state1L}},t.prototype.generateSeeds=function(t){var e=1812433253;return[t=e*(t^t>>30)+1,t=e*(t^t>>30)+2,t=e*(t^t>>30)+3,t=e*(t^t>>30)+4]},t}();Jn.Xorshift=Zn;var Qn={},to=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Qn,"__esModule",{value:!0}),Qn.XorshiftRandomGenerator=void 0;var eo=Tt,ro=Jn,io=function(t){function e(e,r){var i=this;if(void 0===e)throw eo.ExceptionFactory.createAssertionError("XorshiftRandomGenerator#constructor: seed is undefined");return(i=t.call(this,e)||this)._xorshift=r?ro.Xorshift.deserialize(r):new ro.Xorshift(e),i}return to(e,t),e.deserialize=function(t){return new e(t._seed,t._xorshift)},e.prototype.get=function(t,e){return this._xorshift.nextInt(t,e+1)},e.prototype.generate=function(){return this._xorshift.random()},e.prototype.serialize=function(){return{_seed:this.seed,_xorshift:this._xorshift.serialize()}},e}(Gn.RandomGenerator);Qn.XorshiftRandomGenerator=io;var no={};Object.defineProperty(no,"__esModule",{value:!0}),no.Game=void 0;var oo=b,so=or,ao=Or,ho=Zr,uo=ki,co=Qi,lo=Tt,po=ni,fo=dn,_o=On,yo=Dn,go=oi,vo=Gi,mo=At,To=Qn,Ao=function(){function t(t){var e=this._normalizeConfiguration(t.configuration);if(this.fps=e.fps,this.width=e.width,this.height=e.height,this.renderers=[],this.scenes=[],this.age=0,this.assetBase=t.assetBase||"",this.resourceFactory=t.resourceFactory,this.handlerSet=t.handlerSet,this.selfId=t.selfId,this.db=void 0,this.loadingScene=void 0,this.operationPlugins=void 0,this.random=void 0,this.localRandom=void 0,this._defaultLoadingScene=void 0,this._defaultSkippingScene=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this._idx=void 0,this._localDb=void 0,this._localIdx=void 0,this._cameraIdx=void 0,this._isTerminated=void 0,this._modified=void 0,this._postTickTasks=void 0,this._toBeDestroyedScenes=[],this.playId=void 0,this.isSkipping=!1,this.joinedPlayerIds=[],this.audio=new ao.AudioSystemManager(this.resourceFactory),this.defaultAudioSystemId="sound",this.assets={},this.surfaceAtlasSet=new vo.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this.onJoin=new oo.Trigger,this.onLeave=new oo.Trigger,this.onPlayerInfo=new oo.Trigger,this.onSeed=new oo.Trigger,this.join=this.onJoin,this.leave=this.onLeave,this.playerInfo=this.onPlayerInfo,this.seed=this.onSeed,this._eventTriggerMap={unknown:void 0,timestamp:void 0,join:this.onJoin,leave:this.onLeave,"player-info":this.onPlayerInfo,seed:this.onSeed,message:void 0,"point-down":void 0,"point-move":void 0,"point-up":void 0,operation:void 0},this.onResized=new oo.Trigger,this.onSkipChange=new oo.Trigger,this.resized=this.onResized,this.skippingChanged=this.onSkipChange,this.isLastTickLocal=!0,this.lastOmittedLocalTickCount=0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this._onLoad=new oo.Trigger,this._onStart=new oo.Trigger,this._loaded=this._onLoad,this._started=this._onStart,this.isLoaded=!1,this.onSnapshotRequest=new oo.Trigger,this.snapshotRequest=this.onSnapshotRequest,this.external={},this._runtimeValueBase=Object.create(t.engineModule,{game:{value:this,enumerable:!0}}),this._main=e.main,this._mainFunc=t.mainFunc,this._mainParameter=void 0,this._configuration=e,Array.isArray(e.assets))throw new Error("Game#constructor: array type of configuration.assets is not yet supported");this._assetManager=new so.AssetManager(this,e.assets,e.audio,e.moduleMainScripts),this._moduleManager=void 0,this.operationPluginManager=new _o.OperationPluginManager(this,t.operationPluginViewInfo||null),this._onOperationPluginOperated=new oo.Trigger,this._operationPluginOperated=this._onOperationPluginOperated,this._onOperationPluginOperated.add(this._handleOperationPluginOperated,this),this.onSceneChange=new oo.Trigger,this._onSceneChange=new oo.Trigger,this._onSceneChange.add(this._handleSceneChanged,this),this._sceneChanged=this._onSceneChange,this.onUpdate=new oo.Trigger,this._initialScene=new go.Scene({game:this,assetIds:this._assetManager.globalAssetIds(),local:!0,name:"akashic:initial-scene"}),this._initialScene.onLoad.add(this._handleInitialSceneLoad,this),this._reset({age:0})}return Object.defineProperty(t.prototype,"focusingCamera",{get:function(){return this._focusingCamera},set:function(t){t!==this._focusingCamera&&(this._modified&&this.render(),this._focusingCamera=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skippingScene",{get:function(){return this._skippingScene},set:function(t){if(t!==this._skippingScene){if(t){if("full-local"!==t.local)throw lo.ExceptionFactory.createAssertionError("Game#skippingScene: only 'full-local' scene is supported.");if(t._needsLoading())throw lo.ExceptionFactory.createAssertionError("Game#skippingScene: must not depend on any assets.")}this._skippingScene=t}},enumerable:!1,configurable:!0}),t.prototype.pushScene=function(t,e){this._postTickTasks.push({type:0,scene:t,prepare:null==e?void 0:e.prepare})},t.prototype.replaceScene=function(t,e){var r,i;"object"===n(e)?(r=!!e.preserveCurrent,i=e.prepare):r=!!e,this._postTickTasks.push({type:1,scene:t,preserveCurrent:r,prepare:i})},t.prototype.popScene=function(t,e){void 0===e&&(e=1);for(var r=0;r<e;r++)this._postTickTasks.push({type:2,preserveCurrent:!!t})},t.prototype.scene=function(){if(this.scenes.length)return this.scenes[this.scenes.length-1]},t.prototype.tick=function(t,e,r){var i=null;if(this._isTerminated)return!1;if(this.isLastTickLocal=!t,this.lastOmittedLocalTickCount=e||0,this.scenes.length){if(i=this.scenes[this.scenes.length-1],r&&r.length)for(var n=0;n<r.length;++n){var o=this._eventConverter.toGameEvent(r[n]),s=this._eventTriggerMap[o.type];s&&s.fire(o)}i.onUpdate.fire(),t&&++this.age}return this.onUpdate.fire(),!!this._postTickTasks.length&&(this._flushPostTickTasks(),i!==this.scenes[this.scenes.length-1])},t.prototype.render=function(){var t,e,r=null!==(t=this._skippingScene)&&void 0!==t?t:this._defaultSkippingScene;if(r&&this.isSkipping?(e=r).onUpdate.fire():e=this.scene(),this._modified&&e){for(var i=this.focusingCamera,n=this.renderers,o=this.scenes.length-1;o>=0&&this.scenes[o].seethrough;)--o;for(var s=o,a=0;a<n.length;++a){var h=n[a];if(h.begin(),h.save(),h.clear(),i&&(h.save(),i._applyTransformToRenderer(h)),e===r)for(var u=0;u<e.children.length;++u)e.children[u].render(h,i);else for(var c=s;c<this.scenes.length;++c){var l=this.scenes[c].children;for(u=0;u<l.length;++u)l[u].render(h,i)}i&&h.restore(),h.restore(),h.end()}this._modified=!1}},t.prototype.resolvePointEvent=function(t){switch(t.type){case 0:return this._pointEventResolver.pointDown(t);case 1:return this._pointEventResolver.pointMove(t);case 2:return this._pointEventResolver.pointUp(t)}},t.prototype.findPointSource=function(t,e){e||(e=this.focusingCamera);var r=this.scene();if(r)return r.findPointSourceByPoint(t,!1,e)},t.prototype.register=function(t){if(t.local){if(void 0===t.id)t.id=--this._localIdx;else{if(t.id>0)throw lo.ExceptionFactory.createAssertionError("Game#register: invalid local id: "+t.id);if(this._localDb.has(t.id))throw lo.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._localIdx>t.id&&(this._localIdx=t.id)}this._localDb.set(t.id,t)}else{if(void 0===t.id)t.id=++this._idx;else{if(t.id<0)throw lo.ExceptionFactory.createAssertionError("Game#register: invalid non-local id: "+t.id);if(this.db.has(t.id))throw lo.ExceptionFactory.createAssertionError("Game#register: conflicted id: "+t.id);this._idx<t.id&&(this._idx=t.id)}this.db.set(t.id,t)}},t.prototype.unregister=function(t){t.local?this._localDb.delete(t.id):this.db.delete(t.id)},t.prototype.terminateGame=function(){this._isTerminated=!0,this._terminateGame()},t.prototype.modified=function(){this._modified=!0},t.prototype.raiseEvent=function(t){this.handlerSet.raiseEvent(this._eventConverter.toPlaylogEvent(t))},t.prototype.raiseTick=function(t){if(null!=t&&t.length){for(var e=[],r=0;r<t.length;r++)e.push(this._eventConverter.toPlaylogEvent(t[r]));this.handlerSet.raiseTick(e)}else this.handlerSet.raiseTick()},t.prototype.addEventFilter=function(t,e){this.handlerSet.addEventFilter(t,e)},t.prototype.removeEventFilter=function(t){this.handlerSet.removeEventFilter(t)},t.prototype.shouldSaveSnapshot=function(){return this.handlerSet.shouldSaveSnapshot()},t.prototype.saveSnapshot=function(t,e){this.handlerSet.saveSnapshot(this.age,t,this.random.serialize(),this._idx,e)},t.prototype.requestSaveSnapshot=function(t,e){var r=this;this._postTickTasks.unshift({type:3,fun:function(){if(r.handlerSet.shouldSaveSnapshot()){var i=t.call(e);i&&r.handlerSet.saveSnapshot(r.age,i.snapshot,r.random.serialize(),r._idx,i.timestamp)}},owner:null})},t.prototype.getCurrentTime=function(){return this.handlerSet.getCurrentTime()},t.prototype.isActiveInstance=function(){return"active"===this.handlerSet.getInstanceType()},t.prototype._pushPostTickTask=function(t,e){this._postTickTasks.push({type:3,fun:t,owner:e})},t.prototype._popSceneRaw=function(t){this._postTickTasks.push({type:4,preserveCurrent:t})},t.prototype._normalizeConfiguration=function(t){if(!t)throw lo.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: invalid arguments");if(null==t.assets&&(t.assets={}),null==t.fps&&(t.fps=30),"number"!=typeof t.fps)throw lo.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be given as a number");if(!(0<=t.fps&&t.fps<=60))throw lo.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: fps must be a number in (0, 60].");if("number"!=typeof t.width)throw lo.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: width must be given as a number");if("number"!=typeof t.height)throw lo.ExceptionFactory.createAssertionError("Game#_normalizeConfiguration: height must be given as a number");return t},t.prototype._setAudioPlaybackRate=function(t){this.audio._setPlaybackRate(t)},t.prototype._startSuppressAudio=function(){this.audio._startSuppress()},t.prototype._endSuppressAudio=function(){this.audio._endSuppress()},t.prototype._setMuted=function(t){this.audio._setMuted(t)},t.prototype._decodeOperationPluginOperation=function(t,e){var r=this.operationPluginManager.plugins[t];return r&&r.decode?r.decode(e):e},t.prototype._reset=function(t){var e;if(this.operationPluginManager.reset(),this.operationPluginManager.onOperate.add(this._onOperationPluginOperated.fire,this._onOperationPluginOperated),this.scene()){for(;this.scene()!==this._initialScene;)this._popSceneRaw(!1),this._flushPostTickTasks();this.isLoaded||this.scenes.pop()}switch(this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),t&&(void 0!==t.age&&(this.age=t.age),void 0!==t.randGenSer?this.random=To.XorshiftRandomGenerator.deserialize(t.randGenSer):void 0!==t.randSeed&&(this.random=new To.XorshiftRandomGenerator(t.randSeed))),this.audio._reset(),this._onLoad.removeAll({func:this._handleLoad,owner:this}),this.onJoin.removeAll(),this.onLeave.removeAll(),this.onSeed.removeAll(),this.onResized.removeAll(),this.onSkipChange.removeAll(),this.onSceneChange.removeAll(),this.onUpdate.removeAll(),this.handlerSet.removeAllEventFilters(),this.isSkipping=!1,this.onSkipChange.add(this._handleSkipChange,this),this.joinedPlayerIds=[],this.onJoin.add(this._handleJoinEvent,this),this.onLeave.add(this._handleLeaveEvent,this),this._idx=null!==(e=null==t?void 0:t.nextEntityId)&&void 0!==e?e:0,this._localIdx=0,this._cameraIdx=0,this.db=new mo.WeakRefKVS,this._localDb=new mo.WeakRefKVS,this._modified=!0,this.loadingScene=void 0,this._skippingScene=void 0,this._focusingCamera=void 0,this.lastLocalTickMode=null,this.lastTickGenerationMode=null,this.onSnapshotRequest.removeAll(),this._postTickTasks=[],this._toBeDestroyedScenes=[],this._eventConverter=new co.EventConverter({game:this,playerId:this.selfId}),this._pointEventResolver=new yo.PointEventResolver({sourceResolver:this,playerId:this.selfId,maxPoints:this._configuration.maxPoints}),this.localRandom=new To.XorshiftRandomGenerator(Math.floor(9007199254740991*Math.random())),this._isTerminated=!1,this.vars={},this._moduleManager=new fo.ModuleManager(this._runtimeValueBase,this._assetManager),this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=new vo.SurfaceAtlasSet({resourceFactory:this.resourceFactory}),this._configuration.defaultLoadingScene){case"none":this._defaultLoadingScene=new po.LoadingScene({game:this});break;case"compact":this._defaultLoadingScene=new ho.DefaultLoadingScene({game:this,style:"compact"});break;default:this._defaultLoadingScene=new ho.DefaultLoadingScene({game:this})}switch(this._configuration.defaultSkippingScene){case"none":this._defaultSkippingScene=new uo.DefaultSkippingScene({game:this,style:"none"});break;case"indicator":this._defaultSkippingScene=new uo.DefaultSkippingScene({game:this,style:"indicator"});break;default:this._defaultSkippingScene=void 0}},t.prototype._destroy=function(){if(this.operationPluginManager.destroy(),this.scene())for(;this.scene()!==this._initialScene;)this.popScene(),this._flushPostTickTasks();this._initialScene.destroy(),this.loadingScene&&!this.loadingScene.destroyed()&&this.loadingScene.destroy(),this._defaultLoadingScene.destroyed()||this._defaultLoadingScene.destroy(),this._defaultSkippingScene&&!this._defaultSkippingScene.destroyed()&&this._defaultSkippingScene.destroy(),this._skippingScene&&!this._skippingScene.destroyed()&&this._skippingScene.destroy(),this.db=void 0,this.renderers=void 0,this.scenes=void 0,this.random=void 0,this._modified=!1,this.age=0,this.assets=void 0,this.isLoaded=!1,this.loadingScene=void 0,this.assetBase="",this.selfId=void 0,this.audio.music.stopAll(),this.audio.sound.stopAll(),this.audio=void 0,this.defaultAudioSystemId=void 0,this.handlerSet=void 0,this.localRandom=void 0,this.onJoin.destroy(),this.onJoin=void 0,this.onLeave.destroy(),this.onLeave=void 0,this.onSeed.destroy(),this.onSeed=void 0,this.onPlayerInfo.destroy(),this.onPlayerInfo=void 0,this.onResized.destroy(),this.onResized=void 0,this.onSkipChange.destroy(),this.onSkipChange=void 0,this.onSceneChange.destroy(),this.onSceneChange=void 0,this.onUpdate.destroy(),this.onUpdate=void 0,this.onSnapshotRequest.destroy(),this.onSnapshotRequest=void 0,this.join=void 0,this.leave=void 0,this.seed=void 0,this.playerInfo=void 0,this.snapshotRequest=void 0,this.resized=void 0,this.skippingChanged=void 0,this._sceneChanged=void 0,this._loaded=void 0,this._started=void 0,this._operationPluginOperated=void 0,this._onSceneChange.destroy(),this._onSceneChange=void 0,this._onLoad.destroy(),this._onLoad=void 0,this._onStart.destroy(),this._onStart=void 0,this.resourceFactory=void 0,this.playId=void 0,this.operationPlugins=void 0,this._eventTriggerMap=void 0,this._initialScene=void 0,this._defaultLoadingScene=void 0,this._main=void 0,this._mainFunc=void 0,this._mainParameter=void 0,this._assetManager.destroy(),this._assetManager=void 0,this._eventConverter=void 0,this._pointEventResolver=void 0,this.operationPluginManager=void 0,this._onOperationPluginOperated.destroy(),this._onOperationPluginOperated=void 0,this._idx=0,this._localDb=void 0,this._localIdx=0,this._cameraIdx=0,this._isTerminated=!0,this._focusingCamera=void 0,this._skippingScene=void 0,this._configuration=void 0,this._postTickTasks=void 0,this.surfaceAtlasSet.destroy(),this.surfaceAtlasSet=void 0,this._moduleManager=void 0},t.prototype._loadAndStart=function(t){this._mainParameter=t||{},this.isLoaded?this._handleLoad():(this._onLoad.add(this._handleLoad,this),this.pushScene(this._initialScene),this._flushPostTickTasks())},t.prototype._startLoadingGlobalAssets=function(){if(this.isLoaded)throw lo.ExceptionFactory.createAssertionError("Game#_startLoadingGlobalAssets: already loaded.");this.pushScene(this._initialScene),this._flushPostTickTasks()},t.prototype._updateEventTriggers=function(t){if(this._modified=!0,!t)return this._eventTriggerMap.message=void 0,this._eventTriggerMap["point-down"]=void 0,this._eventTriggerMap["point-move"]=void 0,this._eventTriggerMap["point-up"]=void 0,void(this._eventTriggerMap.operation=void 0);this._eventTriggerMap.message=t.onMessage,this._eventTriggerMap["point-down"]=t.onPointDownCapture,this._eventTriggerMap["point-move"]=t.onPointMoveCapture,this._eventTriggerMap["point-up"]=t.onPointUpCapture,this._eventTriggerMap.operation=t.onOperation,t._activate()},t.prototype._handleInitialSceneLoad=function(){this._initialScene.onLoad.remove(this._handleInitialSceneLoad,this),this.assets=this._initialScene.assets,this.isLoaded=!0,this._onLoad.fire(this)},t.prototype._handleOperationPluginOperated=function(t){var e=this._eventConverter.makePlaylogOperationEvent(t);this.handlerSet.raiseEvent(e)},t.prototype._handleSceneChanged=function(t){this._updateEventTriggers(t);var e=t?t.local:"full-local",r=t?t.tickGenerationMode:"by-clock";this.lastLocalTickMode===e&&this.lastTickGenerationMode===r||(this.lastLocalTickMode=e,this.lastTickGenerationMode=r,this.handlerSet.changeSceneMode({local:e,tickGenerationMode:r}))},t.prototype._handleSkippingSceneReady=function(t){this._pushPostTickTask(t._fireLoaded,t)},t.prototype._terminateGame=function(){},t.prototype._flushPostTickTasks=function(){do{var t=this._postTickTasks;this._postTickTasks=[];for(var e=0;e<t.length;++e){var r=t[e];switch(r.type){case 0:var i=this.scene();i&&i._deactivate(),this._doPushScene(r.scene,!1,r.prepare?this._createPreparingLoadingScene(r.scene,r.prepare,"akashic:preparing-".concat(r.scene.name)):void 0);break;case 1:this._doPopScene(r.preserveCurrent,!1,!1),this._doPushScene(r.scene,!1,r.prepare?this._createPreparingLoadingScene(r.scene,r.prepare,"akashic:preparing-".concat(r.scene.name)):void 0);break;case 2:this._doPopScene(r.preserveCurrent,!1,!0);break;case 3:r.fun.call(r.owner);break;case 4:this._doPopScene(r.preserveCurrent,!0,!0);break;default:throw lo.ExceptionFactory.createAssertionError("Game#_flushPostTickTasks: unknown post-tick task type.")}}}while(this._postTickTasks.length>0);if(this._toBeDestroyedScenes.length>0){for(var n=0,o=this._toBeDestroyedScenes;n<o.length;n++){o[n].destroy()}this._toBeDestroyedScenes=[]}},t.prototype._handleSkipChange=function(t){var e;if(this.isSkipping=t,t){var r=null!==(e=this._skippingScene)&&void 0!==e?e:this._defaultSkippingScene;r&&!r._loaded&&(r._load(),r._onReady.addOnce(this._handleSkippingSceneReady,this))}this._cleanDB(),this._modified=!0},t.prototype._handleJoinEvent=function(t){t.player.id&&-1===this.joinedPlayerIds.indexOf(t.player.id)&&this.joinedPlayerIds.push(t.player.id)},t.prototype._handleLeaveEvent=function(t){this.joinedPlayerIds=this.joinedPlayerIds.filter((function(e){return e!==t.player.id}))},t.prototype._doPopScene=function(t,e,r){var i,n=this.scenes.pop();if(!e)for(;n&&n instanceof po.LoadingScene;)n._clearTargetScene(),n=this.scenes.pop();if(!n)throw lo.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; scene stack underflow");if(n===this._initialScene)throw lo.ExceptionFactory.createAssertionError("Game#_doPopScene: invalid call; attempting to pop the initial scene");if((t||this._toBeDestroyedScenes.includes(n)||this._toBeDestroyedScenes.push(n),!e)&&((s=this.scene())&&s._needsLoading()&&"loaded-fired"!==s._loadingState)){var o=s._waitingPrepare?this._createPreparingLoadingScene(s,s._waitingPrepare,"akashic:preparing-".concat(s.name)):null!==(i=this.loadingScene)&&void 0!==i?i:this._defaultLoadingScene;this._doPushScene(o,!0,this._defaultLoadingScene),o.reset(s)}if(r){var s=this.scene();this.onSceneChange.fire(s),this._onSceneChange.fire(s)}},t.prototype._handleLoad=function(){for(var t=0,e=this._configuration.operationPlugins||[];t<e.length;t++){var r=e[t];if(r.script){var i=this._moduleManager._internalRequire(r.script),n=this.operationPluginManager.register(i,r.code,r.option);!r.manualStart&&n&&n.start()}}this.operationPlugins=this.operationPluginManager.plugins;for(var o=0,s=this._assetManager.preloadScriptAssetIds();o<s.length;o++){var a=s[o],h=this._moduleManager._internalRequire(a);if(!h||"function"!=typeof h)throw lo.ExceptionFactory.createAssertionError("Game#_handleLoad: ".concat(a," has no-exported function."));h()}if(this._mainFunc)this._mainFunc(this._runtimeValueBase,this._mainParameter||{});else{if(!this._main)throw lo.ExceptionFactory.createAssertionError("Game#_handleLoad: does not have an entry point");var u=this._moduleManager._internalRequire(this._main);if(!u||"function"!=typeof u)throw lo.ExceptionFactory.createAssertionError("Game#_handleLoad: Entry point ".concat(this._main," not found."));u(this._mainParameter)}this._flushPostTickTasks(),this._onStart.fire()},t.prototype._doPushScene=function(t,e,r){var i=this.scenes;if(!e)for(;i.length>0&&i[i.length-1]instanceof po.LoadingScene;){i.pop()._clearTargetScene()}if(r||(r=this.loadingScene||this._defaultLoadingScene),i.push(t),t._needsLoading()&&"loaded-fired"!==t._loadingState){if(this._defaultLoadingScene._needsLoading())throw lo.ExceptionFactory.createAssertionError("Game#_doPushScene: _defaultLoadingScene must not depend on any assets.");this._doPushScene(r,!0,this._defaultLoadingScene),r.reset(t)}else this.onSceneChange.fire(t),this._onSceneChange.fire(t),t._loaded||(t._load(),this._pushPostTickTask(t._fireLoaded,t));this._modified=!0},t.prototype._createPreparingLoadingScene=function(t,e,r){var i=this;t._waitingPrepare=e;var n=new po.LoadingScene({game:this,explicitEnd:!0,name:r});return n.onTargetReady.addOnce((function(){var e=t._waitingPrepare;t._waitingPrepare=void 0,e?e((function(){i._isTerminated||n.end()})):i._pushPostTickTask(n.end,n)})),n},t.prototype._cleanDB=function(){this.db.clean(),this._localDb.clean()},t}();no.Game=Ao,function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),i=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.PathUtil=e.VideoSystem=e.ShaderProgram=e.Module=e.AudioSystem=void 0,i(A,e),i(b,e),i(O,e);var n=_t;Object.defineProperty(e,"AudioSystem",{enumerable:!0,get:function(){return n.AudioSystem}});var o=Ct;Object.defineProperty(e,"Module",{enumerable:!0,get:function(){return o.Module}});var s=jt;Object.defineProperty(e,"ShaderProgram",{enumerable:!0,get:function(){return s.ShaderProgram}});var a=Ut;Object.defineProperty(e,"VideoSystem",{enumerable:!0,get:function(){return a.VideoSystem}});var h=It;Object.defineProperty(e,"PathUtil",{enumerable:!0,get:function(){return h.PathUtil}}),i(Bt,e),i(Nt,e),i(xe,e),i(Oe,e),i(Be,e),i(Ye,e),i(ke,e),i(Ze,e),i(tr,e),i(er,e),i(nr,e),i(or,e),i(Er,e),i(yt,e),i(_t,e),i(Or,e),i(Rr,e),i(Dr,e),i(Wr,e),i(Vr,e),i(qr,e),i(Zr,e),i(ki,e),i(Di,e),i(ji,e),i(Zi,e),i(Wt,e),i(Qi,e),i(on,e),i(sn,e),i(an,e),i(hn,e),i(Tt,e),i(jr,e),i(un,e),i(cn,e),i(ni,e),i(ln,e),i(re,e),i(Ct,e),i(dn,e),i(xn,e),i(ne,e),i(En,e),i(On,e),i(Cn,e),i(In,e),i(Fn,e),i(Dn,e),i(Gn,e),i(Hn,e),i(Bn,e),i(pn,e),i(_n,e),i(jt,e),i(Nn,e),i(Wn,e),i(Ui,e),i(Gi,e),i(Hi,e),i(qn,e),i(Me,e),i(Ne,e),i(Yn,e),i(Kn,e),i($n,e),i(ai,e),i(si,e),i(he,e),i(Ut,e),i(At,e),i(Jn,e),i(Qn,e),i(oi,e),i(no,e)}(T);var wo={};Object.defineProperty(wo,"__esModule",{value:!0}),function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),i=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(T,e),i(wo,e)}(m);var So=m;Object.defineProperty(v,"__esModule",{value:!0}),v.SimpleProfiler=void 0;var xo=So,bo=function(){function t(e){var r;this._startTime=0,this._beforeFlushTime=0,this._beforeTimes=[],this._values=[],this._calculateProfilerValueTrigger=new xo.Trigger,this._interval=null!==(r=e.interval)&&void 0!==r?r:t.DEFAULT_INTERVAL,null!=e.limit?this._limit=e.limit>=t.DEFAULT_LIMIT?e.limit:t.DEFAULT_LIMIT:this._limit=t.DEFAULT_LIMIT,e.getValueHandler&&this._calculateProfilerValueTrigger.add(e.getValueHandler,e.getValueHandlerOwner),this._reset()}return t.prototype.time=function(t){this._beforeTimes[t]=this._getCurrentTime()},t.prototype.timeEnd=function(t){var e=this._getCurrentTime(),r=null!=this._beforeTimes[t]?e-this._beforeTimes[t]:0;this._values[t].push({time:e,value:r})},t.prototype.flush=function(){var e=this._getCurrentTime();if(0===this._beforeFlushTime&&(this._beforeFlushTime=e),this._beforeFlushTime+this._interval<e&&(this._calculateProfilerValueTrigger.fire(this.getProfilerValue(this._interval)),this._beforeFlushTime=e),this._values[1].length>this._limit)for(var r in this._values)this._values.hasOwnProperty(r)&&(this._values[r]=this._values[r].slice(-t.BACKUP_MARGIN))},t.prototype.setValue=function(t,e){this._values[t].push({time:this._getCurrentTime(),value:e})},t.prototype.getProfilerValue=function(t){var e=this._calculateProfilerValue(1,t);return{skippedFrameCount:this._calculateProfilerValue(0,t),rawFrameInterval:e,framePerSecond:{ave:1e3/e.ave,max:1e3/e.min,min:1e3/e.max},frameTime:this._calculateProfilerValue(2,t),renderingTime:this._calculateProfilerValue(3,t)}},t.prototype._reset=function(){this._startTime=this._getCurrentTime(),this._beforeFlushTime=0,this._beforeTimes=[],this._beforeTimes[1]=0,this._beforeTimes[2]=0,this._beforeTimes[3]=0,this._beforeTimes[0]=0,this._values=[],this._values[1]=[],this._values[2]=[],this._values[3]=[],this._values[0]=[]},t.prototype._calculateProfilerValue=function(t,e){for(var r=this._getCurrentTime()-e,i=0,n=0,o=0,s=Number.MAX_VALUE,a=this._values[t].length-1;a>=0&&!(0<n&&this._values[t][a].time<r);--a){var h=this._values[t][a].value;o<h&&(o=h),h<s&&(s=h),i+=h,++n}return{ave:i/n,max:o,min:s}},t.prototype._getCurrentTime=function(){return+new Date},t.DEFAULT_INTERVAL=1e3,t.DEFAULT_LIMIT=1e3,t.BACKUP_MARGIN=100,t}();v.SimpleProfiler=bo;var Po,Eo={};Object.defineProperty(Eo,"__esModule",{value:!0}),function(t){t[t.Active=0]="Active",t[t.Passive=1]="Passive"}(Po||(Po={})),Eo.default=Po;var Oo={},ko=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Oo,"__esModule",{value:!0}),Oo.Game=void 0;var Mo=So,Lo=function(t){function e(e){var r=t.call(this,e)||this;return r.agePassedTrigger=new Mo.Trigger,r.targetTimeReachedTrigger=new Mo.Trigger,r.skippingChangedTrigger=new Mo.Trigger,r.abortTrigger=new Mo.Trigger,r._notifyPassedAgeTable=Object.create(null),r._notifiesTargetTimeReached=!1,r._isSkipAware=!1,r.player=e.player,r.rawHandlerSet=e.handlerSet,r._gameArgs=e.gameArgs,r._globalGameArgs=e.globalGameArgs,r.skippingChangedTrigger.add(r._onSkippingChanged,r),r}return ko(e,t),e.prototype.requestNotifyAgePassed=function(t){this._notifyPassedAgeTable[t]=!0},e.prototype.cancelNotifyAgePassed=function(t){delete this._notifyPassedAgeTable[t]},e.prototype.requestNotifyTargetTimeReached=function(){this._notifiesTargetTimeReached=!0},e.prototype.cancelNofityTargetTimeReached=function(){this._notifiesTargetTimeReached=!1},e.prototype.fireAgePassedIfNeeded=function(){var t=this.age-1;return!!this._notifyPassedAgeTable[t]&&(delete this._notifyPassedAgeTable[t],this.agePassedTrigger.fire(t),!0)},e.prototype.getIsSkipAware=function(){return this._isSkipAware},e.prototype.setIsSkipAware=function(t){this._isSkipAware=t},e.prototype._destroy=function(){this.agePassedTrigger.destroy(),this.agePassedTrigger=null,this.targetTimeReachedTrigger.destroy(),this.targetTimeReachedTrigger=null,this.skippingChangedTrigger.destroy(),this.skippingChangedTrigger=null,this.abortTrigger.destroy(),this.abortTrigger=null,this.player=null,this.rawHandlerSet=null,this._notifyPassedAgeTable=null,this._gameArgs=null,this._globalGameArgs=null,t.prototype._destroy.call(this)},e.prototype._restartWithSnapshot=function(t){var e=t.data;null!=e.seed?(this._reset({age:t.frame,randSeed:e.seed}),this._loadAndStart({args:this._gameArgs,globalArgs:this._globalGameArgs})):(this._reset({age:t.frame,nextEntityId:e.nextEntityId,randGenSer:e.randGenSer}),this._loadAndStart({args:this._gameArgs,snapshot:e.gameSnapshot}))},e.prototype._abortGame=function(){this.abortTrigger.fire()},e.prototype._onRawTargetTimeReached=function(t){this._notifiesTargetTimeReached&&(this._notifiesTargetTimeReached=!1,this.targetTimeReachedTrigger.fire(t))},e.prototype._onSkippingChanged=function(t){this._isSkipAware&&this.onSkipChange.fire(t)},e}(Mo.Game);Oo.Game=Lo;var Ro,Co={},Io={},Fo={};Object.defineProperty(Fo,"__esModule",{value:!0}),Fo.PathUtil=void 0,function(t){t.resolvePath=function(e,r){function i(t){var e=t.split("/");return""===e[e.length-1]&&e.pop(),e}if(""===r)return e;for(var n=t.splitPath(e),o=i(n.path).concat(i(r)),s=[],a=0;a<o.length;++a){var h=o[a];switch(h){case"..":var u=s.pop();if(void 0===u||""===u||"."===u)throw new Error("PathUtil.resolvePath: invalid arguments");break;case".":0===s.length&&s.push(".");break;case"":s=[""];break;default:s.push(h)}}return n.host+s.join("/")},t.resolveDirname=function(t){var e=t.lastIndexOf("/");return-1===e?t:t.substr(0,e)},t.resolveExtname=function(t){for(var e=t.length-1;e>=0;--e){var r=t.charAt(e);if("."===r)return t.substr(e);if("/"===r)return""}return""},t.makeNodeModulePaths=function(e){var r=t.splitPath(e),i=r.host;"/"===(e=r.path)[e.length-1]&&(e=e.slice(0,e.length-1));for(var n=e.split("/"),o=n.indexOf("node_modules"),s=o>0?o-1:0,a=[],h=n.length-1;h>=s;--h)if("node_modules"!==n[h]){var u=n.slice(0,h+1);u.push("node_modules");var c=u.join("/");a.push(i+c)}return a},t.splitPath=function(t){var e="",r=t.indexOf("//");if(r>=0){var i=t.indexOf("/",r+2);i>=0?(e=t.slice(0,i),t=t.slice(i)):(e=t,t="/")}else e="";return{host:e,path:t}}}(Ro||(Fo.PathUtil=Ro={}));var Do={};Object.defineProperty(Do,"__esModule",{value:!0});var jo={},Go=t&&t.__assign||function(){return Go=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},Go.apply(this,arguments)};Object.defineProperty(jo,"__esModule",{value:!0}),jo._mergeObject=jo.toAssetArray=jo.makeLoadConfigurationFunc=void 0;var Uo=Fo;function Ho(t,e){for(var r=Object.keys(e),i=0,o=r.length;i<o;++i){var s=r[i],a=e[s],h=n(a);if(h===n(t[s]))if("string"===h||"number"===h||"boolean"===h)t[s]=a;else{if("object"!==h)throw new Error("_mergeObject(): unknown type");null==a?t[s]=a:Array.isArray(a)?t[s]=t[s].concat(a):Ho(t[s],a)}else t[s]=a}return t}jo.makeLoadConfigurationFunc=function(t){function e(e,i,o,s){t(e,(function(t,a){if(t)s(t);else if("definitions"in a){var h=a.definitions.map((function(t){return"string"==typeof t?r(o?Uo.PathUtil.resolvePath(o,t):t,void 0,o):r(o?Uo.PathUtil.resolvePath(o,t.url):t.url,t.basePath,o)}));Promise.all(h).then((function(t){return s(null,t.reduce(Ho))})).catch((function(t){return s(t)}))}else{var u=void 0;try{u=function(t,e){var r,i={};function o(t,e){if(i.hasOwnProperty(t))throw new Error("_normalizeAssets: asset ID already exists: "+t);i[t]=e}if(Array.isArray(t.assets))t.assets.forEach((function(t){var r,i=t.path;i&&(t.virtualPath=null!==(r=t.virtualPath)&&void 0!==r?r:t.path,t.path=Uo.PathUtil.resolvePath(e,i)),o(i,t)}));else if("object"===n(t.assets))for(var s in t.assets)if(t.assets.hasOwnProperty(s)){var a=t.assets[s];a.path&&(a.virtualPath=null!==(r=a.virtualPath)&&void 0!==r?r:a.path,a.path=Uo.PathUtil.resolvePath(e,a.path)),o(s,a)}t.globalScripts&&(t.globalScripts.forEach((function(t){o(t,{type:/\.json$/i.test(t)?"text":"script",virtualPath:t,path:Uo.PathUtil.resolvePath(e,t),global:!0})})),delete t.globalScripts);return t.assets=i,t}(a,null!=i?i:Uo.PathUtil.resolveDirname(e))}catch(t){return void s(t)}s(null,u)}}))}function r(t,r,i){return new Promise((function(n,o){e(t,r,i,(function(t,e){return t?o(t):n(e)}))}))}return e},jo.toAssetArray=function(t){return Object.keys(t).map((function(e){return Go({id:e},t[e])}))},jo._mergeObject=Ho,function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),i=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),i(Fo,e),i(Do,e),i(jo,e)}(Io);var Bo={};Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.EventBuffer=void 0;var No=function(){function t(e){var r=this;this._discardsEventsDuringSkip=!0,this._discardsLocalEventsDuringSkip=!0,this._filters=null,this._amflow=e.amflow,this._isLocalReceiver=!0,this._isReceiver=!1,this._isSender=!1,this._isDiscarder=!1,this._skipping=!1,this._defaultEventPriority=0,this._buffer=[],this._joinLeaveBuffer=[],this._localBuffer=[],this._filters=null,this._filterController={processNext:function(e){t.isEventLocal(e)?r._unfilteredLocalEvents.push(e):r._unfilteredEvents.push(e)}},this._unfilteredLocalEvents=[],this._unfilteredEvents=[],this._resolvePointEvent_bound=e.game.resolvePointEvent.bind(e.game),this._onEvent_bound=this.onEvent.bind(this)}return t.isEventLocal=function(t){switch(t[0]){case 0:case 3:case 64:return t[5];case 1:return t[3];case 2:case 32:return t[4];case 33:return t[8];case 34:case 35:return t[12];default:throw new Error("EventBuffer.isEventLocal")}},t.prototype.setMode=function(t){null!=t.isLocalReceiver&&(this._isLocalReceiver=t.isLocalReceiver),null!=t.isReceiver&&this._isReceiver!==t.isReceiver&&(this._isReceiver=t.isReceiver,t.isReceiver?this._amflow.onEvent(this._onEvent_bound):this._amflow.offEvent(this._onEvent_bound)),null!=t.isSender&&(this._isSender=t.isSender),null!=t.isDiscarder&&(this._isDiscarder=t.isDiscarder),null!=t.defaultEventPriority&&(this._defaultEventPriority=3&t.defaultEventPriority)},t.prototype.getMode=function(){return{isLocalReceiver:this._isLocalReceiver,isReceiver:this._isReceiver,isSender:this._isSender,isDiscarder:this._isDiscarder,defaultEventPriority:this._defaultEventPriority}},t.prototype.onEvent=function(e){t.isEventLocal(e)?!this._isLocalReceiver||this._isDiscarder||this._skipping&&this._discardsLocalEventsDuringSkip||this._unfilteredLocalEvents.push(e):this._skipping&&this._discardsEventsDuringSkip||(this._isReceiver&&!this._isDiscarder&&this._unfilteredEvents.push(e),this._isSender&&(null==e[1]&&(e[1]=3&this._defaultEventPriority),this._amflow.sendEvent(e)))},t.prototype.onPointEvent=function(t){var e=this._resolvePointEvent_bound(t);e&&this.onEvent(e)},t.prototype.addEventDirect=function(e){if(t.isEventLocal(e)){if(!this._isLocalReceiver||this._isDiscarder)return;this._localBuffer.push(e)}else this._isReceiver&&!this._isDiscarder&&(0===e[0]||1===e[0]?this._joinLeaveBuffer.push(e):this._buffer.push(e)),this._isSender&&(null==e[1]&&(e[1]=3&this._defaultEventPriority),this._amflow.sendEvent(e))},t.prototype.readEvents=function(){var t=this._buffer;return 0===t.length?null:(this._buffer=[],t)},t.prototype.readJoinLeaves=function(){var t=this._joinLeaveBuffer;return 0===t.length?null:(this._joinLeaveBuffer=[],t)},t.prototype.readLocalEvents=function(){var t=this._localBuffer;return 0===t.length?null:(this._localBuffer=[],t)},t.prototype.addFilter=function(t,e){this._filters||(this._filters=[]),this._filters.push({func:t,handleEmpty:!!e})},t.prototype.removeFilter=function(t){if(this._filters)if(t)for(var e=this._filters.length-1;e>=0;--e)this._filters[e].func===t&&this._filters.splice(e,1);else this._filters=null},t.prototype.processEvents=function(e){var r=this._unfilteredLocalEvents,i=this._unfilteredEvents;this._unfilteredLocalEvents=[];var n=r;if(!e&&i.length>0&&(n=n.length>0?n.concat(i):i,this._unfilteredEvents=[]),this._filters)for(var o=0;o<this._filters.length;++o){var s=this._filters[o];(n.length>0||s.handleEmpty)&&(n=this._filters[o].func(n,this._filterController)||[])}for(o=0;o<n.length;++o){var a=n[o];t.isEventLocal(a)?this._localBuffer.push(a):0===a[0]||1===a[0]?this._joinLeaveBuffer.push(a):this._buffer.push(a)}},t.prototype.startSkipping=function(){this._skipping=!0},t.prototype.endSkipping=function(){this._skipping=!1},t}();Bo.EventBuffer=No;var Wo={};Object.defineProperty(Wo,"__esModule",{value:!0}),Wo.GameHandlerSet=void 0;var Vo=So,Xo=function(){function t(t){this.raiseEventTrigger=new Vo.Trigger,this.raiseTickTrigger=new Vo.Trigger,this.snapshotTrigger=new Vo.Trigger,this.changeSceneModeTrigger=new Vo.Trigger,this._getCurrentTimeFunc=null,this._eventFilterFuncs=null,this._local=null,this._tickGenerationMode=null,this.isSnapshotSaver=!!t.isSnapshotSaver}return t.prototype.setCurrentTimeFunc=function(t){this._getCurrentTimeFunc=t},t.prototype.setEventFilterFuncs=function(t){this._eventFilterFuncs=t},t.prototype.removeAllEventFilters=function(){this._eventFilterFuncs&&this._eventFilterFuncs.removeFilter()},t.prototype.changeSceneMode=function(t){this._local=t.local,this._tickGenerationMode=t.tickGenerationMode,this.changeSceneModeTrigger.fire(t)},t.prototype.getCurrentTime=function(){return Math.floor(this._getCurrentTimeFunc())},t.prototype.raiseEvent=function(t){this.raiseEventTrigger.fire(t)},t.prototype.raiseTick=function(t){this.raiseTickTrigger.fire(t)},t.prototype.addEventFilter=function(t,e){this._eventFilterFuncs&&this._eventFilterFuncs.addFilter(t,e)},t.prototype.removeEventFilter=function(t){this._eventFilterFuncs&&t&&this._eventFilterFuncs.removeFilter(t)},t.prototype.shouldSaveSnapshot=function(){return this.isSnapshotSaver},t.prototype.getInstanceType=function(){return this.shouldSaveSnapshot()?"active":"passive"},t.prototype.saveSnapshot=function(t,e,r,i,n){void 0===n&&(n=this._getCurrentTimeFunc()),this.shouldSaveSnapshot()&&this.snapshotTrigger.fire({frame:t,timestamp:n,data:{randGenSer:r,nextEntityId:i,gameSnapshot:e}})},t}();Wo.GameHandlerSet=Xo;var zo={},qo={};Object.defineProperty(qo,"__esModule",{value:!0}),qo.Clock=void 0;var Yo=So,Ko=function(){function t(e){this.fps=e.fps,this.scaleFactor=e.scaleFactor||1,this.frameTrigger=new Yo.Trigger,this.rawFrameTrigger=new Yo.Trigger,this._platform=e.platform,this._maxFramePerOnce=e.maxFramePerOnce,this._deltaTimeBrokenThreshold=e.deltaTimeBrokenThreshold||t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD,e.frameHandler&&this.frameTrigger.add(e.frameHandler,e.frameHandlerOwner),this.running=!1,this._totalDeltaTime=0,this._onLooperCall_bound=this._onLooperCall.bind(this),this._looper=this._platform.createLooper(this._onLooperCall_bound),this._waitTime=0,this._waitTimeDoubled=0,this._waitTimeMax=0,this._skipFrameWaitTime=0,this._realMaxFramePerOnce=0}return t.prototype.start=function(){this.running||(this._totalDeltaTime=0,this._updateWaitTimes(this.fps,this.scaleFactor),this._looper.start(),this.running=!0)},t.prototype.stop=function(){this.running&&(this._looper.stop(),this.running=!1)},t.prototype.changeScaleFactor=function(t){this.running?(this.stop(),this.scaleFactor=t,this.start()):this.scaleFactor=t},t.prototype._onLooperCall=function(t){isNaN(t)&&(t=this._waitTime-this._totalDeltaTime);var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var r=this._totalDeltaTime;if((r+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=r,this._waitTime-r;for(var i=r<this._waitTimeDoubled?1:r>this._waitTimeMax?this._realMaxFramePerOnce:r/this._waitTime|0,n=i,o={deltaTime:e,interrupt:!1};n>0&&this.running&&!o.interrupt;)--n,this.frameTrigger.fire(o),o.deltaTime=0;return r-=(i-n)*this._waitTime,this.rawFrameTrigger.fire(),this._totalDeltaTime=r,this._waitTime-r},t.prototype._updateWaitTimes=function(e,r){var i=e*r;this._waitTime=1e3/i,this._waitTimeDoubled=Math.max(2e3/i|0,1),this._waitTimeMax=Math.max(r*(1e3*this._maxFramePerOnce/i)|0,1),this._skipFrameWaitTime=this._waitTime*t.ANTICIPATE_RATE|0,this._realMaxFramePerOnce=this._maxFramePerOnce*r},t.ANTICIPATE_RATE=.8,t.DEFAULT_DELTA_TIME_BROKEN_THRESHOLD=150,t}();qo.Clock=Ko;var $o,Jo={};Object.defineProperty(Jo,"__esModule",{value:!0}),function(t){t[t.Realtime=0]="Realtime",t[t.Replay=1]="Replay",t[t.FrameByFrame=2]="FrameByFrame"}($o||($o={})),Jo.default=$o;var Zo,Qo={};Object.defineProperty(Qo,"__esModule",{value:!0}),function(t){t[t.AfterRawFrame=0]="AfterRawFrame",t[t.None=1]="None"}(Zo||(Zo={})),Qo.default=Zo;var ts={},es=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ts,"__esModule",{value:!0}),ts.ProfilerClock=void 0;var rs=function(t){function e(e){var r=t.call(this,e)||this;return r._profiler=e.profiler,r}return es(e,t),e.prototype._onLooperCall=function(t){var e=t;if(t<=0)return this._waitTime-this._totalDeltaTime;t>this._deltaTimeBrokenThreshold&&(t=this._waitTime);var r=this._totalDeltaTime;if((r+=t)<=this._skipFrameWaitTime)return this._totalDeltaTime=r,this._waitTime-r;this._profiler.timeEnd(1),this._profiler.time(1);var i=r<this._waitTimeDoubled?1:r>this._waitTimeMax?this._realMaxFramePerOnce:r/this._waitTime|0,n=i,o={deltaTime:e,interrupt:!1};for(this._profiler.setValue(0,n-1);n>0&&this.running&&!o.interrupt;)--n,this._profiler.time(2),this.frameTrigger.fire(o),this._profiler.timeEnd(2),o.deltaTime=0;return r-=(i-n)*this._waitTime,this._profiler.time(3),this.rawFrameTrigger.fire(),this._profiler.timeEnd(3),this._totalDeltaTime=r,this._profiler.flush(),this._waitTime-r},e}(qo.Clock);ts.ProfilerClock=rs;var is={},ns={};Object.defineProperty(ns,"__esModule",{value:!0}),ns.TickBuffer=void 0;var os=So,ss=Eo;os.EventIndex;var as=function(){function t(e){this.currentAge=0,this.knownLatestAge=-1,this.gotNextTickTrigger=new os.Trigger,this.gotNoTickTrigger=new os.Trigger,this._receiving=!1,this._skipping=!1,this._tickRanges=[],this._nextTickTimeCache=null,this._amflow=e.amflow,this._prefetchThreshold=e.prefetchThreshold||t.DEFAULT_PREFETCH_THRESHOLD,this._sizeRequestOnce=e.sizeRequestOnce||t.DEFAULT_SIZE_REQUEST_ONCE,this._executionMode=e.executionMode,this._startedAt=e.startedAt||0,this._oldTimestampThreshold=null!=e.startedAt?e.startedAt-864e6:0,this._nearestAbsentAge=this.currentAge,this._addTick_bound=this.addTick.bind(this),this._onTicks_bound=this._onTicks.bind(this)}return t.prototype.start=function(){this._receiving=!0,this._updateAmflowReceiveState()},t.prototype.stop=function(){this._receiving=!1,this._updateAmflowReceiveState()},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._dropUntil(this.knownLatestAge+1),this.knownLatestAge=this.currentAge,this._nextTickTimeCache=null,this._nearestAbsentAge=this.currentAge,this._executionMode=t,this._updateAmflowReceiveState())},t.prototype.setCurrentAge=function(t){this._dropUntil(t),this._nextTickTimeCache=null,this.currentAge=t,this.knownLatestAge<t-1&&(this.knownLatestAge=t-1),this._nearestAbsentAge=this._findNearestAbscentAge(t)},t.prototype.startSkipping=function(){this._skipping=!0},t.prototype.endSkipping=function(){this._skipping=!1},t.prototype.hasNextTick=function(){return this.currentAge!==this._nearestAbsentAge},t.prototype.consume=function(){if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];return t===e.start?(this._nextTickTimeCache=null,++this.currentAge,++e.start,t+this._prefetchThreshold===this._nearestAbsentAge&&this.requestTicks(this._nearestAbsentAge,this._sizeRequestOnce),e.start===e.end&&this._tickRanges.shift(),e.ticks.length>0&&e.ticks[0][0]===t?e.ticks.shift():t):(this._dropUntil(this.currentAge),this.consume())},t.prototype.readNextTickTime=function(){if(null!=this._nextTickTimeCache)return this._nextTickTimeCache;if(this.currentAge===this._nearestAbsentAge)return null;var t=this.currentAge,e=this._tickRanges[0];if(t===e.start){if(0===e.ticks.length)return null;var r=e.ticks[0];if(r[0]!==t)return null;var i=r[1];if(!i)return null;for(var n=0;n<i.length;++n)if(2===i[n][0]){var o=i[n][3];return o<this._oldTimestampThreshold&&(o+=this._startedAt),this._nextTickTimeCache=o,o}return null}return this._dropUntil(this.currentAge),this.readNextTickTime()},t.prototype.isKnownLatestTickTimeNear=function(t,e,r){return this._calcKnownLatestTickTimeDelta(t,e,r)<t},t.prototype.requestTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._skipping?this.requestNonIgnorableTicks(t,e):this.requestAllTicks(t,e)},t.prototype.requestAllTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===ss.default.Passive&&("undefined"==typeof window||window.prompt!==window.confirm?this._amflow.getTickList({begin:t,end:t+e},this._onTicks_bound):this._amflow.getTickList(t,t+e,this._onTicks_bound))},t.prototype.requestNonIgnorableTicks=function(t,e){void 0===t&&(t=this.currentAge),void 0===e&&(e=this._sizeRequestOnce),this._executionMode===ss.default.Passive&&("undefined"==typeof window||window.prompt!==window.confirm?this._amflow.getTickList({begin:t,end:t+e,excludeEventFlags:{ignorable:!0}},this._onTicks_bound):this._amflow.getTickList(t,t+e,this._onTicks_bound))},t.prototype.addTick=function(t){var e=t[0],r=this.currentAge===e&&this._nearestAbsentAge===e;this.knownLatestAge<e&&(this.knownLatestAge=e);for(var i=this._tickRanges.length-1;i>=0;--i){if(e>=(n=this._tickRanges[i]).start)break}var n,o=this._tickRanges[i+1];i<0?this._tickRanges.unshift(this._createTickRangeFromTick(t)):e===(n=this._tickRanges[i]).end?(++n.end,t[1]&&n.ticks.push(t)):e>n.end&&this._tickRanges.splice(i+1,0,this._createTickRangeFromTick(t));this._nearestAbsentAge===e&&(++this._nearestAbsentAge,o&&this._nearestAbsentAge===o.start&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge))),r&&this.gotNextTickTrigger.fire()},t.prototype.addTickList=function(t){var e=t[0],r=t[1]+1,i=t[2],n=e,o=r;this.knownLatestAge<r-1&&(this.knownLatestAge=r-1);var s=0,a=this._tickRanges.length;for(s=0;s<a;++s){var h=this._tickRanges[s];if(e<h.start)break}var u=s;if(s>0){--s;var c=this._tickRanges[s].end;e<c&&(e=c)}for(;s<a;++s){h=this._tickRanges[s];if(r<=h.end)break}if(s<a){var l=this._tickRanges[s].start;r>l&&(r=l)}if(e>=r)return{start:e,end:e,ticks:[]};i||(i=[]),n===e&&o===r||(i=i.filter((function(t){var i=t[0];return e<=i&&i<r})));var d={start:e,end:r,ticks:i},p=Math.max(0,s-u);return this._tickRanges.splice(u,p,d),e<=this._nearestAbsentAge&&this._nearestAbsentAge<r&&(this._nearestAbsentAge=this._findNearestAbscentAge(this._nearestAbsentAge)),d},t.prototype.dropAll=function(){this._tickRanges=[],this._nearestAbsentAge=this.currentAge,this._nextTickTimeCache=null},t.prototype._updateAmflowReceiveState=function(){this._receiving&&this._executionMode===ss.default.Passive?this._amflow.onTick(this._addTick_bound):this._amflow.offTick(this._addTick_bound)},t.prototype._onTicks=function(t,e){if(t)throw t;if(e){var r=this.currentAge===this._nearestAbsentAge,i=this.addTickList(e);r&&i.start<=this.currentAge&&this.currentAge<i.end&&this.gotNextTickTrigger.fire(),i.start===i.end&&this.gotNoTickTrigger.fire()}else this.gotNoTickTrigger.fire()},t.prototype._findNearestAbscentAge=function(t){for(var e=0,r=this._tickRanges.length;e<r&&!(t<=this._tickRanges[e].end);++e);for(;e<r;++e){var i=this._tickRanges[e];if(t<i.start)break;t=i.end}return t},t.prototype._dropUntil=function(t){var e;for(e=0;e<this._tickRanges.length&&!(t<this._tickRanges[e].end);++e);if(this._tickRanges=this._tickRanges.slice(e),0!==this._tickRanges.length){var r=this._tickRanges[0];if(!(t<r.start)){for(r.start=t,e=0;e<r.ticks.length&&!(t<=r.ticks[e][0]);++e);r.ticks=r.ticks.slice(e)}}},t.prototype._calcKnownLatestTickTimeDelta=function(t,e,r){var i=this._tickRanges;if(0===i.length)return 0;for(var n=0,o=i[i.length-1].end,s=o,a=i.length-1;a>=0;--a){var h=i[a];if(h.end!==o)return 1/0;o=h.start;for(var u=h.ticks,c=u.length-1;c>=0;--c){var l=u[c],d=l[1];if(d){var p=l[0];if((n+=(s-p)*r)>t)return t;s=p;for(var f=0;f<d.length;++f)if(2===d[f][0]){var _=d[f][3]-e+n;return Math.min(_,t)}}}}return n+=(s-i[0].start)*r,Math.min(n,t)},t.prototype._createTickRangeFromTick=function(t){var e=t[0],r={start:e,end:e+1,ticks:[]};return t[1]&&r.ticks.push(t),r},t.DEFAULT_PREFETCH_THRESHOLD=1800,t.DEFAULT_SIZE_REQUEST_ONCE=9e3,t}();ns.TickBuffer=as;var hs={};Object.defineProperty(hs,"__esModule",{value:!0}),hs.TickGenerator=void 0;var us=So,cs=function(){function t(t){this.tickTrigger=new us.Trigger,this.errorTrigger=new us.Trigger,this._nextAge=0,this._generatingTick=!1,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._eventBuffer=t.eventBuffer}return t.prototype.next=function(){if(this._generatingTick){var t=this._eventBuffer.readEvents(),e=this._eventBuffer.readJoinLeaves(),r=t&&e?t.concat(e):null!=t?t:e;this.tickTrigger.fire([this._nextAge++,r])}},t.prototype.forceNext=function(){var t=this._generatingTick;this._generatingTick=!0,this.next(),this._generatingTick=t},t.prototype.startStopGenerate=function(t){this._generatingTick=t},t.prototype.startTick=function(){this._generatingTick=!0},t.prototype.stopTick=function(){this._generatingTick=!1},t.prototype.setNextAge=function(t){this._nextAge=t},t}();hs.TickGenerator=cs,Object.defineProperty(is,"__esModule",{value:!0}),is.TickController=void 0;var ls=So,ds=Eo,ps=ns,fs=hs,_s=function(){function t(t){this.errorTrigger=new ls.Trigger,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._amflow=t.amflow,this._clock=t.clock,this._started=!1,this._executionMode=t.executionMode,this._generator=new fs.TickGenerator({amflow:t.amflow,eventBuffer:t.eventBuffer,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._buffer=new ps.TickBuffer({amflow:t.amflow,executionMode:t.executionMode,startedAt:t.startedAt}),this._generator.tickTrigger.add(this._onTickGenerated,this),this._clock.frameTrigger.add(this._generator.next,this._generator)}return t.prototype.startTick=function(){this._started=!0,this._updateGeneratorState()},t.prototype.stopTick=function(){this._started=!1,this._updateGeneratorState()},t.prototype.startTickOnce=function(){this._started=!0,this._generator.tickTrigger.addOnce(this._stopTriggerOnTick,this),this._updateGeneratorState()},t.prototype.setNextAge=function(t){this._generator.setNextAge(t)},t.prototype.forceGenerateTick=function(){this._generator.forceNext()},t.prototype.getBuffer=function(){return this._buffer},t.prototype.setExecutionMode=function(t){this._executionMode!==t&&(this._executionMode=t,this._updateGeneratorState(),this._buffer.setExecutionMode(t))},t.prototype._stopTriggerOnTick=function(){this.stopTick()},t.prototype._updateGeneratorState=function(){var t=this._started&&this._executionMode===ds.default.Active;this._generator.startStopGenerate(t)},t.prototype._onTickGenerated=function(t){this._amflow.sendTick(t),this._buffer.addTick(t)},t}();is.TickController=_s,Object.defineProperty(zo,"__esModule",{value:!0}),zo.GameLoop=void 0;var ys=So,gs=qo,vs=i,ms=Eo,Ts=Jo,As=Qo,ws=ts,Ss=is;ys.EventIndex;var xs=function(){function t(t){this.errorTrigger=new ys.Trigger,this.rawTargetTimeReachedTrigger=new ys.Trigger,this.running=!1,this._omittedTickDuration=0,this._sceneTickMode=null,this._sceneLocalMode=null,this._waitingStartPoint=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._waitingNextTick=!1,this._foundLatestTick=!1,this._skipping=!1,this._lastPollingTickTime=0,this._events=[],this._currentTime=t.startedAt,this._currentTickTime=this._currentTime,this._frameTime=1e3/t.game.fps,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner);var e=t.configuration;this._startedAt=t.startedAt,this._targetTimeFunc=e.targetTimeFunc||null,this._targetTimeOffset=e.targetTimeOffset||null,this._originDate=e.originDate||null,this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,this._delayIgnoreThreshold=e.delayIgnoreThreshold||vs.DEFAULT_DELAY_IGNORE_THRESHOLD,this._skipTicksAtOnce=e.skipTicksAtOnce||vs.DEFAULT_SKIP_TICKS_AT_ONCE,this._skipThreshold=e.skipThreshold||vs.DEFAULT_SKIP_THRESHOLD,this._skipThresholdTime=this._skipThreshold*this._frameTime,this._jumpTryThreshold=e.jumpTryThreshold||vs.DEFAULT_JUMP_TRY_THRESHOLD,this._jumpIgnoreThreshold=e.jumpIgnoreThreshold||vs.DEFAULT_JUMP_IGNORE_THRESHOLD,this._pollingTickThreshold=e._pollingTickThreshold||vs.DEFAULT_POLLING_TICK_THRESHOLD,this._playbackRate=e.playbackRate||1;var r=null!=e.loopRenderMode?e.loopRenderMode:As.default.AfterRawFrame;this._loopRenderMode=null,this._omitInterpolatedTickOnReplay=null==e.omitInterpolatedTickOnReplay||e.omitInterpolatedTickOnReplay,this._loopMode=e.loopMode,this._amflow=t.amflow,this._game=t.game,this._eventBuffer=t.eventBuffer,this._executionMode=t.executionMode,this._targetAge=null!=e.targetAge?e.targetAge:null,t.profiler?this._clock=new ws.ProfilerClock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5,profiler:t.profiler}):this._clock=new gs.Clock({fps:t.game.fps,scaleFactor:this._playbackRate,platform:t.platform,maxFramePerOnce:5}),this._tickController=new Ss.TickController({amflow:t.amflow,clock:this._clock,eventBuffer:t.eventBuffer,executionMode:t.executionMode,startedAt:t.startedAt,errorHandler:this.errorTrigger.fire,errorHandlerOwner:this.errorTrigger}),this._tickBuffer=this._tickController.getBuffer(),this._onGotStartPoint_bound=this._onGotStartPoint.bind(this),this._setLoopRenderMode(r),this._game.setIsSkipAware(null==e.skipAwareGame||e.skipAwareGame),this._game.rawHandlerSet.raiseEventTrigger.add(this._onGameRaiseEvent,this),this._game.rawHandlerSet.raiseTickTrigger.add(this._onGameRaiseTick,this),this._game.rawHandlerSet.changeSceneModeTrigger.add(this._handleSceneChange,this),this._game._onStart.add(this._onGameStarted,this),this._tickBuffer.gotNextTickTrigger.add(this._onGotNextFrameTick,this),this._tickBuffer.gotNoTickTrigger.add(this._onGotNoTick,this),this._tickBuffer.start(),this._updateGameAudioSuppression()}return t.prototype.reset=function(t){this._clock.frameTrigger.remove(this._onEventsProcessed,this),this._skipping&&this._stopSkipping(),this._tickBuffer.setCurrentAge(t.frame),this._currentTime=t.timestamp||t.data.timestamp||0,this._currentTickTime=this._currentTime,this._waitingNextTick=!1,this._foundLatestTick=!1,this._lastRequestedStartPointAge=-1,this._lastRequestedStartPointTime=-1,this._omittedTickDuration=0,this._game._restartWithSnapshot(t)},t.prototype.start=function(){this.running=!0,this._clock.start()},t.prototype.stop=function(){this._clock.stop(),this.running=!1},t.prototype.setNextAge=function(t){this._tickController.setNextAge(t)},t.prototype.getExecutionMode=function(){return this._executionMode},t.prototype.setExecutionMode=function(t){this._executionMode=t,this._tickController.setExecutionMode(t)},t.prototype.getLoopConfiguration=function(){var t,e,r,i,n;return{loopMode:this._loopMode,delayIgnoreThreshold:this._delayIgnoreThreshold,skipTicksAtOnce:this._skipTicksAtOnce,skipThreshold:this._skipThreshold,skipAwareGame:this._game.getIsSkipAware(),jumpTryThreshold:this._jumpTryThreshold,jumpIgnoreThreshold:this._jumpIgnoreThreshold,playbackRate:this._playbackRate,loopRenderMode:null!==(t=this._loopRenderMode)&&void 0!==t?t:void 0,targetTimeFunc:null!==(e=this._targetTimeFunc)&&void 0!==e?e:void 0,targetTimeOffset:null!==(r=this._targetTimeOffset)&&void 0!==r?r:void 0,originDate:null!==(i=this._originDate)&&void 0!==i?i:void 0,omitInterpolatedTickOnReplay:this._omitInterpolatedTickOnReplay,targetAge:null!==(n=this._targetAge)&&void 0!==n?n:void 0}},t.prototype.setLoopConfiguration=function(t){null!=t.loopMode&&(this._loopMode=t.loopMode),null!=t.delayIgnoreThreshold&&(this._delayIgnoreThreshold=t.delayIgnoreThreshold),null!=t.skipTicksAtOnce&&(this._skipTicksAtOnce=t.skipTicksAtOnce),null!=t.skipThreshold&&(this._skipThreshold=t.skipThreshold,this._skipThresholdTime=this._skipThreshold*this._frameTime),null!=t.skipAwareGame&&this._game.setIsSkipAware(t.skipAwareGame),null!=t.jumpTryThreshold&&(this._jumpTryThreshold=t.jumpTryThreshold),null!=t.jumpIgnoreThreshold&&(this._jumpIgnoreThreshold=t.jumpIgnoreThreshold),null!=t.playbackRate&&(this._playbackRate=t.playbackRate,this._clock.changeScaleFactor(this._playbackRate),this._updateGameAudioSuppression()),null!=t.loopRenderMode&&this._setLoopRenderMode(t.loopRenderMode),null!=t.targetTimeFunc&&(this._targetTimeFunc=t.targetTimeFunc),null!=t.targetTimeOffset&&(this._targetTimeOffset=t.targetTimeOffset),null!=t.originDate&&(this._originDate=t.originDate),this._realTargetTimeOffset=null!=this._originDate?this._originDate:(this._targetTimeOffset||0)+this._startedAt,null!=t.omitInterpolatedTickOnReplay&&(this._omitInterpolatedTickOnReplay=t.omitInterpolatedTickOnReplay),null!=t.targetAge&&(this._targetAge!==t.targetAge&&(this._waitingNextTick=!1),this._targetAge=t.targetAge)},t.prototype.addTickList=function(t){this._tickBuffer.addTickList(t)},t.prototype.getCurrentTime=function(){return this._currentTime},t.prototype._startSkipping=function(t){this._skipping=!0,t||this._updateGameAudioSuppression(),this._tickBuffer.startSkipping(),this._eventBuffer.startSkipping(),this._game.skippingChangedTrigger.fire(!0)},t.prototype._stopSkipping=function(){this._skipping=!1,this._updateGameAudioSuppression(),this._tickBuffer.endSkipping(),this._eventBuffer.endSkipping(),this._game.skippingChangedTrigger.fire(!1)},t.prototype._updateGameAudioSuppression=function(){1!==(this._skipping?this._playbackRate*this._skipTicksAtOnce:this._playbackRate)?this._game._startSuppressAudio():this._game._endSuppressAudio()},t.prototype._handleSceneChange=function(t){var e=t.local,r=t.tickGenerationMode;if(this._sceneLocalMode!==e||this._sceneTickMode!==r)switch(this._sceneLocalMode=e,this._sceneTickMode=r,this._clock.frameTrigger.remove(this._onFrame,this),this._clock.frameTrigger.remove(this._onLocalFrame,this),e){case"full-local":this._tickController.stopTick(),this._clock.frameTrigger.add(this._onLocalFrame,this);break;case"non-local":case"interpolate-local":"by-clock"===r?this._tickController.startTick():this._tickController.startTickOnce(),this._clock.frameTrigger.add(this._onFrame,this);break;default:return void this.errorTrigger.fire(new Error("Unknown LocalTickMode: "+e))}},t.prototype._onLocalFrame=function(){this._doLocalTick()},t.prototype._doLocalTick=function(){var t=this._game,e=this._eventBuffer.readLocalEvents();this._currentTime+=this._frameTime,e?t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime),e):t.tick(!1,Math.floor(this._omittedTickDuration/this._frameTime)),this._omittedTickDuration=0},t.prototype._onFrame=function(t){if(this._loopMode===Ts.default.Replay&&this._targetTimeFunc){var e=this._targetTimeFunc(),r=e+this._realTargetTimeOffset,i=this._currentTickTime;this._onFrameForTimedReplay(r,t),i===this._currentTickTime&&i<=r&&this._isImmediateBeforeOf(r)&&this.rawTargetTimeReachedTrigger.fire(e)}else this._onFrameNormal(t)},t.prototype._onFrameForTimedReplay=function(t,e){var r,i,n,o=!1,s=this._game,a=(t-this._currentTickTime)/this._frameTime;if((a>this._jumpTryThreshold||a<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointTime<this._currentTickTime&&(this._waitingStartPoint=!0,this._lastRequestedStartPointTime=t,this._amflow.getStartPoint({timestamp:t},this._onGotStartPoint_bound)),a<=0)this._skipping&&this._stopSkipping();else{if(!this._skipping&&(a>this._skipThreshold||0===this._tickBuffer.currentAge)&&(this._tickBuffer.hasNextTick()||this._omitInterpolatedTickOnReplay&&this._foundLatestTick)){var h=a<=this._skipThreshold;this._startSkipping(h)}for(var u=0;u<this._skipTicksAtOnce;++u){var c=this._currentTime+this._frameTime;if(!this._tickBuffer.hasNextTick()){this._waitingNextTick||(this._startWaitingNextTick(),this._foundLatestTick||this._tickBuffer.requestNonIgnorableTicks()),this._omitInterpolatedTickOnReplay&&"interpolate-local"===this._sceneLocalMode&&(this._foundLatestTick&&(this._currentTime=t-this._frameTime),t>c&&this._doLocalTick());break}var l=null!==(n=this._tickBuffer.readNextTickTime())&&void 0!==n?n:this._currentTickTime+this._frameTime;if(t<=l&&t<=c)break;if(c<l){if(!this._omitInterpolatedTickOnReplay||!this._skipping){"interpolate-local"===this._sceneLocalMode&&this._doLocalTick();continue}if(t<=l){this._omittedTickDuration+=t-this._currentTickTime,this._currentTime=Math.floor(t/this._frameTime)*this._frameTime;break}c=l,this._omittedTickDuration+=l-this._currentTickTime}this._currentTime=c,this._currentTickTime=l;var d=this._tickBuffer.consume(),p=-1;if(this._events.length=0,null!=d){var f=this._eventBuffer.readLocalEvents();if(f&&(r=this._events).push.apply(r,f),"number"==typeof d)p=d,o=s.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events);else{p=d[0];var _=d[1];_&&(i=this._events).push.apply(i,_),o=s.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events)}}if(this._omittedTickDuration=0,s._notifyPassedAgeTable[p]&&s.fireAgePassedIfNeeded()){e.interrupt=!0;break}if(o)break}this._skipping&&t-this._currentTime<this._frameTime&&this._isImmediateBeforeOf(t)&&(this._stopSkipping(),this._tickBuffer.dropAll(),this._tickBuffer.requestTicks())}},t.prototype._onFrameNormal=function(t){var e,r,i=!1,n=this._game;if(!this._skipping&&t.deltaTime>this._skipThresholdTime&&(this._startSkipping(!1),this._waitingNextTick&&this._stopSkipping()),this._waitingNextTick)"interpolate-local"===this._sceneLocalMode&&this._doLocalTick();else{var o,s,a=this._tickBuffer.currentAge;if(this._loopMode===Ts.default.Realtime?s=(o=this._tickBuffer.knownLatestAge+1)-a:null===this._targetAge?(o=null,s=1):this._targetAge===a?(o=this._targetAge=null,s=1):s=(o=this._targetAge)-a,(s>this._jumpTryThreshold||s<0)&&!this._waitingStartPoint&&this._lastRequestedStartPointAge<a&&(this._waitingStartPoint=!0,this._lastRequestedStartPointAge=o,this._amflow.getStartPoint({frame:o},this._onGotStartPoint_bound)),s<=0)return 0===s&&(this._foundLatestTick||this._tickBuffer.requestNonIgnorableTicks(),this._startWaitingNextTick()),"interpolate-local"===this._sceneLocalMode&&this._doLocalTick(),void(this._skipping&&this._stopSkipping());if(!this._skipping&&(s>this._skipThreshold||0===a)&&this._tickBuffer.hasNextTick()){var h=0===a&&this._tickBuffer.isKnownLatestTickTimeNear(this._skipThresholdTime,this._currentTickTime,this._frameTime);this._startSkipping(h)}for(var u=!this._skipping&&s<=this._delayIgnoreThreshold?1:Math.min(s,this._skipTicksAtOnce),c=0;c<u;++c){var l=this._currentTime+this._frameTime,d=this._tickBuffer.readNextTickTime();if(null!=d&&l<d){if(!(this._loopMode===Ts.default.Realtime||this._omitInterpolatedTickOnReplay&&this._skipping)){if("interpolate-local"===this._sceneLocalMode){this._doLocalTick();continue}break}l=Math.ceil(d/this._frameTime)*this._frameTime,this._omittedTickDuration+=l-this._currentTickTime}this._currentTime=l,this._currentTickTime=null!=d?d:this._currentTickTime+this._frameTime;var p=this._tickBuffer.consume(),f=-1;if(this._events.length=0,null==p){this._tickBuffer.requestTicks(),this._startWaitingNextTick();break}var _=this._eventBuffer.readLocalEvents();if(_&&(e=this._events).push.apply(e,_),"number"==typeof p)f=p,i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events);else{f=p[0];var y=p[1];y&&(r=this._events).push.apply(r,y),i=n.tick(!0,Math.floor(this._omittedTickDuration/this._frameTime),this._events)}if(this._omittedTickDuration=0,n._notifyPassedAgeTable[f]&&n.fireAgePassedIfNeeded()){t.interrupt=!0;break}if(i)break}this._skipping&&o-this._tickBuffer.currentAge<1&&this._stopSkipping()}},t.prototype._onGotNextFrameTick=function(){this._waitingNextTick&&this._loopMode!==Ts.default.FrameByFrame&&this._stopWaitingNextTick()},t.prototype._onGotNoTick=function(){this._waitingNextTick&&(this._foundLatestTick=!0)},t.prototype._onGotStartPoint=function(t,e){if(this._waitingStartPoint=!1,t)this.errorTrigger.fire(t);else if(e){if(this._targetTimeFunc&&this._loopMode!==Ts.default.Realtime){var r=this._targetTimeFunc()+this._realTargetTimeOffset;if(r<e.timestamp)return;var i=this._currentTickTime;if(i<=r&&e.timestamp<i+this._jumpIgnoreThreshold*this._frameTime)return}else{var n=this._loopMode===Ts.default.Realtime?this._tickBuffer.knownLatestAge+1:this._targetAge;if(null===n||n<e.frame)return;var o=this._tickBuffer.currentAge;if(o<=n&&e.frame<o+this._jumpIgnoreThreshold)return}this.reset(e)}},t.prototype._onGameStarted=function(){this._clock.frameTrigger.add({index:0,owner:this,func:this._onEventsProcessed})},t.prototype._onEventsProcessed=function(){this._eventBuffer.processEvents("full-local"===this._sceneLocalMode)},t.prototype._setLoopRenderMode=function(t){if(t!==this._loopRenderMode)switch(this._loopRenderMode=t,t){case As.default.AfterRawFrame:this._clock.rawFrameTrigger.add(this._renderOnRawFrame,this);break;case As.default.None:this._clock.rawFrameTrigger.remove(this._renderOnRawFrame,this);break;default:this.errorTrigger.fire(new Error("GameLoop#_setLoopRenderMode: unknown mode: "+t))}},t.prototype._renderOnRawFrame=function(){this._game.render()},t.prototype._onGameRaiseEvent=function(t){this._eventBuffer.onEvent(t)},t.prototype._onGameRaiseTick=function(t){if(this._executionMode===ms.default.Active){if(t)for(var e=0;e<t.length;++e)this._eventBuffer.addEventDirect(t[e]);this._tickController.forceGenerateTick()}},t.prototype._onPollingTick=function(){var t=Date.now();t-this._lastPollingTickTime>this._pollingTickThreshold&&(this._lastPollingTickTime=t,this._tickBuffer.requestTicks())},t.prototype._startWaitingNextTick=function(){this._waitingNextTick=!0,this._clock.rawFrameTrigger.add(this._onPollingTick,this),this._lastPollingTickTime=Date.now(),this._skipping&&this._stopSkipping()},t.prototype._stopWaitingNextTick=function(){this._waitingNextTick=!1,this._clock.rawFrameTrigger.remove(this._onPollingTick,this)},t.prototype._isImmediateBeforeOf=function(t){var e;return this._tickBuffer.hasNextTick()?t<(null!==(e=this._tickBuffer.readNextTickTime())&&void 0!==e?e:this._currentTickTime+this._frameTime):this._foundLatestTick},t}();zo.GameLoop=xs,Object.defineProperty(Co,"__esModule",{value:!0}),Co.GameDriver=void 0;var bs=So,Ps=Io,Es=i,Os=Bo,ks=Eo,Ms=Oo,Ls=Wo,Rs=zo,Cs=Jo,Is="GAME_DESTROYED",Fs=function(){function t(t){this.errorTrigger=new bs.Trigger,this.configurationLoadedTrigger=new bs.Trigger,this.gameCreatedTrigger=new bs.Trigger,this._rendererRequirement=null,this._game=null,this._gameLoop=null,this._eventBuffer=null,this._openedAmflow=!1,this._playToken=null,this._permission=null,this._hidden=!1,this._destroyed=!1,t.errorHandler&&this.errorTrigger.add(t.errorHandler,t.errorHandlerOwner),this._platform=t.platform,this._loadConfigurationFunc=(0,Ps.makeLoadConfigurationFunc)(t.platform.loadGameConfiguration),this._player=t.player}return t.prototype.initialize=function(t,e){this.doInitialize(t).then((function(){e()}),e)},t.prototype.changeState=function(t,e){var r,i=this,n=this._gameLoop&&this._gameLoop.running;n&&(null===(r=this._gameLoop)||void 0===r||r.stop()),this.initialize(t,(function(t){var r;t?null==e||e(t):(n&&(null===(r=i._gameLoop)||void 0===r||r.start()),null==e||e())}))},t.prototype.startGame=function(){this._gameLoop?this._gameLoop.start():this.errorTrigger.fire(new Error("Not initialized"))},t.prototype.stopGame=function(){this._gameLoop&&this._gameLoop.stop()},t.prototype.setNextAge=function(t){var e;null===(e=this._gameLoop)||void 0===e||e.setNextAge(t)},t.prototype.getPermission=function(){return this._permission},t.prototype.getDriverConfiguration=function(){var t;return{playId:this._playId,playToken:null!==(t=this._playToken)&&void 0!==t?t:void 0,executionMode:this._gameLoop?this._gameLoop.getExecutionMode():void 0,eventBufferMode:this._eventBuffer?this._eventBuffer.getMode():void 0}},t.prototype.getLoopConfiguration=function(){return this._gameLoop?this._gameLoop.getLoopConfiguration():null},t.prototype.getHidden=function(){return this._hidden},t.prototype.resetPrimarySurface=function(t,e,r){r=r||(this._rendererRequirement?this._rendererRequirement.rendererCandidates:void 0);var i=this._game,n=this._platform,o=n.getPrimarySurface();i.renderers=i.renderers.filter((function(t){return t!==o.renderer()})),n.setRendererRequirement({primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:r}),this._rendererRequirement={primarySurfaceWidth:t,primarySurfaceHeight:e,rendererCandidates:r},i.renderers.push(n.getPrimarySurface().renderer()),i.width=t,i.height=e,i.onResized.fire({width:t,height:e}),i.modified()},t.prototype.doInitialize=function(t){var e=this,r=new Promise((function(r,i){if(e._gameLoop&&e._gameLoop.running)return i(new Error("Game is running. Must be stopped."));e._gameLoop&&t.loopConfiguration&&e._gameLoop.setLoopConfiguration(t.loopConfiguration),null!=t.hidden&&(e._hidden=t.hidden,e._game&&e._game._setMuted(t.hidden)),r()})).then((function(){return e._assertLive(),e._doSetDriverConfiguration(t.driverConfiguration)})),i=t.configurationUrl;return i?r.then((function(){return e._assertLive(),e._loadConfiguration(i,t.assetBase,t.configurationBase)})).then((function(r){return e._assertLive(),e._createGame(r,e._player,t)})):r},t.prototype.destroy=function(){var t=this;return new Promise((function(e,r){t.stopGame(),t._game&&(t._game._destroy(),t._game=null),t.errorTrigger.destroy(),t.errorTrigger=null,t.configurationLoadedTrigger.destroy(),t.configurationLoadedTrigger=null,t.gameCreatedTrigger.destroy(),t.gameCreatedTrigger=null,t._platform.destroy?t._platform.destroy():t._platform.setRendererRequirement(void 0),t._platform=null,t._loadConfigurationFunc=null,t._player=null,t._rendererRequirement=null,t._playId=void 0,t._gameLoop=null,t._eventBuffer=null,t._openedAmflow=!1,t._playToken=null,t._permission=null,t._hidden=!1,t._destroyed=!0,e()}))},t.prototype._doSetDriverConfiguration=function(t){var e,r,i=this;if(null==t)return Promise.resolve();void 0===t.playId&&(t.playId=null!==(e=this._playId)&&void 0!==e?e:void 0),void 0===t.playToken&&(t.playToken=null!==(r=this._playToken)&&void 0!==r?r:void 0),void 0===t.eventBufferMode&&(t.executionMode===ks.default.Active?t.eventBufferMode={isReceiver:!0,isSender:!1}:t.executionMode===ks.default.Passive&&(t.eventBufferMode={isReceiver:!1,isSender:!0}));var n=Promise.resolve();return this._playId!==t.playId&&(n=n.then((function(){return i._assertLive(),i._doOpenAmflow(t.playId)}))),this._playToken!==t.playToken&&(n=n.then((function(){return i._assertLive(),i._doAuthenticate(t.playToken)}))),n.then((function(){i._assertLive(),null!=t.eventBufferMode&&(null==t.eventBufferMode.defaultEventPriority&&(i._permission?t.eventBufferMode.defaultEventPriority=3&i._permission.maxEventPriority:t.eventBufferMode.defaultEventPriority=0),i._eventBuffer&&i._eventBuffer.setMode(t.eventBufferMode)),null!=t.executionMode&&i._gameLoop&&i._gameLoop.setExecutionMode(t.executionMode)}))},t.prototype._doCloseAmflow=function(){var t=this;return new Promise((function(e,r){if(!t._openedAmflow)return e();t._platform.amflow.close((function(i){t._openedAmflow=!1;var n=t._getCallbackError(i);if(n)return r(n);e()}))}))},t.prototype._doOpenAmflow=function(t){var e=this;return void 0===t?Promise.resolve():this._doCloseAmflow().then((function(){return e._assertLive(),new Promise((function(r,i){if(null===t)return r();e._platform.amflow.open(t,(function(n){var o=e._getCallbackError(n);if(o)return i(o);e._openedAmflow=!0,e._playId=t,e._game&&e._updateGamePlayId(e._game),r()}))}))}))},t.prototype._doAuthenticate=function(t){var e=this;return null==t?Promise.resolve():new Promise((function(r,i){e._platform.amflow.authenticate(t,(function(n,o){var s=e._getCallbackError(n);if(s)return i(s);o?(e._playToken=t,e._permission=o,e._game&&(e._game.rawHandlerSet.isSnapshotSaver=o.writeTick),r()):i(new Error("Permission denied."))}))}))},t.prototype._loadConfiguration=function(t,e,r){var i=this;return new Promise((function(n,o){i._loadConfigurationFunc(t,e,r,(function(t,e){var r=i._getCallbackError(t);r?o(r):e?(i.configurationLoadedTrigger.fire(e),n(e)):o(new Error("GameDriver#_loadConfiguration: No configuration found."))}))}))},t.prototype._putZerothStartPoint=function(t){var e=this;return new Promise((function(r,i){var n={frame:0,timestamp:t.startedAt,data:t};e._platform.amflow.putStartPoint(n,(function(t){var n=e._getCallbackError(t);if(n)return i(n);r()}))}))},t.prototype._getStartPoint=function(t){var e=this;return new Promise((function(r,i){e._platform.amflow.getStartPoint({frame:t},(function(t,n){var o=e._getCallbackError(t);return o?i(o):n?void r(n):i(new Error("GameDriver#_getStartPoint: No startPoint found"))}))}))},t.prototype._createGame=function(t,e,r){var i,n,o=this,s=!!(null===(i=this._permission)||void 0===i?void 0:i.writeTick),a=!((null===(n=r.driverConfiguration)||void 0===n?void 0:n.executionMode)!==ks.default.Active)&&s;if(!r.loopConfiguration)throw new Error("GameDriver#_createGame: No loopConfiguration");var h=r.loopConfiguration;return(a?this._putZerothStartPoint({seed:Date.now(),globalArgs:r.globalGameArgs,fps:t.fps,startedAt:Date.now()}):Promise.resolve()).then((function(){return o._assertLive(),o._getStartPoint(0)})).then((function(t){return a||h.loopMode!==Cs.default.Realtime?[t,t]:o._getStartPoint(Es.PSEUDO_INFINITE_AGE).then((function(e){return[t,e]}))})).then((function(i){var n=i[0],a=i[1];o._assertLive();var u=n.data;if("number"!=typeof u.seed)throw new Error("GameDriver#_createGame: No seed found in the zeroth startpoint.");var c=o._platform,l=r.driverConfiguration||{eventBufferMode:{isReceiver:!0,isSender:!1},executionMode:ks.default.Active},d=u.seed,p=r.gameArgs,f=u.globalArgs,_=u.startedAt,y={primarySurfaceWidth:t.width,primarySurfaceHeight:t.height,rendererCandidates:t.renderers};c.setRendererRequirement(y);var g=new Ls.GameHandlerSet({isSnapshotSaver:s}),v=new Ms.Game({engineModule:bs,handlerSet:g,configuration:t,selfId:e.id,player:e,resourceFactory:c.getResourceFactory(),assetBase:r.assetBase,operationPluginViewInfo:c.getOperationPluginViewInfo?c.getOperationPluginViewInfo():void 0,gameArgs:p,globalGameArgs:f}),m=new Os.EventBuffer({game:v,amflow:c.amflow}),T=l.eventBufferMode,A=l.executionMode;m.setMode(T),c.setPlatformEventHandler(m),g.setEventFilterFuncs({addFilter:m.addFilter.bind(m),removeFilter:m.removeFilter.bind(m)}),v.renderers.push(c.getPrimarySurface().renderer());var w=new Rs.GameLoop({game:v,amflow:c.amflow,platform:c,executionMode:A,eventBuffer:m,configuration:h,startedAt:_,profiler:r.profiler});w.rawTargetTimeReachedTrigger.add(v._onRawTargetTimeReached,v),g.setCurrentTimeFunc(w.getCurrentTime.bind(w)),v._reset({age:0,randSeed:d}),o._updateGamePlayId(v),o._hidden&&v._setMuted(!0),g.snapshotTrigger.add((function(t){0!==t.frame&&o._platform.amflow.putStartPoint(t,(function(t){var e=o._getCallbackError(t);e&&o.errorTrigger.fire(e)}))})),o._game=v,o._eventBuffer=m,o._gameLoop=w,o._rendererRequirement=y,o.gameCreatedTrigger.fire(v),w.reset(a)}))},t.prototype._updateGamePlayId=function(t){var e=this;t.playId=this._playId,t.external.send=function(t){e._playId&&e._platform.sendToExternal(e._playId,t)}},t.prototype._assertLive=function(){if(this._destroyed)throw new Error(Is)},t.prototype._getCallbackError=function(t){return t||(this._destroyed?new Error(Is):null)},t}();Co.GameDriver=Fs,function(e){var r=t&&t.__createBinding||(Object.create?function(t,e,r,i){void 0===i&&(i=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,i,n)}:function(t,e,r,i){void 0===i&&(i=r),t[i]=e[r]}),n=t&&t.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),e.LoopRenderMode=e.LoopMode=e.GameDriver=e.Game=e.ExecutionMode=e.SimpleProfiler=e.ReplayAmflowProxy=e.MemoryAmflowClient=void 0,n(i,e);var o=p;Object.defineProperty(e,"MemoryAmflowClient",{enumerable:!0,get:function(){return o.MemoryAmflowClient}});var s=y;Object.defineProperty(e,"ReplayAmflowProxy",{enumerable:!0,get:function(){return s.ReplayAmflowProxy}});var a=v;Object.defineProperty(e,"SimpleProfiler",{enumerable:!0,get:function(){return a.SimpleProfiler}});var h=Eo;e.ExecutionMode=h.default;var u=Oo;Object.defineProperty(e,"Game",{enumerable:!0,get:function(){return u.Game}});var c=Co;Object.defineProperty(e,"GameDriver",{enumerable:!0,get:function(){return c.GameDriver}});var l=Jo;e.LoopMode=l.default;var d=Qo;e.LoopRenderMode=d.default}(r);var Ds=r,js={},Gs={};Object.defineProperty(Gs,"__esModule",{value:!0}),Gs.Asset=void 0;var Us=b,Hs=function(){function t(t,e){this.id=t,this.originalPath=e,this.path=this._assetPathFilter(e),this.onDestroyed=new Us.Trigger}return t.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},t.prototype.destroyed=function(){return void 0===this.id},t.prototype.inUse=function(){return!1},t.prototype._assetPathFilter=function(t){return t},t}();Gs.Asset=Hs;var Bs=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(js,"__esModule",{value:!0}),js.AudioAsset=void 0;var Ns=function(t){function e(e,r,i,n,o,s,a){var h=t.call(this,e,r)||this;return h.type="audio",h.duration=i,h.loop=o,h.hint=s,h._system=n,h.data=void 0,h.offset=a,h}return Bs(e,t),e.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},e.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},e.prototype.inUse=function(){return this._system.findPlayers(this).length>0},e.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},e}(Gs.Asset);js.AudioAsset=Ns;var Ws={};Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.AudioPlayer=void 0;var Vs=b,Xs=function(){function t(t){this.onPlay=new Vs.Trigger,this.onStop=new Vs.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentAudio=void 0,this.volume=t.volume,this._muted=t._muted,this._system=t}return t.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},t.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},t.prototype.canHandleStopped=function(){return!0},t.prototype.changeVolume=function(t){this.volume=t},t.prototype._changeMuted=function(t){this._muted=t},t.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},t}();Ws.AudioPlayer=Xs;var zs={},qs=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(zs,"__esModule",{value:!0}),zs.ScriptAsset=void 0;var Ys=function(t){function e(e,r,i){void 0===i&&(i=[]);var n=t.call(this,e,r)||this;return n.type="script",n.exports=i,n.script=void 0,n}return qs(e,t),e.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},e}(Gs.Asset);zs.ScriptAsset=Ys;var Ks={},$s=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ks,"__esModule",{value:!0}),Ks.TextAsset=void 0;var Js=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.type="text",i.data=void 0,i}return $s(e,t),e.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},e}(Gs.Asset);Ks.TextAsset=Js;var Zs=So;Zs.AudioAsset=js.AudioAsset,Zs.AudioPlayer=Ws.AudioPlayer,Zs.ScriptAsset=zs.ScriptAsset,Zs.TextAsset=Ks.TextAsset;var Qs,ta,ea={},ra={},ia={},na={},oa={};function sa(){return Qs||(Qs=1,Object.defineProperty(oa,"__esModule",{value:!0}),oa.ExceptionFactory=void 0,function(t){t.createAssetLoadError=function(t,e,r){return void 0===e&&(e=!0),{name:"AssetLoadError",message:t,retriable:e,cause:r}}}(t||(oa.ExceptionFactory=t={}))),oa;var t}function aa(){if(ta)return na;ta=1,Object.defineProperty(na,"__esModule",{value:!0}),na.XHRLoader=void 0;var t=sa(),e=function(){function e(t){void 0===t&&(t={}),this.timeout=t.timeout||15e3}return e.prototype.get=function(t,e){this._getRequestObject({url:t,responseType:"text"},e)},e.prototype.getArrayBuffer=function(t,e){this._getRequestObject({url:t,responseType:"arraybuffer"},e)},e.prototype._getRequestObject=function(e,r){var i=new XMLHttpRequest;i.open("GET",e.url,!0),i.responseType=e.responseType,i.timeout=this.timeout,i.addEventListener("timeout",(function(){r(t.ExceptionFactory.createAssetLoadError("loading timeout"))}),!1),i.addEventListener("load",(function(){if(i.status>=200&&i.status<300){var n="text"===e.responseType?i.responseText:i.response;r(null,n)}else r(t.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))}),!1),i.addEventListener("error",(function(){r(t.ExceptionFactory.createAssetLoadError("loading error. status: "+i.status))}),!1),i.send()},e}();return na.XHRLoader=e,na}var ha,ua,ca={};function la(){if(ha)return ca;ha=1,Object.defineProperty(ca,"__esModule",{value:!0}),ca.Asset=void 0;var t=b,e=function(){function e(e,r){this.onDestroyed=new t.Trigger,this.id=e,this.originalPath=r,this.path=this._assetPathFilter(r)}return e.prototype.destroy=function(){this.onDestroyed.fire(this),this.id=void 0,this.originalPath=void 0,this.path=void 0,this.onDestroyed.destroy(),this.onDestroyed=void 0},e.prototype.destroyed=function(){return void 0===this.id},e.prototype.inUse=function(){return!1},e.prototype._assetPathFilter=function(t){return t},e}();return ca.Asset=e,ca}function da(){if(ua)return ia;ua=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ia,"__esModule",{value:!0}),ia.XHRTextAsset=void 0;var r=aa(),i=function(t){function i(e,r){var i=t.call(this,e,r)||this;return i.type="text",i.data="",i}return e(i,t),i.prototype._load=function(t){var e=this;(new r.XHRLoader).get(this.path,(function(r,i){r?t._onAssetError(e,r):i?(e.data=i,t._onAssetLoad(e)):t._onAssetError(e,{name:"AssetLoadError",message:"XHRTextAsset#_load(): no data received",retriable:!1})}))},i.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},i}(la().Asset);return ia.XHRTextAsset=i,ia}var pa,fa={};var _a,ya,ga={},va={},ma={},Ta={};function Aa(){if(_a)return Ta;_a=1,Object.defineProperty(Ta,"__esModule",{value:!0}),Ta.preventEventDefault=Ta.InputEventHandler=void 0;var t=b,e=function(){function e(e){this.inputView=e,this.pointerEventLock={},this._xScale=1,this._yScale=1,this.pointTrigger=new t.Trigger,e.style.touchAction="none",e.style.userSelect="none"}return e.isSupported=function(){return!1},e.prototype.setScale=function(t,e){void 0===e&&(e=t),this._xScale=t,this._yScale=e},e.prototype.pointDown=function(t,e,r){this.pointTrigger.fire({type:0,identifier:t,offset:this.getOffsetFromEvent(e),button:r}),this.pointerEventLock[t]=!0},e.prototype.pointMove=function(t,e,r){this.pointerEventLock.hasOwnProperty(t+"")&&this.pointTrigger.fire({type:1,identifier:t,offset:this.getOffsetFromEvent(e),button:r})},e.prototype.pointUp=function(t,e,r){this.pointerEventLock.hasOwnProperty(t+"")&&(this.pointTrigger.fire({type:2,identifier:t,offset:this.getOffsetFromEvent(e),button:r}),delete this.pointerEventLock[t])},e.prototype.getOffsetFromEvent=function(t){return{x:t.offsetX,y:t.offsetY}},e.prototype.getScale=function(){return{x:this._xScale,y:this._yScale}},e.prototype.getOffsetPositionFromInputView=function(t){var e=this.inputView.getBoundingClientRect(),r=this.getScale();return{offsetX:(t.pageX-Math.round(window.pageXOffset+e.left))/r.x,offsetY:(t.pageY-Math.round(window.pageYOffset+e.top))/r.y}},e}();return Ta.InputEventHandler=e,Ta.preventEventDefault=function(t){t.preventDefault()},Ta}var wa,Sa,xa,ba={};function Pa(){if(Sa)return va;Sa=1,Object.defineProperty(va,"__esModule",{value:!0}),va.InputHandlerLayer=void 0;var e=b,r=function(){if(ya)return ma;ya=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ma,"__esModule",{value:!0}),ma.MouseTouchEventHandler=void 0;var r=Aa(),i=function(t){function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.pressingMouseButton=null,e.onMouseDown=function(t){null==e.pressingMouseButton&&(e.pressingMouseButton=t.button,e.pointDown(i.MOUSE_IDENTIFIER,e.getOffsetPositionFromInputView(t),e.getPlatformButtonType(t,0)),window.addEventListener("mousemove",e.onWindowMouseMove,!1),window.addEventListener("mouseup",e.onWindowMouseUp,!1))},e.onWindowMouseMove=function(t){e.pointMove(i.MOUSE_IDENTIFIER,e.getOffsetPositionFromInputView(t),-1)},e.onWindowMouseUp=function(t){e.pressingMouseButton===t.button&&(e.pressingMouseButton=null,e.pointUp(i.MOUSE_IDENTIFIER,e.getOffsetPositionFromInputView(t),e.getPlatformButtonType(t,0)),window.removeEventListener("mousemove",e.onWindowMouseMove,!1),window.removeEventListener("mouseup",e.onWindowMouseUp,!1))},e.onTouchStart=function(t){for(var r=t.changedTouches,i=0,n=r.length;i<n;i++){var o=r[i];e.pointDown(o.identifier,e.getOffsetPositionFromInputView(o),0)}t.preventDefault()},e.onTouchMove=function(t){for(var r=t.changedTouches,i=0,n=r.length;i<n;i++){var o=r[i];e.pointMove(o.identifier,e.getOffsetPositionFromInputView(o),0)}},e.onTouchEnd=function(t){for(var r=t.changedTouches,i=0,n=r.length;i<n;i++){var o=r[i];e.pointUp(o.identifier,e.getOffsetPositionFromInputView(o),0)}window.removeEventListener("touchmove",e.onTouchMove,!1),window.removeEventListener("touchend",e.onTouchEnd,!1)},e}return e(i,t),i.isSupported=function(){return!1},i.prototype.start=function(){this.inputView.addEventListener("mousedown",this.onMouseDown,!1),this.inputView.addEventListener("touchstart",this.onTouchStart),this.inputView.addEventListener("touchmove",this.onTouchMove),this.inputView.addEventListener("touchend",this.onTouchEnd),this.inputView.addEventListener("contextmenu",r.preventEventDefault)},i.prototype.stop=function(){this.inputView.removeEventListener("mousedown",this.onMouseDown,!1),this.inputView.removeEventListener("touchstart",this.onTouchStart),this.inputView.removeEventListener("touchmove",this.onTouchMove),this.inputView.removeEventListener("touchend",this.onTouchEnd),this.inputView.removeEventListener("contextmenu",r.preventEventDefault)},i.prototype.getPlatformButtonType=function(t,e){switch(t.button){case-1:return-1;case 0:return 0;case 1:return 1;case 2:return 2;default:return e}},i.MOUSE_IDENTIFIER=1,i}(r.InputEventHandler);return ma.MouseTouchEventHandler=i,ma}(),i=function(){if(wa)return ba;wa=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ba,"__esModule",{value:!0}),ba.PointerEventHandler=void 0;var r=Aa(),i=function(t){function i(e){var r=t.call(this,e)||this;return r.onPointerDown=function(t){r.pointDown(t.pointerId,r.getOffsetPositionFromInputView(t),r.getPlatformButtonType(t,0));var e=function(t){r.pointMove(t.pointerId,r.getOffsetPositionFromInputView(t),r.getPlatformButtonType(t,-1))},i=function(e){if(r.pointUp(e.pointerId,r.getOffsetPositionFromInputView(e),r.getPlatformButtonType(e,0)),t.pointerId===e.pointerId){var i=r._eventHandlersMap[e.pointerId];if(!i)return;var n=i.onPointerMove,o=i.onPointerUp;window.removeEventListener("pointermove",n,!1),window.removeEventListener("pointerup",o,!1),delete r._eventHandlersMap[e.pointerId]}};window.addEventListener("pointermove",e,!1),window.addEventListener("pointerup",i,!1),r._eventHandlersMap[t.pointerId]={onPointerMove:e,onPointerUp:i}},r._eventHandlersMap=Object.create(null),r}return e(i,t),i.isSupported=function(){return!1},i.prototype.start=function(){this.inputView.addEventListener("pointerdown",this.onPointerDown,!1),this.inputView.addEventListener("contextmenu",r.preventEventDefault,!1)},i.prototype.stop=function(){this.inputView.removeEventListener("pointerdown",this.onPointerDown,!1),this.inputView.removeEventListener("contextmenu",r.preventEventDefault,!1)},i.prototype.getPlatformButtonType=function(t,e){switch(t.button){case-1:return-1;case 0:return 0;case 1:return 1;case 2:return 2;default:return e}},i}(r.InputEventHandler);return ba.PointerEventHandler=i,ba}(),n=function(){function t(t){this.view=this._createInputView(t.width,t.height),this._inputHandler=void 0,this.pointEventTrigger=new e.Trigger}return t.prototype.enablePointerEvent=function(){var t=this,e=!!window.PointerEvent;this._inputHandler=e?new i.PointerEventHandler(this.view):new r.MouseTouchEventHandler(this.view),this._inputHandler.pointTrigger.add((function(e){t.pointEventTrigger.fire(e)})),this._inputHandler.start()},t.prototype.disablePointerEvent=function(){var t;null===(t=this._inputHandler)||void 0===t||t.stop()},t.prototype.setOffset=function(t){var e="position:relative; left:".concat(t.x,"px; top:").concat(t.y,"px");this._inputHandler.inputView.setAttribute("style",e)},t.prototype.setViewSize=function(t){var e=this.view;e.style.width=t.width+"px",e.style.height=t.height+"px"},t.prototype.setViewTabIndex=function(t){this.view.setAttribute("tabindex",t)},t.prototype._createInputView=function(t,e){var r=document.createElement("div");return r.setAttribute("style","display:inline-block; outline:none; touch-action:none"),r.style.width=t+"px",r.style.height=e+"px",r.setAttribute("tabindex","0"),r},t}();return va.InputHandlerLayer=n,va}var Ea,Oa={};function ka(){if(Ea)return Oa;Ea=1,Object.defineProperty(Oa,"__esModule",{value:!0}),Oa.AudioPluginManager=void 0;var t=function(){function t(){this._activePlugin=null}return t.prototype.getActivePlugin=function(){return this._activePlugin},t.prototype.tryInstallPlugin=function(t){for(var e=0,r=t.length;e<r;e++){var i=t[e];if(!i.isSupported)return this._activePlugin=i,!0;var n=i;if(n.isSupported())return this._activePlugin=new n,!0}return!1},t}();return Oa.AudioPluginManager=t,Oa}var Ma,La={};function Ra(){if(Ma)return La;Ma=1,Object.defineProperty(La,"__esModule",{value:!0}),La.AudioPluginRegistry=void 0;var t=[];return La.AudioPluginRegistry={addPlugin:function(e){-1===t.indexOf(e)&&t.push(e)},getRegisteredAudioPlugins:function(){return t},clear:function(){t=[]}},La}var Ca,Ia={};var Fa,Da={},ja={};var Ga,Ua,Ha={},Ba={},Na={},Wa={},Va={};function Xa(){if(Ga)return Va;Ga=1,Object.defineProperty(Va,"__esModule",{value:!0}),Va.Surface=void 0;var t=function(){function t(t,e,r){this.width=Math.ceil(t),this.height=Math.ceil(e),this._drawable=r}return t.prototype.destroy=function(){this._destroyed=!0},t.prototype.destroyed=function(){return!!this._destroyed},t}();return Va.Surface=t,Va}function za(){if(Ua)return Wa;Ua=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Wa,"__esModule",{value:!0}),Wa.CanvasSurface=void 0;var r=function(t){function r(e,r){var i=this,n=document.createElement("canvas");return i=t.call(this,e,r,n)||this,n.width=e,n.height=r,i.canvas=n,i}return e(r,t),r.prototype.destroy=function(){this.canvas.width=1,this.canvas.height=1,this.canvas=void 0,t.prototype.destroy.call(this)},r.prototype.getHTMLElement=function(){return this.canvas},r.prototype.changeVisualScale=function(t,e){var r=this.canvas.style;"transform"in r?(r.transformOrigin="0 0",r.transform="scale("+t+","+e+")"):"webkitTransform"in r?(r.webkitTransformOrigin="0 0",r.webkitTransform="scale("+t+","+e+")"):(r.width=Math.floor(t*this.width)+"px",r.height=Math.floor(e*this.width)+"px")},r}(Xa().Surface);return Wa.CanvasSurface=r,Wa}var qa,Ya,Ka,$a={},Ja={},Za={};function Qa(){if(qa)return Za;qa=1,Object.defineProperty(Za,"__esModule",{value:!0}),Za.AffineTransformer=void 0;var t=function(){function t(t){this.matrix=t?new Float32Array(t.matrix):new Float32Array([1,0,0,1,0,0])}return t.prototype.scale=function(t,e){var r=this.matrix;return r[0]*=t,r[1]*=t,r[2]*=e,r[3]*=e,this},t.prototype.translate=function(t,e){var r=this.matrix;return r[4]+=r[0]*t+r[2]*e,r[5]+=r[1]*t+r[3]*e,this},t.prototype.transform=function(t){var e=this.matrix,r=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],n=t[2]*e[0]+t[3]*e[2],o=t[2]*e[1]+t[3]*e[3],s=t[4]*e[0]+t[5]*e[2]+e[4],a=t[4]*e[1]+t[5]*e[3]+e[5];return e[0]=r,e[1]=i,e[2]=n,e[3]=o,e[4]=s,e[5]=a,this},t.prototype.setTransform=function(t){var e=this.matrix;e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]},t.prototype.copyFrom=function(t){return this.matrix.set(t.matrix),this},t}();return Za.AffineTransformer=t,Za}function th(){if(Ka)return $a;Ka=1,Object.defineProperty($a,"__esModule",{value:!0}),$a.CanvasSurfaceContext=void 0;var t=function(){if(Ya)return Ja;Ya=1,Object.defineProperty(Ja,"__esModule",{value:!0}),Ja.CanvasRenderingState=void 0;var t=Qa(),e=function(e){e?(this.fillStyle=e.fillStyle,this.globalAlpha=e.globalAlpha,this.globalCompositeOperation=e.globalCompositeOperation,this.transformer=new t.AffineTransformer(e.transformer)):(this.fillStyle="#000000",this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new t.AffineTransformer)};return Ja.CanvasRenderingState=e,Ja}(),e=function(){function e(e){this._stateStack=[],this._modifiedTransform=!1,this._context=e;var r=new t.CanvasRenderingState;this._contextFillStyle=r.fillStyle,this._contextGlobalAlpha=r.globalAlpha,this._contextGlobalCompositeOperation=r.globalCompositeOperation,this.pushState(r)}return Object.defineProperty(e.prototype,"fillStyle",{get:function(){return this.currentState().fillStyle},set:function(t){this.currentState().fillStyle=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalAlpha",{get:function(){return this.currentState().globalAlpha},set:function(t){this.currentState().globalAlpha=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalCompositeOperation",{get:function(){return this.currentState().globalCompositeOperation},set:function(t){this.currentState().globalCompositeOperation=t},enumerable:!1,configurable:!0}),e.prototype.getCanvasRenderingContext2D=function(){return this._context},e.prototype.clearRect=function(t,e,r,i){this.prerender(),this._context.clearRect(t,e,r,i)},e.prototype.save=function(){var e=new t.CanvasRenderingState(this.currentState());this.pushState(e)},e.prototype.restore=function(){this.popState()},e.prototype.scale=function(t,e){this.currentState().transformer.scale(t,e),this._modifiedTransform=!0},e.prototype.drawImage=function(t,e,r,i,n,o,s,a,h){this.prerender(),this._context.drawImage(t,e,r,i,n,o,s,a,h)},e.prototype.fillRect=function(t,e,r,i){this.prerender(),this._context.fillRect(t,e,r,i)},e.prototype.fillText=function(t,e,r,i){this.prerender(),this._context.fillText(t,e,r,i)},e.prototype.strokeText=function(t,e,r,i){this.prerender(),this._context.strokeText(t,e,r,i)},e.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e),this._modifiedTransform=!0},e.prototype.transform=function(t,e,r,i,n,o){this.currentState().transformer.transform([t,e,r,i,n,o]),this._modifiedTransform=!0},e.prototype.setTransform=function(t,e,r,i,n,o){this.currentState().transformer.setTransform([t,e,r,i,n,o]),this._modifiedTransform=!0},e.prototype.setGlobalAlpha=function(t){this.currentState().globalAlpha=t},e.prototype.getImageData=function(t,e,r,i){return this._context.getImageData(t,e,r,i)},e.prototype.putImageData=function(t,e,r,i,n,o,s){this._context.putImageData(t,e,r,i,n,o,s)},e.prototype.prerender=function(){var t=this.currentState();if(t.fillStyle!==this._contextFillStyle&&(this._context.fillStyle=t.fillStyle,this._contextFillStyle=t.fillStyle),t.globalAlpha!==this._contextGlobalAlpha&&(this._context.globalAlpha=t.globalAlpha,this._contextGlobalAlpha=t.globalAlpha),t.globalCompositeOperation!==this._contextGlobalCompositeOperation&&(this._context.globalCompositeOperation=t.globalCompositeOperation,this._contextGlobalCompositeOperation=t.globalCompositeOperation),this._modifiedTransform){var e=t.transformer;this._context.setTransform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this._modifiedTransform=!1}},e.prototype.pushState=function(t){this._stateStack.push(t)},e.prototype.popState=function(){this._stateStack.length<=1||(this._stateStack.pop(),this._modifiedTransform=!0,this._contextFillStyle=this._context.fillStyle,this._contextGlobalAlpha=this._context.globalAlpha,this._contextGlobalCompositeOperation=this._context.globalCompositeOperation)},e.prototype.currentState=function(){return this._stateStack[this._stateStack.length-1]},e}();return $a.CanvasSurfaceContext=e,$a}var eh,rh,ih,nh,oh={};function sh(){if(rh)return Na;rh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Na,"__esModule",{value:!0}),Na.Context2DSurface=void 0;var r=za(),i=th(),n=function(){if(eh)return oh;eh=1,Object.defineProperty(oh,"__esModule",{value:!0}),oh.Context2DRenderer=void 0;var t={"source-over":"source-over","source-atop":"source-atop",lighter:"lighter",copy:"copy","experimental-source-in":"source-in","experimental-source-out":"source-out","experimental-destination-atop":"destination-atop","experimental-destination-in":"destination-in","destination-out":"destination-out","destination-over":"destination-over",xor:"xor"},e=function(){function e(t){this.surface=t,this.context=t.context(),this.canvasRenderingContext2D=this.context.getCanvasRenderingContext2D()}return e.prototype.begin=function(){this.canvasRenderingContext2D.save(),this.context.save()},e.prototype.end=function(){this.canvasRenderingContext2D.restore(),this.context.restore()},e.prototype.clear=function(){this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.drawImage=function(t,e,r,i,n,o,s){this.context.drawImage(t._drawable,e,r,i,n,o,s,i,n)},e.prototype.drawSprites=function(t,e,r,i,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],r[h],i[h],n[h],o[h],s[h])},e.prototype.translate=function(t,e){this.context.translate(t,e)},e.prototype.transform=function(t){this.context.transform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.opacity=function(t){this.context.globalAlpha*=t},e.prototype.save=function(){this.context.save()},e.prototype.restore=function(){this.context.restore()},e.prototype.fillRect=function(t,e,r,i,n){this.context.fillStyle=n,this.context.fillRect(t,e,r,i)},e.prototype.setCompositeOperation=function(e){this.context.globalCompositeOperation=t[e]||"source-over"},e.prototype.setOpacity=function(t){this.context.globalAlpha=t},e.prototype.setTransform=function(t){this.context.setTransform(t[0],t[1],t[2],t[3],t[4],t[5])},e.prototype.setShaderProgram=function(t){throw new Error("Context2DRenderer#setShaderProgram() is not implemented")},e.prototype.isSupportedShaderProgram=function(){return!1},e.prototype.getContext=function(){return this.context.getCanvasRenderingContext2D()},e.prototype.flush=function(){},e.prototype._getImageData=function(t,e,r,i){return this.context.getImageData(t,e,r,i)},e.prototype._putImageData=function(t,e,r,i,n,o,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=t.width),void 0===s&&(s=t.height),this.context.putImageData(t,e,r,i,n,o,s)},e}();return oh.Context2DRenderer=e,oh}(),o=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.context=function(){if(!this._context){var t=this.canvas.getContext("2d");if(!t)throw new Error("Context2DSurface#context(): could not initialize CanvasRenderingContext2D");this._context=new i.CanvasSurfaceContext(t)}return this._context},r.prototype.renderer=function(){return this._renderer||(this._renderer=new n.Context2DRenderer(this)),this._renderer},r.prototype.changePhysicalScale=function(t,e){if(!this._context)throw new Error("Context2DSurface#changePhysicalScale(): context has not been initialized");this.canvas.width=this.width*t,this.canvas.height=this.height*e,this._context.scale(t,e)},r.prototype.isPlaying=function(){return!1},r}(r.CanvasSurface);return Na.Context2DSurface=o,Na}function ah(){if(ih)return Ba;ih=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ba,"__esModule",{value:!0}),Ba.SVGImageAsset=Ba.SVGImageAssetSurface=void 0;var r=sh(),i=Xa(),n=sa(),o=la(),s=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.renderer=function(){throw new Error("SVGImageAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(i.Surface);Ba.SVGImageAssetSurface=s;var a=function(t){function i(e,r,i,n,o){var s=t.call(this,e,r)||this;return s.type="vector-image",s.width=i,s.height=n,s.hint=o,s.data=null,s._surface=null,s}return e(i,t),i.prototype.destroy=function(){this.data=null,this.hint=void 0,this._surface=null,t.prototype.destroy.call(this)},i.prototype._load=function(t){var e=this,r=new Image;this.hint&&this.hint.untainted&&(r.crossOrigin="anonymous"),r.onerror=function(){t._onAssetError(e,n.ExceptionFactory.createAssetLoadError("SVGImageAsset unknown loading error"))},r.onload=function(){e.data=r,t._onAssetLoad(e)},r.src=this.path},i.prototype.createSurface=function(t,e,i,n,o,a){void 0===i&&(i=0),void 0===n&&(n=0);var h=this,u=h.width,c=h.height,l=h.data;if(!l)throw new Error("SVGImageAsset#asSurface: not yet loaded.");this._surface||(this._surface=new s(u,c,l)),o||(o=u),a||(a=c);var d=new r.Context2DSurface(t,e),p=d.renderer();return p.save(),p.transform([t/o,0,0,e/a,0,0]),p.drawImage(this._surface,i,n,o,a,0,0),p.restore(),d},i}(o.Asset);return Ba.SVGImageAsset=a,Ba}var hh,uh={};var ch,lh,dh={},ph={};function fh(){if(lh)return dh;lh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(dh,"__esModule",{value:!0}),dh.HTMLVideoAsset=void 0;var r=Xa(),i=la(),n=function(){if(ch)return ph;ch=1,Object.defineProperty(ph,"__esModule",{value:!0}),ph.HTMLVideoPlayer=void 0;var t=b,e=function(){function e(e){this._loop=!!e,this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.currentVideo=void 0,this.volume=1,this.isDummy=!0}return e.prototype.play=function(t){},e.prototype.stop=function(){},e.prototype.changeVolume=function(t){},e}();return ph.HTMLVideoPlayer=e,ph}(),o=function(t){function r(e,r,i){return t.call(this,e,r,i)||this}return e(r,t),r.prototype.renderer=function(){throw new Error("VideoAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(r.Surface),s=function(t){function r(e,r,i,s,a,h,u){var c=t.call(this,e,r)||this;return c.type="video",c.width=i,c.height=s,c.realWidth=0,c.realHeight=0,c._system=a,c._loop=h,c._useRealSize=u,c._player=new n.HTMLVideoPlayer,c._surface=new o(i,s),c}return e(r,t),r.prototype.play=function(t){return this.getPlayer().play(this),this.getPlayer()},r.prototype.stop=function(){this.getPlayer().stop()},r.prototype.inUse=function(){return!1},r.prototype._load=function(t){var e=this;setTimeout((function(){t._onAssetLoad(e)}),0)},r.prototype.getPlayer=function(){return this._player},r.prototype.asSurface=function(){return this._surface},r}(i.Asset);return dh.HTMLVideoAsset=s,dh}var _h,yh={};var gh,vh={};var mh,Th={},Ah={};function wh(){return mh||(mh=1,Object.defineProperty(Ah,"__esModule",{value:!0}),Ah.RenderingHelper=void 0,function(t){t.toPowerOfTwo=function(t){if(0!=(t&t-1)){for(var e=1;e<t;)e*=2;return e}return t},t.clamp=function(t){return Math.min(Math.max(t,0),1)},t.usedWebGL=function(t){var e=!1;return t&&0<t.length&&(e="webgl"===t[0]),e}}(t||(Ah.RenderingHelper=t={}))),Ah;var t}var Sh,xh={},bh={},Ph={},Eh={},Oh={};var kh,Mh,Lh,Rh={};function Ch(){if(kh)return Rh;kh=1,Object.defineProperty(Rh,"__esModule",{value:!0}),Rh.WebGLRenderingState=void 0;var t=Qa(),e=function(){function e(e){e?(this.globalAlpha=e.globalAlpha,this.globalCompositeOperation=e.globalCompositeOperation,this.transformer=new t.AffineTransformer(e.transformer),this.shaderProgram=e.shaderProgram):(this.globalAlpha=1,this.globalCompositeOperation="source-over",this.transformer=new t.AffineTransformer,this.shaderProgram=null)}return e.prototype.copyFrom=function(t){return this.globalAlpha=t.globalAlpha,this.globalCompositeOperation=t.globalCompositeOperation,this.transformer.copyFrom(t.transformer),this.shaderProgram=t.shaderProgram,this},e}();return Rh.WebGLRenderingState=e,Rh}function Ih(){if(Mh)return Eh;Mh=1,Object.defineProperty(Eh,"__esModule",{value:!0}),Eh.WebGLRenderer=void 0;var t=function(){if(Sh)return Oh;Sh=1,Object.defineProperty(Oh,"__esModule",{value:!0}),Oh.WebGLColor=void 0;var t,e=wh();return function(t){t.colorMap={ALICEBLUE:[240/255,248/255,1,1],ANTIQUEWHITE:[250/255,235/255,215/255,1],AQUA:[0,1,1,1],AQUAMARINE:[127/255,1,212/255,1],AZURE:[240/255,1,1,1],BEIGE:[245/255,245/255,220/255,1],BISQUE:[1,228/255,196/255,1],BLACK:[0,0,0,1],BLANCHEDALMOND:[1,235/255,205/255,1],BLUE:[0,0,1,1],BLUEVIOLET:[138/255,43/255,226/255,1],BROWN:[165/255,42/255,42/255,1],BURLYWOOD:[222/255,184/255,135/255,1],CADETBLUE:[95/255,158/255,160/255,1],CHARTREUSE:[127/255,1,0,1],CHOCOLATE:[210/255,105/255,30/255,1],CORAL:[1,127/255,80/255,1],CORNFLOWERBLUE:[100/255,149/255,237/255,1],CORNSILK:[1,248/255,220/255,1],CRIMSON:[220/255,20/255,60/255,1],CYAN:[0,1,1,1],DARKBLUE:[0,0,139/255,1],DARKCYAN:[0,139/255,139/255,1],DARKGOLDENROD:[184/255,134/255,11/255,1],DARKGRAY:[169/255,169/255,169/255,1],DARKGREEN:[0,100/255,0,1],DARKGREY:[169/255,169/255,169/255,1],DARKKHAKI:[189/255,183/255,107/255,1],DARKMAGENTA:[139/255,0,139/255,1],DARKOLIVEGREEN:[85/255,107/255,47/255,1],DARKORANGE:[1,140/255,0,1],DARKORCHID:[.6,50/255,.8,1],DARKRED:[139/255,0,0,1],DARKSALMON:[233/255,150/255,122/255,1],DARKSEAGREEN:[143/255,188/255,143/255,1],DARKSLATEBLUE:[72/255,61/255,139/255,1],DARKSLATEGRAY:[47/255,79/255,79/255,1],DARKSLATEGREY:[47/255,79/255,79/255,1],DARKTURQUOISE:[0,206/255,209/255,1],DARKVIOLET:[148/255,0,211/255,1],DEEPPINK:[1,20/255,147/255,1],DEEPSKYBLUE:[0,191/255,1,1],DIMGRAY:[105/255,105/255,105/255,1],DIMGREY:[105/255,105/255,105/255,1],DODGERBLUE:[30/255,144/255,1,1],FIREBRICK:[178/255,34/255,34/255,1],FLORALWHITE:[1,250/255,240/255,1],FORESTGREEN:[34/255,139/255,34/255,1],FUCHSIA:[1,0,1,1],GAINSBORO:[220/255,220/255,220/255,1],GHOSTWHITE:[248/255,248/255,1,1],GOLD:[1,215/255,0,1],GOLDENROD:[218/255,165/255,32/255,1],GRAY:[128/255,128/255,128/255,1],GREEN:[0,128/255,0,1],GREENYELLOW:[173/255,1,47/255,1],GREY:[128/255,128/255,128/255,1],HONEYDEW:[240/255,1,240/255,1],HOTPINK:[1,105/255,180/255,1],INDIANRED:[205/255,92/255,92/255,1],INDIGO:[75/255,0,130/255,1],IVORY:[1,1,240/255,1],KHAKI:[240/255,230/255,140/255,1],LAVENDER:[230/255,230/255,250/255,1],LAVENDERBLUSH:[1,240/255,245/255,1],LAWNGREEN:[124/255,252/255,0,1],LEMONCHIFFON:[1,250/255,205/255,1],LIGHTBLUE:[173/255,216/255,230/255,1],LIGHTCORAL:[240/255,128/255,128/255,1],LIGHTCYAN:[224/255,1,1,1],LIGHTGOLDENRODYELLOW:[250/255,250/255,210/255,1],LIGHTGRAY:[211/255,211/255,211/255,1],LIGHTGREEN:[144/255,238/255,144/255,1],LIGHTGREY:[211/255,211/255,211/255,1],LIGHTPINK:[1,182/255,193/255,1],LIGHTSALMON:[1,160/255,122/255,1],LIGHTSEAGREEN:[32/255,178/255,170/255,1],LIGHTSKYBLUE:[135/255,206/255,250/255,1],LIGHTSLATEGRAY:[119/255,136/255,.6,1],LIGHTSLATEGREY:[119/255,136/255,.6,1],LIGHTSTEELBLUE:[176/255,196/255,222/255,1],LIGHTYELLOW:[1,1,224/255,1],LIME:[0,1,0,1],LIMEGREEN:[50/255,205/255,50/255,1],LINEN:[250/255,240/255,230/255,1],MAGENTA:[1,0,1,1],MAROON:[128/255,0,0,1],MEDIUMAQUAMARINE:[.4,205/255,170/255,1],MEDIUMBLUE:[0,0,205/255,1],MEDIUMORCHID:[186/255,85/255,211/255,1],MEDIUMPURPLE:[147/255,112/255,219/255,1],MEDIUMSEAGREEN:[60/255,179/255,113/255,1],MEDIUMSLATEBLUE:[123/255,104/255,238/255,1],MEDIUMSPRINGGREEN:[0,250/255,154/255,1],MEDIUMTURQUOISE:[72/255,209/255,.8,1],MEDIUMVIOLETRED:[199/255,21/255,133/255,1],MIDNIGHTBLUE:[25/255,25/255,112/255,1],MINTCREAM:[245/255,1,250/255,1],MISTYROSE:[1,228/255,225/255,1],MOCCASIN:[1,228/255,181/255,1],NAVAJOWHITE:[1,222/255,173/255,1],NAVY:[0,0,128/255,1],OLDLACE:[253/255,245/255,230/255,1],OLIVE:[128/255,128/255,0,1],OLIVEDRAB:[107/255,142/255,35/255,1],ORANGE:[1,165/255,0,1],ORANGERED:[1,69/255,0,1],ORCHID:[218/255,112/255,214/255,1],PALEGOLDENROD:[238/255,232/255,170/255,1],PALEGREEN:[152/255,251/255,152/255,1],PALETURQUOISE:[175/255,238/255,238/255,1],PALEVIOLETRED:[219/255,112/255,147/255,1],PAPAYAWHIP:[1,239/255,213/255,1],PEACHPUFF:[1,218/255,185/255,1],PERU:[205/255,133/255,63/255,1],PINK:[1,192/255,203/255,1],PLUM:[221/255,160/255,221/255,1],POWDERBLUE:[176/255,224/255,230/255,1],PURPLE:[128/255,0,128/255,1],RED:[1,0,0,1],ROSYBROWN:[188/255,143/255,143/255,1],ROYALBLUE:[65/255,105/255,225/255,1],SADDLEBROWN:[139/255,69/255,19/255,1],SALMON:[250/255,128/255,114/255,1],SANDYBROWN:[244/255,164/255,96/255,1],SEAGREEN:[46/255,139/255,87/255,1],SEASHELL:[1,245/255,238/255,1],SIENNA:[160/255,82/255,45/255,1],SILVER:[192/255,192/255,192/255,1],SKYBLUE:[135/255,206/255,235/255,1],SLATEBLUE:[106/255,90/255,205/255,1],SLATEGRAY:[112/255,128/255,144/255,1],SLATEGREY:[112/255,128/255,144/255,1],SNOW:[1,250/255,250/255,1],SPRINGGREEN:[0,1,127/255,1],STEELBLUE:[70/255,130/255,180/255,1],TAN:[210/255,180/255,140/255,1],TEAL:[0,128/255,128/255,1],THISTLE:[216/255,191/255,216/255,1],TOMATO:[1,99/255,71/255,1],TURQUOISE:[64/255,224/255,208/255,1],VIOLET:[238/255,130/255,238/255,1],WHEAT:[245/255,222/255,179/255,1],WHITE:[1,1,1,1],WHITESMOKE:[245/255,245/255,245/255,1],YELLOW:[1,1,0,1],YELLOWGREEN:[154/255,205/255,50/255,1]},t.get=function(r){var i="string"==typeof r?t._toColor(r):[r[0],r[1],r[2],r[3]];return i[3]=e.RenderingHelper.clamp(i[3]),i[0]=e.RenderingHelper.clamp(i[0])*i[3],i[1]=e.RenderingHelper.clamp(i[1])*i[3],i[2]=e.RenderingHelper.clamp(i[2])*i[3],i},t._hsl2rgb=function(t){var e=t[0]%360,r=t[1],i=t[2]>50?100-t[2]:t[2],n=t[3],o=i+i*r,s=i-i*r;return e<60?[o,e/60*(o-s)+s,s,n]:e<120?[(120-e)/60*(o-s)+s,o,s,n]:e<180?[s,o,(e-120)/60*(o-s)+s,n]:e<240?[s,(240-e)/60*(o-s)+s,o,n]:e<300?[(e-240)/60*(o-s)+s,s,o,n]:[o,s,(360-e)/60*(o-s)+s,n]},t._toColor=function(r){var i=r.toUpperCase().replace(/\s+/g,""),n=t.colorMap[i];if(n)return n;if(i.match(/^#([\dA-F])([\dA-F])([\dA-F])$/))return[parseInt(RegExp.$1,16)/15,parseInt(RegExp.$2,16)/15,parseInt(RegExp.$3,16)/15,1];if(i.match(/^#([\dA-F]{2})([\dA-F]{2})([\dA-F]{2})$/))return[parseInt(RegExp.$1,16)/255,parseInt(RegExp.$2,16)/255,parseInt(RegExp.$3,16)/255,1];if(i.match(/^RGB\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,1];if(i.match(/^RGBA\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d*)?)\)$/))return[parseInt(RegExp.$1,10)/255,parseInt(RegExp.$2,10)/255,parseInt(RegExp.$3,10)/255,parseFloat(RegExp.$4)];if(i.match(/^HSL\((\d{1,3}),(\d{1,3})%,(\d{1,3})%\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),e.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),e.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),1]);if(i.match(/^HSLA\((\d{1,3}),(\d{1,3})%,(\d{1,3})%,(\d(\.\d*)?)\)$/))return t._hsl2rgb([parseInt(RegExp.$1,10),e.RenderingHelper.clamp(parseInt(RegExp.$2,10)/100),e.RenderingHelper.clamp(parseInt(RegExp.$3,10)/100),parseFloat(RegExp.$4)]);throw Error("illigal cssColor format: "+i)}}(t||(Oh.WebGLColor=t={})),Oh}(),e=Ch(),r=function(){function r(t,e){this._stateStack=[],this._stateStackPointer=0,this._capacity=0,this._reallocation(r.DEFAULT_CAPACITY),this._whiteColor=[1,1,1,1],this._shared=t,this._renderTarget=e}return r.prototype.clear=function(){this._shared.clear()},r.prototype.begin=function(){},r.prototype.end=function(){this._shared.end()},r.prototype.save=function(){this._pushState()},r.prototype.restore=function(){this._popState()},r.prototype.translate=function(t,e){this.currentState().transformer.translate(t,e)},r.prototype.transform=function(t){this.currentState().transformer.transform(t)},r.prototype.opacity=function(t){this.currentState().globalAlpha*=t},r.prototype.setCompositeOperation=function(t){this.currentState().globalCompositeOperation=t},r.prototype.currentState=function(){return this._stateStack[this._stateStackPointer]},r.prototype.fillRect=function(e,r,i,n,o){this._shared.draw(this.currentState(),this._shared.getFillRectSurfaceTexture(),0,0,i,n,e,r,t.WebGLColor.get(o))},r.prototype.drawSprites=function(t,e,r,i,n,o,s,a){for(var h=0;h<a;++h)this.drawImage(t,e[h],r[h],i[h],n[h],o[h],s[h])},r.prototype.drawImage=function(t,e,r,i,n,o,s){if(!t._drawable)throw new Error("WebGLRenderer#drawImage: no drawable surface.");if(t._drawable.texture instanceof WebGLTexture||this._shared.makeTextureForSurface(t),!t._drawable.texture)throw new Error("WebGLRenderer#drawImage: could not create a texture.");this._shared.draw(this.currentState(),t._drawable,e,r,i,n,o,s,this._whiteColor)},r.prototype.setTransform=function(t){this.currentState().transformer.setTransform(t)},r.prototype.setOpacity=function(t){this.currentState().globalAlpha=t},r.prototype.setShaderProgram=function(t){this.currentState().shaderProgram=this._shared.initializeShaderProgram(t)},r.prototype.isSupportedShaderProgram=function(){return!0},r.prototype.changeViewportSize=function(t,e){var r=this._renderTarget;this._renderTarget={width:r.width,height:r.height,viewportWidth:t,viewportHeight:e,texture:r.texture,framebuffer:r.framebuffer}},r.prototype.getContext=function(){return this._shared.getContext()},r.prototype.flush=function(){return this._shared.flush()},r.prototype.destroy=function(){this._shared.requestDeleteRenderTarget(this._renderTarget),this._shared=void 0,this._renderTarget=void 0,this._whiteColor=void 0},r.prototype._getImageData=function(){throw new Error("WebGLRenderer#_getImageData() is not implemented")},r.prototype._putImageData=function(t,e,r,i,n,o,s){throw new Error("WebGLRenderer#_putImageData() is not implemented")},r.prototype._pushState=function(){var t=this.currentState();++this._stateStackPointer,this._isOverCapacity()&&this._reallocation(this._stateStackPointer+1),this.currentState().copyFrom(t)},r.prototype._popState=function(){if(!(this._stateStackPointer>0))throw new Error("WebGLRenderer#restore: state stack under-flow.");this.currentState().shaderProgram=null,--this._stateStackPointer},r.prototype._isOverCapacity=function(){return this._capacity<=this._stateStackPointer},r.prototype._reallocation=function(t){var r=this._capacity;if(r<t){t<2*r?this._capacity*=2:this._capacity=t;for(var i=r;i<this._capacity;++i)this._stateStack.push(new e.WebGLRenderingState)}},r.DEFAULT_CAPACITY=16,r}();return Eh.WebGLRenderer=r,Eh}var Fh,Dh,jh,Gh={},Uh={};function Hh(){if(Dh)return Gh;Dh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.WebGLPrimarySurface=void 0;var r=za(),i=function(){if(Fh)return Uh;Fh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Uh,"__esModule",{value:!0}),Uh.WebGLPrimarySurfaceRenderer=void 0;var r=function(t){function r(e,r){var i=t.call(this,e,r)||this;return i._shared.pushRenderTarget(i._renderTarget),i}return e(r,t),r.prototype.begin=function(){t.prototype.begin.call(this),this._shared.begin()},r}(Ih().WebGLRenderer);return Uh.WebGLPrimarySurfaceRenderer=r,Uh}(),n=function(t){function r(e,r,i){var n=t.call(this,r,i)||this;return n.canvas.style.position="absolute",n._shared=e,n}return e(r,t),r.prototype.renderer=function(){return this._renderer||(this._renderer=new i.WebGLPrimarySurfaceRenderer(this._shared,this._shared.getPrimaryRenderTarget(this.width,this.height))),this._renderer},r.prototype.changePhysicalScale=function(t,e){var r=Math.ceil(this.width*t),i=Math.ceil(this.height*e);this.canvas.width=r,this.canvas.height=i,this.renderer().changeViewportSize(r,i)},r.prototype.isPlaying=function(){return!1},r}(r.CanvasSurface);return Gh.WebGLPrimarySurface=n,Gh}function Bh(){if(jh)return bh;jh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(bh,"__esModule",{value:!0}),bh.WebGLBackSurface=void 0;var r=function(){if(Lh)return Ph;Lh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ph,"__esModule",{value:!0}),Ph.WebGLBackSurfaceRenderer=void 0;var r=Ih(),i=Ch(),n=function(t){function r(e,r){var i=t.call(this,r,r.createRenderTarget(e.width,e.height))||this;return e._drawable={texture:i._renderTarget.texture,textureOffsetX:0,textureOffsetY:0,textureWidth:e.width,textureHeight:e.height},i}return e(r,t),r.prototype.begin=function(){t.prototype.begin.call(this),this.save();var e=new i.WebGLRenderingState(this.currentState()),r=e.transformer.matrix;r[1]*=-1,r[3]*=-1,r[5]=-r[5]+this._renderTarget.height,this.currentState().copyFrom(e),this._shared.pushRenderTarget(this._renderTarget)},r.prototype.end=function(){this.restore(),this._shared.popRenderTarget(),t.prototype.end.call(this)},r}(r.WebGLRenderer);return Ph.WebGLBackSurfaceRenderer=n,Ph}(),i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return e(i,t),i.prototype.renderer=function(){return this._renderer||(this._renderer=new r.WebGLBackSurfaceRenderer(this,this._shared)),this._renderer},i.prototype.destroy=function(){this._renderer&&this._renderer.destroy(),this._renderer=void 0,this._drawable=void 0,t.prototype.destroy.call(this)},i}(Hh().WebGLPrimarySurface);return bh.WebGLBackSurface=i,bh}var Nh,Wh={};var Vh,Xh,zh,qh={},Yh={};function Kh(){if(Xh)return qh;Xh=1,Object.defineProperty(qh,"__esModule",{value:!0}),qh.WebGLTextureAtlas=void 0;var t=wh(),e=function(){if(Vh)return Yh;Vh=1,Object.defineProperty(Yh,"__esModule",{value:!0}),Yh.WebGLTextureMap=void 0;var t=function(){function t(t,e,r,i,n){this._left=null,this._right=null,this._surface=null,this.texture=t,this.offsetX=e,this.offsetY=r,this._width=i,this._height=n}return t.prototype.dispose=function(){this._left&&(this._left.dispose(),this._left=null),this._right&&(this._right.dispose(),this._right=null),this._surface&&(this._surface._drawable&&(this._surface._drawable.texture=null),this._surface=null)},t.prototype.capacity=function(){return this._width*this._height},t.prototype.area=function(){if(!this._surface)return 0;var t=this._surface._drawable,e=t.width*t.height;return this._left&&(e+=this._left.area()),this._right&&(e+=this._right.area()),e},t.prototype.occupancy=function(){return this.area()/this.capacity()},t.prototype.insert=function(e){var r=e._drawable,i=r.width+t.TEXTURE_MARGIN,n=r.height+t.TEXTURE_MARGIN;if(this._surface){if(this._left){var o=this._left.insert(e);if(o)return o}if(this._right){var s=this._right.insert(e);if(s)return s}return null}if(this._width<i||this._height<n)return null;var a=this._width-i,h=this._height-n;return a<=h?(this._left=new t(this.texture,this.offsetX+i,this.offsetY,a,n),this._right=new t(this.texture,this.offsetX,this.offsetY+n,this._width,h)):(this._left=new t(this.texture,this.offsetX,this.offsetY+n,i,h),this._right=new t(this.texture,this.offsetX+i,this.offsetY,a,this._height)),this._surface=e,this},t.TEXTURE_MARGIN=1,t}();return Yh.WebGLTextureMap=t,Yh}(),r=function(){function r(){this._maps=[],this._insertPos=0,this.emptyTexturePixels=new Uint8Array(r.TEXTURE_SIZE*r.TEXTURE_SIZE*4)}return r.prototype.clear=function(){for(var t=0;t<this._maps.length;++t)this._maps[t].dispose()},r.prototype.showOccupancy=function(){for(var t=0;t<this._maps.length;++t)console.log("occupancy["+t+"]: "+this._maps[t].occupancy())},r.prototype.makeTextureForSurface=function(e,i){var n=i._drawable;if(n&&!n.texture){var o=n.width,s=n.height;if(o>=r.TEXTURE_SIZE||s>=r.TEXTURE_SIZE){var a=t.RenderingHelper.toPowerOfTwo(n.width),h=t.RenderingHelper.toPowerOfTwo(n.height);if(a!==n.width||h!==n.height){var u=document.createElement("canvas");u.width=a,u.height=h;var c=u.getContext("2d");if(!c)throw new Error("WebGLTextureAtlas#makeTextureForSurface(): could not initialize CanvasRenderingContext2D");c.globalCompositeOperation="copy",c.drawImage(n,0,0),n=c.getImageData(0,0,a,h)}return i._drawable.texture=e.makeTexture(n),i._drawable.textureOffsetX=0,i._drawable.textureOffsetY=0,i._drawable.textureWidth=a,void(i._drawable.textureHeight=h)}this._assign(e,i,this._maps)}},r.prototype._assign=function(t,i,n){for(var o=null,s=0;s<n.length;++s)if(o=n[(s+this._insertPos)%n.length].insert(i))return this._register(t,o,i._drawable),void(this._insertPos=s);o=null,n.length>=r.TEXTURE_COUNT&&(o=n.shift(),t.disposeTexture(o.texture),o.dispose(),t.clearTexture(this.emptyTexturePixels,r.TEXTURE_SIZE,r.TEXTURE_SIZE,o.texture)),o||(o=new e.WebGLTextureMap(t.makeTextureRaw(r.TEXTURE_SIZE,r.TEXTURE_SIZE),0,0,r.TEXTURE_SIZE,r.TEXTURE_SIZE)),n.push(o),o=o.insert(i),this._register(t,o,i._drawable)},r.prototype._register=function(t,e,i){i.texture=e.texture,i.textureOffsetX=e.offsetX,i.textureOffsetY=e.offsetY,i.textureWidth=r.TEXTURE_SIZE,i.textureHeight=r.TEXTURE_SIZE,t.assignTexture(i,e.offsetX,e.offsetY,e.texture)},r.TEXTURE_SIZE=1024,r.TEXTURE_COUNT=16,r}();return qh.WebGLTextureAtlas=r,qh}function $h(){if(zh)return xh;zh=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.WebGLSharedObject=void 0;var t=Bh(),e=Hh(),r=function(){if(Nh)return Wh;Nh=1,Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.WebGLShaderProgram=void 0;var t=function(){function t(e,r,i){void 0===i&&(i=Object.create(null));var n=t._DEFAULT_VERTEX_SHADER;r=r||t._DEFAULT_FRAGMENT_SHADER;var o=t._makeShaderProgram(e,n,r);this.program=o,this._context=e,this._aVertex=e.getAttribLocation(this.program,"aVertex");var s=e.getUniformLocation(this.program,"uColor");if(!s)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uColor'");var a=e.getUniformLocation(this.program,"uAlpha");if(!a)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uAlpha'");var h=e.getUniformLocation(this.program,"uSampler");if(!h)throw new Error("WebGLShaderProgram#constructor: could not get UniformLocation of 'uSampler'");this._uColor=s,this._uAlpha=a,this._uSampler=h,this._uniforms=i,this._uniformCaches=[],this._uniformSetterTable={float:this._uniform1f.bind(this),int:this._uniform1i.bind(this),float_v:this._uniform1fv.bind(this),int_v:this._uniform1iv.bind(this),vec2:this._uniform2fv.bind(this),vec3:this._uniform3fv.bind(this),vec4:this._uniform4fv.bind(this),ivec2:this._uniform2iv.bind(this),ivec3:this._uniform3iv.bind(this),ivec4:this._uniform4iv.bind(this),mat2:this._uniformMatrix2fv.bind(this),mat3:this._uniformMatrix3fv.bind(this),mat4:this._uniformMatrix4fv.bind(this)}}return t._makeShader=function(t,e,r){var i=t.createShader(e);if(!i)throw new Error("WebGLShaderProgram._makeShader(): WebGLShader could not initialize");if(t.shaderSource(i,r),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var n=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error(null!=n?n:"WebGLShaderProgram._makeShader(): unknown gl error")}return i},t._makeShaderProgram=function(e,r,i){var n=e.createProgram();if(!n)throw new Error("WebGLShaderProgram._makeShaderProgram(): WebGLProgram could not initialize");var o=t._makeShader(e,e.VERTEX_SHADER,r);e.attachShader(n,o),e.deleteShader(o);var s=t._makeShader(e,e.FRAGMENT_SHADER,i);if(e.attachShader(n,s),e.deleteShader(s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){var a=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(null!=a?a:"WebGLShaderProgram._makeShaderProgram(): unknown gl error")}return n},t.prototype.set_aVertex=function(t){this._context.bindBuffer(this._context.ARRAY_BUFFER,t),this._context.enableVertexAttribArray(this._aVertex),this._context.vertexAttribPointer(this._aVertex,4,this._context.FLOAT,!1,0,0)},t.prototype.set_uColor=function(t){this._context.uniform4f(this._uColor,t[0],t[1],t[2],t[3])},t.prototype.set_uAlpha=function(t){this._context.uniform1f(this._uAlpha,t)},t.prototype.set_uSampler=function(t){this._context.uniform1i(this._uSampler,t)},t.prototype.updateUniforms=function(){for(var t=0;t<this._uniformCaches.length;++t){var e=this._uniformCaches[t],r=this._uniforms[e.name].value;(e.isArray||r!==e.beforeValue)&&(e.update(e.loc,r),e.beforeValue=r)}},t.prototype.initializeUniforms=function(){var t=this,e=[],r=this._uniforms;null!=r&&Object.keys(r).forEach((function(i){var n=r[i].type,o=!("number"==typeof r[i].value);!o||"int"!==n&&"float"!==n||(n+="_v");var s=t._uniformSetterTable[n];if(!s)throw new Error("WebGLShaderProgram#initializeUniforms: Uniform type '".concat(n,"' is not supported."));var a=t._context.getUniformLocation(t.program,i);if(!a)throw new Error("WebGLShaderProgram#initializeUniforms: could not get UniformLocation of '".concat(i,"'."));e.push({name:i,update:s,beforeValue:null,isArray:o,loc:a})})),this._uniformCaches=e},t.prototype.use=function(){this._context.useProgram(this.program)},t.prototype.unuse=function(){this._context.useProgram(null)},t.prototype.destroy=function(){this._context.deleteProgram(this.program)},t.prototype._uniform1f=function(t,e){this._context.uniform1f(t,e)},t.prototype._uniform1i=function(t,e){this._context.uniform1i(t,e)},t.prototype._uniform1fv=function(t,e){this._context.uniform1fv(t,e)},t.prototype._uniform1iv=function(t,e){this._context.uniform1iv(t,e)},t.prototype._uniform2fv=function(t,e){this._context.uniform2fv(t,e)},t.prototype._uniform3fv=function(t,e){this._context.uniform3fv(t,e)},t.prototype._uniform4fv=function(t,e){this._context.uniform4fv(t,e)},t.prototype._uniform2iv=function(t,e){this._context.uniform2iv(t,e)},t.prototype._uniform3iv=function(t,e){this._context.uniform3iv(t,e)},t.prototype._uniform4iv=function(t,e){this._context.uniform4iv(t,e)},t.prototype._uniformMatrix2fv=function(t,e){this._context.uniformMatrix2fv(t,!1,e)},t.prototype._uniformMatrix3fv=function(t,e){this._context.uniformMatrix3fv(t,!1,e)},t.prototype._uniformMatrix4fv=function(t,e){this._context.uniformMatrix4fv(t,!1,e)},t._DEFAULT_VERTEX_SHADER="#version 100\nprecision mediump float;\nattribute vec4 aVertex;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform vec4 uColor;\nuniform float uAlpha;\nvoid main() {    gl_Position = vec4(aVertex.xy, 0.0, 1.0);    vTexCoord = aVertex.zw;    vColor = uColor * uAlpha;}",t._DEFAULT_FRAGMENT_SHADER="#version 100\nprecision mediump float;\nvarying vec2 vTexCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main() {    gl_FragColor = texture2D(uSampler, vTexCoord) * vColor;}",t}();return Wh.WebGLShaderProgram=t,Wh}(),i=Kh(),n=function(){function n(t,r){this._renderTarget=void 0,this._defaultShaderProgram=void 0,this._textureAtlas=void 0,this._fillRectTexture=void 0,this._fillRectSurfaceTexture=void 0,this._maxSpriteCount=void 0,this._vertices=void 0,this._verticesCache=void 0,this._numSprites=void 0,this._renderTargetStack=void 0,this._currentTexture=void 0,this._currentColor=void 0,this._currentAlpha=void 0,this._currentCompositeOperation=void 0,this._currentShaderProgram=void 0,this._compositeOps=void 0,this._deleteRequestedTargets=void 0;var i=new e.WebGLPrimarySurface(this,t,r),n=i.canvas.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!n)throw new Error("WebGLSharedObject#constructor: could not initialize WebGLRenderingContext");this._surface=i,this._context=n,this._init()}return n.prototype.getFillRectSurfaceTexture=function(){return this._fillRectSurfaceTexture},n.prototype.getPrimarySurface=function(){return this._surface},n.prototype.createBackSurface=function(e,r){return new t.WebGLBackSurface(this,e,r)},n.prototype.pushRenderTarget=function(t){this._commit(),this._renderTargetStack.push(t),this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},n.prototype.popRenderTarget=function(){this._commit(),this._renderTargetStack.pop();var t=this.getCurrentRenderTarget();this._context.bindFramebuffer(this._context.FRAMEBUFFER,t.framebuffer),this._context.viewport(0,0,t.viewportWidth,t.viewportHeight)},n.prototype.getCurrentRenderTarget=function(){return this._renderTargetStack[this._renderTargetStack.length-1]},n.prototype.begin=function(){this.clear(),this._currentShaderProgram.use(),this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0),this._currentShaderProgram.updateUniforms()},n.prototype.clear=function(){this._context.clear(this._context.COLOR_BUFFER_BIT)},n.prototype.draw=function(t,e,r,i,n,o,s,a,h){var u;if(this._numSprites>=this._maxSpriteCount&&this._commit(),u=e===this._fillRectSurfaceTexture||null==t.shaderProgram||null==t.shaderProgram._program?this._defaultShaderProgram:t.shaderProgram._program,this._currentShaderProgram!==u&&(this._commit(),this._currentShaderProgram=u,this._currentShaderProgram.use(),this._currentShaderProgram.updateUniforms(),this._currentCompositeOperation=null,this._currentAlpha=null,this._currentColor=[],this._currentTexture=null),this._currentTexture!==e.texture&&(this._currentTexture=e.texture,this._commit(),this._context.bindTexture(this._context.TEXTURE_2D,e.texture)),this._currentColor[0]===h[0]&&this._currentColor[1]===h[1]&&this._currentColor[2]===h[2]&&this._currentColor[3]===h[3]||(this._currentColor=h,this._commit(),this._currentShaderProgram.set_uColor(h)),this._currentAlpha!==t.globalAlpha&&(this._currentAlpha=t.globalAlpha,this._commit(),this._currentShaderProgram.set_uAlpha(t.globalAlpha)),this._currentCompositeOperation!==t.globalCompositeOperation){this._currentCompositeOperation=t.globalCompositeOperation,this._commit();var c=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(c[0],c[1])}var l=1/e.textureWidth,d=1/e.textureHeight,p=e.textureOffsetX,f=e.textureOffsetY,_=l*(p+r+n),y=d*(f+i+o),g=l*(p+r),v=d*(f+i);this._register(this._transformVertex(s,a,n,o,t.transformer),[g,v,_,v,_,y,g,v,_,y,g,y])},n.prototype.end=function(){if(this._commit(),this._deleteRequestedTargets.length>0){for(var t=0;t<this._deleteRequestedTargets.length;++t)this.deleteRenderTarget(this._deleteRequestedTargets[t]);this._deleteRequestedTargets=[]}},n.prototype.makeTextureForSurface=function(t){this._textureAtlas.makeTextureForSurface(this,t)},n.prototype.disposeTexture=function(t){this._currentTexture===t&&this._commit()},n.prototype.assignTexture=function(t,e,r,i){if(this._context.bindTexture(this._context.TEXTURE_2D,i),t instanceof HTMLVideoElement)throw new Error("WebGLRenderer#assignTexture: HTMLVideoElement is not supported.");this._context.texSubImage2D(this._context.TEXTURE_2D,0,e,r,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},n.prototype.clearTexture=function(t,e,r,i){this._context.bindTexture(this._context.TEXTURE_2D,i),this._context.texSubImage2D(this._context.TEXTURE_2D,0,0,0,e,r,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture)},n.prototype.makeTextureRaw=function(t,e,r){void 0===r&&(r=null);var i=this._context.createTexture();if(!i)throw new Error("WebGLSharedObject#makeTextureRaw(): could not create WebGLTexture");return this._context.bindTexture(this._context.TEXTURE_2D,i),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,t,e,0,this._context.RGBA,this._context.UNSIGNED_BYTE,r),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),i},n.prototype.makeTexture=function(t){var e=this._context.createTexture();if(!e)throw new Error("WebGLSharedObject#makeTexture(): could not create WebGLTexture");return this._context.bindTexture(this._context.TEXTURE_2D,e),this._context.pixelStorei(this._context.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_S,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_WRAP_T,this._context.CLAMP_TO_EDGE),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MAG_FILTER,this._context.NEAREST),this._context.texParameteri(this._context.TEXTURE_2D,this._context.TEXTURE_MIN_FILTER,this._context.NEAREST),(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData)&&this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA,this._context.RGBA,this._context.UNSIGNED_BYTE,t),this._context.bindTexture(this._context.TEXTURE_2D,this._currentTexture),e},n.prototype.getPrimaryRenderTarget=function(t,e){return this._renderTarget},n.prototype.createRenderTarget=function(t,e){var r=this._context,i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i);var n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0),r.bindTexture(r.TEXTURE_2D,this._currentTexture);var o=this.getCurrentRenderTarget();return r.bindFramebuffer(r.FRAMEBUFFER,o.framebuffer),{width:t,height:e,viewportWidth:t,viewportHeight:e,framebuffer:i,texture:n}},n.prototype.requestDeleteRenderTarget=function(t){this._deleteRequestedTargets.push(t)},n.prototype.deleteRenderTarget=function(t){var e=this._context;this.getCurrentRenderTarget()===t&&this._commit(),e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)},n.prototype.getContext=function(){return this._context},n.prototype.getDefaultShaderProgram=function(){return this._defaultShaderProgram},n.prototype.initializeShaderProgram=function(t){if(t&&!t._program){var e=new r.WebGLShaderProgram(this._context,t.fragmentShader,t.uniforms);e.initializeUniforms(),t._program=e}return t},n.prototype.flush=function(){this._commit()},n.prototype._init=function(){var t=new r.WebGLShaderProgram(this._context);this._textureAtlas=new i.WebGLTextureAtlas,this._fillRectTexture=this.makeTextureRaw(1,1,new Uint8Array([255,255,255,255])),this._fillRectSurfaceTexture={texture:this._fillRectTexture,textureWidth:1,textureHeight:1,textureOffsetX:0,textureOffsetY:0},this._renderTarget={width:this._surface.width,height:this._surface.height,viewportWidth:this._surface.width,viewportHeight:this._surface.height,framebuffer:null,texture:null},this._maxSpriteCount=1024,this._vertices=this._makeBuffer(24*this._maxSpriteCount*4),this._verticesCache=new Float32Array(24*this._maxSpriteCount),this._numSprites=0,this._currentTexture=null,this._currentColor=[1,1,1,1],this._currentAlpha=1,this._currentCompositeOperation="source-over",this._currentShaderProgram=t,this._defaultShaderProgram=t,this._renderTargetStack=[],this._deleteRequestedTargets=[],this._currentShaderProgram.use();try{this._currentShaderProgram.set_aVertex(this._vertices),this._currentShaderProgram.set_uColor(this._currentColor),this._currentShaderProgram.set_uAlpha(this._currentAlpha),this._currentShaderProgram.set_uSampler(0)}finally{this._currentShaderProgram.unuse()}this._context.enable(this._context.BLEND),this._context.activeTexture(this._context.TEXTURE0),this._context.bindTexture(this._context.TEXTURE_2D,this._fillRectTexture),this._compositeOps={"source-atop":[this._context.DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA],"experimental-source-in":[this._context.DST_ALPHA,this._context.ZERO],"experimental-source-out":[this._context.ONE_MINUS_DST_ALPHA,this._context.ZERO],"source-over":[this._context.ONE,this._context.ONE_MINUS_SRC_ALPHA],"experimental-destination-atop":[this._context.ONE_MINUS_DST_ALPHA,this._context.SRC_ALPHA],"experimental-destination-in":[this._context.ZERO,this._context.SRC_ALPHA],"destination-out":[this._context.ZERO,this._context.ONE_MINUS_SRC_ALPHA],"destination-over":[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE],lighter:[this._context.ONE,this._context.ONE],copy:[this._context.ONE,this._context.ZERO],xor:[this._context.ONE_MINUS_DST_ALPHA,this._context.ONE_MINUS_SRC_ALPHA]};var e=this._compositeOps[this._currentCompositeOperation];this._context.blendFunc(e[0],e[1])},n.prototype._makeBuffer=function(t){var e=this._context.createBuffer();if(!e)throw new Error("WebGLSharedObject#_makeBuffer(): could not create WebGLBuffer");return this._context.bindBuffer(this._context.ARRAY_BUFFER,e),this._context.bufferData(this._context.ARRAY_BUFFER,t,this._context.DYNAMIC_DRAW),e},n.prototype._transformVertex=function(t,e,r,i,n){var o=this.getCurrentRenderTarget(),s=2/o.width,a=-2/o.height,h=n.matrix,u=s*r*h[0],c=a*r*h[1],l=s*i*h[2],d=a*i*h[3],p=s*(t*h[0]+e*h[2]+h[4])-1,f=a*(t*h[1]+e*h[3]+h[5])+1;return[p,f,u+p,c+f,u+l+p,c+d+f,p,f,u+l+p,c+d+f,l+p,d+f]},n.prototype._register=function(t,e){var r=6*this._numSprites;++this._numSprites;for(var i=0;i<6;++i)this._verticesCache[4*(i+r)+0]=t[2*i+0],this._verticesCache[4*(i+r)+1]=t[2*i+1],this._verticesCache[4*(i+r)+2]=e[2*i+0],this._verticesCache[4*(i+r)+3]=e[2*i+1]},n.prototype._commit=function(){this._numSprites>0&&(this._context.bindBuffer(this._context.ARRAY_BUFFER,this._vertices),this._context.bufferSubData(this._context.ARRAY_BUFFER,0,this._verticesCache.subarray(0,24*this._numSprites)),this._context.drawArrays(this._context.TRIANGLES,0,6*this._numSprites),this._numSprites=0)},n}();return xh.WebGLSharedObject=n,xh}var Jh,Zh,Qh,tu,eu={};function ru(){if(Zh)return Th;Zh=1,Object.defineProperty(Th,"__esModule",{value:!0}),Th.SurfaceFactory=void 0;var t=sh(),e=wh(),r=$h(),i=function(){if(Jh)return eu;Jh=1,Object.defineProperty(eu,"__esModule",{value:!0}),eu.CanvasDisposer=void 0;var t=function(){function t(){this._idCounter=0,this._canvasMap={},this._registry="undefined"!=typeof FinalizationRegistry?new FinalizationRegistry(this._dispose.bind(this)):null}return t.prototype.register=function(t,e){if(this._registry){var r="".concat(this._idCounter++);this._canvasMap[r]=e,this._registry.register(t,r)}},t.prototype._dispose=function(t){var e=this._canvasMap[t];e&&(e.width=1,e.height=1,delete this._canvasMap[t])},t}();return eu.CanvasDisposer=t,eu}(),n=function(){function n(){this._disposer=new i.CanvasDisposer}return n.prototype.createPrimarySurface=function(i,n,o){return e.RenderingHelper.usedWebGL(o)?(this._shared||(this._shared=new r.WebGLSharedObject(i,n)),this._shared.getPrimarySurface()):new t.Context2DSurface(i,n)},n.prototype.createBackSurface=function(r,i,n){var o=e.RenderingHelper.usedWebGL(n)?this._shared.createBackSurface(r,i):new t.Context2DSurface(r,i);return this._disposer.register(o,o.getHTMLElement()),o},n}();return Th.SurfaceFactory=n,Th}function iu(){if(Qh)return Da;Qh=1,Object.defineProperty(Da,"__esModule",{value:!0}),Da.ResourceFactory=void 0;var e=function(){if(Fa)return ja;Fa=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ja,"__esModule",{value:!0}),ja.BinaryAsset=void 0;var r=aa(),i=function(t){function i(e,r){var i=t.call(this,e,r)||this;return i.type="binary",i.data=void 0,i}return e(i,t),i.prototype.destroy=function(){this.data=void 0,t.prototype.destroy.call(this)},i.prototype._load=function(t){var e=this;(new r.XHRLoader).getArrayBuffer(this.path,(function(r,i){r?t._onAssetError(e,r):null!=i?(e.data=i,t._onAssetLoad(e)):t._onAssetError(e,{name:"AssetLoadError",retriable:!1,message:"BinaryAsset#_load(): no data received"})}))},i}(la().Asset);return ja.BinaryAsset=i,ja}(),r=function(){if(nh)return Ha;nh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Ha,"__esModule",{value:!0}),Ha.GeneratedSVGImageAsset=void 0;var r=sa(),i=function(t){function i(e,r,i){var n=t.call(this,e,r,0,0)||this;return n._svgString=i,n}return e(i,t),i.prototype.destroy=function(){this._svgString=null,t.prototype.destroy.call(this)},i.prototype._load=function(t){var e,i=this,o=this._svgString,s=new DOMParser;try{var a=s.parseFromString(o,"text/xml").getElementsByTagName("svg")[0],h=a.getAttribute("width"),u=a.getAttribute("height");if(null==h)throw new Error("must give width in the root element.");if(null==u)throw new Error("must give height in the root element.");if(!n(h))throw new Error('the width in the root element must be given in "px" units');if(!n(u))throw new Error('the height in the root element must be given in "px" units');e=window.btoa(o),this.width=parseFloat(h),this.height=parseFloat(u)}catch(e){return void t._onAssetError(this,r.ExceptionFactory.createAssetLoadError(e.message,!1,e))}var c=new Image;c.onerror=function(e){t._onAssetError(i,r.ExceptionFactory.createAssetLoadError("GeneratedSVGImageAsset: unknown loading error",void 0,e))},c.onload=function(){i.data=c,t._onAssetLoad(i)},c.src="data:image/svg+xml;base64,"+e},i}(ah().SVGImageAsset);function n(t){return/^[+-]?(?:(?:[0-9]+(?:\.[0-9]*)?)|(?:\.[0-9]+))(?:[eE][+-]?[0-9]+)?(?:px)?$/.test(t)}return Ha.GeneratedSVGImageAsset=i,Ha}(),i=function(){if(hh)return uh;hh=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(uh,"__esModule",{value:!0}),uh.HTMLImageAsset=uh.ImageAssetSurface=void 0;var r=Xa(),i=sa(),n=la(),o=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype.renderer=function(){throw new Error("ImageAssetSurface cannot be rendered.")},r.prototype.isPlaying=function(){return!1},r}(r.Surface);uh.ImageAssetSurface=o;var s=function(t){function r(e,r,i,n){var o=t.call(this,e,r)||this;return o.type="image",o.width=i,o.height=n,o.data=void 0,o._surface=void 0,o}return e(r,t),r.prototype.initialize=function(t){this.hint=t},r.prototype.destroy=function(){this._surface&&!this._surface.destroyed()&&this._surface.destroy(),this.data=void 0,this._surface=void 0,t.prototype.destroy.call(this)},r.prototype._load=function(t){var e=this,r=new Image;this.hint&&this.hint.untainted&&(r.crossOrigin="anonymous"),r.onerror=function(){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("HTMLImageAsset unknown loading error"))},r.onload=function(){e.data=r,t._onAssetLoad(e)},r.src=this.path},r.prototype.asSurface=function(){if(!this.data)throw new Error("ImageAssetImpl#asSurface: not yet loaded.");return this._surface||(this._surface=new o(this.width,this.height,this.data)),this._surface},r}(n.Asset);return uh.HTMLImageAsset=s,uh}(),n=fh(),o=ah(),s=function(){if(_h)return yh;_h=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(yh,"__esModule",{value:!0}),yh.XHRScriptAsset=void 0;var r=aa(),i=function(t){function i(e,r,i){void 0===i&&(i=[]);var n=t.call(this,e,r)||this;return n.type="script",n.script="",n.exports=i,n}return e(i,t),i.prototype._load=function(t){var e=this;(new r.XHRLoader).get(this.path,(function(r,i){r?t._onAssetError(e,r):(e.script=i+"\n",t._onAssetLoad(e))}))},i.prototype.execute=function(t){return this._wrap()(t),t.module.exports},i.prototype.destroy=function(){this.script=void 0,t.prototype.destroy.call(this)},i.prototype._wrap=function(){for(var t="",e=0,r=this.exports;e<r.length;e++){var i=r[e];t+='exports["'.concat(i,'"] = typeof ').concat(i,' !== "undefined" ? ').concat(i," : undefined;\n")}return new Function("g","(function(exports, require, module, __filename, __dirname) {\n"+this.script+"\n"+t+"\n})(g.module.exports, g.module.require, g.module, g.filename, g.dirname);")},i}(la().Asset);return yh.XHRScriptAsset=i,yh}(),a=da(),h=function(){if(gh)return vh;gh=1,Object.defineProperty(vh,"__esModule",{value:!0}),vh.GlyphFactory=void 0;var t=sh();function e(e,r,i,n,s,a,h,u,c,l,d,p){var f=r<o._environmentMinimumFontSize?r/o._environmentMinimumFontSize:1,_=Math.ceil((r+2*s)*f),y=Math.ceil((r+2*a)*f),g=new t.Context2DSurface(_,y),v=g.canvas,m=v.getContext("2d");if(!m)throw new Error("createGlyphRenderedSurface(): could not initialize CanvasRenderingContext2D");var T=4294901760&e?String.fromCharCode((4294901760&e)>>>16,65535&e):String.fromCharCode(e);m.save(),m.font=p+" "+r+"px "+i,m.textAlign="left",m.textBaseline="alphabetic",m.lineJoin="bevel",1!==f&&m.scale(f,f),c>0&&(m.lineWidth=c,m.strokeStyle=l,m.strokeText(T,s,a+n)),d||(m.fillStyle=u,m.fillText(T,s,a+n));var A=m.measureText(T).width;return m.restore(),{surface:g,advanceWidth:A,imageData:h?m.getImageData(0,0,v.width,v.height):void 0}}var r=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function i(t){return-1!==r.indexOf(t)?t:'"'+t+'"'}function n(t,e,r,i,n,o,s,a,h,u){return{code:t,x:e,y:r,width:i,height:n,surface:h,offsetX:o,offsetY:s,advanceWidth:a,isSurfaceValid:u,_atlas:null}}var o=function(){function t(e,r,n,o,s,a,h,u){void 0===n&&(n=r),void 0===o&&(o="black"),void 0===s&&(s=0),void 0===a&&(a="black"),void 0===h&&(h=!1),void 0===u&&(u="normal"),this._glyphAreas=Object.create(null),this.fontFamily=e,this.fontSize=r,this.baselineHeight=n,this.fontColor=o,this.strokeWidth=s,this.strokeColor=a,this.strokeOnly=h,this.fontWeight=u,this._cssFontFamily="string"==typeof e?i(e):e.map(i).join(","),-1===this._cssFontFamily.indexOf("sans-serif")&&(this._cssFontFamily+=",sans-serif"),this._marginW=Math.ceil(.3*this.fontSize+this.strokeWidth/2),this._marginH=Math.ceil(.3*this.fontSize+this.strokeWidth/2),void 0===t._environmentMinimumFontSize&&(t._environmentMinimumFontSize=this.measureMinimumFontSize())}return t.prototype.create=function(t){var r=null,i=this._glyphAreas[t];return i||((i=function(t){for(var e=t.width,r=t.height,i=0,n=0,o=0,s=0,a=t.height;s<a;s=s+1|0)for(var h=0,u=t.width;h<u;h=h+1|0)0!==t.data[o+3]&&(h<e&&(e=h),h>i&&(i=h),s<r&&(r=s),s>n&&(n=s)),o+=4;return e===t.width?{x:0,y:0,width:0,height:0}:{x:e,y:r,width:i-e+1,height:n-r+1}}((r=e(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!0,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)).imageData)).advanceWidth=r.advanceWidth,this._glyphAreas[t]=i),function(t){return 0===t.width||0===t.height}(i)?(r&&r.surface.destroy(),n(t,0,0,0,0,0,0,i.advanceWidth,void 0,!0)):(r||(r=e(t,this.fontSize,this._cssFontFamily,this.baselineHeight,this._marginW,this._marginH,!1,this.fontColor,this.strokeWidth,this.strokeColor,this.strokeOnly,this.fontWeight)),n(t,i.x,i.y,i.width,i.height,i.x-this._marginW,i.y-this._marginH,i.advanceWidth,r.surface,!0))},t.prototype.measureMinimumFontSize=function(){var t,e=1,r=document.createElement("canvas").getContext("2d");if(!r)throw new Error("GlyphFactory#measureMinimumFontSize(): could not initialize CanvasRenderingContext2D");r.textAlign="left",r.textBaseline="alphabetic",r.lineJoin="bevel",r.font=e+"px sans-serif";var i=r.measureText("M").width;do{t=i,e+=1,r.font=e+"px sans-serif",i=r.measureText("M").width}while(t===i||e>50);return e},t}();return vh.GlyphFactory=o,vh}(),u=ru(),c=function(){function t(t){this._audioPluginManager=t.audioPluginManager,this._audioManager=t.audioManager,this._platform=t.platform,this._surfaceFactory=new u.SurfaceFactory}return t.prototype.createAudioAsset=function(t,e,r,i,n,o,s){var a=this._audioPluginManager.getActivePlugin();if(!a)throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin");var h=a.createAsset(t,e,r,i,n,o,s);return this._audioManager.registerAudioAsset(h),h.onDestroyed.addOnce(this._onAudioAssetDestroyed,this),h},t.prototype.createAudioPlayer=function(t){var e=this._audioPluginManager.getActivePlugin();if(!e)throw new Error("ResourceFactory#createAudioAsset(): could not initialize ActivePlugin");return e.createPlayer(t,this._audioManager)},t.prototype.createImageAsset=function(t,e,r,n){return new i.HTMLImageAsset(t,e,r,n)},t.prototype.createVideoAsset=function(t,e,r,i,o,s,a){return new n.HTMLVideoAsset(t,e,r,i,o,s,a)},t.prototype.createTextAsset=function(t,e){return new a.XHRTextAsset(t,e)},t.prototype.createScriptAsset=function(t,e,r){return new s.XHRScriptAsset(t,e,r)},t.prototype.createPrimarySurface=function(t,e){return this._surfaceFactory.createPrimarySurface(t,e,this._rendererCandidates)},t.prototype.createSurface=function(t,e){return this._surfaceFactory.createBackSurface(t,e,this._rendererCandidates)},t.prototype.createGlyphFactory=function(t,e,r,i,n,o,s,a){return new h.GlyphFactory(t,e,r,i,n,o,s,a)},t.prototype.createVectorImageAsset=function(t,e,r,i,n){return new o.SVGImageAsset(t,e,r,i,n)},t.prototype.createVectorImageAssetFromString=function(t,e,i){return new r.GeneratedSVGImageAsset(t,e,i)},t.prototype.createBinaryAsset=function(t,r){return new e.BinaryAsset(t,r)},t.prototype._onAudioAssetDestroyed=function(t){this._audioManager.removeAudioAsset(t)},t}();return Da.ResourceFactory=c,Da}function nu(){if(tu)return ra;tu=1,Object.defineProperty(ra,"__esModule",{value:!0}),ra.Platform=void 0;var t=da(),e=function(){if(pa)return fa;pa=1,Object.defineProperty(fa,"__esModule",{value:!0}),fa.AudioManager=void 0;var t=function(){function t(){this.audioAssets=[],this._masterVolume=1}return t.prototype.registerAudioAsset=function(t){-1===this.audioAssets.indexOf(t)&&this.audioAssets.push(t)},t.prototype.removeAudioAsset=function(t){var e=this.audioAssets.indexOf(t);-1===e&&this.audioAssets.splice(e,1)},t.prototype.setMasterVolume=function(t){this._masterVolume=t;for(var e=0;e<this.audioAssets.length;e++)this.audioAssets[e]._lastPlayedPlayer&&this.audioAssets[e]._lastPlayedPlayer.notifyMasterVolumeChanged()},t.prototype.getMasterVolume=function(){return this._masterVolume},t}();return fa.AudioManager=t,fa}(),r=function(){if(xa)return ga;xa=1,Object.defineProperty(ga,"__esModule",{value:!0}),ga.ContainerController=void 0;var t=b,e=Pa(),r=function(){function r(e){this.container=void 0,this.surface=void 0,this.inputHandlerLayer=void 0,this.rootView=void 0,this.useResizeForScaling=!1,this.pointEventTrigger=new t.Trigger,this._rendererReq=void 0,this.resourceFactory=e}return r.prototype.initialize=function(t){this._rendererReq=t.rendererRequirement,this._loadView()},r.prototype.setRootView=function(t){t!==this.rootView&&(this.rootView&&(this.unloadView(),this._loadView()),this.rootView=t,this._appendToRootView(t))},r.prototype.resetView=function(t){this.unloadView(),this._rendererReq=t,this._loadView(),this._appendToRootView(this.rootView)},r.prototype.getRenderer=function(){if(!this.surface)throw new Error("this container has no surface");return this.surface.renderer()},r.prototype.changeScale=function(t,e){this.useResizeForScaling?this.surface.changePhysicalScale(t,e):this.surface.changeVisualScale(t,e),this.inputHandlerLayer._inputHandler.setScale(t,e)},r.prototype.unloadView=function(){if(this.inputHandlerLayer.disablePointerEvent(),this.rootView)for(;this.rootView.firstChild;)this.rootView.removeChild(this.rootView.firstChild)},r.prototype.setTabIndex=function(t){this.inputHandlerLayer.setViewTabIndex(t)},r.prototype._loadView=function(){var t=this._rendererReq,r=t.primarySurfaceWidth,i=t.primarySurfaceHeight;this.container=document.createDocumentFragment(),this.inputHandlerLayer?(this.inputHandlerLayer.setViewSize({width:r,height:i}),this.inputHandlerLayer.pointEventTrigger.removeAll(),this.surface&&!this.surface.destroyed()&&(this.inputHandlerLayer.view.removeChild(this.surface.canvas),this.surface.destroy())):this.inputHandlerLayer=new e.InputHandlerLayer({width:r,height:i}),this.surface=this.resourceFactory.createPrimarySurface(r,i),this.inputHandlerLayer.view.appendChild(this.surface.getHTMLElement()),this.container.appendChild(this.inputHandlerLayer.view)},r.prototype._appendToRootView=function(t){t.appendChild(this.container),this.inputHandlerLayer.enablePointerEvent(),this.inputHandlerLayer.pointEventTrigger.add(this.pointEventTrigger.fire,this.pointEventTrigger)},r}();return ga.ContainerController=r,ga}(),i=ka(),n=Ra(),o=function(){if(Ca)return Ia;Ca=1,Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.RafLooper=void 0;var t=function(){function t(t){this._timerId=null,this._fun=t,this._prev=0}return t.prototype.start=function(){var t=this,e=function e(r){null!=t._timerId&&(t._timerId=requestAnimationFrame(e),t._fun(r-t._prev),t._prev=r)};this._timerId=requestAnimationFrame((function(r){t._timerId=requestAnimationFrame(e),t._fun(0),t._prev=r}))},t.prototype.stop=function(){null!=this._timerId&&cancelAnimationFrame(this._timerId),this._timerId=null,this._prev=0},t}();return Ia.RafLooper=t,Ia}(),s=iu(),a=function(){function a(t){this.usingPointerEvents=!0,this.containerView=t.containerView,this.audioPluginManager=new i.AudioPluginManager,t.audioPlugins&&this.audioPluginManager.tryInstallPlugin(t.audioPlugins),this.audioPluginManager.tryInstallPlugin(n.AudioPluginRegistry.getRegisteredAudioPlugins()),this._audioManager=new e.AudioManager,this.amflow=t.amflow,this._platformEventHandler=null,this._resourceFactory=t.resourceFactory||new s.ResourceFactory({audioPluginManager:this.audioPluginManager,platform:this,audioManager:this._audioManager}),this.containerController=new r.ContainerController(this._resourceFactory),this._rendererReq=null,this._disablePreventDefault=!!t.disablePreventDefault}return a.prototype.setPlatformEventHandler=function(t){this.containerController&&(this.containerController.pointEventTrigger.removeAll({owner:this._platformEventHandler}),this.containerController.pointEventTrigger.add(t.onPointEvent,t)),this._platformEventHandler=t},a.prototype.loadGameConfiguration=function(e,r){var i=new t.XHRTextAsset("(game.json)",e);i._load({_onAssetLoad:function(t){r(null,JSON.parse(i.data))},_onAssetError:function(t,e){r(e,null)}})},a.prototype.getResourceFactory=function(){return this._resourceFactory},a.prototype.setRendererRequirement=function(t){var e;t?(this._rendererReq=t,this._resourceFactory._rendererCandidates=null!==(e=this._rendererReq.rendererCandidates)&&void 0!==e?e:[],this.containerController&&!this.containerController.inputHandlerLayer?(this.containerController.initialize({rendererRequirement:t,disablePreventDefault:this._disablePreventDefault}),this.containerController.setRootView(this.containerView),this._platformEventHandler&&this.containerController.pointEventTrigger.add(this._platformEventHandler.onPointEvent,this._platformEventHandler)):this.containerController.resetView(t)):this.containerController&&this.containerController.unloadView()},a.prototype.getPrimarySurface=function(){return this.containerController.surface},a.prototype.getOperationPluginViewInfo=function(){var t=this;return{type:"pdi-browser",view:this.containerController.inputHandlerLayer.view,getScale:function(){return t.containerController.inputHandlerLayer._inputHandler.getScale()}}},a.prototype.createLooper=function(t){return new o.RafLooper(t)},a.prototype.sendToExternal=function(t,e){},a.prototype.registerAudioPlugins=function(t){return this.audioPluginManager.tryInstallPlugin(t)},a.prototype.setScale=function(t,e){this.containerController.changeScale(t,e)},a.prototype.notifyViewMoved=function(){},a.prototype.setMasterVolume=function(t){this._audioManager.setMasterVolume(t)},a.prototype.getMasterVolume=function(){return this._audioManager.getMasterVolume()},a.prototype.setTabIndex=function(t){this.containerController.setTabIndex(t)},a.prototype.destroy=function(){this.setRendererRequirement(void 0),this.setMasterVolume(0)},a}();return ra.Platform=a,ra}var ou,su={},au={};function hu(){if(ou)return au;return ou=1,Object.defineProperty(au,"__esModule",{value:!0}),au.addExtname=au.resolveExtname=au.detectSupportedFormats=void 0,au.detectSupportedFormats=function(){var t;if(-1!==navigator.userAgent.indexOf("Edge/"))return["aac"];for(var e=document.createElement("audio"),r=["ogg","m4a","aac","mp4"],i={m4a:"audio/x-m4a"},n=[],o=0,s=r.length;o<s;o++){var a=r[o],h=null!==(t=i[a])&&void 0!==t?t:"audio/"+a;try{var u=e.canPlayType(h);"no"!==u&&""!==u&&n.push(a)}catch(t){}}return n},au.resolveExtname=function(t,e){if(!t||!t.length)return null;for(var r=0,i=e;r<i.length;r++){var n="."+i[r];if(-1!==t.indexOf(n))return n}return null},au.addExtname=function(t,e){var r=t.indexOf("?");return-1===r?t+e:t.substring(0,r)+e+t.substring(r,t.length)},au}var uu,cu,lu={},du={};function pu(){if(uu)return du;uu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(du,"__esModule",{value:!0}),du.AudioAsset=void 0;var r=function(t){function r(e,r,i,n,o,s,a){var h=t.call(this,e,r)||this;return h.type="audio",h.data=void 0,h.duration=i,h.loop=o,h.hint=s,h._system=n,h.offset=a,h.path=h._modifyPath(h.path),h}return e(r,t),r.prototype.play=function(){var t=this._system.createPlayer();return t.play(this),this._lastPlayedPlayer=t,t},r.prototype.stop=function(){for(var t=this._system.findPlayers(this),e=0;e<t.length;++e)t[e].stop()},r.prototype.inUse=function(){return this._system.findPlayers(this).length>0},r.prototype.destroy=function(){this._system&&this.stop(),this.data=void 0,this._system=void 0,this._lastPlayedPlayer=void 0,t.prototype.destroy.call(this)},r}(la().Asset);return du.AudioAsset=r,du}var fu,_u={},yu={};function gu(){if(fu)return yu;fu=1,Object.defineProperty(yu,"__esModule",{value:!0}),yu.AudioPlayer=void 0;var t=b,e=function(){function e(e){this.onPlay=new t.Trigger,this.onStop=new t.Trigger,this.played=this.onPlay,this.stopped=this.onStop,this.volume=1,this._muted=!1,this._system=e}return e.prototype.play=function(t){this.currentAudio=t,this.onPlay.fire({player:this,audio:t})},e.prototype.stop=function(){var t=this.currentAudio;t&&(this.currentAudio=void 0,this.onStop.fire({player:this,audio:t}))},e.prototype.canHandleStopped=function(){return!0},e.prototype.changeVolume=function(t){this.volume=t},e.prototype._changeMuted=function(t){},e.prototype._notifyVolumeChanged=function(){this.changeVolume(this.volume)},e}();return yu.AudioPlayer=e,yu}var vu,mu,Tu,Au={};function wu(){if(vu)return Au;vu=1,Object.defineProperty(Au,"__esModule",{value:!0}),Au.setupChromeMEIWorkaround=void 0;var t=0,e=[];function r(){i(),document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}function i(){t=2,e.forEach((function(t){return t.play()})),e=[]}return Au.setupChromeMEIWorkaround=function(n){var o=null;function s(){switch(t){case 0:case 1:i()}t=2,clearTimeout(o)}switch(t){case 0:n.addEventListener("play",s,!0),o=window.setTimeout((function(){switch(n.removeEventListener("play",s),t){case 0:e.push(n),t=1,document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0);break;case 1:e.push(n);break;case 2:n.play()}}),100);break;case 1:e.push(n)}},Au}function Su(){if(Tu)return su;Tu=1,Object.defineProperty(su,"__esModule",{value:!0}),su.HTMLAudioPlugin=void 0;var e=hu(),r=function(){if(cu)return lu;cu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(lu,"__esModule",{value:!0}),lu.HTMLAudioAsset=void 0;var r=pu(),i=sa(),n=hu(),o=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e._intervalId=-1,e._intervalCount=0,e}return e(r,t),r.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout((function(){return t._onAssetLoad(e)}),0);var o=this.createAudioElement(),s=function(t,r){o.autoplay=!1,o.preload="none",o.src=t,e._attachAll(o,r),o.preload="auto",h(o,r),o.load()},a={success:function(){e._detachAll(o,a),e.data=o,t._onAssetLoad(e),window.clearInterval(e._intervalId)},error:function(){e._detachAll(o,a),e.data=o,t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("HTMLAudioAsset loading error")),window.clearInterval(e._intervalId)}},h=function(t,r){e._intervalCount=0,e._intervalId=window.setInterval((function(){4===t.readyState?r.success():(++e._intervalCount,600===e._intervalCount&&r.error())}),100)},u=this.path.indexOf("?");if(".aac"!==(u>=0?this.path.substring(0,u):this.path).slice(-4)||-1===r.supportedFormats.indexOf("mp4"))s(this.path,a);else{var c={success:a.success,error:function(){e._detachAll(o,c),window.clearInterval(e._intervalId),e.path=(0,n.addExtname)(e.originalPath,".mp4"),s(e.path,a)}};s(this.path,c)}},r.prototype.cloneElement=function(){return this.data?this.createAudioElement(this.data.src):null},r.prototype._assetPathFilter=function(t){return-1!==r.supportedFormats.indexOf("ogg")?(0,n.addExtname)(t,".ogg"):-1!==r.supportedFormats.indexOf("aac")?(0,n.addExtname)(t,".aac"):null},r.prototype._modifyPath=function(t){var e,i=(0,n.resolveExtname)(null===(e=this.hint)||void 0===e?void 0:e.extensions,r.supportedFormats);return i?(0,n.addExtname)(this.originalPath,i):t},r.prototype.createAudioElement=function(t){return new Audio(t)},r.prototype._attachAll=function(t,e){e.success&&t.addEventListener("canplaythrough",e.success,!1),e.error&&(t.addEventListener("stalled",e.error,!1),t.addEventListener("error",e.error,!1),t.addEventListener("abort",e.error,!1))},r.prototype._detachAll=function(t,e){e.success&&t.removeEventListener("canplaythrough",e.success,!1),e.error&&(t.removeEventListener("stalled",e.error,!1),t.removeEventListener("error",e.error,!1),t.removeEventListener("abort",e.error,!1))},r}(r.AudioAsset);return lu.HTMLAudioAsset=o,lu}(),i=function(){if(mu)return _u;mu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(_u,"__esModule",{value:!0}),_u.HTMLAudioPlayer=void 0;var r=gu(),i=wu(),n=function(t){function r(e,r){var i=t.call(this,e)||this;return i._audioInstance=null,i._isWaitingPlayEvent=!1,i._isStopRequested=!1,i._manager=r,i._endedEventHandler=function(){i._onAudioEnded()},i._onPlayEventHandler=function(){i._onPlayEvent()},i._dummyDurationWaitTimer=null,i}return e(r,t),r.prototype.play=function(e){var r;this.currentAudio&&this.stop();var n=e.cloneElement();if(n){if(void 0===e.offset)n.loop=e.loop;else{var o=(null!==(r=e.offset)&&void 0!==r?r:0)/1e3,s=e.duration/1e3+o;n.currentTime=o,n.ontimeupdate=function(){s<=n.currentTime&&(e.loop?n.currentTime=o:n.pause())},n.onended=function(){e.loop&&(n.currentTime=o,n.play())}}(0,i.setupChromeMEIWorkaround)(n),n.volume=this._calculateVolume(),n.play().catch((function(t){})),n.addEventListener("ended",this._endedEventHandler,!1),n.addEventListener("play",this._onPlayEventHandler,!1),this._isWaitingPlayEvent=!0,this._audioInstance=n}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},r.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._audioInstance&&(this._isWaitingPlayEvent?this._isStopRequested=!0:(this._audioInstance.pause(),this._audioInstance=null)),t.prototype.stop.call(this)):t.prototype.stop.call(this)},r.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},r.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},r.prototype.notifyMasterVolumeChanged=function(){this._audioInstance&&(this._audioInstance.volume=this._calculateVolume())},r.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},r.prototype._clearEndedEventHandler=function(){this._audioInstance&&this._audioInstance.removeEventListener("ended",this._endedEventHandler,!1),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},r.prototype._onPlayEvent=function(){var t;this._isWaitingPlayEvent&&(this._isWaitingPlayEvent=!1,this._isStopRequested&&(this._isStopRequested=!1,null===(t=this._audioInstance)||void 0===t||t.pause(),this._audioInstance=null))},r.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},r}(r.AudioPlayer);return _u.HTMLAudioPlayer=n,_u}(),n=function(){function t(){this._supportedFormats=[],this.supportedFormats=(0,e.detectSupportedFormats)()}return t.isSupported=function(){var t=document.createElement("audio"),e=!1;try{e=void 0!==t.canPlayType}catch(t){}return e},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.HTMLAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s,a){return new r.HTMLAudioAsset(t,e,i,n,o,s,a)},t.prototype.createPlayer=function(t,e){return new i.HTMLAudioPlayer(t,e)},t}();return su.HTMLAudioPlugin=n,su}var xu,bu={},Pu={};var Eu,Ou,ku={};function Mu(){if(Ou)return bu;Ou=1,Object.defineProperty(bu,"__esModule",{value:!0}),bu.ProxyAudioPlugin=void 0;var e=function(){if(xu)return Pu;xu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.ProxyAudioAsset=void 0;var r=pu(),i=sa(),n=function(t){function r(e,r,i,n,o,s,a,h){var u=t.call(this,r,i,n,o,s,a,h)||this;return u._handlerSet=e,u}return e(r,t),r.prototype.destroy=function(){this._handlerSet.unloadAudioAsset(this.id),t.prototype.destroy.call(this)},r.prototype._load=function(t){var e=this;this._handlerSet.loadAudioAsset({id:this.id,assetPath:this.path,duration:this.duration,loop:this.loop,hint:this.hint,offset:this.offset},(function(r){r?t._onAssetError(e,i.ExceptionFactory.createAssetLoadError(r)):t._onAssetLoad(e)}))},r.prototype._assetPathFilter=function(t){return t},r.prototype._modifyPath=function(t){return t},r}(r.AudioAsset);return Pu.ProxyAudioAsset=n,Pu}(),r=function(){if(Eu)return ku;Eu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ku,"__esModule",{value:!0}),ku.ProxyAudioPlayer=void 0;var r=function(t){function r(e,r,i){var n=t.call(this,r)||this;return n._audioPlayerId=null,n._handlerSet=e,n._manager=i,n}return e(r,t),r.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._notifyVolumeToHandler()},r.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._notifyVolumeToHandler()},r.prototype.play=function(e){null!=this._audioPlayerId&&this.stop(),this._audioPlayerId="ap".concat(r._audioPlayerIdCounter++),this._handlerSet.createAudioPlayer({assetId:e.id,audioPlayerId:this._audioPlayerId,isPlaying:!0,volume:this._calculateVolume(),playbackRate:1}),t.prototype.play.call(this,e)},r.prototype.stop=function(){null!=this._audioPlayerId&&(this._handlerSet.stopAudioPlayer(this._audioPlayerId),this._handlerSet.destroyAudioPlayer(this._audioPlayerId),this._audioPlayerId=null),t.prototype.stop.call(this)},r.prototype.notifyMasterVolumeChanged=function(){this._notifyVolumeToHandler()},r.prototype._notifyVolumeToHandler=function(){null!=this._audioPlayerId&&this._handlerSet.changeAudioVolume(this._audioPlayerId,this._calculateVolume())},r.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},r._audioPlayerIdCounter=0,r}(gu().AudioPlayer);return ku.ProxyAudioPlayer=r,ku}(),i=function(){function t(t){this.supportedFormats=[],this._handlerSet=t}return t.isSupported=function(){return!0},t.prototype.createAsset=function(t,r,i,n,o,s,a){return new e.ProxyAudioAsset(this._handlerSet,t,r,i,n,o,s,a)},t.prototype.createPlayer=function(t,e){return new r.ProxyAudioPlayer(this._handlerSet,t,e)},t}();return bu.ProxyAudioPlugin=i,bu}var Lu,Ru,Cu,Iu,Fu,Du={},ju={};function Gu(){if(Ru)return Lu;Ru=1;var t,e=window.AudioContext||window.webkitAudioContext;return function(t){t.getAudioContext=function(){window.__akashic__||Object.defineProperty(window,"__akashic__",{value:{},enumerable:!1,configurable:!1,writable:!1});var r=window.__akashic__.audioContext;return r instanceof e||(r=window.__akashic__.audioContext=new e,t._workAroundSafari()),r},t.createGainNode=function(t){return t.createGain?t.createGain():t.createGainNode()},t.createBufferNode=function(t){var e=t.createBufferSource();return e.start||(e.start=e.noteOn,e.stop=e.noteOff),e},t._workAroundSafari=function(){document.addEventListener("touchstart",(function e(){document.removeEventListener("touchstart",e),t.getAudioContext().createBufferSource().start(0)}),!0)}}(t||(t={})),Lu=t}function Uu(){if(Fu)return Iu;Fu=1;var t,e=Gu();function r(){e.getAudioContext().resume(),document.removeEventListener("keydown",r),document.removeEventListener("mousedown",r),document.removeEventListener("touchend",r)}return function(t){t.setupChromeMEIWorkaround=function(){var t=e.getAudioContext();if(!t||"function"==typeof t.resume){var i=e.createGainNode(t),n=t.createOscillator();n.type="sawtooth",n.frequency.value=440,n.connect(i),n.start(0);var o=t.state;n.disconnect(),"running"!==o&&(document.addEventListener("keydown",r,!0),document.addEventListener("mousedown",r,!0),document.addEventListener("touchend",r,!0))}}}(t||(t={})),Iu=t}var Hu,Bu,Nu,Wu,Vu,Xu={};function zu(){if(Bu)return Du;Bu=1,Object.defineProperty(Du,"__esModule",{value:!0}),Du.WebAudioPlugin=void 0;var e=hu(),r=function(){if(Cu)return ju;Cu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(ju,"__esModule",{value:!0}),ju.WebAudioAsset=void 0;var r=pu(),i=sa(),n=aa(),o=hu(),s=Gu(),a=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return e(r,t),r.prototype._load=function(t){var e=this;if(null==this.path)return this.data=null,void setTimeout((function(){return t._onAssetLoad(e)}),0);var r=function(r){e.data=r,t._onAssetLoad(e)},a=function(){t._onAssetError(e,i.ExceptionFactory.createAssetLoadError("WebAudioAsset unknown loading error"))},h=function(t){s.getAudioContext().decodeAudioData(t,r,a)},u=new n.XHRLoader,c=function(t,e,r){u.getArrayBuffer(t,(function(t,i){t?r(t):e(i)}))},l=this.path.indexOf("?");".aac"!==(l>=0?this.path.substring(0,l):this.path).slice(-4)?c(this.path,h,a):c(this.path,h,(function(t){var r=(0,o.addExtname)(e.originalPath,".mp4");c(r,(function(t){e.path=r,h(t)}),a)}))},r.prototype._assetPathFilter=function(t){return-1!==r.supportedFormats.indexOf("ogg")?(0,o.addExtname)(t,".ogg"):-1!==r.supportedFormats.indexOf("aac")?(0,o.addExtname)(t,".aac"):null},r.prototype._modifyPath=function(t){var e,i=(0,o.resolveExtname)(null===(e=this.hint)||void 0===e?void 0:e.extensions,r.supportedFormats);return i?(0,o.addExtname)(this.originalPath,i):t},r.supportedFormats=[],r}(r.AudioAsset);return ju.WebAudioAsset=a,ju}(),i=Uu(),n=function(){if(Hu)return Xu;Hu=1;var e=t&&t.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.WebAudioPlayer=void 0;var r=gu(),i=Gu(),n=function(t){function r(e,r){var n=t.call(this,e)||this;return n._audioContext=i.getAudioContext(),n._manager=r,n._gainNode=i.createGainNode(n._audioContext),n._gainNode.connect(n._audioContext.destination),n._dummyDurationWaitTimer=null,n._endedEventHandler=function(){n._onAudioEnded()},n}return e(r,t),r.prototype.changeVolume=function(e){t.prototype.changeVolume.call(this,e),this._gainNode.gain.value=this._calculateVolume()},r.prototype._changeMuted=function(e){t.prototype._changeMuted.call(this,e),this._gainNode.gain.value=this._calculateVolume()},r.prototype.play=function(e){var r;if(this.currentAudio&&this.stop(),e.data){var n=i.createBufferNode(this._audioContext);if(n.buffer=e.data,this._gainNode.gain.value=this._calculateVolume(),n.connect(this._gainNode),this._sourceNode=n,this._sourceNode.onended=this._endedEventHandler,e.loop)n.loop=e.loop,this._sourceNode.start(0);else{var o=(null!==(r=e.offset)&&void 0!==r?r:0)/1e3;e.duration>0?this._sourceNode.start(0,o,e.duration/1e3):this._sourceNode.start(0,o)}}else this._dummyDurationWaitTimer=setTimeout(this._endedEventHandler,e.duration);t.prototype.play.call(this,e)},r.prototype.stop=function(){this.currentAudio?(this._clearEndedEventHandler(),this._sourceNode&&this._sourceNode.stop(0),t.prototype.stop.call(this)):t.prototype.stop.call(this)},r.prototype.notifyMasterVolumeChanged=function(){this._gainNode.gain.value=this._calculateVolume()},r.prototype._onAudioEnded=function(){this._clearEndedEventHandler(),t.prototype.stop.call(this)},r.prototype._clearEndedEventHandler=function(){this._sourceNode&&(this._sourceNode.onended=null),null!=this._dummyDurationWaitTimer&&(clearTimeout(this._dummyDurationWaitTimer),this._dummyDurationWaitTimer=null)},r.prototype._calculateVolume=function(){return this._system._muted?0:this.volume*this._system.volume*this._manager.getMasterVolume()},r}(r.AudioPlayer);return Xu.WebAudioPlayer=n,Xu}(),o=function(){function t(){this._supportedFormats=[],this.supportedFormats=(0,e.detectSupportedFormats)(),i.setupChromeMEIWorkaround()}return t.isSupported=function(){return"AudioContext"in window||"webkitAudioContext"in window},Object.defineProperty(t.prototype,"supportedFormats",{get:function(){return this._supportedFormats},set:function(t){this._supportedFormats=t,r.WebAudioAsset.supportedFormats=t},enumerable:!1,configurable:!0}),t.prototype.createAsset=function(t,e,i,n,o,s,a){return new r.WebAudioAsset(t,e,i,n,o,s,a)},t.prototype.createPlayer=function(t,e){return new n.WebAudioPlayer(t,e)},t}();return Du.WebAudioPlugin=o,Du}return e({gameDriver:Ds,akashicEngine:Zs,pdiBrowser:"undefined"!=typeof window?Vu?Wu:(Vu=1,Nu||(Nu=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyAudioPlugin=t.WebAudioPlugin=t.HTMLAudioPlugin=t.AudioPluginManager=t.AudioPluginRegistry=t.ResourceFactory=t.Platform=void 0;var e=nu();Object.defineProperty(t,"Platform",{enumerable:!0,get:function(){return e.Platform}});var r=Ra();Object.defineProperty(t,"AudioPluginRegistry",{enumerable:!0,get:function(){return r.AudioPluginRegistry}});var i=ka();Object.defineProperty(t,"AudioPluginManager",{enumerable:!0,get:function(){return i.AudioPluginManager}});var n=Su();Object.defineProperty(t,"HTMLAudioPlugin",{enumerable:!0,get:function(){return n.HTMLAudioPlugin}});var o=Mu();Object.defineProperty(t,"ProxyAudioPlugin",{enumerable:!0,get:function(){return o.ProxyAudioPlugin}});var s=zu();Object.defineProperty(t,"WebAudioPlugin",{enumerable:!0,get:function(){return s.WebAudioPlugin}});var a=iu();Object.defineProperty(t,"ResourceFactory",{enumerable:!0,get:function(){return a.ResourceFactory}})}(ea)),Wu=ea):null})}));
